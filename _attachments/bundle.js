(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){},{}],2:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){function Foo(){}try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};arr.constructor=Foo;return arr.foo()===42&&arr.constructor===Foo&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){if(!(this instanceof Buffer)){if(arguments.length>1)return new Buffer(arg,arguments[1]);return new Buffer(arg)}this.length=0;this.parent=undefined;if(typeof arg==="number"){return fromNumber(this,arg)}if(typeof arg==="string"){return fromString(this,arg,arguments.length>1?arguments[1]:"utf8")}return fromObject(this,arg)}function fromNumber(that,length){that=allocate(that,length<0?0:checked(length)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<length;i++){that[i]=0}}return that}function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding==="")encoding="utf8";var length=byteLength(string,encoding)|0;that=allocate(that,length);that.write(string,encoding);return that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(object==null){throw new TypeError("must start with number, buffer, array or string")}if(typeof ArrayBuffer!=="undefined"&&object.buffer instanceof ArrayBuffer){return fromTypedArray(that,object)}if(object.length)return fromArrayLike(that,object);return fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=checked(buffer.length)|0;that=allocate(that,length);buffer.copy(that,0,0,length);return that}function fromArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromTypedArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromJsonObject(that,object){var array;var length=0;if(object.type==="Buffer"&&isArray(object.data)){array=object.data;length=checked(array.length)|0}that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function allocate(that,length){if(Buffer.TYPED_ARRAY_SUPPORT){that=Buffer._augment(new Uint8Array(length))}else{that.length=length;that._isBuffer=true}var fromPool=length!==0&&length<=Buffer.poolSize>>>1;if(fromPool)that.parent=rootParent;return that}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;var i=0;var len=Math.min(x,y);while(i<len){if(a[i]!==b[i])break;++i}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(length===undefined){length=0;for(i=0;i<list.length;i++){length+=list[i].length}}var buf=new Buffer(length);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function byteLength(string,encoding){if(typeof string!=="string")string=""+string;var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;function slowToString(encoding,start,end){var loweredCase=false;start=start|0;end=end===undefined||end===Infinity?this.length:end|0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return 0;return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.get=function get(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function set(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length|0;length=swap}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+targetStart]=this[i+start]}}else{target._set(this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function toArrayBuffer(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function _augment(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.indexOf=BP.indexOf;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];var i=0;for(;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(leadSurrogate){if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}else{codePoint=leadSurrogate-55296<<10|codePoint-56320|65536;leadSurrogate=null}}else{if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}else{leadSurrogate=codePoint;continue}}}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null}if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<2097152){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":3,ieee754:4,"is-array":5}],3:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],4:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],5:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],6:[function(require,module,exports){function EventEmitter(){
this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],7:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){currentQueue[queueIndex].run()}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],8:[function(require,module,exports){var $,PouchDB;$=require("jquery");PouchDB=require("pouchdb");module.exports={database:PouchDB("coconut"),debug:function(string){console.log(string);return $("#log").append(string+"<br/>")}}},{jquery:34,pouchdb:94}],9:[function(require,module,exports){var $,Backbone,Coconut,Config,HelpView,LoginView,MenuView,Question,QuestionCollection,QuestionView,Result,ResultCollection,ResultsView,Router,SyncView,User,UserCollection,_,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Coconut=require("./Coconut");Config=require("./models/Config");HelpView=require("./views/HelpView");LoginView=require("./views/LoginView");MenuView=require("./views/MenuView");Question=require("./models/Question");QuestionCollection=require("./models/QuestionCollection");QuestionView=require("./views/QuestionView");Result=require("./models/Result");ResultsView=require("./views/ResultsView");ResultCollection=require("./models/ResultCollection");SyncView=require("./views/SyncView");User=require("./models/User");UserCollection=require("./models/UserCollection");Router=function(superClass){extend(Router,superClass);function Router(){this.userWithRoleLoggedIn=bind(this.userWithRoleLoggedIn,this);return Router.__super__.constructor.apply(this,arguments)}Router.prototype.routes={login:"login",logout:"logout","show/results/:question_id":"showResults","new/result/:question_id":"newResult","show/result/:result_id":"showResult","edit/result/:result_id":"editResult","delete/result/:result_id":"deleteResult","delete/result/:result_id/:confirmed":"deleteResult","reset/database":"resetDatabase",sync:"sendAndGet",configure:"configure",help:"help","help/:helpDocument":"help","":"default"};Router.prototype.userLoggedIn=function(callback){return User.isAuthenticated({success:function(user){Coconut.menuView.render();return callback.success(user)},error:function(){Coconut.loginView.callback=callback;return Coconut.loginView.render()}})};Router.prototype.help=function(helpDocument){return this.userLoggedIn({success:function(){if(Coconut.helpView==null){Coconut.helpView=new HelpView}if(helpDocument!=null){Coconut.helpView.helpDocument=helpDocument}else{Coconut.helpView.helpDocument=null}return Coconut.helpView.render()}})};Router.prototype.login=function(){Coconut.loginView.callback={success:function(){return Coconut.router.navigate("",true)}};return Coconut.loginView.render()};Router.prototype.userWithRoleLoggedIn=function(role,callback){return this.userLoggedIn({success:function(user){if(user.hasRole(role)){return callback.success(user)}else{return $("#content").html("<h2>User '"+user.username()+"' must have role: '"+role+"'</h2>")}},error:function(){return $("#content").html("<h2>User '"+user.username()+"' must have role: '"+role+"'</h2>")}})};Router.prototype.adminLoggedIn=function(callback){return this.userLoggedIn({success:function(user){if(user.isAdmin()){return callback.success(user)}},error:function(){return $("#content").html("<h2>Must be an admin user</h2>")}})};Router.prototype.logout=function(){User.logout();Coconut.router.navigate("",true);return document.location.reload()};Router.prototype["default"]=function(){return this.userLoggedIn({success:function(){if(User.currentUser.hasRole("reports")){Coconut.router.navigate("reports",true)}return $("#content").html("")}})};Router.prototype.syncSend=function(action){Coconut.router.navigate("",false);return this.userLoggedIn({success:function(){Coconut.syncView.render();return Coconut.syncView.sync.sendToCloud({success:function(){return Coconut.syncView.update()},error:function(){return Coconut.syncView.update()}})}})};Router.prototype.syncGet=function(action){Coconut.router.navigate("",false);return this.userLoggedIn({success:function(){Coconut.syncView.render();return Coconut.syncView.sync.getFromCloud()}})};Router.prototype.sendAndGet=function(action){Coconut.router.navigate("",false);return this.userLoggedIn({success:function(){Coconut.syncView.render();return Coconut.syncView.sync.sendToCloud({success:function(){return Coconut.syncView.sync.getFromCloud({success:function(){return Coconut.debug("Refreshing app in 5 seconds, please wait")}})},error:function(){return Coconut.syncView.sync.getFromCloud()}})}})};Router.prototype.newResult=function(question_id){return this.userLoggedIn({success:function(){Coconut.questionView.result=new Result({question:unescape(question_id)});Coconut.questionView.model=new Question({id:unescape(question_id)});return Coconut.questionView.model.fetch({success:function(){return Coconut.questionView.render()}})}})};Router.prototype.showResult=function(result_id){return this.userLoggedIn({success:function(){Coconut.questionView.readonly=true;Coconut.questionView.result=new Result({_id:result_id});return Coconut.questionView.result.fetch({success:function(){var question;question=Coconut.questionView.result.question();if(question!=null){Coconut.questionView.model=new Question({id:question});return Coconut.questionView.model.fetch({success:function(){return Coconut.questionView.render()}})}else{$("#content").html("<button id='delete' type='button'>Delete</button> <pre>"+JSON.stringify(Coconut.questionView.result,null,2)+"</pre>");return $("button#delete").click(function(){if(confirm("Are you sure you want to delete this result?")){return Coconut.questionView.result.destroy({success:function(){$("#content").html("Result deleted, redirecting...");return _.delay(function(){return Coconut.router.navigate("/",true)},2e3)}})}})}}})}})};Router.prototype.editResult=function(result_id){return this.userLoggedIn({success:function(){Coconut.questionView.readonly=false;Coconut.questionView.result=new Result({_id:result_id});return Coconut.questionView.result.fetch({success:function(){var question;question=Coconut.questionView.result.question();if(question!=null){Coconut.questionView.model=new Question({id:question});return Coconut.questionView.model.fetch({success:function(){return Coconut.questionView.render()}})}else{$("#content").html("<button id='delete' type='button'>Delete</button> <br/> (Editing not supported for USSD Notifications) <br/> <pre>"+JSON.stringify(Coconut.questionView.result,null,2)+"</pre>");return $("button#delete").click(function(){if(confirm("Are you sure you want to delete this result?")){return Coconut.questionView.result.destroy({success:function(){$("#content").html("Result deleted, redirecting...");return _.delay(function(){return Coconut.router.navigate("/",true)},2e3)}})}})}}})}})};Router.prototype.deleteResult=function(result_id,confirmed){return this.userLoggedIn({success:function(){Coconut.questionView.readonly=true;Coconut.questionView.result=new Result({_id:result_id});return Coconut.questionView.result.fetch({success:function(){var question;question=Coconut.questionView.result.question();if(question!=null){if(confirmed==="confirmed"){return Coconut.questionView.result.destroy({success:function(){Coconut.menuView.update();return Coconut.router.navigate("show/results/"+escape(Coconut.questionView.result.question()),true)}})}else{Coconut.questionView.model=new Question({id:question});return Coconut.questionView.model.fetch({success:function(){Coconut.questionView.render();$("#content").prepend("<h2>Are you sure you want to delete this result?</h2> <div id='confirm'> <a href='#delete/result/"+result_id+"/confirmed'>Yes</a> <a href='#show/results/"+escape(Coconut.questionView.result.question())+"'>Cancel</a> </div>");$("#confirm a").button();$("#content form").css({"background-color":"#333",margin:"50px",padding:"10px"});return $("#content form label").css({color:"white"})}})}}else{return Coconut.router.navigate("edit/result/"+result_id,true)}}})}})};Router.prototype.showResults=function(question_id){return this.userLoggedIn({success:function(){if(Coconut.resultsView==null){Coconut.resultsView=new ResultsView}Coconut.resultsView.question=new Question({id:unescape(question_id)});return Coconut.resultsView.question.fetch({success:function(){return Coconut.resultsView.render()}})}})};Router.prototype.resetDatabase=function(){var confirmReset;confirmReset=function(){if(confirm("Are you sure you want to reset the database? All data that has not yet been sent to the cloud will be lost.")){return Coconut.database.destroy(function(error,result){Coconut.router.navigate("",true);return document.location.reload()})}};if(Coconut.users.length===0){confirmReset()}return this.userLoggedIn({success:function(){return confirmReset()}})};Router.prototype.startApp=function(){Coconut.config=new Config;return Coconut.config.fetch({error:function(){return Coconut.debug("Error loading config")},success:function(){var classesToLoad,startApplication;$("header.coconut-drawer-header").html("<h3><span id='user'></span></h3> Last sync: <span class='sync-sent-status'></span>");$("nav.coconut-navigation").html(_(["#sync,sync,Sync data","#logout,person,Logout","#reset/database,warning,Reset database"]).map(function(linkData){var icon,linktext,ref,url;ref=linkData.split(","),url=ref[0],icon=ref[1],linktext=ref[2];return"<a class='mdl-navigation__link' href='"+url+"'><i class='mdl-color-text--accent material-icons'>"+icon+"</i>"+linktext+"</a><br/>"}).join(""),$("nav.coconut-navigation").on("click",".mdl-navigation__link",function(){return $(".mdl-layout__drawer").removeClass("is-visible")}));classesToLoad=[UserCollection,ResultCollection];startApplication=_.after(classesToLoad.length,function(){Coconut.loginView=new LoginView;Coconut.questionView=new QuestionView;Coconut.menuView=new MenuView;Coconut.syncView=new SyncView;Coconut.syncView.update();return Backbone.history.start()});return QuestionCollection.load({error:function(error){return alert("Could not load "+ClassToLoad+": "+error+". Recommendation: Press get data again.")},success:function(){return _.each(classesToLoad,function(ClassToLoad){return ClassToLoad.load({success:function(){return startApplication()},error:function(error){alert("Could not load "+ClassToLoad+": "+error+". Recommendation: Press get data again.");return startApplication()}})})}})}})};return Router}(Backbone.Router);module.exports=Router},{"./Coconut":8,"./models/Config":11,"./models/Question":12,"./models/QuestionCollection":13,"./models/Result":14,"./models/ResultCollection":15,"./models/User":17,"./models/UserCollection":18,"./views/HelpView":20,"./views/LoginView":21,"./views/MenuView":22,"./views/QuestionView":23,"./views/ResultsView":24,"./views/SyncView":25,backbone:29,jquery:34,underscore:126}],10:[function(require,module,exports){var Coconut,Utils,_;_=require("underscore");Coconut=require("./Coconut");Utils={};Utils.addOrUpdateDesignDoc=function(designDoc,options){var name;name=designDoc._id.replace(/^_design\//,"");return Coconut.database.get("_design/"+name,function(error,result){var ref,ref1;if((result!=null?(ref=result.views)!=null?(ref1=ref[name])!=null?ref1.map:void 0:void 0:void 0)===designDoc.views[name].map){return options.success()}else{console.log("Updating design doc for "+name);if(result&&result._rev){designDoc._rev=result._rev}return Coconut.database.put(designDoc).then(function(){return options.success()})}})};Utils.createDesignDoc=function(name,mapFunction){var ddoc;if(!_.isFunction(mapFunction)){mapFunction=CoffeeScript.compile(mapFunction,{bare:true})}else{mapFunction=mapFunction.toString()}ddoc={_id:"_design/"+name,views:{}};ddoc.views[name]={map:mapFunction};return ddoc};module.exports=Utils},{"./Coconut":8,underscore:126}],11:[function(require,module,exports){var $,Backbone,Coconut,Config,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;$=require("jquery");Backbone=require("backbone");Backbone.$=$;Coconut=require("../Coconut");Config=function(superClass){extend(Config,superClass);function Config(){this.cloud_url_no_http=bind(this.cloud_url_no_http,this);this.cloud_database_name=bind(this.cloud_database_name,this);this.fetch=bind(this.fetch,this);return Config.__super__.constructor.apply(this,arguments)}Config.prototype.initialize=function(){return this.set({_id:"coconut.config"})};Config.prototype.fetch=function(options){return Coconut.database.get("coconut.config",function(_this){return function(error,result){_this.set(result);return Coconut.database.get("coconut.config.local",function(error,result){Coconut.config.local=new Backbone.Model;Coconut.config.local.set(result);return typeof options.success==="function"?options.success():void 0})}}(this))};Config.prototype.title=function(){return this.get("title")||"Coconut"};Config.prototype.database_name=function(){return Coconut.database._db_name};Config.prototype.cloud_database_name=function(){return this.get("cloud_database_name")||this.database_name()};Config.prototype.cloud_url=function(){return"http://"+this.cloud_url_no_http()+"/"+this.cloud_database_name()};Config.prototype.cloud_url_with_credentials=function(){return"http://"+this.get("cloud_credentials")+"@"+this.cloud_url_no_http()+"/"+this.cloud_database_name()};Config.prototype.cloud_log_url_with_credentials=function(){return"http://"+this.get("cloud_credentials")+"@"+this.cloud_url_no_http()+"/"+this.cloud_database_name()+"-log"};Config.prototype.cloud_url_no_http=function(){return this.get("cloud").replace(/http:\/\//,"")};return Config}(Backbone.Model);module.exports=Config},{"../Coconut":8,backbone:29,jquery:34}],12:[function(require,module,exports){var $,Backbone,Question,_,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Question=function(superClass){extend(Question,superClass);function Question(){this.summaryFieldNames=bind(this.summaryFieldNames,this);this.resultSummaryFields=bind(this.resultSummaryFields,this);return Question.__super__.constructor.apply(this,arguments)}Question.prototype.initialize=function(){return this.set({collection:"result"})};Question.prototype.type=function(){return this.get("type")};Question.prototype.label=function(){if(this.get("label")!=null){return this.get("label")}else{return this.get("id")}};Question.prototype.safeLabel=function(){return this.label().replace(/[^a-zA-Z0-9 -]/g,"").replace(/[ -]/g,"")};Question.prototype.repeatable=function(){return this.get("repeatable")};Question.prototype.questions=function(){return this.get("questions")};Question.prototype.value=function(){if(this.get("value")!=null){return this.get("value")}else{return""}};Question.prototype.required=function(){if(this.get("required")!=null){return this.get("required")}else{return"true"}};Question.prototype.validation=function(){if(this.get("validation")!=null){return this.get("validation")}else{return null}};Question.prototype.skipLogic=function(){return this.get("skip_logic")||this.get("skip-logic")||""};Question.prototype.actionOnChange=function(){return this.get("action_on_change")||""};Question.prototype.attributeSafeText=function(){var returnVal;returnVal=this.get("label")!=null?this.get("label"):this.get("id");return returnVal.replace(/[^a-zA-Z0-9]/g,"")};Question.prototype.url="/question";Question.prototype.set=function(attributes){if(attributes.questions!=null){attributes.questions=_.map(attributes.questions,function(question){return new Question(question)})}if(attributes.id!=null){attributes._id=attributes.id}return Question.__super__.set.call(this,attributes)};Question.prototype.loadFromDesigner=function(domNode){var attribute,i,len,property,ref,result;result=Question.fromDomNode(domNode);if(result.length===1){result=result[0];this.set({id:result.id});ref=["label","type","repeatable","required","validation"];for(i=0,len=ref.length;i<len;i++){property=ref[i];attribute={};attribute[property]=result.get(property);this.set(attribute)}return this.set({questions:result.questions()})}else{throw"More than one root node"}};Question.prototype.resultSummaryFields=function(){var i,numberOfFields,resultSummaryFields,results,returnValue;resultSummaryFields=this.get("resultSummaryFields");if(resultSummaryFields){return resultSummaryFields}else{numberOfFields=Math.min(2,this.questions().length-1);returnValue={};_.each(function(){results=[];for(var i=0;0<=numberOfFields?i<=numberOfFields:i>=numberOfFields;0<=numberOfFields?i++:i--){results.push(i)}return results}.apply(this),function(_this){return function(index){var ref;return returnValue[(ref=_this.questions()[index])!=null?ref.label():void 0]="on"}}(this));return returnValue}};Question.prototype.summaryFieldNames=function(){return _.keys(this.resultSummaryFields())};Question.prototype.summaryFieldKeys=function(){return _.map(this.summaryFieldNames(),function(key){return key.replace(/[^a-zA-Z0-9 -]/g,"").replace(/[ -]/g,"")})};return Question}(Backbone.Model);Question.fromDomNode=function(domNode){return _(domNode).chain().map(function(_this){return function(question){var attribute,i,id,len,property,propertyValue,ref,result;question=$(question);id=question.attr("id");if(question.children("#rootQuestionName").length>0){id=question.children("#rootQuestionName").val()}if(!id){return}result=new Question;result.set({id:id});ref=["label","type","repeatable","select-options","radio-options","autocomplete-options","validation","required","action_on_questions_loaded","skip_logic","action_on_change","image-path","image-style"];for(i=0,len=ref.length;i<len;i++){property=ref[i];attribute={};propertyValue=question.find("#"+property+"-"+id).val();if(property==="required"){propertyValue=String(question.find("#"+property+"-"+id).is(":checked"))}if(propertyValue!=null){attribute[property]=propertyValue;result.set(attribute)}}result.set({safeLabel:result.safeLabel()});if(question.find(".question-definition").length>0){result.set({questions:Question.fromDomNode(question.children(".question-definition"))})}return result}}(this)).compact().value()};module.exports=Question},{backbone:29,jquery:34,underscore:126}],13:[function(require,module,exports){var $,Backbone,Coconut,Question,QuestionCollection,Utils,_,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Coconut=require("../Coconut");Question=require("./Question");Utils=require("../Utils");QuestionCollection=function(superClass){extend(QuestionCollection,superClass);function QuestionCollection(){return QuestionCollection.__super__.constructor.apply(this,arguments)}QuestionCollection.prototype.model=Question;QuestionCollection.prototype.pouch={options:{query:{include_docs:true,fun:"questions"}}};QuestionCollection.prototype.parse=function(response){return _(response.rows).pluck("doc")};QuestionCollection.load=function(options){var questionsDesignDoc;Coconut.questions=new QuestionCollection;questionsDesignDoc=Utils.createDesignDoc("questions",function(doc){if(doc.collection&&doc.collection==="question"){return emit(doc._id,doc.resultSummaryFields)}});return Utils.addOrUpdateDesignDoc(questionsDesignDoc,{success:function(){return Coconut.questions.fetch({success:function(){return options.success()}})}})};return QuestionCollection}(Backbone.Collection);module.exports=QuestionCollection},{"../Coconut":8,"../Utils":10,"./Question":12,backbone:29,jquery:34,underscore:126}],14:[function(require,module,exports){var $,Backbone,Coconut,Cookie,Result,User,_,moment,sha1,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Cookie=require("js-cookie");Backbone=require("backbone");Backbone.$=$;moment=require("moment");sha1=require("sha1");Coconut=require("../Coconut");User=require("./User");Result=function(superClass){extend(Result,superClass);function Result(){return Result.__super__.constructor.apply(this,arguments)}Result.prototype.initialize=function(){this.set({collection:"result"});if(!this.attributes.createdAt){this.set({createdAt:moment(new Date).format(Coconut.config.get("date_format"))})}if(!this.attributes.lastModifiedAt){return this.set({lastModifiedAt:moment(new Date).format(Coconut.config.get("date_format"))})}};Result.prototype.question=function(){return this.get("question")};Result.prototype.tags=function(){var tags;tags=this.get("Tags");if(tags!=null){return tags.split(/, */)}return[]};Result.prototype.complete=function(){var complete;if(_.include(this.tags(),"complete")){return true}complete=this.get("complete");if(typeof complete==="undefined"){complete=this.get("Complete")}if(complete===null||typeof complete==="undefined"){return false}if(complete===true||complete.match(/true|yes/)){return true}};Result.prototype.shortString=function(){var result;result=this.string;if(result.length>40){return result.substring(0,40)+"..."}else{return result}};Result.prototype.summaryKeys=function(question){var relevantKeys;relevantKeys=question.summaryFieldKeys();if(relevantKeys.length===0){relevantKeys=_.difference(_.keys(result.toJSON()),["_id","_rev","complete","question","collection"])}return relevantKeys};Result.prototype.summaryValues=function(question){return _.map(this.summaryKeys(question),function(_this){return function(key){var returnVal;returnVal=_this.get(key)||"";if(typeof returnVal==="object"){returnVal=JSON.stringify(returnVal)}return returnVal}}(this))};Result.prototype.get=function(attribute){var original;if(User.currentUser==null){return null}original=Result.__super__.get.call(this,attribute);if(User.currentUser.hasRole("cleaner")){return original}if(original!=null&&User.currentUser.hasRole("reports")){if(_.contains(Coconut.identifyingAttributes,attribute)){return sha1(original)}}return original};Result.prototype.toJSON=function(){var json;json=Result.__super__.toJSON.call(this);if(User.currentUser.hasRole("admin")){return json}if(User.currentUser.hasRole("reports")){_.each(json,function(_this){return function(value,key){if(value!=null&&_.contains(Coconut.identifyingAttributes,key)){return json[key]=sha1(value)}}}(this))}return json};Result.prototype.save=function(key,value,options){this.set({user:Cookie("current_user"),lastModifiedAt:moment(new Date).format(Coconut.config.get("date_format"))});return Result.__super__.save.call(this,key,value,options)};Result.prototype.wasTransferredOut=function(){var transferred,transferredTo;transferred=this.get("transferred");if(transferred!=null){transferredTo=transferred[transferred.length-1].to;if(transferredTo!==User.currentUser.id){return true}}return false};return Result}(Backbone.Model);module.exports=Result},{"../Coconut":8,"./User":17,backbone:29,jquery:34,"js-cookie":35,moment:54,sha1:123,underscore:126}],15:[function(require,module,exports){var $,Backbone,Coconut,Result,ResultCollection,Utils,_,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Coconut=require("../Coconut");Utils=require("../Utils");Result=require("./Result");ResultCollection=function(){function ResultCollection(){this.fetch=bind(this.fetch,this)}ResultCollection.prototype.fetch=function(options){var fields,queryOptions;queryOptions=_.extend({include_docs:false,startkey:[options.question,options.isComplete===true],endkey:[options.question,options.isComplete===true,{}]},options);fields=Coconut.questions.find(function(question){return question.id===options.question}).summaryFieldKeys();return Coconut.database.query("results",queryOptions,function(_this){return function(error,result){_this.results=_(result.rows).map(function(row){var returnVal;returnVal=_.object(fields,row.value);returnVal._id=row.id;return new Result(returnVal)});return options.success()}}(this))};ResultCollection.prototype.each=function(arg){return _(this.results).each(arg)};ResultCollection.load=function(options){return Coconut.questions.fetch({error:function(error){return console.log("Error loading Coconut.questions: "+JSON.stringify(error))},success:function(){var designDocs,finished;if(Coconut.questions.length===0){options.success()}designDocs={results:'(doc) ->\n  if doc.collection is "result" and doc.question and (doc.complete or doc.complete is null) and doc.createdAt\n    summaryFields = ('+(Coconut.questions.length===0?"[]":Coconut.questions.map(function(question){return"if doc.question is '"+question.id+"' then "+JSON.stringify(question.summaryFieldKeys())}).join(" else "))+')\n\n    summaryResults = []\n    for field in summaryFields\n      summaryResults.push doc[field]\n\n    emit([doc.question, doc.complete is "true", doc.createdAt], summaryResults)',resultsByQuestionNotCompleteNotTransferredOut:function(document){if(document.collection==="result"){if(document.complete!=="true"){
if(document.transferred!=null){return emit(document.question,document.transferred[document.transferred.length-1].to)}else{return emit(document.question,null)}}}},rawNotificationsConvertedToCaseNotifications:function(document){if(document.hf&&document.hasCaseNotification){return emit(document.date,null)}}};finished=_.after(_(designDocs).size(),function(){return options.success()});return _(designDocs).each(function(designDoc,name){designDoc=Utils.createDesignDoc(name,designDoc);return Utils.addOrUpdateDesignDoc(designDoc,{success:function(){return finished()}})})}})};return ResultCollection}();module.exports=ResultCollection},{"../Coconut":8,"../Utils":10,"./Result":14,backbone:29,jquery:34,underscore:126}],16:[function(require,module,exports){var $,Backbone,Coconut,Sync,_,moment,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;moment=require("moment");Coconut=require("../Coconut");Sync=function(superClass){extend(Sync,superClass);function Sync(){this.replicateApplicationDocs=bind(this.replicateApplicationDocs,this);this.getFromCloud=bind(this.getFromCloud,this);this.log=bind(this.log,this);this.sendToCloud=bind(this.sendToCloud,this);this.checkForInternet=bind(this.checkForInternet,this);this.last_get_time=bind(this.last_get_time,this);this.was_last_get_successful=bind(this.was_last_get_successful,this);this.last_send_time=bind(this.last_send_time,this);this.was_last_send_successful=bind(this.was_last_send_successful,this);this.last_send=bind(this.last_send,this);return Sync.__super__.constructor.apply(this,arguments)}Sync.prototype.initialize=function(){return this.set({_id:"SyncLog"})};Sync.prototype.target=function(){return Coconut.config.cloud_url()};Sync.prototype.last_send=function(){return this.get("last_send_result")};Sync.prototype.was_last_send_successful=function(){var last_send_data;if(this.get("last_send_error")===true){return false}last_send_data=this.last_send();if(last_send_data==null){return false}if(last_send_data.no_changes!=null&&last_send_data.no_changes===true){return true}return last_send_data.docs_read===last_send_data.docs_written&&last_send_data.doc_write_failures===0};Sync.prototype.last_send_time=function(){var result;result=this.get("last_send_time");if(result){return moment(this.get("last_send_time")).fromNow()}else{return"never"}};Sync.prototype.was_last_get_successful=function(){return this.get("last_get_success")};Sync.prototype.last_get_time=function(){var result;result=this.get("last_get_time");if(result){return moment(this.get("last_get_time")).fromNow()}else{return"never"}};Sync.prototype.checkForInternet=function(options){this.log("Checking for internet. (Is "+Coconut.config.cloud_url()+" is reachable?) Please wait.");return $.ajax({url:Coconut.config.cloud_url(),error:function(_this){return function(error){_this.log("ERROR! "+Coconut.config.cloud_url()+" is not reachable. Do you have enough airtime? Are you on WIFI?  Either the internet is not working or the site is down: "+JSON.stringify(error));options.error();return _this.save({last_send_error:true})}}(this),success:function(_this){return function(){_this.log(Coconut.config.cloud_url()+" is reachable, so internet is available.");return options.success()}}(this)})};Sync.prototype.sendToCloud=function(options){return this.fetch({error:function(_this){return function(error){return _this.log("Unable to fetch Sync doc: "+JSON.stringify(error))}}(this),success:function(_this){return function(){return _this.checkForInternet({error:function(error){return options!=null?typeof options.error==="function"?options.error(error):void 0:void 0},success:function(){_this.log("Creating list of all results on the tablet. Please wait.");return Coconut.database.query("results",{},function(error,result){var resultIDs;if(error){_this.log("Could not retrieve list of results: "+JSON.stringify(error));options.error();return _this.save({last_send_error:true})}else{_this.log("Synchronizing "+result.rows.length+" results. Please wait.");resultIDs=_.pluck(result.rows,"id");return Coconut.database.replicate.to(Coconut.config.cloud_url_with_credentials(),{doc_ids:resultIDs}).on("complete",function(info){_this.log("Success! Send data finished: created, updated or deleted "+info.docs_written+" results on the server.");_this.save({last_send_result:result,last_send_error:false,last_send_time:(new Date).getTime()});return options.success()}).on("error",function(error){return options.error(error)})}})}})}}(this)})};Sync.prototype.log=function(message){return Coconut.debug(message)};Sync.prototype.getFromCloud=function(options){return this.fetch({error:function(_this){return function(error){return _this.log("Unable to fetch Sync doc: "+JSON.stringify(error))}}(this),success:function(_this){return function(){return _this.checkForInternet({error:function(error){return options!=null?typeof options.error==="function"?options.error(error):void 0:void 0},success:function(){return _this.fetch({success:function(){return _this.replicateApplicationDocs({error:function(error){$.couch.logout();_this.log("ERROR updating application: "+JSON.stringify(error));_this.save({last_get_success:false});return options!=null?typeof options.error==="function"?options.error(error):void 0:void 0},success:function(){_this.save({last_get_success:true,last_get_time:(new Date).getTime()});if(options!=null){if(typeof options.success==="function"){options.success()}}return _.delay(function(){return document.location.reload()},5e3)}})}})}})}}(this)})};Sync.prototype.replicateApplicationDocs=function(options){return this.checkForInternet({error:function(error){return options!=null?typeof options.error==="function"?options.error(error):void 0:void 0},success:function(_this){return function(){_this.log("Getting list of application documents to replicate");return $.ajax({url:Coconut.config.cloud_url()+"/_design/coconut/_view/docIDsForUpdating",dataType:"json",include_docs:false,error:function(a,b,error){return typeof options.error==="function"?options.error(error):void 0},success:function(result){var doc_ids;doc_ids=_.pluck(result.rows,"id");doc_ids=_(doc_ids).without("_design/coconut");_this.log("Updating "+doc_ids.length+" docs <small>(users and forms: "+doc_ids.join(",")+")</small>. Please wait.");return Coconut.database.replicate.from(Coconut.config.cloud_url_with_credentials(),{doc_ids:doc_ids}).on("change",function(info){return $("#content").html("<h2> "+info.docs_written+" written out of "+doc_ids.length+" ("+parseInt(100*(info.docs_written/doc_ids.length))+"%) </h2>")}).on("complete",function(info){var resultData;resultData=_(info).chain().map(function(value,property){if(property.match(/^doc.*/)){return property+": "+value}}).compact().value();_this.log("Finished updating application documents: "+JSON.stringify(resultData));return typeof options.success==="function"?options.success():void 0}).on("error",function(error){_this.log("Error while updating application documents: "+JSON.stringify(error));return typeof options.error==="function"?options.error(error):void 0})}})}}(this)})};return Sync}(Backbone.Model);module.exports=Sync},{"../Coconut":8,backbone:29,jquery:34,moment:54,underscore:126}],17:[function(require,module,exports){var $,Backbone,Cookie,User,_,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Cookie=require("js-cookie");User=function(superClass){extend(User,superClass);function User(){return User.__super__.constructor.apply(this,arguments)}User.prototype.url="/user";User.prototype.username=function(){return this.get("_id").replace(/^user\./,"")};User.prototype.district=function(){return this.get("district")};User.prototype.passwordIsValid=function(password){return this.get("password")===password};User.prototype.isAdmin=function(){return _(this.get("roles")).include("admin")};User.prototype.hasRole=function(role){return _(this.get("roles")).include(role)};User.prototype.nameOrUsername=function(){return this.get("name")||this.username()};User.prototype.login=function(){User.currentUser=this;Cookie("current_user",this.username());$("span#user").html(this.username());$("#district").html(this.get("district"));$("a[href=#logout]").show();$("a[href=#login]").hide();if(this.isAdmin()){$("#manage-button").show()}else{$("#manage-button").hide()}if(this.hasRole("reports")){$("#top-menu").hide();return $("#bottom-menu").hide()}};User.prototype.refreshLogin=function(){return this.login()};return User}(Backbone.Model);User.isAuthenticated=function(options){var current_user_cookie,user;current_user_cookie=Cookie("current_user");if(current_user_cookie!=null&&current_user_cookie!==""){user=new User({_id:"user."+Cookie("current_user")});return user.fetch({success:function(_this){return function(){user.refreshLogin();return options.success(user)}}(this),error:function(error){console.error("Could not fetch user."+Cookie("current_user")+": "+error);return options!=null?options.error():void 0}})}else{if(options.error!=null){return options.error()}}};User.logout=function(){Cookie("current_user","");$("span#user").html("");$("#district").html("");$("a[href=#logout]").hide();$("a[href=#login]").show();return User.currentUser=null};module.exports=User},{backbone:29,jquery:34,"js-cookie":35,underscore:126}],18:[function(require,module,exports){var $,Backbone,Coconut,User,UserCollection,Utils,_,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;$=require("jquery");Backbone=require("backbone");Backbone.$=$;_=require("underscore");Coconut=require("../Coconut");User=require("./User");Utils=require("../Utils");UserCollection=function(superClass){extend(UserCollection,superClass);function UserCollection(){return UserCollection.__super__.constructor.apply(this,arguments)}UserCollection.prototype.model=User;UserCollection.prototype.pouch={options:{query:{include_docs:true,fun:"users"}}};UserCollection.prototype.parse=function(response){return _(response.rows).pluck("doc")};UserCollection.prototype.district=function(userId){if(!userId.match(/^user\./)){userId="user."+userId}return this.get(userId).get("district")};return UserCollection}(Backbone.Collection);UserCollection.load=function(options){var designDocs,finished;Coconut.users=new UserCollection;designDocs={users:function(doc){if(doc.collection&&doc.collection==="user"){return emit(doc._id,null)}},usersByDistrict:function(doc){if(doc.collection&&doc.collection==="user"){return emit(doc.district,[doc.name,doc._id.substring(5)])}}};finished=_.after(_(designDocs).size(),function(){return Coconut.users.fetch({success:function(){return options.success()}})});return _(designDocs).each(function(designDoc,name){designDoc=Utils.createDesignDoc(name,designDoc);return Utils.addOrUpdateDesignDoc(designDoc,{success:function(){return finished()}})})};module.exports=UserCollection},{"../Coconut":8,"../Utils":10,"./User":17,backbone:29,jquery:34,underscore:126}],19:[function(require,module,exports){(function(global){var $,Backbone,BackbonePouch,Coconut,Config,Router,Sync,_,appCacheNanny;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;BackbonePouch=require("backbone-pouch");appCacheNanny=require("appcache-nanny");Coconut=require("./Coconut");global.Coconut=Coconut;Config=require("./models/Config");Router=require("./Router");Sync=require("./models/Sync");Backbone.sync=BackbonePouch.sync({db:Coconut.database,fetch:"query"});Backbone.Model.prototype.idAttribute="_id";Coconut.router=new Router;Coconut.database.get("_local/initial_load_complete",function(error,result){var appName,cloudDefault,cloudUrl,configureApplicationAndSync,getParameterByName,password,passwordDefault,ref,username,usernameDefault;if(!error){_.delay(appCacheNanny.start,5e3);return Coconut.router.startApp()}else{if(error.status!==404){throw error}getParameterByName=function(name){var match;match=RegExp("[?&]"+name+"=([^&]*)").exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g," "))};configureApplicationAndSync=function(cloudUrl,appName,username,password){var sync;Coconut.config=new Config({cloud:cloudUrl,cloud_database_name:appName,cloud_credentials:username+":"+password});Coconut.config.save();sync=new Sync;return sync.replicateApplicationDocs({error:function(error){return console.error("Updating application docs failed: "+JSON.stringify(error))},success:function(){Coconut.database.put({_id:"_local/initial_load_complete"},function(error,result){if(error){return console.log(error)}});Coconut.router.startApp();return _.delay(function(){return document.location=document.location.origin},5e3)}})};ref=[getParameterByName("cloudUrl"),getParameterByName("appName"),getParameterByName("username"),getParameterByName("password")],cloudUrl=ref[0],appName=ref[1],username=ref[2],password=ref[3];if(cloudUrl&&appName&&username&&password){return configureApplicationAndSync(cloudUrl,appName,username,password)}else{cloudDefault="";usernameDefault="";passwordDefault="";return $.ajax({url:"defaults.json",success:function(result){var ref1;if(result){cloudDefault=result.cloud;return ref1=result.cloud_credentials.split(":"),usernameDefault=ref1[0],passwordDefault=ref1[1],ref1}},complete:function(){cloudUrl=prompt("Enter cloud URL",cloudDefault);cloudUrl=cloudUrl.replace(/http:\/\//,"");appName=prompt("Enter application name");username=prompt("Enter cloud username",usernameDefault);password=prompt("Enter cloud password",passwordDefault);return configureApplicationAndSync(cloudUrl,appName,username,password)}})}}})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Coconut":8,"./Router":9,"./models/Config":11,"./models/Sync":16,"appcache-nanny":26,backbone:29,"backbone-pouch":28,jquery:34,underscore:126}],20:[function(require,module,exports){var $,Backbone,Coconut,HelpView,Sync,User,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;$=require("jquery");Backbone=require("backbone");Backbone.$=$;Coconut=require("../Coconut");Sync=require("../models/Sync");User=require("../models/User");HelpView=function(superClass){extend(HelpView,superClass);function HelpView(){this.render=bind(this.render,this);return HelpView.__super__.constructor.apply(this,arguments)}HelpView.prototype.el="#content";HelpView.prototype.events={"click input[value=Send]":"send"};HelpView.prototype.render=function(){if(this.helpDocument!=null){return $.ajax({url:"documentation/"+this.helpDocument+".markdown",success:function(_this){return function(result){_this.$el.html(markdown.toHTML(result));return _this.appendHelpForm()}}(this)})}else{this.$el.html("");return this.appendHelpForm()}};HelpView.prototype.appendHelpForm=function(){return this.$el.append("<hr/> <label style='display:block' for='message'>If you are having trouble please contact your supervisor as soon as possible. You can also describe the problem in the box below and it will send a message to our support team. We'll get back to you as soon as possible.</label> <textarea style='width:100%' id='message' name='message'></textarea> <div id='messageBox'></div> </div> <input type='submit' value='Send'></input>")};HelpView.prototype.send=function(){var help,messageText,sync;messageText=$("#message").val();if(messageText.length===0){return false}help=new Help({date:moment(new Date).format(Coconut.config.get("date_format")),text:messageText,user:User.currentUser.id.replace(/user\./,"")});help.save();sync=new Sync;$("#messageBox").append("Attempting to 'Send Data'");sync.sendToCloud({success:function(){return $("#messageBox").append("Thank you for your feedback, it has been sent")},error:function(){return $("#messageBox").append("There was a problem sending data, but your messages has been saved. If you have connectivity you can try again by pressing the 'Send data' button at the bottom of the screen.")}});return false};return HelpView}(Backbone.View);module.exports=HelpView},{"../Coconut":8,"../models/Sync":16,"../models/User":17,backbone:29,jquery:34}],21:[function(require,module,exports){var $,Backbone,Form2js,LoginView,User,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;$=require("jquery");Backbone=require("backbone");Backbone.$=$;Form2js=require("form2js");User=require("../models/User");LoginView=function(superClass){extend(LoginView,superClass);function LoginView(){this.login=bind(this.login,this);this.render=bind(this.render,this);return LoginView.__super__.constructor.apply(this,arguments)}LoginView.prototype.el="#content";LoginView.prototype.render=function(){this.$el.html("<style> #login_wrapper{ font-size: 200%; width:50%; margin: 0px auto; } #login_message{ margin-top: 20px; margin-bottom: 20px; } #login_form input{ font-size: 200%; display: block; } .coconut-mdl-card{ padding:10px; } #login_button{ font-size:200% } </style> <div class='mdl-card mdl-shadow--8dp coconut-mdl-card' id='login_wrapper'> <div class='mdl-card__title coconut-mdl-card__title'></div> <form id='login_form'> <div class='mdl-textfield mdl-js-textfield mdl-textfield--floating-label'> <input class='mdl-textfield__input' type='text' id='username' name='username' autofocus> <label class='mdl-textfield__label' for='username'>Username</label> </div> <div class='mdl-textfield mdl-js-textfield mdl-textfield--floating-label'> <input class='mdl-textfield__input' type='password' id='password' name='password'> <label class='mdl-textfield__label' for='password'>Password</label> </div> <div class='mdl-card__actions'> <button type='button' class='mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent' id='login_button'>Login</button> </div> </form> </div>");return componentHandler.upgradeDom()};LoginView.prototype.events={"click #login_button":"login","keypress #password":"submitIfEnter"};LoginView.prototype.submitIfEnter=function(event){if(event.which===10||event.which===13){return this.login()}};LoginView.prototype.updateNavBar=function(){};LoginView.prototype.login=function(){var loginData,user;loginData=Form2js.form2js("login_form");user=new User({_id:"user."+loginData.username});return user.fetch({success:function(_this){return function(){if(user.passwordIsValid(loginData.password)){user.login();Coconut.menuView.render();return _this.callback.success()}else{return $(".coconut-mdl-card__title").html("Wrong password <i style='padding-left:10px' class='material-icons'>mood_bad</i>")}}}(this),error:function(_this){return function(){return $(".coconut-mdl-card__title").html("Wrong username <i style='padding-left:10px' class='material-icons'>mood_bad</i>")}}(this)})};return LoginView}(Backbone.View);module.exports=LoginView},{"../models/User":17,backbone:29,form2js:31,jquery:34}],22:[function(require,module,exports){var $,Backbone,Coconut,MenuView,User,_,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Coconut=require("../Coconut");User=require("../models/User");MenuView=function(superClass){extend(MenuView,superClass);function MenuView(){this.render=bind(this.render,this);return MenuView.__super__.constructor.apply(this,arguments)}MenuView.prototype.render=function(){this.$el.html("<div id='navbar' data-role='navbar'> <ul></ul> </div>");return Coconut.questions.fetch({success:function(_this){return function(){$(".mdl-layout__header-row").html(Coconut.questions.map(function(question,index){return"<span class='mdl-layout-title'>"+question.id+"</span> <button onClick='document.location=\"#new/result/"+escape(question.id)+"\"' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon'> <i class='material-icons'>add</i> </button> <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='hdrbtn'> <i class='material-icons'>more_vert</i> </button> <ul class='mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right' for='hdrbtn'> <li class='mdl-menu__item'> <a href='#show/results/"+escape(question.id)+"'>Results (<span id='complete_results'></span>)</a> </li> </ul>"}).join(" "));componentHandler.upgradeDom();return _this.update()}}(this)})};MenuView.prototype.update=function(){User.isAuthenticated({success:function(){return Coconut.questions.each(function(_this){return function(question,index){return Coconut.database.query("results",{key:[question.id,true],include_docs:false},function(error,result){if(error){console.log(error)}return $("#complete_results").html(result.rows.length)})}}(this))}});return Coconut.database.get("version",function(error,result){if(error){return $("#version").html("-")}else{return $("#version").html(result.version)}})};return MenuView}(Backbone.View);module.exports=MenuView},{"../Coconut":8,"../models/User":17,backbone:29,jquery:34,underscore:126}],23:[function(require,module,exports){(function(global){var $,Backbone,Coconut,Cookie,Form2js,QuestionView,ResultCollection,_,moment,typeahead,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;global.SkipTheseWhen=function(argQuestions,result){var disabledClass,i,j,len,len1,question,questions,results;questions=[];argQuestions=argQuestions.split(/\s*,\s*/);for(i=0,len=argQuestions.length;i<len;i++){question=argQuestions[i];questions.push(window.questionCache[question])}disabledClass="disabled_skipped";results=[];for(j=0,len1=questions.length;j<len1;j++){question=questions[j];if(result){results.push(question.addClass(disabledClass))}else{results.push(question.removeClass(disabledClass))}}return results};global.ResultOfQuestion=function(name){var base;return(typeof(base=window.getValueCache)[name]==="function"?base[name]():void 0)||null};_=require("underscore");$=require("jquery");Cookie=require("js-cookie");Backbone=require("backbone");Backbone.$=$;Form2js=require("form2js");moment=require("moment");typeahead=require("typeahead.js");Coconut=require("../Coconut");ResultCollection=require("../models/ResultCollection");QuestionView=function(superClass){extend(QuestionView,superClass);function QuestionView(){this.onChange=bind(this.onChange,this);this.render=bind(this.render,this);return QuestionView.__super__.constructor.apply(this,arguments)}QuestionView.prototype.initialize=function(){if(Coconut.resultCollection==null){Coconut.resultCollection=new ResultCollection}return this.autoscrollTimer=0};QuestionView.prototype.el="#content";QuestionView.prototype.triggerChangeIn=function(names){var elements,i,len,name,results;results=[];for(i=0,len=names.length;i<len;i++){name=names[i];elements=[];elements.push(window.questionCache[name].find("input, select, textarea, img"));results.push($(elements).each(function(_this){return function(index,element){var event;event={target:element};return _this.actionOnChange(event)}}(this)))}return results};QuestionView.prototype.render=function(){var autocompleteElements,skipperList;this.primary1="rgb(63,81,181)";this.primary2="rgb(48,63,159)";this.accent1="rgb(230,33,90)";this.accent2="rgb(194,24,91)";this.$el.html("<style> label, label.coconut-radio.mdl-radio, input, input.mdl-textfield__input{ font-size:200%; } .message { color: white; font-weight: bold; padding: 10px; border: 1px "+this.accent2+" dotted; background: "+this.accent2+"; display: none; } .message, label.radio{ max-width: 600px; } label.mdl-nontextfield__label{ display:block; color: "+this.accent1+"; padding-bottom:20px; font-size:150%; } label.mdl-nontextfield__label.has-value{ color: "+this.primary1+"; font-size:100%; } .mdl-textfield--floating-label.is-focused .mdl-textfield__label, .mdl-textfield--floating-label.is-dirty .mdl-textfield__label{ font-size:100%; } label.mdl-textfield__label{ color:"+this.accent1+"; font-size:125%; } div.radio label.mdl-textfield__label{ font-size:150%; color:"+this.accent1+"; } .is-dirty label.mdl-textfield__label{ color:"+this.primary1+"; } .coconut-radio{ margin: 10px; } .mdl-radio__label{ line-height:normal; } input{ font-size: 2em; } label.radio-option,label.checkbox-option { border-radius:20px; display:inline-block; padding:4px 11px; border: 1px solid black; cursor: pointer; text-decoration: none; width:250px; line-height:100%; vertical-align: top; } input[type='radio']:checked + label { color: white; background-color:#ddd; background: "+this.primary1+"; background-image: -webkit-gradient(linear,left top,left bottom,from("+this.primary1+"),to("+this.primary2+")); background-image: -webkit-linear-gradient("+this.primary1+","+this.primary2+"); background-image: -moz-linear-gradient("+this.primary1+","+this.primary2+"); background-image: -ms-linear-gradient("+this.primary1+","+this.primary2+"); background-image: -o-linear-gradient("+this.primary1+","+this.primary2+"); earchCompleteStop() } input[type='radio'],input[type='checkbox']{ height: 0px; width: 0px; margin: 0px; } input[type='radio'],input[type='checkbox']{ height: 0px; width: 0px; margin: 0px; } input[type='checkbox']:checked + label { color: white; background-color:#ddd; background: "+this.primary1+"; background-image: -webkit-gradient(linear,left top,left bottom,from("+this.primary1+"),to("+this.primary2+")); background-image: -webkit-linear-gradient("+this.primary1+","+this.primary2+"); background-image: -moz-linear-gradient("+this.primary1+","+this.primary2+"); background-image: -ms-linear-gradient("+this.primary1+","+this.primary2+"); background-image: -o-linear-gradient("+this.primary1+","+this.primary2+"); earchCompleteStop() } input[type='checkbox']{ height: 0px; } #question-set-complete:checked + label { color: "+this.primary1+"; background:none; } .question-set-complete-label{ color: "+this.accent2+"; } #question-set-complete{ /* Triple-sized Checkboxes */ -ms-transform: scale(3); /* IE */ -moz-transform: scale(3); /* FF */ -webkit-transform: scale(3); /* Safari and Chrome */ -o-transform: scale(3); /* Opera */ padding: 10px; height:20px; width: 15px; margin: 10px; } div.question.radio{ padding-top: 8px; padding-bottom: 8px; } .tt-hint{ display:none } .tt-dropdown-menu{ width: 100%; background-color: lightgray; } .tt-suggestion{ background-color: white; border-radius:20px; display:block; padding:4px 11px; border: 1px solid black; cursor: pointer; text-decoration: none; } .tt-suggestion .{ } "+(this.model.get("styles")||"")+" </style> <div style='position:fixed; right:5px; color:white; padding:20px; z-index:5' id='messageText'> </div> <div style='position:fixed; right:5px; color:white; background-color: #333; padding:20px; display:none; z-index:10' id='messageText'> Saving... </div> <!-- <div style='background-color: "+this.primary2+"'> <h2 style='font-weight:100; color: "+this.accent1+"' >"+this.model.id+"</h2> </div> --> <hr/> <div id='question-view'> <form id='questions'> "+this.toHTMLForm(this.model)+" </form> </div>");componentHandler.upgradeDom();_.delay(function(_this){return function(){$("input[type=text]").filter(function(){return this.value!==""}).closest("div").addClass("is-dirty");$("input[type=number]").filter(function(){return this.value!==""}).closest("div").addClass("is-dirty");return _this.updateLabelClass()}}(this),500);Form2js.js2form("questions",this.result.toJSON());this.updateCache();this.updateSkipLogic();skipperList=[];$(this.model.get("questions")).each(function(_this){return function(index,question){if(question.actionOnChange().match(/skip/i)){skipperList.push(question.safeLabel())}if(question.get("action_on_questions_loaded")!=null&&question.get("action_on_questions_loaded")!==""){return CoffeeScript["eval"](question.get("action_on_questions_loaded"))}}}(this));this.triggerChangeIn(skipperList);autocompleteElements=[];_.each($("input[type='autocomplete from list']"),function(element){element=$(element);element.typeahead({local:element.attr("data-autocomplete-options").replace(/\n|\t/,"").split(/, */)});return autocompleteElements.push(element)});_.each($("input[type='autocomplete from code']"),function(element){element=$(element);element.typeahead({local:eval(element.attr("data-autocomplete-options"))});return autocompleteElements.push(element)});_.each($("input[type='autocomplete from previous entries']"),function(element){element=$(element);element.typeahead({prefetch:document.location.pathname.substring(0,document.location.pathname.indexOf("index.html"))+('_list/values/byValue?key="'+element.attr("name")+'"')});return autocompleteElements.push(element)});_.each(autocompleteElements,function(_this){return function(autocompeteElement){return autocompeteElement.blur(function(){return _this.autoscroll(autocompeteElement)})}}(this));if(this.readonly){return $("input, textarea").attr("readonly","true")}};QuestionView.prototype.events={"change #question-view input":"onChange","change #question-view select":"onChange","change #question-view textarea":"onChange","click #question-view button:contains(+)":"repeat","click #question-view a:contains(Get current location)":"getLocation","click .next_error":"runValidate","click .validate_one":"onValidateOne"};QuestionView.prototype.runValidate=function(){return this.validateAll()};QuestionView.prototype.onChange=function(event){var $target,allQuestionsPassValidation,eventStamp,messageVisible,onValidatedComplete,targetName;this.updateLabelClass();$target=$(event.target);eventStamp=$target.attr("id");if(eventStamp===this.oldStamp&&(new Date).getTime()<this.throttleTime+1e3){return}this.throttleTime=(new Date).getTime();this.oldStamp=eventStamp;targetName=$target.attr("name");if(targetName==="complete"){allQuestionsPassValidation=this.validateAll();Coconut.menuView.update();this.save();this.updateSkipLogic();this.actionOnChange(event);if(allQuestionsPassValidation){onValidatedComplete=this.model.get("onValidatedComplete");if(onValidatedComplete){console.log("Evaling: "+onValidatedComplete);return _.delay(function(){return CoffeeScript["eval"](onValidatedComplete)},1e3)}}else{return $("#question-set-complete").prop("checked",false)}}else{messageVisible=window.questionCache[targetName].find(".message").is(":visible");return _.delay(function(_this){return function(){var wasValid;if(!messageVisible){wasValid=_this.validateOne({key:targetName,autoscroll:false,
button:"<button type='button' data-name='"+targetName+"' class='validate_one'>Validate</button>"});_this.save();_this.updateSkipLogic();_this.actionOnChange(event);if(wasValid){return _this.autoscroll(event)}}}}(this),500)}};QuestionView.prototype.onValidateOne=function(event){var $target,name;$target=$(event.target);name=$(event.target).attr("data-name");return this.validateOne({key:name,autoscroll:true,leaveMessage:false,button:"<button type='button' data-name='"+name+"' class='validate_one'>Validate</button>"})};QuestionView.prototype.validateAll=function(){var i,isValid,key,len,questionIsntValid,ref;isValid=true;ref=window.keyCache;for(i=0,len=ref.length;i<len;i++){key=ref[i];questionIsntValid=!this.validateOne({key:key,autoscroll:isValid,leaveMessage:false});if(isValid&&questionIsntValid){isValid=false}}this.completeButton(isValid);if(isValid){$("[name=complete]").parent().scrollTo()}return isValid};QuestionView.prototype.validateOne=function(options){var $message,$question,autoscroll,button,e,key,leaveMessage,message;key=options.key||"";autoscroll=options.autoscroll||false;button=options.button||"<button type='button' class='next_error'>Next Error</button>";leaveMessage=options.leaveMessage||false;$question=window.questionCache[key];$message=$question.find(".message");try{message=this.isValid(key)}catch(_error){e=_error;alert("isValid error in "+key+"\n"+e);message=""}if($message.is(":visible")&&leaveMessage){if(message===""){return true}else{return false}}if(message===""){$message.hide();if(autoscroll){this.autoscroll($question)}return true}else{$message.show().html(message+" "+button).find("button");this.scrollToQuestion($question);return false}};QuestionView.prototype.isValid=function(question_id){var error,labelText,question,questionWrapper,ref,required,result,type,validation,validationFunctionResult,value;if(!question_id){return}result=[];questionWrapper=window.questionCache[question_id];if(questionWrapper.hasClass("label")){return""}question=$("[name="+question_id+"]",questionWrapper);type=$(questionWrapper.find("input").get(0)).attr("type");labelText=type==="radio"?$("label[for="+question.attr("id").split("-")[0]+"]",questionWrapper).text()||"":(ref=$("label[for="+question.attr("id")+"]",questionWrapper))!=null?ref.text():void 0;required=questionWrapper.attr("data-required")==="true";validation=unescape(questionWrapper.attr("data-validation"));if(validation==="undefined"){validation=null}value=window.getValueCache[question_id]();if(!questionWrapper.is(":visible")){return""}if(question.find("input").length!==0&&(type==="checkbox"||type==="radio")){return""}if(question_id!=="Location"){if(required&&(value===""||value===null)){result.push("'"+labelText+"' is required.")}}if(validation!=null&&validation!==""){try{validationFunctionResult=CoffeeScript["eval"]("(value) -> "+validation,{bare:true})(value);if(validationFunctionResult!=null){result.push(validationFunctionResult)}}catch(_error){error=_error;if(error==="invisible reference"){return""}alert("Validation error for "+question_id+" with value "+value+": "+error)}}if(result.length!==0){return result.join("<br>")+"<br>"}return""};QuestionView.prototype.scrollToQuestion=function(question){return this.autoscroll($(question).prev())};QuestionView.prototype.autoscroll=function(event){var $div,$target,safetyCounter;clearTimeout(this.autoscrollTimer);if(event.jquery){$div=event;window.scrollTargetName=$div.attr("data-question-name")||$div.attr("name")}else{$target=$(event.target);window.scrollTargetName=$target.attr("name");$div=window.questionCache[window.scrollTargetName]}this.$next=$div.next();if(!this.$next.is(":visible")&&this.$next.length>0){safetyCounter=0;while(!this.$next.is(":visible")&&(safetyCounter+=1)<100){this.$next=this.$next.next()}}if(this.$next.is(":visible")){if(window.questionCache[window.scrollTargetName].find(".message").is(":visible")){return}$(window).on("scroll",function(_this){return function(){$(window).off("scroll");return clearTimeout(_this.autoscrollTimer)}}(this));return this.autoscrollTimer=setTimeout(function(_this){return function(){$(window).off("scroll");return _this.$next.scrollTo().find("input[type=text],input[type=number]").focus()}}(this),1e3)}};QuestionView.prototype.actionOnChange=function(event){var $divQuestion,$target,code,error,message,name,newFunction,nodeName,value;nodeName=$(event.target).get(0).nodeName;$target=nodeName==="INPUT"||nodeName==="SELECT"||nodeName==="TEXTAREA"?$(event.target):$(event.target).parent().parent().parent().find("input,textarea,select");if(!$target.is(":visible")){return}name=$target.attr("name");$divQuestion=$(".question [data-question-name="+name+"]");code=$divQuestion.attr("data-action_on_change");try{value=ResultOfQuestion(name)}catch(_error){error=_error;if(error==="invisible reference"){return}}if(code===""||code==null){return}code="(value) -> "+code;try{newFunction=CoffeeScript["eval"].apply(this,[code]);return newFunction(value)}catch(_error){error=_error;name=/function (.{1,})\(/.exec(error.constructor.toString())[1];message=error.message;return alert("Action on change error in question "+($divQuestion.attr("data-question-id")||$divQuestion.attr("id"))+"\n\n"+name+"\n\n"+message)}};QuestionView.prototype.updateSkipLogic=function(){var $question,error,message,name,ref,result,results,skipLogicCode;ref=window.questionCache;results=[];for(name in ref){$question=ref[name];skipLogicCode=window.skipLogicCache[name];if(skipLogicCode===""||skipLogicCode==null){continue}try{result=eval(skipLogicCode)}catch(_error){error=_error;if(error==="invisible reference"){result=true}else{name=/function (.{1,})\(/.exec(error.constructor.toString())[1];message=error.message;alert("Skip logic error in question "+$question.attr("data-question-id")+"\n\n"+name+"\n\n"+message)}}if(result){results.push($question[0].style.display="none")}else{results.push($question[0].style.display="")}}return results};QuestionView.prototype.save=_.throttle(function(){var currentData;currentData=Form2js.form2js("questions",".",false);currentData.lastModifiedAt=moment(new Date).format(Coconut.config.get("date_format"));currentData.savedBy=Cookie("current_user");return this.result.save(currentData,{success:function(_this){return function(model){$("#messageText").slideDown().fadeOut();Coconut.router.navigate("edit/result/"+model.id,false);return Coconut.menuView.update()}}(this)})},1e3);QuestionView.prototype.completeButton=function(value){if($("[name=complete]").prop("checked")!==value){return $("[name=complete]").click()}};QuestionView.prototype.toHTMLForm=function(questions,groupId){if(questions==null){questions=this.model}window.skipLogicCache={};if(questions.length==null){questions=[questions]}return _.map(questions,function(_this){return function(question){var html,index,name,newGroupId,option,options,question_id,repeatable;repeatable=question.repeatable()==="true"?"<button>+</button>":"";if(!(question.type()!=null&&question.label()!=null&&question.label()!=="")){newGroupId=question_id;if(question.repeatable()){newGroupId=newGroupId+"[0]"}return"<div data-group-id='"+question_id+"' class='question group'> "+_this.toHTMLForm(question.questions(),newGroupId)+" <hr/> <div style='padding-top:20px'> <input name='complete' id='question-set-complete' type='checkbox' value='true'></input> <label class='question-set-complete-label' for='question-set-complete'>Complete</label> </div> </div> "+repeatable}else{name=question.safeLabel();window.skipLogicCache[name]=question.skipLogic()!==""?CoffeeScript.compile(question.skipLogic(),{bare:true}):"";question_id=question.get("id");if(question.repeatable()==="true"){name=name+"[0]";question_id=question.get("id")+"-0"}if(groupId!=null){name="group."+groupId+"."+name}return"<div "+(question.validation()?question.validation()?"data-validation = '"+escape(question.validation())+"'":void 0:"")+" data-required='"+question.required()+"' class='question "+((typeof question.type==="function"?question.type():void 0)||"")+" question-"+question_id+" mdl-textfield mdl-js-textfield mdl-textfield--floating-label' data-question-name='"+name+"' data-question-id='"+question_id+"' data-action_on_change='"+_.escape(question.actionOnChange())+"' > <div class='message'></div> "+(!~question.type().indexOf("hidden")?"<label class='"+question.type()+" "+(question.type().match(/text|number/)?"mdl-textfield__label":"mdl-nontextfield__label")+"' type='"+question.type()+"' for='"+question_id+"'>"+question.label()+" <span></span></label>":void 0)+" "+function(){var i,len,ref;switch(question.type()){case"textarea":return"<input name='"+name+"' type='text' id='"+question_id+"' value='"+_.escape(question.value())+"'></input>";case"select":if(this.readonly){return question.value()}else{html="<select>";ref=question.get("select-options").split(/, */);for(index=i=0,len=ref.length;i<len;index=++i){option=ref[index];html+="<option name='"+name+"' id='"+question_id+"-"+index+"' value='"+option+"'>"+option+"</option>"}return html+="</select>"}break;case"radio":if(this.readonly){return"<input class='radioradio' name='"+name+"' type='text' id='"+question_id+"' value='"+question.value()+"'></input>"}else{options=question.get("radio-options");return _.map(options.split(/, */),function(option,index){return"<input class='radio' type='radio' name='"+name+"' id='"+question_id+"-"+index+"' value='"+_.escape(option)+"'/> <label class='radio radio-option' for='"+question_id+"-"+index+"'>"+option+"</label>"}).join("")}break;case"checkbox":if(this.readonly){return"<input class='radioradio' name='"+name+"' type='text' id='"+question_id+"' value='"+question.value()+"'></input>"}else{options=question.get("checkbox-options");return _.map(options.split(/, */),function(option,index){return"<input class='checkbox' type='checkbox' name='"+name+"' id='"+question_id+"-"+index+"' value='"+_.escape(option)+"'/> <label class='checkbox checkbox-option' for='"+question_id+"-"+index+"'>"+option+"</label>"}).join("")}break;case"autocomplete from list":case"autocomplete from previous entries":case"autocomplete from code":return"<!-- autocomplete='off' disables browser completion --> <input autocomplete='off' name='"+name+"' id='"+question_id+"' type='"+question.type()+"' value='"+question.value()+"' data-autocomplete-options='"+question.get("autocomplete-options")+"'></input> <ul id='"+question_id+"-suggestions' data-role='listview' data-inset='true'/>";case"location":this.watchID=navigator.geolocation.getAccurateCurrentPosition(function(){},function(){},function(){},{desiredAccuracy:50,maxWait:60*5*1e3});return"<a data-question-id='"+question_id+"'>Get current location</a> <label for='"+question_id+"-description'>Location Description</label> <input type='text' name='"+name+"-description' id='"+question_id+"-description'></input> "+_.map(["latitude","longitude","accuracy"],function(field){return"<label for='"+question_id+"-"+field+"'>"+field+"</label><input readonly='readonly' type='number' name='"+name+"-"+field+"' id='"+question_id+"-"+field+"'></input>"}).join("")+" "+_.map(["altitude","altitudeAccuracy","heading","timestamp"],function(field){return"<input type='hidden' name='"+name+"-"+field+"' id='"+question_id+"-"+field+"'></input>"}).join("");case"image":return"<img style='"+question.get("image-style")+"' src='"+question.get("image-path")+"'/>";case"label":return"";case"text":return"<input name='"+name+"' id='"+question_id+"' type='text' class='mdl-textfield__input' value='"+question.value()+"'></input>";case"number":return"<input name='"+name+"' id='"+question_id+"' type='number' class='mdl-textfield__input' value='"+question.value()+"'></input>";default:return"<input name='"+name+"' id='"+question_id+"' type='"+question.type()+"' value='"+question.value()+"'></input>"}}.call(_this)+" </div> "+repeatable}}}(this)).join("")};QuestionView.prototype.updateLabelClass=function(){return _(["radio","checkbox"]).each(function(type){if($("input[type="+type+"]").filter(function(){return this.checked===true}).length>0){return $("input[type="+type+"]").siblings("label.mdl-nontextfield__label").addClass("has-value")}else{return $("input[type="+type+"]").siblings("label.mdl-nontextfield__label").removeClass("has-value")}})};QuestionView.prototype.updateCache=function(){var $qC,accessorFunction,i,inputs,len,name,question,ref,selects,type;window.questionCache={};window.getValueCache={};window.$questions=$(".question");ref=window.$questions;for(i=0,len=ref.length;i<len;i++){question=ref[i];name=question.getAttribute("data-question-name");if(name!=null&&name!==""){accessorFunction={};window.questionCache[name]=$(question);$qC=window.questionCache[name];selects=$("select[name="+name+"]",$qC);if(selects.length===0){inputs=$("input[name="+name+"]",$qC);if(inputs.length!==0){type=inputs[0].getAttribute("type");if(type==="radio"){(function(name,$qC){return accessorFunction=function(){return $("input:checked",$qC).safeVal()}})(name,$qC)}else if(type==="checkbox"){(function(name,$qC){return accessorFunction=function(){return $("input:checked",$qC).map(function(){return $(this).safeVal()})}})(name,$qC)}else{(function(inputs){return accessorFunction=function(){return inputs.safeVal()}})(inputs)}}else{(function(name,$qC){return accessorFunction=function(){return $(".textarea[name="+name+"]",$qC).safeVal()}})(name,$qC)}}else{(function(selects){return accessorFunction=function(){return selects.safeVal()}})(selects)}window.getValueCache[name]=accessorFunction}}return window.keyCache=_.keys(questionCache)};QuestionView.prototype.repeat=function(event){var button,i,inputElement,len,name,newIndex,newQuestion,questionID,re,ref;button=$(event.target);newQuestion=button.prev(".question").clone();questionID=newQuestion.attr("data-group-id");if(questionID==null){questionID=""}ref=newQuestion.find("input");for(i=0,len=ref.length;i<len;i++){inputElement=ref[i];inputElement=$(inputElement);name=inputElement.attr("name");re=new RegExp(questionID+"\\[(\\d)\\]");newIndex=parseInt(_.last(name.match(re)))+1;inputElement.attr("name",name.replace(re,questionID+"["+newIndex+"]"))}button.after(newQuestion.add(button.clone()));return button.remove()};QuestionView.prototype.getLocation=function(event){var maxWait,onError,onProgress,onSuccess,question_id,requiredAccuracy,updateFormWithCoordinates;requiredAccuracy=200;maxWait=3*60*1e3;question_id=$(event.target).closest("[data-question-id]").attr("data-question-id");$("#"+question_id+"-description").val("Retrieving position, please wait.");updateFormWithCoordinates=function(geoposition){_.each(geoposition.coords,function(value,key){return $("#"+question_id+"-"+key).val(value)});$("#"+question_id+"-timestamp").val(moment(geoposition.timestamp).format(Coconut.config.get("datetime_format")));return $.getJSON("http://api.geonames.org/findNearbyPlaceNameJSON?lat="+geoposition.coords.latitude+"&lng="+geoposition.coords.longitude+"&username=mikeymckay&callback=?",null,function(_this){return function(result){return $("#"+question_id+"-description").val(parseFloat(result.geonames[0].distance).toFixed(1)+" km from center of "+result.geonames[0].name)}}(this))};onSuccess=function(_this){return function(geoposition){$("label[type=location]").html("Household Location");updateFormWithCoordinates(geoposition);$("#"+question_id+"-description").val("Success");return _this.save()}}(this);onError=function(error){return $("#"+question_id+"-description").val("Error: "+JSON.stringify(error))};onProgress=function(_this){return function(geoposition){updateFormWithCoordinates(geoposition);return $("label[type=location]").html("Household Location<div style='background-color:yellow'>Current accuracy is "+geoposition.coords.accuracy+" meters - must be less than "+requiredAccuracy+" meters. Make sure there are no trees or buildings blocking view to the sky.</div>")}}(this);navigator.geolocation.clearWatch(this.watchID);return navigator.geolocation.getAccurateCurrentPosition(onSuccess,onError,onProgress,{desiredAccuracy:requiredAccuracy,maxWait:maxWait})};return QuestionView}(Backbone.View);(function($){$.fn.scrollTo=function(speed,callback){var e;if(speed==null){speed=500}try{$("html, body").animate({scrollTop:$(this).offset().top+"px"},speed,null,callback)}catch(_error){e=_error;console.log("error",e);console.log("Scroll error with 'this'",this)}return this};return $.fn.safeVal=function(){if(this.is(":visible")||this.parents(".question").filter(function(){return!$(this).hasClass("group")}).is(":visible")){return $.trim(this.val()||"")}else{return null}}})($);module.exports=QuestionView}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../Coconut":8,"../models/ResultCollection":15,backbone:29,form2js:31,jquery:34,"js-cookie":35,moment:54,"typeahead.js":125,underscore:126}],24:[function(require,module,exports){var $,Backbone,Question,ResultCollection,ResultsView,_,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;$.DataTable=require("datatables");Question=require("../models/Question");ResultCollection=require("../models/ResultCollection");ResultsView=function(superClass){extend(ResultsView,superClass);function ResultsView(){this.render=bind(this.render,this);return ResultsView.__super__.constructor.apply(this,arguments)}ResultsView.prototype.initialize=function(){return this.question=new Question};ResultsView.prototype.el="#content";ResultsView.prototype.render=function(){this.$el.html("<style> table.results th.header, table.results td{ font-size:150%; } .dataTables_wrapper .dataTables_length{ display: none; } .dataTables_filter input{ display:inline; width:300px; } a[role=button]{ background-color: white; margin-right:5px; -moz-border-radius: 1em; -webkit-border-radius: 1em; border: solid gray 1px; font-family: Helvetica,Arial,sans-serif; font-weight: bold; color: #222; text-shadow: 0 1px 0 #fff; -webkit-background-clip: padding-box; -moz-background-clip: padding; background-clip: padding-box; padding: .6em 20px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; position: relative; zoom: 1; } a[role=button].paginate_disabled_previous, a[role=button].paginate_disabled_next{ color:gray; } .dataTables_info{ float:right; } .dataTables_paginate{ margin-bottom:20px; } </style> <a href='#new/result/"+escape(this.question.id)+"'>Add new '"+this.question.id+"'</a> <div class='not-complete' data-collapsed='false' data-role='collapsible'> <h2>'"+this.question.id+"' Items Not Completed (<span class='count-complete-false'></span>)</h2> <table class='results complete-false tablesorter'> <thead><tr>"+_.map(this.question.summaryFieldNames(),function(summaryField){return"<th class='header'>"+summaryField+"</th>"}).join("")+"<th></th> </tr></thead> <tbody> </tbody> <!-- <tfoot><tr>"+_.map(this.question.summaryFieldNames(),function(summaryField){return"<th class='header'>"+summaryField+"</th>"}).join("")+("<th></th> </tr></tfoot> --> </table> </div> <div class='complete' data-role='collapsible'> <h2>'"+this.question.id+"' Items Completed (<span class='count-complete-true'></span>)</h2> <table class='results complete-true tablesorter'> <thead><tr>")+_.map(this.question.summaryFieldNames(),function(summaryField){return"<th class='header'>"+summaryField+"</th>"}).join("")+"<th></th> </tr></thead> <tbody> </tbody> <!-- <tfoot><tr>"+_.map(this.question.summaryFieldNames(),function(summaryField){return"<th class='header'>"+summaryField+"</th>"}).join("")+"<th></th> </tr></tfoot> --> </table> </div>");$(".complete").bind("expand",function(_this){return function(){return _this.loadResults(true)}}(this));this.loadResults(false);return this.updateCountComplete()};ResultsView.prototype.updateCountComplete=function(){var results;console.log("ZZZ");results=new ResultCollection;return results.fetch({question:this.question.id,isComplete:true,success:function(_this){return function(){return $(".count-complete-true").html(results.results.length)}}(this)})};ResultsView.prototype.loadResults=function(complete){var results;results=new ResultCollection;return results.fetch({include_docs:"true",question:this.question.id,isComplete:complete,success:function(_this){return function(){$(".count-complete-"+complete).html(results.results.length);results.each(function(result,index){if(complete!=="true"&&result.wasTransferredOut()){$(".count-complete-"+complete).html(parseInt($(".count-complete-"+complete).html())-1);return}$("table.complete-"+complete+" tbody").append("<tr> "+_.map(result.summaryValues(_this.question),function(value){return"<td><a href='#edit/result/"+result.id+"'>"+value+"</a></td>"}).join("")+" <td><a href='#delete/result/"+result.id+"' data-icon='delete' data-iconpos='notext'>Delete</a></td> </tr>");if(index+1===results.length){$("table").trigger("update")}return _.each($("table tr"),function(row,index){if(index%2===1){return $(row).addClass("odd")}})});return $("table").dataTable()}}(this)})};return ResultsView}(Backbone.View);module.exports=ResultsView},{"../models/Question":12,"../models/ResultCollection":15,backbone:29,datatables:30,jquery:34,underscore:126}],25:[function(require,module,exports){var $,Backbone,Sync,SyncView,_,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;_=require("underscore");$=require("jquery");Backbone=require("backbone");Backbone.$=$;Sync=require("../models/Sync");SyncView=function(superClass){extend(SyncView,superClass);function SyncView(){this.update=bind(this.update,this);this.render=bind(this.render,this);return SyncView.__super__.constructor.apply(this,arguments)}SyncView.prototype.initialize=function(){return this.sync=new Sync};SyncView.prototype.el="#content";SyncView.prototype.render=function(){this.$el.html("");return $("#log").html("")};SyncView.prototype.update=function(){return this.sync.fetch({success:function(_this){return function(){$(".sync-sent-status").html(_this.sync.was_last_send_successful()?_this.sync.last_send_time():_this.sync.last_send_time()+" - last attempt FAILED");return $(".sync-get-status").html(_this.sync.was_last_get_successful()?_this.sync.last_get_time():_this.sync.last_get_time()+" - last attempt FAILED")}}(this),error:function(_this){return function(){console.log("synclog doesn't exist yet, create it and re-render");_this.sync.save();return _.delay(_this.update,1e3)}}(this)})};return SyncView}(Backbone.View);module.exports=SyncView},{"../models/Sync":16,backbone:29,jquery:34,underscore:126}],26:[function(require,module,exports){"use strict";(function(root,factory){var appCache=typeof applicationCache==="undefined"?undefined:applicationCache;function Events(){var events={};var api=this;api.on=function on(type,func,ctx){if(!events[type])events[type]=[];events[type].push({f:func,c:ctx})};api.off=function off(type,func){var list=events[type]||[];var i=list.length=func?list.length:0;while(i-->0)if(func===list[i].f)list.splice(i,1)};api.trigger=function trigger(){var args=Array.apply([],arguments);var list=events[args.shift()]||[];var i=list.length;var j;for(j=0;j<i;j++)list[j].f.apply(list[j].c,args)};api.bind=api.on;api.unbind=api.off;api.emit=api.trigger}if(typeof define==="function"&&define.amd){define([],function(){root.appCacheNanny=factory(appCache,Events);return root.appCacheNanny})}else if(typeof exports==="object"){module.exports=factory(appCache,Events)}else{root.appCacheNanny=factory(appCache,Events)}})(this,function(applicationCache,Events){var DEFAULT_MANIFEST_LOADER_PATH="/appcache-loader.html";var DEFAULT_CHECK_INTERVAL=3e4;var appCacheNanny=new Events;var nannyOptions={loaderPath:DEFAULT_MANIFEST_LOADER_PATH,checkInterval:DEFAULT_CHECK_INTERVAL,offlineCheckInterval:DEFAULT_CHECK_INTERVAL};appCacheNanny.isSupported=function isSupported(){return!!applicationCache};appCacheNanny.update=function update(){trigger("update");if(!setupDone){setupCallbacks.push(appCacheNanny.update);if(!setupPending){setup();setupPending=true}return true}if(!appCacheNanny.isSupported())return false;try{applicationCache.update();return true}catch(e){appCacheNanny.update=noop;return false}};var intervalPointer;var setupDone=false;var setupPending=false;appCacheNanny.start=function start(options){if(options)appCacheNanny.set(options);if(!setupDone){setupCallbacks.push(appCacheNanny.start);if(!setupPending){setup();setupPending=true}return true}clearInterval(intervalPointer);checkInterval=hasNetworkError?appCacheNanny.get("offlineCheckInterval"):appCacheNanny.get("checkInterval");intervalPointer=setInterval(appCacheNanny.update,checkInterval);isCheckingForUpdatesFlag=true;trigger("start")};appCacheNanny.stop=function stop(){if(!isCheckingForUpdatesFlag)return;clearInterval(intervalPointer);isCheckingForUpdatesFlag=false;trigger("stop")};appCacheNanny.isCheckingForUpdates=function isCheckingForUpdates(){return isCheckingForUpdatesFlag};appCacheNanny.hasUpdate=function hasUpdate(){return hasUpdateFlag};appCacheNanny.set=function setOption(key,value){var property,newSettings;if(typeof key==="object"){newSettings=key;for(property in newSettings)if(newSettings.hasOwnProperty(property)){nannyOptions[property]=newSettings[property]}return}nannyOptions[key]=value};appCacheNanny.get=function getOption(key){var property,settings={};if(key)return nannyOptions[key];for(property in nannyOptions)if(nannyOptions.hasOwnProperty(property)){settings[property]=nannyOptions[property]}return settings};var checkInterval=DEFAULT_CHECK_INTERVAL;var hasUpdateFlag=false;var isCheckingForUpdatesFlag=false;var hasNetworkError=false;var isInitialDownload=false;var noop=function(){};var APPCACHE_STORE_KEY="_appcache_nanny";var setupCallbacks=[];function setup(){var iframe;var scriptTag;try{isInitialDownload=!localStorage.getItem(APPCACHE_STORE_KEY);localStorage.setItem(APPCACHE_STORE_KEY,"1")}catch(e){}if(!appCacheNanny.isSupported()){appCacheNanny.update=noop;return}if(applicationCache.status!==applicationCache.UNCACHED){subscribeToEvents();setupPending=false;setupDone=true;setupCallbacks.forEach(function(callback){callback()});return}iframe=document.createElement("iframe");iframe.src=nannyOptions.loaderPath;iframe.style.display="none";iframe.onload=function(){applicationCache=iframe.contentWindow.applicationCache;subscribeToEvents();setupPending=false;setupDone=true;setupCallbacks.forEach(function(callback){callback()})};iframe.onerror=function(){throw new Error("/appcache-loader.html could not be loaded.")};scriptTag=document.getElementsByTagName("script")[0];scriptTag.parentNode.insertBefore(iframe,scriptTag)}function subscribeToEvents(){on("updateready",handleUpdateReady);on("error",handleNetworkError);on("obsolete",handleNetworkObsolete);on("noupdate",handleNetworkSucces);on("cached",handleNetworkSucces);on("updateready",handleNetworkSucces);on("progress",handleNetworkSucces);on("downloading",handleNetworkSucces);addEventListener("online",appCacheNanny.update,false);addEventListener("offline",appCacheNanny.update,false)}function on(eventName,callback){applicationCache.addEventListener(eventName,callback,false)}function trigger(eventName){if(hasUpdateFlag)return;appCacheNanny.trigger(eventName)}function handleUpdateReady(){try{if(!hasUpdateFlag){hasUpdateFlag=true;appCacheNanny.trigger("updateready")}applicationCache.swapCache()}catch(error){}}function handleNetworkSucces(event){var prefix="";if(isInitialDownload){prefix="init:";if(event.type==="cached"){isInitialDownload=false}}trigger(prefix+event.type);if(!hasNetworkError)return;hasNetworkError=false;appCacheNanny.start();trigger("online")}function handleNetworkError(){trigger("error");if(hasNetworkError)return;hasNetworkError=true;if(applicationCache.status===applicationCache.UNCACHED)return;appCacheNanny.start();trigger("offline")}function handleNetworkObsolete(){trigger("obsolete");if(hasNetworkError){hasNetworkError=false;trigger("online")}appCacheNanny.stop()}return appCacheNanny})},{}],27:[function(require,module,exports){"use strict";module.exports=argsArray;function argsArray(fun){return function(){var len=arguments.length;if(len){var args=[];var i=-1;while(++i<len){args[i]=arguments[i]}return fun.call(this,args)}else{return fun.call(this,[])}}}},{}],28:[function(require,module,exports){(function(root){"use strict";var BackbonePouch;if(typeof exports==="object"){BackbonePouch=exports}else{BackbonePouch=root.BackbonePouch={}}var _=root._;if(!_&&typeof require==="function"){_=require("underscore")}var methodMap={create:"post",update:"put",patch:"put","delete":"remove"};BackbonePouch.defaults={fetch:"allDocs",listen:false,options:{post:{},put:{},get:{},remove:{},allDocs:{},query:{},spatial:{},changes:{continuous:true}}};function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];if(typeof source!=="object"){continue}for(var name in source){if(source[name]&&target[name]&&typeof source[name]==="object"&&typeof target[name]==="object"&&name!=="db"){target[name]=extend(target[name]||{},source[name])}else{target[name]=source[name]}}}return target}BackbonePouch.sync=function(defaults){defaults=defaults||{};defaults=extend(BackbonePouch.defaults,defaults);var adapter=function(method,model,options){options=options||{};options=extend(defaults,model&&model.pouch||{},options);if(typeof method!=="string"){return options}if(!options.db){throw new Error('A "db" property must be specified')}function callback(err,response){if(err){return options.error&&options.error(err)}if(method==="create"||method==="update"||method==="patch"){response={_id:response.id,_rev:response.rev}}if(method==="delete"){response={}}if(method==="read"){if(options.listen){options.db.info(function(err,info){options.db.changes(_.extend({},options.options.changes,{since:info.update_seq,onChange:function(change){var todo=model.get(change.id);if(change.deleted){if(todo){todo.destroy()}}else{if(todo){todo.set(change.doc)}else{model.add(change.doc)}}if(typeof options.options.changes.onChange==="function"){options.options.changes.onChange(change)}}}))})}}return options.success&&options.success(response)}model.trigger("request",model,options.db,options);if(method==="read"){if(model.id){return options.db.get(model.id,options.options.get,callback)}if(options.fetch==="query"||options.fetch==="spatial"){if(!options.options[options.fetch].fun){throw new Error('A "'+options.fetch+'.fun" object must be specified')}return options.db[options.fetch](options.options[options.fetch].fun,options.options[options.fetch],callback)}options.db[options.fetch](options.options[options.fetch],callback)}else{options.db[methodMap[method]](model.toJSON(),options.options[methodMap[method]],callback)}return options};adapter.defaults=defaults;return adapter};BackbonePouch.attachments=function(defaults){defaults=defaults||{};function getPouch(model){if(model.pouch&&model.pouch.db){return model.pouch.db}if(model.collection&&model.collection.pouch&&model.collection.pouch.db){return model.collection.pouch.db}if(defaults.db){return defaults.db}var options=model.sync();if(options.db){return options.db}throw new Error('A "db" property must be specified')}return{attachments:function(filter){var atts=this.get("_attachments")||{};if(filter){return _.filter(_.keys(atts),function(key){if(typeof filter==="function"){return filter(key,atts[key])}return atts[key].content_type.match(filter)})}return _.keys(atts)},attachment:function(name,done){var db=getPouch(this);return db.getAttachment(this.id,name,done)},attach:function(blob,name,type,done){
if(typeof name==="function"){done=name;name=undefined;type=undefined}if(typeof type==="function"){done=type;type=undefined}name=name||blob.filename;type=type||blob.type;var db=getPouch(this);var that=this;return db.putAttachment(this.id,name,this.get("_rev"),blob,type,function(err,response){if(!err&&response.rev){var atts=that.get("_attachments")||{};atts[name]={content_type:type,stub:true};that.set({_id:response.id,_rev:response.rev,_attachments:atts},{silent:true})}done(err,response)})}}}})(this)},{underscore:126}],29:[function(require,module,exports){(function(global){(function(factory){var root=typeof self=="object"&&self.self==self&&self||typeof global=="object"&&global.global==global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)})}else if(typeof exports!=="undefined"){var _=require("underscore"),$;try{$=require("jquery")}catch(e){}factory(root,exports,_,$)}else{root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}})(function(root,Backbone,_,$){var previousBackbone=root.Backbone;var slice=[].slice;Backbone.VERSION="1.2.1";Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var addMethod=function(length,method,attribute){switch(length){case 1:return function(){return _[method](this[attribute])};case 2:return function(value){return _[method](this[attribute],value)};case 3:return function(iteratee,context){return _[method](this[attribute],iteratee,context)};case 4:return function(iteratee,defaultVal,context){return _[method](this[attribute],iteratee,defaultVal,context)};default:return function(){var args=slice.call(arguments);args.unshift(this[attribute]);return _[method].apply(_,args)}}};var addUnderscoreMethods=function(Class,methods,attribute){_.each(methods,function(length,method){if(_[method])Class.prototype[method]=addMethod(length,method,attribute)})};var Events=Backbone.Events={};var eventSplitter=/\s+/;var eventsApi=function(iteratee,memo,name,callback,opts){var i=0,names;if(name&&typeof name==="object"){if(callback!==void 0&&"context"in opts&&opts.context===void 0)opts.context=callback;for(names=_.keys(name);i<names.length;i++){memo=iteratee(memo,names[i],name[names[i]],opts)}}else if(name&&eventSplitter.test(name)){for(names=name.split(eventSplitter);i<names.length;i++){memo=iteratee(memo,names[i],callback,opts)}}else{memo=iteratee(memo,name,callback,opts)}return memo};Events.on=function(name,callback,context){return internalOn(this,name,callback,context)};var internalOn=function(obj,name,callback,context,listening){obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening});if(listening){var listeners=obj._listeners||(obj._listeners={});listeners[listening.id]=listening}return obj};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_.uniqueId("l"));var listeningTo=this._listeningTo||(this._listeningTo={});var listening=listeningTo[id];if(!listening){var thisId=this._listenId||(this._listenId=_.uniqueId("l"));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0}}internalOn(obj,name,callback,this,listening);return this};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]);var context=options.context,ctx=options.ctx,listening=options.listening;if(listening)listening.count++;handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};Events.off=function(name,callback,context){if(!this._events)return this;this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners});return this};Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var ids=obj?[obj._listenId]:_.keys(listeningTo);for(var i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this)}if(_.isEmpty(listeningTo))this._listeningTo=void 0;return this};var offApi=function(events,name,callback,options){if(!events)return;var i=0,listening;var context=options.context,listeners=options.listeners;if(!name&&!callback&&!context){var ids=_.keys(listeners);for(;i<ids.length;i++){listening=listeners[ids[i]];delete listeners[listening.id];delete listening.listeningTo[listening.objId]}return}var names=name?[name]:_.keys(events);for(;i<names.length;i++){name=names[i];var handlers=events[name];if(!handlers)break;var remaining=[];for(var j=0;j<handlers.length;j++){var handler=handlers[j];if(callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context){remaining.push(handler)}else{listening=handler.listening;if(listening&&--listening.count===0){delete listeners[listening.id];delete listening.listeningTo[listening.objId]}}}if(remaining.length){events[name]=remaining}else{delete events[name]}}if(_.size(events))return events};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,_.bind(this.off,this));return this.on(events,void 0,context)};Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,_.bind(this.stopListening,this,obj));return this.listenTo(obj,events)};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_.once(function(){offer(name,once);callback.apply(this,arguments)});once._callback=callback}return map};Events.trigger=function(name){if(!this._events)return this;var length=Math.max(0,arguments.length-1);var args=Array(length);for(var i=0;i<length;i++)args[i]=arguments[i+1];eventsApi(triggerApi,this._events,name,void 0,args);return this};var triggerApi=function(objEvents,name,cb,args){if(objEvents){var events=objEvents[name];var allEvents=objEvents.all;if(events&&allEvents)allEvents=allEvents.slice();if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,[name].concat(args))}return objEvents};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return}};Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId(this.cidPrefix);this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,"defaults"));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},matches:function(attrs){return!!_.iteratee(attrs,this)(this.attributes)},set:function(key,val,options){if(key==null)return this;var attrs;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;var unset=options.unset;var silent=options.silent;var changes=[];var changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}var current=this.attributes;var changed=this.changed;var prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(var attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){changed[attr]=val}else{delete changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=options;for(var i=0;i<changes.length;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var old=this._changing?this._previousAttributes:this.attributes;var changed={};for(var attr in diff){var val=diff[attr];if(_.isEqual(old[attr],val))continue;changed[attr]=val}return _.size(changed)?changed:false},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=_.extend({parse:true},options);var model=this;var success=options.success;options.success=function(resp){var serverAttrs=options.parse?model.parse(resp,options):resp;if(!model.set(serverAttrs,options))return false;if(success)success.call(options.context,model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options=_.extend({validate:true,parse:true},options);var wait=options.wait;if(attrs&&!wait){if(!this.set(attrs,options))return false}else{if(!this._validate(attrs,options))return false}var model=this;var success=options.success;var attributes=this.attributes;options.success=function(resp){model.attributes=attributes;var serverAttrs=options.parse?model.parse(resp,options):resp;if(wait)serverAttrs=_.extend({},attrs,serverAttrs);if(serverAttrs&&!model.set(serverAttrs,options))return false;if(success)success.call(options.context,model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);if(attrs&&wait)this.attributes=_.extend({},attributes,attrs);var method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch"&&!options.attrs)options.attrs=attrs;var xhr=this.sync(method,this,options);this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var wait=options.wait;var destroy=function(){model.stopListening();model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(wait)destroy();if(success)success.call(options.context,model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};var xhr=false;if(this.isNew()){_.defer(options.success)}else{wrapError(this,options);xhr=this.sync("delete",this,options)}if(!wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;var id=this.get(this.idAttribute);return base.replace(/[^\/]$/,"$&/")+encodeURIComponent(id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.defaults({validate:true},options))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return false}});var modelMethods={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};addUnderscoreMethods(Model,modelMethods,"attributes");var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions))},remove:function(models,options){options=_.extend({},options);var singular=!_.isArray(models);models=singular?[models]:_.clone(models);var removed=this._removeModels(models,options);if(!options.silent&&removed)this.trigger("update",this,options);return singular?removed[0]:removed},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse&&!this._isModel(models))models=this.parse(models,options);var singular=!_.isArray(models);models=singular?models?[models]:[]:models.slice();var id,model,attrs,existing,sort;var at=options.at;if(at!=null)at=+at;if(at<0)at+=this.length+1;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;var orderChanged=false;for(var i=0;i<models.length;i++){attrs=models[i];if(existing=this.get(attrs)){if(remove)modelMap[existing.cid]=true;if(merge&&attrs!==existing){attrs=this._isModel(attrs)?attrs.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}models[i]=existing}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);this._addReference(model,options)}model=existing||model;if(!model)continue;id=this.modelId(model.attributes);if(order&&(model.isNew()||!modelMap[id])){order.push(model);orderChanged=orderChanged||!this.models[i]||model.cid!==this.models[i].cid}modelMap[id]=true}if(remove){for(var i=0;i<this.length;i++){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this._removeModels(toRemove,options)}if(toAdd.length||orderChanged){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(var i=0;i<toAdd.length;i++){this.models.splice(at+i,0,toAdd[i])}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(var i=0;i<orderedModels.length;i++){this.models.push(orderedModels[i])}}}if(sort)this.sort({silent:true});if(!options.silent){var addOpts=at!=null?_.clone(options):options;for(var i=0;i<toAdd.length;i++){if(at!=null)addOpts.index=at+i;(model=toAdd[i]).trigger("add",model,this,addOpts)}if(sort||orderChanged)this.trigger("sort",this,options);if(toAdd.length||toRemove.length)this.trigger("update",this,options)}return singular?models[0]:models},reset:function(models,options){options=options?_.clone(options):{};for(var i=0;i<this.models.length;i++){this._removeReference(this.models[i],options)}options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options)},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options)},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(obj==null)return void 0;var id=this.modelId(this._isModel(obj)?obj.attributes:obj);return this._byId[obj]||this._byId[id]||this._byId[obj.cid]},at:function(index){if(index<0)index+=this.length;return this.models[index]},where:function(attrs,first){var matches=_.matches(attrs);return this[first?"find":"filter"](function(model){return matches(model.attributes)})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=_.extend({parse:true},options);var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success.call(options.context,collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};var wait=options.wait;model=this._prepareModel(model,options);if(!model)return false;if(!wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,callbackOpts){if(wait)collection.add(model,callbackOpts);if(success)success.call(callbackOpts.context,model,resp,callbackOpts)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(attrs){return attrs[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(this._isModel(attrs)){if(!attrs.collection)attrs.collection=this;return attrs}options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return false},_removeModels:function(models,options){var removed=[];for(var i=0;i<models.length;i++){var model=this.get(models[i]);if(!model)continue;var index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}removed.push(model);this._removeReference(model,options)}return removed.length?removed:false},_isModel:function(model){return model instanceof Model},_addReference:function(model,options){this._byId[model.cid]=model;var id=this.modelId(model.attributes);if(id!=null)this._byId[id]=model;model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){delete this._byId[model.cid];var id=this.modelId(model.attributes);if(id!=null)delete this._byId[id];if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(event==="change"){var prevId=this.modelId(model.previousAttributes());var id=this.modelId(model.attributes);if(prevId!==id){if(prevId!=null)delete this._byId[prevId];if(id!=null)this._byId[id]=model}}this.trigger.apply(this,arguments)}});var collectionMethods={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:2,contains:2,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3};addUnderscoreMethods(Collection,collectionMethods,"models");var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){if(!_[method])return;Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments)};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(element){this.undelegateEvents();this._setElement(element);this.delegateEvents();return this},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el);this.el=this.$el[0]},delegateEvents:function(events){events||(events=_.result(this,"events"));if(!events)return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[method];if(!method)continue;var match=key.match(delegateEventSplitter);this.delegate(match[1],match[2],_.bind(method,this))}return this},delegate:function(eventName,selector,listener){this.$el.on(eventName+".delegateEvents"+this.cid,selector,listener);return this},undelegateEvents:function(){if(this.$el)this.$el.off(".delegateEvents"+this.cid);return this},undelegate:function(eventName,selector,listener){this.$el.off(eventName+".delegateEvents"+this.cid,selector,listener);return this},_createElement:function(tagName){return document.createElement(tagName)},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");this.setElement(this._createElement(_.result(this,"tagName")));this._setAttributes(attrs)}else{this.setElement(_.result(this,"el"))}},_setAttributes:function(attributes){this.$el.attr(attributes)}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}var error=options.error;options.error=function(xhr,textStatus,errorThrown){options.textStatus=textStatus;options.errorThrown=errorThrown;if(error)error.call(options.context,xhr,textStatus,errorThrown)};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);if(router.execute(callback,args,name)!==false){router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)}});return this},execute:function(callback,args,name){if(callback)callback.apply(this,args)},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)");return new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){var path=this.location.pathname.replace(/[^\/]$/,"$&/");return path===this.root&&!this.getSearch()},matchRoot:function(){var path=this.decodeFragment(this.location.pathname);var root=path.slice(0,this.root.length-1)+"/";return root===this.root},decodeFragment:function(fragment){return decodeURI(fragment.replace(/%25/g,"%2525"))},getSearch:function(){var match=this.location.href.replace(/#.*/,"").match(/\?.+/);return match?match[0]:""},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getPath:function(){var path=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return path.charAt(0)==="/"?path.slice(1):path},getFragment:function(fragment){if(fragment==null){if(this._usePushState||!this._wantsHashChange){fragment=this.getPath()}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange"in window;this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(rootStripper,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var root=this.root.slice(0,-1)||"/";this.location.replace(root+"#"+this.getPath());return true}else if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var body=document.body;var iWindow=body.insertBefore(this.iframe,body.firstChild).contentWindow;iWindow.document.open();iWindow.document.close();iWindow.location.hash="#"+this.fragment}var addEventListener=window.addEventListener||function(eventName,listener){return attachEvent("on"+eventName,listener)};if(this._usePushState){addEventListener("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){addEventListener("hashchange",this.checkUrl,false)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}if(!this.options.silent)return this.loadUrl()},stop:function(){var removeEventListener=window.removeEventListener||function(eventName,listener){return detachEvent("on"+eventName,listener)};if(this._usePushState){removeEventListener("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){removeEventListener("hashchange",this.checkUrl,false)}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getHash(this.iframe.contentWindow)}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()},loadUrl:function(fragment){if(!this.matchRoot())return false;fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}})},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};fragment=this.getFragment(fragment||"");var root=this.root;if(fragment===""||fragment.charAt(0)==="?"){root=root.slice(0,-1)||"/"}var url=root+fragment;fragment=this.decodeFragment(fragment.replace(pathStripper,""));if(this.fragment===fragment)return;this.fragment=fragment;if(this._usePushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getHash(this.iframe.contentWindow)){var iWindow=this.iframe.contentWindow;if(!options.replace){iWindow.document.open();iWindow.document.close()}this._updateHash(iWindow.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)return this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error.call(options.context,model,resp,options);model.trigger("error",model,resp,options)}};return Backbone})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{jquery:34,underscore:126}],30:[function(require,module,exports){(function(window,document,undefined){(function(factory){"use strict";if(typeof define==="function"&&define.amd){define("datatables",["jquery"],factory)}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else if(jQuery&&!jQuery.fn.dataTable){
factory(jQuery)}})(function($){"use strict";var DataTable;var _ext;var _Api;var _api_register;var _api_registerPlural;var _re_dic={};var _re_new_lines=/[\r\n]/g;var _re_html=/<.*?>/g;var _re_date_start=/^[\w\+\-]/;var _re_date_end=/[\w\+\-]$/;var _re_escape_regex=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\","$","^","-"].join("|\\")+")","g");var _re_formatted_numeric=/[',$£€¥%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi;var _empty=function(d){return!d||d===true||d==="-"?true:false};var _intVal=function(s){var integer=parseInt(s,10);return!isNaN(integer)&&isFinite(s)?integer:null};var _numToDecimal=function(num,decimalPoint){if(!_re_dic[decimalPoint]){_re_dic[decimalPoint]=new RegExp(_fnEscapeRegex(decimalPoint),"g")}return typeof num==="string"&&decimalPoint!=="."?num.replace(/\./g,"").replace(_re_dic[decimalPoint],"."):num};var _isNumber=function(d,decimalPoint,formatted){var strType=typeof d==="string";if(_empty(d)){return true}if(decimalPoint&&strType){d=_numToDecimal(d,decimalPoint)}if(formatted&&strType){d=d.replace(_re_formatted_numeric,"")}return!isNaN(parseFloat(d))&&isFinite(d)};var _isHtml=function(d){return _empty(d)||typeof d==="string"};var _htmlNumeric=function(d,decimalPoint,formatted){if(_empty(d)){return true}var html=_isHtml(d);return!html?null:_isNumber(_stripHtml(d),decimalPoint,formatted)?true:null};var _pluck=function(a,prop,prop2){var out=[];var i=0,ien=a.length;if(prop2!==undefined){for(;i<ien;i++){if(a[i]&&a[i][prop]){out.push(a[i][prop][prop2])}}}else{for(;i<ien;i++){if(a[i]){out.push(a[i][prop])}}}return out};var _pluck_order=function(a,order,prop,prop2){var out=[];var i=0,ien=order.length;if(prop2!==undefined){for(;i<ien;i++){if(a[order[i]][prop]){out.push(a[order[i]][prop][prop2])}}}else{for(;i<ien;i++){out.push(a[order[i]][prop])}}return out};var _range=function(len,start){var out=[];var end;if(start===undefined){start=0;end=len}else{end=start;start=len}for(var i=start;i<end;i++){out.push(i)}return out};var _removeEmpty=function(a){var out=[];for(var i=0,ien=a.length;i<ien;i++){if(a[i]){out.push(a[i])}}return out};var _stripHtml=function(d){return d.replace(_re_html,"")};var _unique=function(src){var out=[],val,i,ien=src.length,j,k=0;again:for(i=0;i<ien;i++){val=src[i];for(j=0;j<k;j++){if(out[j]===val){continue again}}out.push(val);k++}return out};function _fnHungarianMap(o){var hungarian="a aa ai ao as b fn i m o s ",match,newKey,map={};$.each(o,function(key,val){match=key.match(/^([^A-Z]+?)([A-Z])/);if(match&&hungarian.indexOf(match[1]+" ")!==-1){newKey=key.replace(match[0],match[2].toLowerCase());map[newKey]=key;if(match[1]==="o"){_fnHungarianMap(o[key])}}});o._hungarianMap=map}function _fnCamelToHungarian(src,user,force){if(!src._hungarianMap){_fnHungarianMap(src)}var hungarianKey;$.each(user,function(key,val){hungarianKey=src._hungarianMap[key];if(hungarianKey!==undefined&&(force||user[hungarianKey]===undefined)){if(hungarianKey.charAt(0)==="o"){if(!user[hungarianKey]){user[hungarianKey]={}}$.extend(true,user[hungarianKey],user[key]);_fnCamelToHungarian(src[hungarianKey],user[hungarianKey],force)}else{user[hungarianKey]=user[key]}}})}function _fnLanguageCompat(lang){var defaults=DataTable.defaults.oLanguage;var zeroRecords=lang.sZeroRecords;if(!lang.sEmptyTable&&zeroRecords&&defaults.sEmptyTable==="No data available in table"){_fnMap(lang,lang,"sZeroRecords","sEmptyTable")}if(!lang.sLoadingRecords&&zeroRecords&&defaults.sLoadingRecords==="Loading..."){_fnMap(lang,lang,"sZeroRecords","sLoadingRecords")}if(lang.sInfoThousands){lang.sThousands=lang.sInfoThousands}var decimal=lang.sDecimal;if(decimal){_addNumericSort(decimal)}}var _fnCompatMap=function(o,knew,old){if(o[knew]!==undefined){o[old]=o[knew]}};function _fnCompatOpts(init){_fnCompatMap(init,"ordering","bSort");_fnCompatMap(init,"orderMulti","bSortMulti");_fnCompatMap(init,"orderClasses","bSortClasses");_fnCompatMap(init,"orderCellsTop","bSortCellsTop");_fnCompatMap(init,"order","aaSorting");_fnCompatMap(init,"orderFixed","aaSortingFixed");_fnCompatMap(init,"paging","bPaginate");_fnCompatMap(init,"pagingType","sPaginationType");_fnCompatMap(init,"pageLength","iDisplayLength");_fnCompatMap(init,"searching","bFilter");var searchCols=init.aoSearchCols;if(searchCols){for(var i=0,ien=searchCols.length;i<ien;i++){if(searchCols[i]){_fnCamelToHungarian(DataTable.models.oSearch,searchCols[i])}}}}function _fnCompatCols(init){_fnCompatMap(init,"orderable","bSortable");_fnCompatMap(init,"orderData","aDataSort");_fnCompatMap(init,"orderSequence","asSorting");_fnCompatMap(init,"orderDataType","sortDataType");var dataSort=init.aDataSort;if(dataSort&&!$.isArray(dataSort)){init.aDataSort=[dataSort]}}function _fnBrowserDetect(settings){var browser=settings.oBrowser;var n=$("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append($("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append($('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body");var test=n.find(".test");browser.bScrollOversize=test[0].offsetWidth===100;browser.bScrollbarLeft=Math.round(test.offset().left)!==1;n.remove()}function _fnReduce(that,fn,init,start,end,inc){var i=start,value,isSet=false;if(init!==undefined){value=init;isSet=true}while(i!==end){if(!that.hasOwnProperty(i)){continue}value=isSet?fn(value,that[i],i,that):that[i];isSet=true;i+=inc}return value}function _fnAddColumn(oSettings,nTh){var oDefaults=DataTable.defaults.column;var iCol=oSettings.aoColumns.length;var oCol=$.extend({},DataTable.models.oColumn,oDefaults,{nTh:nTh?nTh:document.createElement("th"),sTitle:oDefaults.sTitle?oDefaults.sTitle:nTh?nTh.innerHTML:"",aDataSort:oDefaults.aDataSort?oDefaults.aDataSort:[iCol],mData:oDefaults.mData?oDefaults.mData:iCol,idx:iCol});oSettings.aoColumns.push(oCol);var searchCols=oSettings.aoPreSearchCols;searchCols[iCol]=$.extend({},DataTable.models.oSearch,searchCols[iCol]);_fnColumnOptions(oSettings,iCol,$(nTh).data())}function _fnColumnOptions(oSettings,iCol,oOptions){var oCol=oSettings.aoColumns[iCol];var oClasses=oSettings.oClasses;var th=$(oCol.nTh);if(!oCol.sWidthOrig){oCol.sWidthOrig=th.attr("width")||null;var t=(th.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);if(t){oCol.sWidthOrig=t[1]}}if(oOptions!==undefined&&oOptions!==null){_fnCompatCols(oOptions);_fnCamelToHungarian(DataTable.defaults.column,oOptions);if(oOptions.mDataProp!==undefined&&!oOptions.mData){oOptions.mData=oOptions.mDataProp}if(oOptions.sType){oCol._sManualType=oOptions.sType}if(oOptions.className&&!oOptions.sClass){oOptions.sClass=oOptions.className}$.extend(oCol,oOptions);_fnMap(oCol,oOptions,"sWidth","sWidthOrig");if(oOptions.iDataSort!==undefined){oCol.aDataSort=[oOptions.iDataSort]}_fnMap(oCol,oOptions,"aDataSort")}var mDataSrc=oCol.mData;var mData=_fnGetObjectDataFn(mDataSrc);var mRender=oCol.mRender?_fnGetObjectDataFn(oCol.mRender):null;var attrTest=function(src){return typeof src==="string"&&src.indexOf("@")!==-1};oCol._bAttrSrc=$.isPlainObject(mDataSrc)&&(attrTest(mDataSrc.sort)||attrTest(mDataSrc.type)||attrTest(mDataSrc.filter));oCol.fnGetData=function(rowData,type,meta){var innerData=mData(rowData,type,undefined,meta);return mRender&&type?mRender(innerData,type,rowData,meta):innerData};oCol.fnSetData=function(rowData,val,meta){return _fnSetObjectDataFn(mDataSrc)(rowData,val,meta)};if(typeof mDataSrc!=="number"){oSettings._rowReadObject=true}if(!oSettings.oFeatures.bSort){oCol.bSortable=false;th.addClass(oClasses.sSortableNone)}var bAsc=$.inArray("asc",oCol.asSorting)!==-1;var bDesc=$.inArray("desc",oCol.asSorting)!==-1;if(!oCol.bSortable||!bAsc&&!bDesc){oCol.sSortingClass=oClasses.sSortableNone;oCol.sSortingClassJUI=""}else if(bAsc&&!bDesc){oCol.sSortingClass=oClasses.sSortableAsc;oCol.sSortingClassJUI=oClasses.sSortJUIAscAllowed}else if(!bAsc&&bDesc){oCol.sSortingClass=oClasses.sSortableDesc;oCol.sSortingClassJUI=oClasses.sSortJUIDescAllowed}else{oCol.sSortingClass=oClasses.sSortable;oCol.sSortingClassJUI=oClasses.sSortJUI}}function _fnAdjustColumnSizing(settings){if(settings.oFeatures.bAutoWidth!==false){var columns=settings.aoColumns;_fnCalculateColumnWidths(settings);for(var i=0,iLen=columns.length;i<iLen;i++){columns[i].nTh.style.width=columns[i].sWidth}}var scroll=settings.oScroll;if(scroll.sY!==""||scroll.sX!==""){_fnScrollDraw(settings)}_fnCallbackFire(settings,null,"column-sizing",[settings])}function _fnVisibleToColumnIndex(oSettings,iMatch){var aiVis=_fnGetColumns(oSettings,"bVisible");return typeof aiVis[iMatch]==="number"?aiVis[iMatch]:null}function _fnColumnIndexToVisible(oSettings,iMatch){var aiVis=_fnGetColumns(oSettings,"bVisible");var iPos=$.inArray(iMatch,aiVis);return iPos!==-1?iPos:null}function _fnVisbleColumns(oSettings){return _fnGetColumns(oSettings,"bVisible").length}function _fnGetColumns(oSettings,sParam){var a=[];$.map(oSettings.aoColumns,function(val,i){if(val[sParam]){a.push(i)}});return a}function _fnColumnTypes(settings){var columns=settings.aoColumns;var data=settings.aoData;var types=DataTable.ext.type.detect;var i,ien,j,jen,k,ken;var col,cell,detectedType,cache;for(i=0,ien=columns.length;i<ien;i++){col=columns[i];cache=[];if(!col.sType&&col._sManualType){col.sType=col._sManualType}else if(!col.sType){for(j=0,jen=types.length;j<jen;j++){for(k=0,ken=data.length;k<ken;k++){if(cache[k]===undefined){cache[k]=_fnGetCellData(settings,k,i,"type")}detectedType=types[j](cache[k],settings);if(!detectedType&&j!==types.length-1){break}if(detectedType==="html"){break}}if(detectedType){col.sType=detectedType;break}}if(!col.sType){col.sType="string"}}}}function _fnApplyColumnDefs(oSettings,aoColDefs,aoCols,fn){var i,iLen,j,jLen,k,kLen,def;var columns=oSettings.aoColumns;if(aoColDefs){for(i=aoColDefs.length-1;i>=0;i--){def=aoColDefs[i];var aTargets=def.targets!==undefined?def.targets:def.aTargets;if(!$.isArray(aTargets)){aTargets=[aTargets]}for(j=0,jLen=aTargets.length;j<jLen;j++){if(typeof aTargets[j]==="number"&&aTargets[j]>=0){while(columns.length<=aTargets[j]){_fnAddColumn(oSettings)}fn(aTargets[j],def)}else if(typeof aTargets[j]==="number"&&aTargets[j]<0){fn(columns.length+aTargets[j],def)}else if(typeof aTargets[j]==="string"){for(k=0,kLen=columns.length;k<kLen;k++){if(aTargets[j]=="_all"||$(columns[k].nTh).hasClass(aTargets[j])){fn(k,def)}}}}}}if(aoCols){for(i=0,iLen=aoCols.length;i<iLen;i++){fn(i,aoCols[i])}}}function _fnAddData(oSettings,aDataIn,nTr,anTds){var iRow=oSettings.aoData.length;var oData=$.extend(true,{},DataTable.models.oRow,{src:nTr?"dom":"data"});oData._aData=aDataIn;oSettings.aoData.push(oData);var nTd,sThisType;var columns=oSettings.aoColumns;for(var i=0,iLen=columns.length;i<iLen;i++){if(nTr){_fnSetCellData(oSettings,iRow,i,_fnGetCellData(oSettings,iRow,i))}columns[i].sType=null}oSettings.aiDisplayMaster.push(iRow);if(nTr||!oSettings.oFeatures.bDeferRender){_fnCreateTr(oSettings,iRow,nTr,anTds)}return iRow}function _fnAddTr(settings,trs){var row;if(!(trs instanceof $)){trs=$(trs)}return trs.map(function(i,el){row=_fnGetRowElements(settings,el);return _fnAddData(settings,row.data,el,row.cells)})}function _fnNodeToDataIndex(oSettings,n){return n._DT_RowIndex!==undefined?n._DT_RowIndex:null}function _fnNodeToColumnIndex(oSettings,iRow,n){return $.inArray(n,oSettings.aoData[iRow].anCells)}function _fnGetCellData(settings,rowIdx,colIdx,type){var draw=settings.iDraw;var col=settings.aoColumns[colIdx];var rowData=settings.aoData[rowIdx]._aData;var defaultContent=col.sDefaultContent;var cellData=col.fnGetData(rowData,type,{settings:settings,row:rowIdx,col:colIdx});if(cellData===undefined){if(settings.iDrawError!=draw&&defaultContent===null){_fnLog(settings,0,"Requested unknown parameter "+(typeof col.mData=="function"?"{function}":"'"+col.mData+"'")+" for row "+rowIdx,4);settings.iDrawError=draw}return defaultContent}if((cellData===rowData||cellData===null)&&defaultContent!==null){cellData=defaultContent}else if(typeof cellData==="function"){return cellData.call(rowData)}if(cellData===null&&type=="display"){return""}return cellData}function _fnSetCellData(settings,rowIdx,colIdx,val){var col=settings.aoColumns[colIdx];var rowData=settings.aoData[rowIdx]._aData;col.fnSetData(rowData,val,{settings:settings,row:rowIdx,col:colIdx})}var __reArray=/\[.*?\]$/;var __reFn=/\(\)$/;function _fnSplitObjNotation(str){return $.map(str.match(/(\\.|[^\.])+/g),function(s){return s.replace(/\\./g,".")})}function _fnGetObjectDataFn(mSource){if($.isPlainObject(mSource)){var o={};$.each(mSource,function(key,val){if(val){o[key]=_fnGetObjectDataFn(val)}});return function(data,type,row,meta){var t=o[type]||o._;return t!==undefined?t(data,type,row,meta):data}}else if(mSource===null){return function(data){return data}}else if(typeof mSource==="function"){return function(data,type,row,meta){return mSource(data,type,row,meta)}}else if(typeof mSource==="string"&&(mSource.indexOf(".")!==-1||mSource.indexOf("[")!==-1||mSource.indexOf("(")!==-1)){var fetchData=function(data,type,src){var arrayNotation,funcNotation,out,innerSrc;if(src!==""){var a=_fnSplitObjNotation(src);for(var i=0,iLen=a.length;i<iLen;i++){arrayNotation=a[i].match(__reArray);funcNotation=a[i].match(__reFn);if(arrayNotation){a[i]=a[i].replace(__reArray,"");if(a[i]!==""){data=data[a[i]]}out=[];a.splice(0,i+1);innerSrc=a.join(".");for(var j=0,jLen=data.length;j<jLen;j++){out.push(fetchData(data[j],type,innerSrc))}var join=arrayNotation[0].substring(1,arrayNotation[0].length-1);data=join===""?out:out.join(join);break}else if(funcNotation){a[i]=a[i].replace(__reFn,"");data=data[a[i]]();continue}if(data===null||data[a[i]]===undefined){return undefined}data=data[a[i]]}}return data};return function(data,type){return fetchData(data,type,mSource)}}else{return function(data,type){return data[mSource]}}}function _fnSetObjectDataFn(mSource){if($.isPlainObject(mSource)){return _fnSetObjectDataFn(mSource._)}else if(mSource===null){return function(){}}else if(typeof mSource==="function"){return function(data,val,meta){mSource(data,"set",val,meta)}}else if(typeof mSource==="string"&&(mSource.indexOf(".")!==-1||mSource.indexOf("[")!==-1||mSource.indexOf("(")!==-1)){var setData=function(data,val,src){var a=_fnSplitObjNotation(src),b;var aLast=a[a.length-1];var arrayNotation,funcNotation,o,innerSrc;for(var i=0,iLen=a.length-1;i<iLen;i++){arrayNotation=a[i].match(__reArray);funcNotation=a[i].match(__reFn);if(arrayNotation){a[i]=a[i].replace(__reArray,"");data[a[i]]=[];b=a.slice();b.splice(0,i+1);innerSrc=b.join(".");for(var j=0,jLen=val.length;j<jLen;j++){o={};setData(o,val[j],innerSrc);data[a[i]].push(o)}return}else if(funcNotation){a[i]=a[i].replace(__reFn,"");data=data[a[i]](val)}if(data[a[i]]===null||data[a[i]]===undefined){data[a[i]]={}}data=data[a[i]]}if(aLast.match(__reFn)){data=data[aLast.replace(__reFn,"")](val)}else{data[aLast.replace(__reArray,"")]=val}};return function(data,val){return setData(data,val,mSource)}}else{return function(data,val){data[mSource]=val}}}function _fnGetDataMaster(settings){return _pluck(settings.aoData,"_aData")}function _fnClearTable(settings){settings.aoData.length=0;settings.aiDisplayMaster.length=0;settings.aiDisplay.length=0}function _fnDeleteIndex(a,iTarget,splice){var iTargetIndex=-1;for(var i=0,iLen=a.length;i<iLen;i++){if(a[i]==iTarget){iTargetIndex=i}else if(a[i]>iTarget){a[i]--}}if(iTargetIndex!=-1&&splice===undefined){a.splice(iTargetIndex,1)}}function _fnInvalidate(settings,rowIdx,src,colIdx){var row=settings.aoData[rowIdx];var i,ien;var cellWrite=function(cell,col){while(cell.childNodes.length){cell.removeChild(cell.firstChild)}cell.innerHTML=_fnGetCellData(settings,rowIdx,col,"display")};if(src==="dom"||(!src||src==="auto")&&row.src==="dom"){row._aData=_fnGetRowElements(settings,row,colIdx,colIdx===undefined?undefined:row._aData).data}else{var cells=row.anCells;if(cells){if(colIdx!==undefined){cellWrite(cells[colIdx],colIdx)}else{for(i=0,ien=cells.length;i<ien;i++){cellWrite(cells[i],i)}}}}row._aSortData=null;row._aFilterData=null;var cols=settings.aoColumns;if(colIdx!==undefined){cols[colIdx].sType=null}else{for(i=0,ien=cols.length;i<ien;i++){cols[i].sType=null}_fnRowAttributes(row)}}function _fnGetRowElements(settings,row,colIdx,d){var tds=[],td=row.firstChild,name,col,o,i=0,contents,columns=settings.aoColumns,objectRead=settings._rowReadObject;d=d||objectRead?{}:[];var attr=function(str,td){if(typeof str==="string"){var idx=str.indexOf("@");if(idx!==-1){var attr=str.substring(idx+1);var setter=_fnSetObjectDataFn(str);setter(d,td.getAttribute(attr))}}};var cellProcess=function(cell){if(colIdx===undefined||colIdx===i){col=columns[i];contents=$.trim(cell.innerHTML);if(col&&col._bAttrSrc){var setter=_fnSetObjectDataFn(col.mData._);setter(d,contents);attr(col.mData.sort,cell);attr(col.mData.type,cell);attr(col.mData.filter,cell)}else{if(objectRead){if(!col._setter){col._setter=_fnSetObjectDataFn(col.mData)}col._setter(d,contents)}else{d[i]=contents}}}i++};if(td){while(td){name=td.nodeName.toUpperCase();if(name=="TD"||name=="TH"){cellProcess(td);tds.push(td)}td=td.nextSibling}}else{tds=row.anCells;for(var j=0,jen=tds.length;j<jen;j++){cellProcess(tds[j])}}return{data:d,cells:tds}}function _fnCreateTr(oSettings,iRow,nTrIn,anTds){var row=oSettings.aoData[iRow],rowData=row._aData,cells=[],nTr,nTd,oCol,i,iLen;if(row.nTr===null){nTr=nTrIn||document.createElement("tr");row.nTr=nTr;row.anCells=cells;nTr._DT_RowIndex=iRow;_fnRowAttributes(row);for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++){oCol=oSettings.aoColumns[i];nTd=nTrIn?anTds[i]:document.createElement(oCol.sCellType);cells.push(nTd);if(!nTrIn||oCol.mRender||oCol.mData!==i){nTd.innerHTML=_fnGetCellData(oSettings,iRow,i,"display")}if(oCol.sClass){nTd.className+=" "+oCol.sClass}if(oCol.bVisible&&!nTrIn){nTr.appendChild(nTd)}else if(!oCol.bVisible&&nTrIn){nTd.parentNode.removeChild(nTd)}if(oCol.fnCreatedCell){oCol.fnCreatedCell.call(oSettings.oInstance,nTd,_fnGetCellData(oSettings,iRow,i),rowData,iRow,i)}}_fnCallbackFire(oSettings,"aoRowCreatedCallback",null,[nTr,rowData,iRow])}row.nTr.setAttribute("role","row")}function _fnRowAttributes(row){var tr=row.nTr;var data=row._aData;if(tr){if(data.DT_RowId){tr.id=data.DT_RowId}if(data.DT_RowClass){var a=data.DT_RowClass.split(" ");row.__rowc=row.__rowc?_unique(row.__rowc.concat(a)):a;$(tr).removeClass(row.__rowc.join(" ")).addClass(data.DT_RowClass)}if(data.DT_RowAttr){$(tr).attr(data.DT_RowAttr)}if(data.DT_RowData){$(tr).data(data.DT_RowData)}}}function _fnBuildHead(oSettings){var i,ien,cell,row,column;var thead=oSettings.nTHead;var tfoot=oSettings.nTFoot;var createHeader=$("th, td",thead).length===0;var classes=oSettings.oClasses;var columns=oSettings.aoColumns;if(createHeader){row=$("<tr/>").appendTo(thead)}for(i=0,ien=columns.length;i<ien;i++){column=columns[i];cell=$(column.nTh).addClass(column.sClass);if(createHeader){cell.appendTo(row)}if(oSettings.oFeatures.bSort){cell.addClass(column.sSortingClass);if(column.bSortable!==false){cell.attr("tabindex",oSettings.iTabIndex).attr("aria-controls",oSettings.sTableId);_fnSortAttachListener(oSettings,column.nTh,i)}}if(column.sTitle!=cell.html()){cell.html(column.sTitle)}_fnRenderer(oSettings,"header")(oSettings,cell,column,classes)}if(createHeader){_fnDetectHeader(oSettings.aoHeader,thead)}$(thead).find(">tr").attr("role","row");$(thead).find(">tr>th, >tr>td").addClass(classes.sHeaderTH);$(tfoot).find(">tr>th, >tr>td").addClass(classes.sFooterTH);if(tfoot!==null){var cells=oSettings.aoFooter[0];for(i=0,ien=cells.length;i<ien;i++){column=columns[i];column.nTf=cells[i].cell;if(column.sClass){$(column.nTf).addClass(column.sClass)}}}}function _fnDrawHead(oSettings,aoSource,bIncludeHidden){var i,iLen,j,jLen,k,kLen,n,nLocalTr;var aoLocal=[];var aApplied=[];var iColumns=oSettings.aoColumns.length;var iRowspan,iColspan;if(!aoSource){return}if(bIncludeHidden===undefined){bIncludeHidden=false}for(i=0,iLen=aoSource.length;i<iLen;i++){aoLocal[i]=aoSource[i].slice();aoLocal[i].nTr=aoSource[i].nTr;for(j=iColumns-1;j>=0;j--){if(!oSettings.aoColumns[j].bVisible&&!bIncludeHidden){aoLocal[i].splice(j,1)}}aApplied.push([])}for(i=0,iLen=aoLocal.length;i<iLen;i++){nLocalTr=aoLocal[i].nTr;if(nLocalTr){while(n=nLocalTr.firstChild){nLocalTr.removeChild(n)}}for(j=0,jLen=aoLocal[i].length;j<jLen;j++){iRowspan=1;iColspan=1;if(aApplied[i][j]===undefined){nLocalTr.appendChild(aoLocal[i][j].cell);aApplied[i][j]=1;while(aoLocal[i+iRowspan]!==undefined&&aoLocal[i][j].cell==aoLocal[i+iRowspan][j].cell){aApplied[i+iRowspan][j]=1;iRowspan++}while(aoLocal[i][j+iColspan]!==undefined&&aoLocal[i][j].cell==aoLocal[i][j+iColspan].cell){for(k=0;k<iRowspan;k++){aApplied[i+k][j+iColspan]=1}iColspan++}$(aoLocal[i][j].cell).attr("rowspan",iRowspan).attr("colspan",iColspan)}}}}function _fnDraw(oSettings){var aPreDraw=_fnCallbackFire(oSettings,"aoPreDrawCallback","preDraw",[oSettings]);if($.inArray(false,aPreDraw)!==-1){_fnProcessingDisplay(oSettings,false);return}var i,iLen,n;var anRows=[];var iRowCount=0;var asStripeClasses=oSettings.asStripeClasses;var iStripes=asStripeClasses.length;var iOpenRows=oSettings.aoOpenRows.length;var oLang=oSettings.oLanguage;var iInitDisplayStart=oSettings.iInitDisplayStart;var bServerSide=_fnDataSource(oSettings)=="ssp";var aiDisplay=oSettings.aiDisplay;oSettings.bDrawing=true;if(iInitDisplayStart!==undefined&&iInitDisplayStart!==-1){oSettings._iDisplayStart=bServerSide?iInitDisplayStart:iInitDisplayStart>=oSettings.fnRecordsDisplay()?0:iInitDisplayStart;oSettings.iInitDisplayStart=-1}var iDisplayStart=oSettings._iDisplayStart;var iDisplayEnd=oSettings.fnDisplayEnd();if(oSettings.bDeferLoading){oSettings.bDeferLoading=false;oSettings.iDraw++;_fnProcessingDisplay(oSettings,false)}else if(!bServerSide){oSettings.iDraw++}else if(!oSettings.bDestroying&&!_fnAjaxUpdate(oSettings)){return}if(aiDisplay.length!==0){var iStart=bServerSide?0:iDisplayStart;var iEnd=bServerSide?oSettings.aoData.length:iDisplayEnd;for(var j=iStart;j<iEnd;j++){var iDataIndex=aiDisplay[j];var aoData=oSettings.aoData[iDataIndex];if(aoData.nTr===null){_fnCreateTr(oSettings,iDataIndex)}var nRow=aoData.nTr;if(iStripes!==0){var sStripe=asStripeClasses[iRowCount%iStripes];if(aoData._sRowStripe!=sStripe){$(nRow).removeClass(aoData._sRowStripe).addClass(sStripe);aoData._sRowStripe=sStripe}}_fnCallbackFire(oSettings,"aoRowCallback",null,[nRow,aoData._aData,iRowCount,j]);anRows.push(nRow);iRowCount++}}else{var sZero=oLang.sZeroRecords;if(oSettings.iDraw==1&&_fnDataSource(oSettings)=="ajax"){sZero=oLang.sLoadingRecords}else if(oLang.sEmptyTable&&oSettings.fnRecordsTotal()===0){sZero=oLang.sEmptyTable}anRows[0]=$("<tr/>",{"class":iStripes?asStripeClasses[0]:""}).append($("<td />",{valign:"top",colSpan:_fnVisbleColumns(oSettings),"class":oSettings.oClasses.sRowEmpty}).html(sZero))[0]}_fnCallbackFire(oSettings,"aoHeaderCallback","header",[$(oSettings.nTHead).children("tr")[0],_fnGetDataMaster(oSettings),iDisplayStart,iDisplayEnd,aiDisplay]);_fnCallbackFire(oSettings,"aoFooterCallback","footer",[$(oSettings.nTFoot).children("tr")[0],_fnGetDataMaster(oSettings),iDisplayStart,iDisplayEnd,aiDisplay]);var body=$(oSettings.nTBody);body.children().detach();body.append($(anRows));_fnCallbackFire(oSettings,"aoDrawCallback","draw",[oSettings]);oSettings.bSorted=false;oSettings.bFiltered=false;oSettings.bDrawing=false}function _fnReDraw(settings,holdPosition){var features=settings.oFeatures,sort=features.bSort,filter=features.bFilter;if(sort){_fnSort(settings)}if(filter){_fnFilterComplete(settings,settings.oPreviousSearch)}else{settings.aiDisplay=settings.aiDisplayMaster.slice()}if(holdPosition!==true){settings._iDisplayStart=0}settings._drawHold=holdPosition;_fnDraw(settings);settings._drawHold=false}function _fnAddOptionsHtml(oSettings){var classes=oSettings.oClasses;var table=$(oSettings.nTable);var holding=$("<div/>").insertBefore(table);var features=oSettings.oFeatures;var insert=$("<div/>",{id:oSettings.sTableId+"_wrapper","class":classes.sWrapper+(oSettings.nTFoot?"":" "+classes.sNoFooter)});oSettings.nHolding=holding[0];oSettings.nTableWrapper=insert[0];oSettings.nTableReinsertBefore=oSettings.nTable.nextSibling;var aDom=oSettings.sDom.split("");var featureNode,cOption,nNewNode,cNext,sAttr,j;for(var i=0;i<aDom.length;i++){featureNode=null;cOption=aDom[i];if(cOption=="<"){nNewNode=$("<div/>")[0];cNext=aDom[i+1];if(cNext=="'"||cNext=='"'){sAttr="";j=2;while(aDom[i+j]!=cNext){sAttr+=aDom[i+j];j++}if(sAttr=="H"){sAttr=classes.sJUIHeader}else if(sAttr=="F"){sAttr=classes.sJUIFooter}if(sAttr.indexOf(".")!=-1){var aSplit=sAttr.split(".");nNewNode.id=aSplit[0].substr(1,aSplit[0].length-1);nNewNode.className=aSplit[1]}else if(sAttr.charAt(0)=="#"){nNewNode.id=sAttr.substr(1,sAttr.length-1)}else{nNewNode.className=sAttr}i+=j}insert.append(nNewNode);insert=$(nNewNode)}else if(cOption==">"){insert=insert.parent()}else if(cOption=="l"&&features.bPaginate&&features.bLengthChange){featureNode=_fnFeatureHtmlLength(oSettings)}else if(cOption=="f"&&features.bFilter){featureNode=_fnFeatureHtmlFilter(oSettings)}else if(cOption=="r"&&features.bProcessing){featureNode=_fnFeatureHtmlProcessing(oSettings)}else if(cOption=="t"){featureNode=_fnFeatureHtmlTable(oSettings)}else if(cOption=="i"&&features.bInfo){featureNode=_fnFeatureHtmlInfo(oSettings)}else if(cOption=="p"&&features.bPaginate){featureNode=_fnFeatureHtmlPaginate(oSettings)}else if(DataTable.ext.feature.length!==0){var aoFeatures=DataTable.ext.feature;for(var k=0,kLen=aoFeatures.length;k<kLen;k++){if(cOption==aoFeatures[k].cFeature){featureNode=aoFeatures[k].fnInit(oSettings);break}}}if(featureNode){var aanFeatures=oSettings.aanFeatures;if(!aanFeatures[cOption]){aanFeatures[cOption]=[]}aanFeatures[cOption].push(featureNode);insert.append(featureNode)}}holding.replaceWith(insert)}function _fnDetectHeader(aLayout,nThead){var nTrs=$(nThead).children("tr");var nTr,nCell;var i,k,l,iLen,jLen,iColShifted,iColumn,iColspan,iRowspan;var bUnique;var fnShiftCol=function(a,i,j){var k=a[i];while(k[j]){j++}return j};aLayout.splice(0,aLayout.length);for(i=0,iLen=nTrs.length;i<iLen;i++){aLayout.push([])}for(i=0,iLen=nTrs.length;i<iLen;i++){nTr=nTrs[i];iColumn=0;nCell=nTr.firstChild;while(nCell){if(nCell.nodeName.toUpperCase()=="TD"||nCell.nodeName.toUpperCase()=="TH"){iColspan=nCell.getAttribute("colspan")*1;iRowspan=nCell.getAttribute("rowspan")*1;iColspan=!iColspan||iColspan===0||iColspan===1?1:iColspan;iRowspan=!iRowspan||iRowspan===0||iRowspan===1?1:iRowspan;iColShifted=fnShiftCol(aLayout,i,iColumn);bUnique=iColspan===1?true:false;for(l=0;l<iColspan;l++){for(k=0;k<iRowspan;k++){aLayout[i+k][iColShifted+l]={cell:nCell,unique:bUnique};aLayout[i+k].nTr=nTr}}}nCell=nCell.nextSibling}}}function _fnGetUniqueThs(oSettings,nHeader,aLayout){var aReturn=[];if(!aLayout){aLayout=oSettings.aoHeader;if(nHeader){aLayout=[];_fnDetectHeader(aLayout,nHeader)}}for(var i=0,iLen=aLayout.length;i<iLen;i++){for(var j=0,jLen=aLayout[i].length;j<jLen;j++){if(aLayout[i][j].unique&&(!aReturn[j]||!oSettings.bSortCellsTop)){aReturn[j]=aLayout[i][j].cell}}}return aReturn}function _fnBuildAjax(oSettings,data,fn){_fnCallbackFire(oSettings,"aoServerParams","serverParams",[data]);if(data&&$.isArray(data)){var tmp={};var rbracket=/(.*?)\[\]$/;$.each(data,function(key,val){var match=val.name.match(rbracket);if(match){var name=match[0];if(!tmp[name]){tmp[name]=[]}tmp[name].push(val.value)}else{tmp[val.name]=val.value}});data=tmp}var ajaxData;var ajax=oSettings.ajax;var instance=oSettings.oInstance;var callback=function(json){_fnCallbackFire(oSettings,null,"xhr",[oSettings,json,oSettings.jqXHR]);fn(json)};if($.isPlainObject(ajax)&&ajax.data){ajaxData=ajax.data;var newData=$.isFunction(ajaxData)?ajaxData(data,oSettings):ajaxData;data=$.isFunction(ajaxData)&&newData?newData:$.extend(true,data,newData);delete ajax.data}var baseAjax={data:data,success:function(json){var error=json.error||json.sError;if(error){_fnLog(oSettings,0,error)}oSettings.json=json;callback(json)},dataType:"json",cache:false,type:oSettings.sServerMethod,error:function(xhr,error,thrown){var ret=_fnCallbackFire(oSettings,null,"xhr",[oSettings,null,oSettings.jqXHR]);if($.inArray(true,ret)===-1){if(error=="parsererror"){_fnLog(oSettings,0,"Invalid JSON response",1)}else if(xhr.readyState===4){_fnLog(oSettings,0,"Ajax error",7)}}_fnProcessingDisplay(oSettings,false)}};oSettings.oAjaxData=data;_fnCallbackFire(oSettings,null,"preXhr",[oSettings,data]);if(oSettings.fnServerData){oSettings.fnServerData.call(instance,oSettings.sAjaxSource,$.map(data,function(val,key){return{name:key,value:val}}),callback,oSettings)}else if(oSettings.sAjaxSource||typeof ajax==="string"){oSettings.jqXHR=$.ajax($.extend(baseAjax,{url:ajax||oSettings.sAjaxSource}))}else if($.isFunction(ajax)){oSettings.jqXHR=ajax.call(instance,data,callback,oSettings)}else{oSettings.jqXHR=$.ajax($.extend(baseAjax,ajax));ajax.data=ajaxData}}function _fnAjaxUpdate(settings){if(settings.bAjaxDataGet){settings.iDraw++;_fnProcessingDisplay(settings,true);_fnBuildAjax(settings,_fnAjaxParameters(settings),function(json){_fnAjaxUpdateDraw(settings,json)});return false}return true}function _fnAjaxParameters(settings){var columns=settings.aoColumns,columnCount=columns.length,features=settings.oFeatures,preSearch=settings.oPreviousSearch,preColSearch=settings.aoPreSearchCols,i,data=[],dataProp,column,columnSearch,sort=_fnSortFlatten(settings),displayStart=settings._iDisplayStart,displayLength=features.bPaginate!==false?settings._iDisplayLength:-1;var param=function(name,value){data.push({name:name,value:value})};param("sEcho",settings.iDraw);param("iColumns",columnCount);param("sColumns",_pluck(columns,"sName").join(","));param("iDisplayStart",displayStart);param("iDisplayLength",displayLength);var d={draw:settings.iDraw,columns:[],order:[],start:displayStart,length:displayLength,search:{value:preSearch.sSearch,regex:preSearch.bRegex}};for(i=0;i<columnCount;i++){column=columns[i];columnSearch=preColSearch[i];dataProp=typeof column.mData=="function"?"function":column.mData;d.columns.push({data:dataProp,name:column.sName,searchable:column.bSearchable,orderable:column.bSortable,search:{value:columnSearch.sSearch,regex:columnSearch.bRegex}});param("mDataProp_"+i,dataProp);if(features.bFilter){param("sSearch_"+i,columnSearch.sSearch);param("bRegex_"+i,columnSearch.bRegex);param("bSearchable_"+i,column.bSearchable)}if(features.bSort){param("bSortable_"+i,column.bSortable)}}if(features.bFilter){param("sSearch",preSearch.sSearch);param("bRegex",preSearch.bRegex)}if(features.bSort){$.each(sort,function(i,val){d.order.push({column:val.col,dir:val.dir});param("iSortCol_"+i,val.col);param("sSortDir_"+i,val.dir)});param("iSortingCols",sort.length)}var legacy=DataTable.ext.legacy.ajax;if(legacy===null){return settings.sAjaxSource?data:d}return legacy?data:d}function _fnAjaxUpdateDraw(settings,json){var compat=function(old,modern){return json[old]!==undefined?json[old]:json[modern]};var data=_fnAjaxDataSrc(settings,json);var draw=compat("sEcho","draw");var recordsTotal=compat("iTotalRecords","recordsTotal");var recordsFiltered=compat("iTotalDisplayRecords","recordsFiltered");if(draw){if(draw*1<settings.iDraw){return}settings.iDraw=draw*1}_fnClearTable(settings);settings._iRecordsTotal=parseInt(recordsTotal,10);settings._iRecordsDisplay=parseInt(recordsFiltered,10);for(var i=0,ien=data.length;i<ien;i++){_fnAddData(settings,data[i])}settings.aiDisplay=settings.aiDisplayMaster.slice();settings.bAjaxDataGet=false;_fnDraw(settings);if(!settings._bInitComplete){_fnInitComplete(settings,json)}settings.bAjaxDataGet=true;_fnProcessingDisplay(settings,false)}function _fnAjaxDataSrc(oSettings,json){var dataSrc=$.isPlainObject(oSettings.ajax)&&oSettings.ajax.dataSrc!==undefined?oSettings.ajax.dataSrc:oSettings.sAjaxDataProp;if(dataSrc==="data"){return json.aaData||json[dataSrc]}return dataSrc!==""?_fnGetObjectDataFn(dataSrc)(json):json}function _fnFeatureHtmlFilter(settings){var classes=settings.oClasses;var tableId=settings.sTableId;var language=settings.oLanguage;var previousSearch=settings.oPreviousSearch;

var features=settings.aanFeatures;var input='<input type="search" class="'+classes.sFilterInput+'"/>';var str=language.sSearch;str=str.match(/_INPUT_/)?str.replace("_INPUT_",input):str+input;var filter=$("<div/>",{id:!features.f?tableId+"_filter":null,"class":classes.sFilter}).append($("<label/>").append(str));var searchFn=function(){var n=features.f;var val=!this.value?"":this.value;if(val!=previousSearch.sSearch){_fnFilterComplete(settings,{sSearch:val,bRegex:previousSearch.bRegex,bSmart:previousSearch.bSmart,bCaseInsensitive:previousSearch.bCaseInsensitive});settings._iDisplayStart=0;_fnDraw(settings)}};var searchDelay=settings.searchDelay!==null?settings.searchDelay:_fnDataSource(settings)==="ssp"?400:0;var jqFilter=$("input",filter).val(previousSearch.sSearch).attr("placeholder",language.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",searchDelay?_fnThrottle(searchFn,searchDelay):searchFn).bind("keypress.DT",function(e){if(e.keyCode==13){return false}}).attr("aria-controls",tableId);$(settings.nTable).on("search.dt.DT",function(ev,s){if(settings===s){try{if(jqFilter[0]!==document.activeElement){jqFilter.val(previousSearch.sSearch)}}catch(e){}}});return filter[0]}function _fnFilterComplete(oSettings,oInput,iForce){var oPrevSearch=oSettings.oPreviousSearch;var aoPrevSearch=oSettings.aoPreSearchCols;var fnSaveFilter=function(oFilter){oPrevSearch.sSearch=oFilter.sSearch;oPrevSearch.bRegex=oFilter.bRegex;oPrevSearch.bSmart=oFilter.bSmart;oPrevSearch.bCaseInsensitive=oFilter.bCaseInsensitive};var fnRegex=function(o){return o.bEscapeRegex!==undefined?!o.bEscapeRegex:o.bRegex};_fnColumnTypes(oSettings);if(_fnDataSource(oSettings)!="ssp"){_fnFilter(oSettings,oInput.sSearch,iForce,fnRegex(oInput),oInput.bSmart,oInput.bCaseInsensitive);fnSaveFilter(oInput);for(var i=0;i<aoPrevSearch.length;i++){_fnFilterColumn(oSettings,aoPrevSearch[i].sSearch,i,fnRegex(aoPrevSearch[i]),aoPrevSearch[i].bSmart,aoPrevSearch[i].bCaseInsensitive)}_fnFilterCustom(oSettings)}else{fnSaveFilter(oInput)}oSettings.bFiltered=true;_fnCallbackFire(oSettings,null,"search",[oSettings])}function _fnFilterCustom(settings){var filters=DataTable.ext.search;var displayRows=settings.aiDisplay;var row,rowIdx;for(var i=0,ien=filters.length;i<ien;i++){var rows=[];for(var j=0,jen=displayRows.length;j<jen;j++){rowIdx=displayRows[j];row=settings.aoData[rowIdx];if(filters[i](settings,row._aFilterData,rowIdx,row._aData,j)){rows.push(rowIdx)}}displayRows.length=0;displayRows.push.apply(displayRows,rows)}}function _fnFilterColumn(settings,searchStr,colIdx,regex,smart,caseInsensitive){if(searchStr===""){return}var data;var display=settings.aiDisplay;var rpSearch=_fnFilterCreateSearch(searchStr,regex,smart,caseInsensitive);for(var i=display.length-1;i>=0;i--){data=settings.aoData[display[i]]._aFilterData[colIdx];if(!rpSearch.test(data)){display.splice(i,1)}}}function _fnFilter(settings,input,force,regex,smart,caseInsensitive){var rpSearch=_fnFilterCreateSearch(input,regex,smart,caseInsensitive);var prevSearch=settings.oPreviousSearch.sSearch;var displayMaster=settings.aiDisplayMaster;var display,invalidated,i;if(DataTable.ext.search.length!==0){force=true}invalidated=_fnFilterData(settings);if(input.length<=0){settings.aiDisplay=displayMaster.slice()}else{if(invalidated||force||prevSearch.length>input.length||input.indexOf(prevSearch)!==0||settings.bSorted){settings.aiDisplay=displayMaster.slice()}display=settings.aiDisplay;for(i=display.length-1;i>=0;i--){if(!rpSearch.test(settings.aoData[display[i]]._sFilterRow)){display.splice(i,1)}}}}function _fnFilterCreateSearch(search,regex,smart,caseInsensitive){search=regex?search:_fnEscapeRegex(search);if(smart){var a=$.map(search.match(/"[^"]+"|[^ ]+/g)||[""],function(word){if(word.charAt(0)==='"'){var m=word.match(/^"(.*)"$/);word=m?m[1]:word}return word.replace('"',"")});search="^(?=.*?"+a.join(")(?=.*?")+").*$"}return new RegExp(search,caseInsensitive?"i":"")}function _fnEscapeRegex(sVal){return sVal.replace(_re_escape_regex,"\\$1")}var __filter_div=$("<div>")[0];var __filter_div_textContent=__filter_div.textContent!==undefined;function _fnFilterData(settings){var columns=settings.aoColumns;var column;var i,j,ien,jen,filterData,cellData,row;var fomatters=DataTable.ext.type.search;var wasInvalidated=false;for(i=0,ien=settings.aoData.length;i<ien;i++){row=settings.aoData[i];if(!row._aFilterData){filterData=[];for(j=0,jen=columns.length;j<jen;j++){column=columns[j];if(column.bSearchable){cellData=_fnGetCellData(settings,i,j,"filter");if(fomatters[column.sType]){cellData=fomatters[column.sType](cellData)}if(cellData===null){cellData=""}if(typeof cellData!=="string"&&cellData.toString){cellData=cellData.toString()}}else{cellData=""}if(cellData.indexOf&&cellData.indexOf("&")!==-1){__filter_div.innerHTML=cellData;cellData=__filter_div_textContent?__filter_div.textContent:__filter_div.innerText}if(cellData.replace){cellData=cellData.replace(/[\r\n]/g,"")}filterData.push(cellData)}row._aFilterData=filterData;row._sFilterRow=filterData.join("  ");wasInvalidated=true}}return wasInvalidated}function _fnSearchToCamel(obj){return{search:obj.sSearch,smart:obj.bSmart,regex:obj.bRegex,caseInsensitive:obj.bCaseInsensitive}}function _fnSearchToHung(obj){return{sSearch:obj.search,bSmart:obj.smart,bRegex:obj.regex,bCaseInsensitive:obj.caseInsensitive}}function _fnFeatureHtmlInfo(settings){var tid=settings.sTableId,nodes=settings.aanFeatures.i,n=$("<div/>",{"class":settings.oClasses.sInfo,id:!nodes?tid+"_info":null});if(!nodes){settings.aoDrawCallback.push({fn:_fnUpdateInfo,sName:"information"});n.attr("role","status").attr("aria-live","polite");$(settings.nTable).attr("aria-describedby",tid+"_info")}return n[0]}function _fnUpdateInfo(settings){var nodes=settings.aanFeatures.i;if(nodes.length===0){return}var lang=settings.oLanguage,start=settings._iDisplayStart+1,end=settings.fnDisplayEnd(),max=settings.fnRecordsTotal(),total=settings.fnRecordsDisplay(),out=total?lang.sInfo:lang.sInfoEmpty;if(total!==max){out+=" "+lang.sInfoFiltered}out+=lang.sInfoPostFix;out=_fnInfoMacros(settings,out);var callback=lang.fnInfoCallback;if(callback!==null){out=callback.call(settings.oInstance,settings,start,end,max,total,out)}$(nodes).html(out)}function _fnInfoMacros(settings,str){var formatter=settings.fnFormatNumber,start=settings._iDisplayStart+1,len=settings._iDisplayLength,vis=settings.fnRecordsDisplay(),all=len===-1;return str.replace(/_START_/g,formatter.call(settings,start)).replace(/_END_/g,formatter.call(settings,settings.fnDisplayEnd())).replace(/_MAX_/g,formatter.call(settings,settings.fnRecordsTotal())).replace(/_TOTAL_/g,formatter.call(settings,vis)).replace(/_PAGE_/g,formatter.call(settings,all?1:Math.ceil(start/len))).replace(/_PAGES_/g,formatter.call(settings,all?1:Math.ceil(vis/len)))}function _fnInitialise(settings){var i,iLen,iAjaxStart=settings.iInitDisplayStart;var columns=settings.aoColumns,column;var features=settings.oFeatures;if(!settings.bInitialised){setTimeout(function(){_fnInitialise(settings)},200);return}_fnAddOptionsHtml(settings);_fnBuildHead(settings);_fnDrawHead(settings,settings.aoHeader);_fnDrawHead(settings,settings.aoFooter);_fnProcessingDisplay(settings,true);if(features.bAutoWidth){_fnCalculateColumnWidths(settings)}for(i=0,iLen=columns.length;i<iLen;i++){column=columns[i];if(column.sWidth){column.nTh.style.width=_fnStringToCss(column.sWidth)}}_fnReDraw(settings);var dataSrc=_fnDataSource(settings);if(dataSrc!="ssp"){if(dataSrc=="ajax"){_fnBuildAjax(settings,[],function(json){var aData=_fnAjaxDataSrc(settings,json);for(i=0;i<aData.length;i++){_fnAddData(settings,aData[i])}settings.iInitDisplayStart=iAjaxStart;_fnReDraw(settings);_fnProcessingDisplay(settings,false);_fnInitComplete(settings,json)},settings)}else{_fnProcessingDisplay(settings,false);_fnInitComplete(settings)}}}function _fnInitComplete(settings,json){settings._bInitComplete=true;if(json){_fnAdjustColumnSizing(settings)}_fnCallbackFire(settings,"aoInitComplete","init",[settings,json])}function _fnLengthChange(settings,val){var len=parseInt(val,10);settings._iDisplayLength=len;_fnLengthOverflow(settings);_fnCallbackFire(settings,null,"length",[settings,len])}function _fnFeatureHtmlLength(settings){var classes=settings.oClasses,tableId=settings.sTableId,menu=settings.aLengthMenu,d2=$.isArray(menu[0]),lengths=d2?menu[0]:menu,language=d2?menu[1]:menu;var select=$("<select/>",{name:tableId+"_length","aria-controls":tableId,"class":classes.sLengthSelect});for(var i=0,ien=lengths.length;i<ien;i++){select[0][i]=new Option(language[i],lengths[i])}var div=$("<div><label/></div>").addClass(classes.sLength);if(!settings.aanFeatures.l){div[0].id=tableId+"_length"}div.children().append(settings.oLanguage.sLengthMenu.replace("_MENU_",select[0].outerHTML));$("select",div).val(settings._iDisplayLength).bind("change.DT",function(e){_fnLengthChange(settings,$(this).val());_fnDraw(settings)});$(settings.nTable).bind("length.dt.DT",function(e,s,len){if(settings===s){$("select",div).val(len)}});return div[0]}function _fnFeatureHtmlPaginate(settings){var type=settings.sPaginationType,plugin=DataTable.ext.pager[type],modern=typeof plugin==="function",redraw=function(settings){_fnDraw(settings)},node=$("<div/>").addClass(settings.oClasses.sPaging+type)[0],features=settings.aanFeatures;if(!modern){plugin.fnInit(settings,node,redraw)}if(!features.p){node.id=settings.sTableId+"_paginate";settings.aoDrawCallback.push({fn:function(settings){if(modern){var start=settings._iDisplayStart,len=settings._iDisplayLength,visRecords=settings.fnRecordsDisplay(),all=len===-1,page=all?0:Math.ceil(start/len),pages=all?1:Math.ceil(visRecords/len),buttons=plugin(page,pages),i,ien;for(i=0,ien=features.p.length;i<ien;i++){_fnRenderer(settings,"pageButton")(settings,features.p[i],i,buttons,page,pages)}}else{plugin.fnUpdate(settings,redraw)}},sName:"pagination"})}return node}function _fnPageChange(settings,action,redraw){var start=settings._iDisplayStart,len=settings._iDisplayLength,records=settings.fnRecordsDisplay();if(records===0||len===-1){start=0}else if(typeof action==="number"){start=action*len;if(start>records){start=0}}else if(action=="first"){start=0}else if(action=="previous"){start=len>=0?start-len:0;if(start<0){start=0}}else if(action=="next"){if(start+len<records){start+=len}}else if(action=="last"){start=Math.floor((records-1)/len)*len}else{_fnLog(settings,0,"Unknown paging action: "+action,5)}var changed=settings._iDisplayStart!==start;settings._iDisplayStart=start;if(changed){_fnCallbackFire(settings,null,"page",[settings]);if(redraw){_fnDraw(settings)}}return changed}function _fnFeatureHtmlProcessing(settings){return $("<div/>",{id:!settings.aanFeatures.r?settings.sTableId+"_processing":null,"class":settings.oClasses.sProcessing}).html(settings.oLanguage.sProcessing).insertBefore(settings.nTable)[0]}function _fnProcessingDisplay(settings,show){if(settings.oFeatures.bProcessing){$(settings.aanFeatures.r).css("display",show?"block":"none")}_fnCallbackFire(settings,null,"processing",[settings,show])}function _fnFeatureHtmlTable(settings){var table=$(settings.nTable);table.attr("role","grid");var scroll=settings.oScroll;if(scroll.sX===""&&scroll.sY===""){return settings.nTable}var scrollX=scroll.sX;var scrollY=scroll.sY;var classes=settings.oClasses;var caption=table.children("caption");var captionSide=caption.length?caption[0]._captionSide:null;var headerClone=$(table[0].cloneNode(false));var footerClone=$(table[0].cloneNode(false));var footer=table.children("tfoot");var _div="<div/>";var size=function(s){return!s?null:_fnStringToCss(s)};if(scroll.sX&&table.attr("width")==="100%"){table.removeAttr("width")}if(!footer.length){footer=null}var scroller=$(_div,{"class":classes.sScrollWrapper}).append($(_div,{"class":classes.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:scrollX?size(scrollX):"100%"}).append($(_div,{"class":classes.sScrollHeadInner}).css({"box-sizing":"content-box",width:scroll.sXInner||"100%"}).append(headerClone.removeAttr("id").css("margin-left",0).append(captionSide==="top"?caption:null).append(table.children("thead"))))).append($(_div,{"class":classes.sScrollBody}).css({overflow:"auto",height:size(scrollY),width:size(scrollX)}).append(table));if(footer){scroller.append($(_div,{"class":classes.sScrollFoot}).css({overflow:"hidden",border:0,width:scrollX?size(scrollX):"100%"}).append($(_div,{"class":classes.sScrollFootInner}).append(footerClone.removeAttr("id").css("margin-left",0).append(captionSide==="bottom"?caption:null).append(table.children("tfoot")))))}var children=scroller.children();var scrollHead=children[0];var scrollBody=children[1];var scrollFoot=footer?children[2]:null;if(scrollX){$(scrollBody).on("scroll.DT",function(e){var scrollLeft=this.scrollLeft;scrollHead.scrollLeft=scrollLeft;if(footer){scrollFoot.scrollLeft=scrollLeft}})}settings.nScrollHead=scrollHead;settings.nScrollBody=scrollBody;settings.nScrollFoot=scrollFoot;settings.aoDrawCallback.push({fn:_fnScrollDraw,sName:"scrolling"});return scroller[0]}function _fnScrollDraw(settings){var scroll=settings.oScroll,scrollX=scroll.sX,scrollXInner=scroll.sXInner,scrollY=scroll.sY,barWidth=scroll.iBarWidth,divHeader=$(settings.nScrollHead),divHeaderStyle=divHeader[0].style,divHeaderInner=divHeader.children("div"),divHeaderInnerStyle=divHeaderInner[0].style,divHeaderTable=divHeaderInner.children("table"),divBodyEl=settings.nScrollBody,divBody=$(divBodyEl),divBodyStyle=divBodyEl.style,divFooter=$(settings.nScrollFoot),divFooterInner=divFooter.children("div"),divFooterTable=divFooterInner.children("table"),header=$(settings.nTHead),table=$(settings.nTable),tableEl=table[0],tableStyle=tableEl.style,footer=settings.nTFoot?$(settings.nTFoot):null,browser=settings.oBrowser,ie67=browser.bScrollOversize,headerTrgEls,footerTrgEls,headerSrcEls,footerSrcEls,headerCopy,footerCopy,headerWidths=[],footerWidths=[],headerContent=[],idx,correction,sanityWidth,zeroOut=function(nSizer){var style=nSizer.style;style.paddingTop="0";style.paddingBottom="0";style.borderTopWidth="0";style.borderBottomWidth="0";style.height=0};table.children("thead, tfoot").remove();headerCopy=header.clone().prependTo(table);headerTrgEls=header.find("tr");headerSrcEls=headerCopy.find("tr");headerCopy.find("th, td").removeAttr("tabindex");if(footer){footerCopy=footer.clone().prependTo(table);footerTrgEls=footer.find("tr");footerSrcEls=footerCopy.find("tr")}if(!scrollX){divBodyStyle.width="100%";divHeader[0].style.width="100%"}$.each(_fnGetUniqueThs(settings,headerCopy),function(i,el){idx=_fnVisibleToColumnIndex(settings,i);el.style.width=settings.aoColumns[idx].sWidth});if(footer){_fnApplyToChildren(function(n){n.style.width=""},footerSrcEls)}if(scroll.bCollapse&&scrollY!==""){divBodyStyle.height=divBody[0].offsetHeight+header[0].offsetHeight+"px"}sanityWidth=table.outerWidth();if(scrollX===""){tableStyle.width="100%";if(ie67&&(table.find("tbody").height()>divBodyEl.offsetHeight||divBody.css("overflow-y")=="scroll")){tableStyle.width=_fnStringToCss(table.outerWidth()-barWidth)}}else{if(scrollXInner!==""){tableStyle.width=_fnStringToCss(scrollXInner)}else if(sanityWidth==divBody.width()&&divBody.height()<table.height()){tableStyle.width=_fnStringToCss(sanityWidth-barWidth);if(table.outerWidth()>sanityWidth-barWidth){tableStyle.width=_fnStringToCss(sanityWidth)}}else{tableStyle.width=_fnStringToCss(sanityWidth)}}sanityWidth=table.outerWidth();_fnApplyToChildren(zeroOut,headerSrcEls);_fnApplyToChildren(function(nSizer){headerContent.push(nSizer.innerHTML);headerWidths.push(_fnStringToCss($(nSizer).css("width")))},headerSrcEls);_fnApplyToChildren(function(nToSize,i){nToSize.style.width=headerWidths[i]},headerTrgEls);$(headerSrcEls).height(0);if(footer){_fnApplyToChildren(zeroOut,footerSrcEls);_fnApplyToChildren(function(nSizer){footerWidths.push(_fnStringToCss($(nSizer).css("width")))},footerSrcEls);_fnApplyToChildren(function(nToSize,i){nToSize.style.width=footerWidths[i]},footerTrgEls);$(footerSrcEls).height(0)}_fnApplyToChildren(function(nSizer,i){nSizer.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+headerContent[i]+"</div>";nSizer.style.width=headerWidths[i]},headerSrcEls);if(footer){_fnApplyToChildren(function(nSizer,i){nSizer.innerHTML="";nSizer.style.width=footerWidths[i]},footerSrcEls)}if(table.outerWidth()<sanityWidth){correction=divBodyEl.scrollHeight>divBodyEl.offsetHeight||divBody.css("overflow-y")=="scroll"?sanityWidth+barWidth:sanityWidth;if(ie67&&(divBodyEl.scrollHeight>divBodyEl.offsetHeight||divBody.css("overflow-y")=="scroll")){tableStyle.width=_fnStringToCss(correction-barWidth)}if(scrollX===""||scrollXInner!==""){_fnLog(settings,1,"Possible column misalignment",6)}}else{correction="100%"}divBodyStyle.width=_fnStringToCss(correction);divHeaderStyle.width=_fnStringToCss(correction);if(footer){settings.nScrollFoot.style.width=_fnStringToCss(correction)}if(!scrollY){if(ie67){divBodyStyle.height=_fnStringToCss(tableEl.offsetHeight+barWidth)}}if(scrollY&&scroll.bCollapse){divBodyStyle.height=_fnStringToCss(scrollY);var iExtra=scrollX&&tableEl.offsetWidth>divBodyEl.offsetWidth?barWidth:0;if(tableEl.offsetHeight<divBodyEl.offsetHeight){divBodyStyle.height=_fnStringToCss(tableEl.offsetHeight+iExtra)}}var iOuterWidth=table.outerWidth();divHeaderTable[0].style.width=_fnStringToCss(iOuterWidth);divHeaderInnerStyle.width=_fnStringToCss(iOuterWidth);var bScrolling=table.height()>divBodyEl.clientHeight||divBody.css("overflow-y")=="scroll";var padding="padding"+(browser.bScrollbarLeft?"Left":"Right");divHeaderInnerStyle[padding]=bScrolling?barWidth+"px":"0px";if(footer){divFooterTable[0].style.width=_fnStringToCss(iOuterWidth);divFooterInner[0].style.width=_fnStringToCss(iOuterWidth);divFooterInner[0].style[padding]=bScrolling?barWidth+"px":"0px"}divBody.scroll();if((settings.bSorted||settings.bFiltered)&&!settings._drawHold){divBodyEl.scrollTop=0}}function _fnApplyToChildren(fn,an1,an2){var index=0,i=0,iLen=an1.length;var nNode1,nNode2;while(i<iLen){nNode1=an1[i].firstChild;nNode2=an2?an2[i].firstChild:null;while(nNode1){if(nNode1.nodeType===1){if(an2){fn(nNode1,nNode2,index)}else{fn(nNode1,index)}index++}nNode1=nNode1.nextSibling;nNode2=an2?nNode2.nextSibling:null}i++}}var __re_html_remove=/<.*?>/g;function _fnCalculateColumnWidths(oSettings){var table=oSettings.nTable,columns=oSettings.aoColumns,scroll=oSettings.oScroll,scrollY=scroll.sY,scrollX=scroll.sX,scrollXInner=scroll.sXInner,columnCount=columns.length,visibleColumns=_fnGetColumns(oSettings,"bVisible"),headerCells=$("th",oSettings.nTHead),tableWidthAttr=table.getAttribute("width"),tableContainer=table.parentNode,userInputs=false,i,column,columnIdx,width,outerWidth;var styleWidth=table.style.width;if(styleWidth&&styleWidth.indexOf("%")!==-1){tableWidthAttr=styleWidth}for(i=0;i<visibleColumns.length;i++){column=columns[visibleColumns[i]];if(column.sWidth!==null){column.sWidth=_fnConvertToWidth(column.sWidthOrig,tableContainer);userInputs=true}}if(!userInputs&&!scrollX&&!scrollY&&columnCount==_fnVisbleColumns(oSettings)&&columnCount==headerCells.length){for(i=0;i<columnCount;i++){columns[i].sWidth=_fnStringToCss(headerCells.eq(i).width())}}else{var tmpTable=$(table).clone().css("visibility","hidden").removeAttr("id");tmpTable.find("tbody tr").remove();var tr=$("<tr/>").appendTo(tmpTable.find("tbody"));tmpTable.find("tfoot th, tfoot td").css("width","");headerCells=_fnGetUniqueThs(oSettings,tmpTable.find("thead")[0]);for(i=0;i<visibleColumns.length;i++){column=columns[visibleColumns[i]];headerCells[i].style.width=column.sWidthOrig!==null&&column.sWidthOrig!==""?_fnStringToCss(column.sWidthOrig):""}if(oSettings.aoData.length){for(i=0;i<visibleColumns.length;i++){columnIdx=visibleColumns[i];column=columns[columnIdx];$(_fnGetWidestNode(oSettings,columnIdx)).clone(false).append(column.sContentPadding).appendTo(tr)}}tmpTable.appendTo(tableContainer);if(scrollX&&scrollXInner){tmpTable.width(scrollXInner)}else if(scrollX){tmpTable.css("width","auto");if(tmpTable.width()<tableContainer.offsetWidth){tmpTable.width(tableContainer.offsetWidth)}}else if(scrollY){tmpTable.width(tableContainer.offsetWidth)}else if(tableWidthAttr){tmpTable.width(tableWidthAttr)}_fnScrollingWidthAdjust(oSettings,tmpTable[0]);if(scrollX){var total=0;for(i=0;i<visibleColumns.length;i++){column=columns[visibleColumns[i]];outerWidth=$(headerCells[i]).outerWidth();total+=column.sWidthOrig===null?outerWidth:parseInt(column.sWidth,10)+outerWidth-$(headerCells[i]).width()}tmpTable.width(_fnStringToCss(total));table.style.width=_fnStringToCss(total)}for(i=0;i<visibleColumns.length;i++){column=columns[visibleColumns[i]];width=$(headerCells[i]).width();if(width){column.sWidth=_fnStringToCss(width)}}table.style.width=_fnStringToCss(tmpTable.css("width"));tmpTable.remove()}if(tableWidthAttr){table.style.width=_fnStringToCss(tableWidthAttr)}if((tableWidthAttr||scrollX)&&!oSettings._reszEvt){var bindResize=function(){$(window).bind("resize.DT-"+oSettings.sInstance,_fnThrottle(function(){_fnAdjustColumnSizing(oSettings)}))};if(oSettings.oBrowser.bScrollOversize){setTimeout(bindResize,1e3)}else{bindResize()}oSettings._reszEvt=true}}function _fnThrottle(fn,freq){var frequency=freq!==undefined?freq:200,last,timer;return function(){var that=this,now=+new Date,args=arguments;if(last&&now<last+frequency){clearTimeout(timer);timer=setTimeout(function(){last=undefined;fn.apply(that,args)},frequency)}else{last=now;fn.apply(that,args)}}}function _fnConvertToWidth(width,parent){if(!width){return 0}var n=$("<div/>").css("width",_fnStringToCss(width)).appendTo(parent||document.body);var val=n[0].offsetWidth;n.remove();return val}function _fnScrollingWidthAdjust(settings,n){var scroll=settings.oScroll;if(scroll.sX||scroll.sY){var correction=!scroll.sX?scroll.iBarWidth:0;n.style.width=_fnStringToCss($(n).outerWidth()-correction)}}function _fnGetWidestNode(settings,colIdx){var idx=_fnGetMaxLenString(settings,colIdx);if(idx<0){return null}var data=settings.aoData[idx];return!data.nTr?$("<td/>").html(_fnGetCellData(settings,idx,colIdx,"display"))[0]:data.anCells[colIdx]}function _fnGetMaxLenString(settings,colIdx){var s,max=-1,maxIdx=-1;for(var i=0,ien=settings.aoData.length;i<ien;i++){s=_fnGetCellData(settings,i,colIdx,"display")+"";s=s.replace(__re_html_remove,"");if(s.length>max){max=s.length;maxIdx=i}}return maxIdx}function _fnStringToCss(s){if(s===null){return"0px"}if(typeof s=="number"){return s<0?"0px":s+"px"}return s.match(/\d$/)?s+"px":s}function _fnScrollBarWidth(){var width=DataTable.__scrollbarWidth;if(width===undefined){var sizer=$("<p/>").css({position:"absolute",top:0,left:0,width:"100%",height:150,padding:0,overflow:"scroll",visibility:"hidden"}).appendTo("body");width=sizer[0].offsetWidth-sizer[0].clientWidth;DataTable.__scrollbarWidth=width;sizer.remove()}return width}function _fnSortFlatten(settings){var i,iLen,k,kLen,aSort=[],aiOrig=[],aoColumns=settings.aoColumns,aDataSort,iCol,sType,srcCol,fixed=settings.aaSortingFixed,fixedObj=$.isPlainObject(fixed),nestedSort=[],add=function(a){if(a.length&&!$.isArray(a[0])){nestedSort.push(a)}else{nestedSort.push.apply(nestedSort,a)}};if($.isArray(fixed)){add(fixed)}if(fixedObj&&fixed.pre){add(fixed.pre)}add(settings.aaSorting);if(fixedObj&&fixed.post){add(fixed.post)}for(i=0;i<nestedSort.length;i++){srcCol=nestedSort[i][0];aDataSort=aoColumns[srcCol].aDataSort;for(k=0,kLen=aDataSort.length;k<kLen;k++){iCol=aDataSort[k];sType=aoColumns[iCol].sType||"string";if(nestedSort[i]._idx===undefined){nestedSort[i]._idx=$.inArray(nestedSort[i][1],aoColumns[iCol].asSorting)}aSort.push({src:srcCol,col:iCol,dir:nestedSort[i][1],index:nestedSort[i]._idx,type:sType,formatter:DataTable.ext.type.order[sType+"-pre"]})}}return aSort}function _fnSort(oSettings){var i,ien,iLen,j,jLen,k,kLen,sDataType,nTh,aiOrig=[],oExtSort=DataTable.ext.type.order,aoData=oSettings.aoData,aoColumns=oSettings.aoColumns,aDataSort,data,iCol,sType,oSort,formatters=0,sortCol,displayMaster=oSettings.aiDisplayMaster,aSort;_fnColumnTypes(oSettings);aSort=_fnSortFlatten(oSettings);for(i=0,ien=aSort.length;i<ien;i++){sortCol=aSort[i];if(sortCol.formatter){formatters++}_fnSortData(oSettings,sortCol.col)}if(_fnDataSource(oSettings)!="ssp"&&aSort.length!==0){for(i=0,iLen=displayMaster.length;i<iLen;i++){aiOrig[displayMaster[i]]=i}if(formatters===aSort.length){displayMaster.sort(function(a,b){var x,y,k,test,sort,len=aSort.length,dataA=aoData[a]._aSortData,dataB=aoData[b]._aSortData;for(k=0;k<len;k++){sort=aSort[k];x=dataA[sort.col];y=dataB[sort.col];test=x<y?-1:x>y?1:0;if(test!==0){return sort.dir==="asc"?test:-test}}x=aiOrig[a];y=aiOrig[b];return x<y?-1:x>y?1:0})}else{displayMaster.sort(function(a,b){var x,y,k,l,test,sort,fn,len=aSort.length,dataA=aoData[a]._aSortData,dataB=aoData[b]._aSortData;for(k=0;k<len;k++){sort=aSort[k];x=dataA[sort.col];y=dataB[sort.col];fn=oExtSort[sort.type+"-"+sort.dir]||oExtSort["string-"+sort.dir];test=fn(x,y);if(test!==0){return test}}x=aiOrig[a];y=aiOrig[b];return x<y?-1:x>y?1:0})}}oSettings.bSorted=true}function _fnSortAria(settings){var label;var nextSort;var columns=settings.aoColumns;var aSort=_fnSortFlatten(settings);var oAria=settings.oLanguage.oAria;for(var i=0,iLen=columns.length;i<iLen;i++){var col=columns[i];var asSorting=col.asSorting;var sTitle=col.sTitle.replace(/<.*?>/g,"");var th=col.nTh;th.removeAttribute("aria-sort");if(col.bSortable){if(aSort.length>0&&aSort[0].col==i){th.setAttribute("aria-sort",aSort[0].dir=="asc"?"ascending":"descending");nextSort=asSorting[aSort[0].index+1]||asSorting[0]}else{nextSort=asSorting[0]}label=sTitle+(nextSort==="asc"?oAria.sSortAscending:oAria.sSortDescending)}else{label=sTitle}th.setAttribute("aria-label",label)}}function _fnSortListener(settings,colIdx,append,callback){var col=settings.aoColumns[colIdx];var sorting=settings.aaSorting;var asSorting=col.asSorting;var nextSortIdx;var next=function(a,overflow){var idx=a._idx;if(idx===undefined){idx=$.inArray(a[1],asSorting)}return idx+1<asSorting.length?idx+1:overflow?null:0};if(typeof sorting[0]==="number"){sorting=settings.aaSorting=[sorting]}if(append&&settings.oFeatures.bSortMulti){var sortIdx=$.inArray(colIdx,_pluck(sorting,"0"));if(sortIdx!==-1){nextSortIdx=next(sorting[sortIdx],true);if(nextSortIdx===null&&sorting.length===1){nextSortIdx=0}if(nextSortIdx===null){sorting.splice(sortIdx,1)}else{sorting[sortIdx][1]=asSorting[nextSortIdx];sorting[sortIdx]._idx=nextSortIdx}}else{sorting.push([colIdx,asSorting[0],0]);sorting[sorting.length-1]._idx=0}}else if(sorting.length&&sorting[0][0]==colIdx){nextSortIdx=next(sorting[0]);sorting.length=1;sorting[0][1]=asSorting[nextSortIdx];sorting[0]._idx=nextSortIdx}else{sorting.length=0;sorting.push([colIdx,asSorting[0]]);sorting[0]._idx=0}_fnReDraw(settings);if(typeof callback=="function"){callback(settings)}}function _fnSortAttachListener(settings,attachTo,colIdx,callback){var col=settings.aoColumns[colIdx];_fnBindAction(attachTo,{},function(e){if(col.bSortable===false){return}if(settings.oFeatures.bProcessing){_fnProcessingDisplay(settings,true);setTimeout(function(){_fnSortListener(settings,colIdx,e.shiftKey,callback);if(_fnDataSource(settings)!=="ssp"){_fnProcessingDisplay(settings,false)}},0)}else{_fnSortListener(settings,colIdx,e.shiftKey,callback)}})}function _fnSortingClasses(settings){var oldSort=settings.aLastSort;var sortClass=settings.oClasses.sSortColumn;var sort=_fnSortFlatten(settings);var features=settings.oFeatures;var i,ien,colIdx;if(features.bSort&&features.bSortClasses){for(i=0,ien=oldSort.length;i<ien;i++){colIdx=oldSort[i].src;$(_pluck(settings.aoData,"anCells",colIdx)).removeClass(sortClass+(i<2?i+1:3))}for(i=0,ien=sort.length;i<ien;i++){colIdx=sort[i].src;$(_pluck(settings.aoData,"anCells",colIdx)).addClass(sortClass+(i<2?i+1:3))}}settings.aLastSort=sort}function _fnSortData(settings,idx){var column=settings.aoColumns[idx];var customSort=DataTable.ext.order[column.sSortDataType];var customData;if(customSort){customData=customSort.call(settings.oInstance,settings,idx,_fnColumnIndexToVisible(settings,idx))}var row,cellData;var formatter=DataTable.ext.type.order[column.sType+"-pre"];for(var i=0,ien=settings.aoData.length;i<ien;i++){row=settings.aoData[i];if(!row._aSortData){row._aSortData=[]}if(!row._aSortData[idx]||customSort){cellData=customSort?customData[i]:_fnGetCellData(settings,i,idx,"sort");row._aSortData[idx]=formatter?formatter(cellData):cellData}}}function _fnSaveState(settings){if(!settings.oFeatures.bStateSave||settings.bDestroying){return}var state={time:+new Date,start:settings._iDisplayStart,length:settings._iDisplayLength,order:$.extend(true,[],settings.aaSorting),search:_fnSearchToCamel(settings.oPreviousSearch),columns:$.map(settings.aoColumns,function(col,i){return{visible:col.bVisible,search:_fnSearchToCamel(settings.aoPreSearchCols[i])}})};_fnCallbackFire(settings,"aoStateSaveParams","stateSaveParams",[settings,state]);settings.oSavedState=state;settings.fnStateSaveCallback.call(settings.oInstance,settings,state)}function _fnLoadState(settings,oInit){var i,ien;var columns=settings.aoColumns;if(!settings.oFeatures.bStateSave){return}var state=settings.fnStateLoadCallback.call(settings.oInstance,settings);if(!state||!state.time){return}var abStateLoad=_fnCallbackFire(settings,"aoStateLoadParams","stateLoadParams",[settings,state]);if($.inArray(false,abStateLoad)!==-1){return}var duration=settings.iStateDuration;if(duration>0&&state.time<+new Date-duration*1e3){return}if(columns.length!==state.columns.length){return}settings.oLoadedState=$.extend(true,{},state);if(state.start!==undefined){settings._iDisplayStart=state.start;settings.iInitDisplayStart=state.start}if(state.length!==undefined){settings._iDisplayLength=state.length}if(state.order!==undefined){settings.aaSorting=[];$.each(state.order,function(i,col){settings.aaSorting.push(col[0]>=columns.length?[0,col[1]]:col)})}if(state.search!==undefined){$.extend(settings.oPreviousSearch,_fnSearchToHung(state.search))}for(i=0,ien=state.columns.length;i<ien;i++){var col=state.columns[i];if(col.visible!==undefined){columns[i].bVisible=col.visible}if(col.search!==undefined){$.extend(settings.aoPreSearchCols[i],_fnSearchToHung(col.search))}}_fnCallbackFire(settings,"aoStateLoaded","stateLoaded",[settings,state])}function _fnSettingsFromNode(table){var settings=DataTable.settings;var idx=$.inArray(table,_pluck(settings,"nTable"));return idx!==-1?settings[idx]:null}function _fnLog(settings,level,msg,tn){msg="DataTables warning: "+(settings!==null?"table id="+settings.sTableId+" - ":"")+msg;if(tn){msg+=". For more information about this error, please see "+"http://datatables.net/tn/"+tn}if(!level){var ext=DataTable.ext;var type=ext.sErrMode||ext.errMode;_fnCallbackFire(settings,null,"error",[settings,tn,msg]);if(type=="alert"){alert(msg)}else if(type=="throw"){throw new Error(msg)}else if(typeof type=="function"){type(settings,tn,msg)}}else if(window.console&&console.log){console.log(msg)}}function _fnMap(ret,src,name,mappedName){if($.isArray(name)){$.each(name,function(i,val){if($.isArray(val)){_fnMap(ret,src,val[0],val[1])}else{_fnMap(ret,src,val)}});return}if(mappedName===undefined){mappedName=name}if(src[name]!==undefined){ret[mappedName]=src[name]}}function _fnExtend(out,extender,breakRefs){var val;for(var prop in extender){if(extender.hasOwnProperty(prop)){val=extender[prop];if($.isPlainObject(val)){if(!$.isPlainObject(out[prop])){out[prop]={}}$.extend(true,out[prop],val)}else if(breakRefs&&prop!=="data"&&prop!=="aaData"&&$.isArray(val)){out[prop]=val.slice()}else{out[prop]=val}}}return out}function _fnBindAction(n,oData,fn){$(n).bind("click.DT",oData,function(e){n.blur();fn(e)}).bind("keypress.DT",oData,function(e){if(e.which===13){e.preventDefault();fn(e)}}).bind("selectstart.DT",function(){return false})}function _fnCallbackReg(oSettings,sStore,fn,sName){if(fn){oSettings[sStore].push({fn:fn,sName:sName})}}function _fnCallbackFire(settings,callbackArr,eventName,args){var ret=[];if(callbackArr){
ret=$.map(settings[callbackArr].slice().reverse(),function(val,i){return val.fn.apply(settings.oInstance,args)})}if(eventName!==null){var e=$.Event(eventName+".dt");$(settings.nTable).trigger(e,args);ret.push(e.result)}return ret}function _fnLengthOverflow(settings){var start=settings._iDisplayStart,end=settings.fnDisplayEnd(),len=settings._iDisplayLength;if(start>=end){start=end-len}start-=start%len;if(len===-1||start<0){start=0}settings._iDisplayStart=start}function _fnRenderer(settings,type){var renderer=settings.renderer;var host=DataTable.ext.renderer[type];if($.isPlainObject(renderer)&&renderer[type]){return host[renderer[type]]||host._}else if(typeof renderer==="string"){return host[renderer]||host._}return host._}function _fnDataSource(settings){if(settings.oFeatures.bServerSide){return"ssp"}else if(settings.ajax||settings.sAjaxSource){return"ajax"}return"dom"}DataTable=function(options){this.$=function(sSelector,oOpts){return this.api(true).$(sSelector,oOpts)};this._=function(sSelector,oOpts){return this.api(true).rows(sSelector,oOpts).data()};this.api=function(traditional){return traditional?new _Api(_fnSettingsFromNode(this[_ext.iApiIndex])):new _Api(this)};this.fnAddData=function(data,redraw){var api=this.api(true);var rows=$.isArray(data)&&($.isArray(data[0])||$.isPlainObject(data[0]))?api.rows.add(data):api.row.add(data);if(redraw===undefined||redraw){api.draw()}return rows.flatten().toArray()};this.fnAdjustColumnSizing=function(bRedraw){var api=this.api(true).columns.adjust();var settings=api.settings()[0];var scroll=settings.oScroll;if(bRedraw===undefined||bRedraw){api.draw(false)}else if(scroll.sX!==""||scroll.sY!==""){_fnScrollDraw(settings)}};this.fnClearTable=function(bRedraw){var api=this.api(true).clear();if(bRedraw===undefined||bRedraw){api.draw()}};this.fnClose=function(nTr){this.api(true).row(nTr).child.hide()};this.fnDeleteRow=function(target,callback,redraw){var api=this.api(true);var rows=api.rows(target);var settings=rows.settings()[0];var data=settings.aoData[rows[0][0]];rows.remove();if(callback){callback.call(this,settings,data)}if(redraw===undefined||redraw){api.draw()}return data};this.fnDestroy=function(remove){this.api(true).destroy(remove)};this.fnDraw=function(complete){this.api(true).draw(complete)};this.fnFilter=function(sInput,iColumn,bRegex,bSmart,bShowGlobal,bCaseInsensitive){var api=this.api(true);if(iColumn===null||iColumn===undefined){api.search(sInput,bRegex,bSmart,bCaseInsensitive)}else{api.column(iColumn).search(sInput,bRegex,bSmart,bCaseInsensitive)}api.draw()};this.fnGetData=function(src,col){var api=this.api(true);if(src!==undefined){var type=src.nodeName?src.nodeName.toLowerCase():"";return col!==undefined||type=="td"||type=="th"?api.cell(src,col).data():api.row(src).data()||null}return api.data().toArray()};this.fnGetNodes=function(iRow){var api=this.api(true);return iRow!==undefined?api.row(iRow).node():api.rows().nodes().flatten().toArray()};this.fnGetPosition=function(node){var api=this.api(true);var nodeName=node.nodeName.toUpperCase();if(nodeName=="TR"){return api.row(node).index()}else if(nodeName=="TD"||nodeName=="TH"){var cell=api.cell(node).index();return[cell.row,cell.columnVisible,cell.column]}return null};this.fnIsOpen=function(nTr){return this.api(true).row(nTr).child.isShown()};this.fnOpen=function(nTr,mHtml,sClass){return this.api(true).row(nTr).child(mHtml,sClass).show().child()[0]};this.fnPageChange=function(mAction,bRedraw){var api=this.api(true).page(mAction);if(bRedraw===undefined||bRedraw){api.draw(false)}};this.fnSetColumnVis=function(iCol,bShow,bRedraw){var api=this.api(true).column(iCol).visible(bShow);if(bRedraw===undefined||bRedraw){api.columns.adjust().draw()}};this.fnSettings=function(){return _fnSettingsFromNode(this[_ext.iApiIndex])};this.fnSort=function(aaSort){this.api(true).order(aaSort).draw()};this.fnSortListener=function(nNode,iColumn,fnCallback){this.api(true).order.listener(nNode,iColumn,fnCallback)};this.fnUpdate=function(mData,mRow,iColumn,bRedraw,bAction){var api=this.api(true);if(iColumn===undefined||iColumn===null){api.row(mRow).data(mData)}else{api.cell(mRow,iColumn).data(mData)}if(bAction===undefined||bAction){api.columns.adjust()}if(bRedraw===undefined||bRedraw){api.draw()}return 0};this.fnVersionCheck=_ext.fnVersionCheck;var _that=this;var emptyInit=options===undefined;var len=this.length;if(emptyInit){options={}}this.oApi=this.internal=_ext.internal;for(var fn in DataTable.ext.internal){if(fn){this[fn]=_fnExternApiFunc(fn)}}this.each(function(){var o={};var oInit=len>1?_fnExtend(o,options,true):options;var i=0,iLen,j,jLen,k,kLen;var sId=this.getAttribute("id");var bInitHandedOff=false;var defaults=DataTable.defaults;var $this=$(this);if(this.nodeName.toLowerCase()!="table"){_fnLog(null,0,"Non-table node initialisation ("+this.nodeName+")",2);return}_fnCompatOpts(defaults);_fnCompatCols(defaults.column);_fnCamelToHungarian(defaults,defaults,true);_fnCamelToHungarian(defaults.column,defaults.column,true);_fnCamelToHungarian(defaults,$.extend(oInit,$this.data()));var allSettings=DataTable.settings;for(i=0,iLen=allSettings.length;i<iLen;i++){var s=allSettings[i];if(s.nTable==this||s.nTHead.parentNode==this||s.nTFoot&&s.nTFoot.parentNode==this){var bRetrieve=oInit.bRetrieve!==undefined?oInit.bRetrieve:defaults.bRetrieve;var bDestroy=oInit.bDestroy!==undefined?oInit.bDestroy:defaults.bDestroy;if(emptyInit||bRetrieve){return s.oInstance}else if(bDestroy){s.oInstance.fnDestroy();break}else{_fnLog(s,0,"Cannot reinitialise DataTable",3);return}}if(s.sTableId==this.id){allSettings.splice(i,1);break}}if(sId===null||sId===""){sId="DataTables_Table_"+DataTable.ext._unique++;this.id=sId}var oSettings=$.extend(true,{},DataTable.models.oSettings,{sDestroyWidth:$this[0].style.width,sInstance:sId,sTableId:sId});oSettings.nTable=this;oSettings.oApi=_that.internal;oSettings.oInit=oInit;allSettings.push(oSettings);oSettings.oInstance=_that.length===1?_that:$this.dataTable();_fnCompatOpts(oInit);if(oInit.oLanguage){_fnLanguageCompat(oInit.oLanguage)}if(oInit.aLengthMenu&&!oInit.iDisplayLength){oInit.iDisplayLength=$.isArray(oInit.aLengthMenu[0])?oInit.aLengthMenu[0][0]:oInit.aLengthMenu[0]}oInit=_fnExtend($.extend(true,{},defaults),oInit);_fnMap(oSettings.oFeatures,oInit,["bPaginate","bLengthChange","bFilter","bSort","bSortMulti","bInfo","bProcessing","bAutoWidth","bSortClasses","bServerSide","bDeferRender"]);_fnMap(oSettings,oInit,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);_fnMap(oSettings.oScroll,oInit,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);_fnMap(oSettings.oLanguage,oInit,"fnInfoCallback");_fnCallbackReg(oSettings,"aoDrawCallback",oInit.fnDrawCallback,"user");_fnCallbackReg(oSettings,"aoServerParams",oInit.fnServerParams,"user");_fnCallbackReg(oSettings,"aoStateSaveParams",oInit.fnStateSaveParams,"user");_fnCallbackReg(oSettings,"aoStateLoadParams",oInit.fnStateLoadParams,"user");_fnCallbackReg(oSettings,"aoStateLoaded",oInit.fnStateLoaded,"user");_fnCallbackReg(oSettings,"aoRowCallback",oInit.fnRowCallback,"user");_fnCallbackReg(oSettings,"aoRowCreatedCallback",oInit.fnCreatedRow,"user");_fnCallbackReg(oSettings,"aoHeaderCallback",oInit.fnHeaderCallback,"user");_fnCallbackReg(oSettings,"aoFooterCallback",oInit.fnFooterCallback,"user");_fnCallbackReg(oSettings,"aoInitComplete",oInit.fnInitComplete,"user");_fnCallbackReg(oSettings,"aoPreDrawCallback",oInit.fnPreDrawCallback,"user");var oClasses=oSettings.oClasses;if(oInit.bJQueryUI){$.extend(oClasses,DataTable.ext.oJUIClasses,oInit.oClasses);if(oInit.sDom===defaults.sDom&&defaults.sDom==="lfrtip"){oSettings.sDom='<"H"lfr>t<"F"ip>'}if(!oSettings.renderer){oSettings.renderer="jqueryui"}else if($.isPlainObject(oSettings.renderer)&&!oSettings.renderer.header){oSettings.renderer.header="jqueryui"}}else{$.extend(oClasses,DataTable.ext.classes,oInit.oClasses)}$this.addClass(oClasses.sTable);if(oSettings.oScroll.sX!==""||oSettings.oScroll.sY!==""){oSettings.oScroll.iBarWidth=_fnScrollBarWidth()}if(oSettings.oScroll.sX===true){oSettings.oScroll.sX="100%"}if(oSettings.iInitDisplayStart===undefined){oSettings.iInitDisplayStart=oInit.iDisplayStart;oSettings._iDisplayStart=oInit.iDisplayStart}if(oInit.iDeferLoading!==null){oSettings.bDeferLoading=true;var tmp=$.isArray(oInit.iDeferLoading);oSettings._iRecordsDisplay=tmp?oInit.iDeferLoading[0]:oInit.iDeferLoading;oSettings._iRecordsTotal=tmp?oInit.iDeferLoading[1]:oInit.iDeferLoading}var oLanguage=oSettings.oLanguage;$.extend(true,oLanguage,oInit.oLanguage);if(oLanguage.sUrl!==""){$.ajax({dataType:"json",url:oLanguage.sUrl,success:function(json){_fnLanguageCompat(json);_fnCamelToHungarian(defaults.oLanguage,json);$.extend(true,oLanguage,json);_fnInitialise(oSettings)},error:function(){_fnInitialise(oSettings)}});bInitHandedOff=true}if(oInit.asStripeClasses===null){oSettings.asStripeClasses=[oClasses.sStripeOdd,oClasses.sStripeEven]}var stripeClasses=oSettings.asStripeClasses;var rowOne=$this.children("tbody").find("tr").eq(0);if($.inArray(true,$.map(stripeClasses,function(el,i){return rowOne.hasClass(el)}))!==-1){$("tbody tr",this).removeClass(stripeClasses.join(" "));oSettings.asDestroyStripes=stripeClasses.slice()}var anThs=[];var aoColumnsInit;var nThead=this.getElementsByTagName("thead");if(nThead.length!==0){_fnDetectHeader(oSettings.aoHeader,nThead[0]);anThs=_fnGetUniqueThs(oSettings)}if(oInit.aoColumns===null){aoColumnsInit=[];for(i=0,iLen=anThs.length;i<iLen;i++){aoColumnsInit.push(null)}}else{aoColumnsInit=oInit.aoColumns}for(i=0,iLen=aoColumnsInit.length;i<iLen;i++){_fnAddColumn(oSettings,anThs?anThs[i]:null)}_fnApplyColumnDefs(oSettings,oInit.aoColumnDefs,aoColumnsInit,function(iCol,oDef){_fnColumnOptions(oSettings,iCol,oDef)});if(rowOne.length){var a=function(cell,name){return cell.getAttribute("data-"+name)!==null?name:null};$.each(_fnGetRowElements(oSettings,rowOne[0]).cells,function(i,cell){var col=oSettings.aoColumns[i];if(col.mData===i){var sort=a(cell,"sort")||a(cell,"order");var filter=a(cell,"filter")||a(cell,"search");if(sort!==null||filter!==null){col.mData={_:i+".display",sort:sort!==null?i+".@data-"+sort:undefined,type:sort!==null?i+".@data-"+sort:undefined,filter:filter!==null?i+".@data-"+filter:undefined};_fnColumnOptions(oSettings,i)}}})}var features=oSettings.oFeatures;if(oInit.bStateSave){features.bStateSave=true;_fnLoadState(oSettings,oInit);_fnCallbackReg(oSettings,"aoDrawCallback",_fnSaveState,"state_save")}if(oInit.aaSorting===undefined){var sorting=oSettings.aaSorting;for(i=0,iLen=sorting.length;i<iLen;i++){sorting[i][1]=oSettings.aoColumns[i].asSorting[0]}}_fnSortingClasses(oSettings);if(features.bSort){_fnCallbackReg(oSettings,"aoDrawCallback",function(){if(oSettings.bSorted){var aSort=_fnSortFlatten(oSettings);var sortedColumns={};$.each(aSort,function(i,val){sortedColumns[val.src]=val.dir});_fnCallbackFire(oSettings,null,"order",[oSettings,aSort,sortedColumns]);_fnSortAria(oSettings)}})}_fnCallbackReg(oSettings,"aoDrawCallback",function(){if(oSettings.bSorted||_fnDataSource(oSettings)==="ssp"||features.bDeferRender){_fnSortingClasses(oSettings)}},"sc");_fnBrowserDetect(oSettings);var captions=$this.children("caption").each(function(){this._captionSide=$this.css("caption-side")});var thead=$this.children("thead");if(thead.length===0){thead=$("<thead/>").appendTo(this)}oSettings.nTHead=thead[0];var tbody=$this.children("tbody");if(tbody.length===0){tbody=$("<tbody/>").appendTo(this)}oSettings.nTBody=tbody[0];var tfoot=$this.children("tfoot");if(tfoot.length===0&&captions.length>0&&(oSettings.oScroll.sX!==""||oSettings.oScroll.sY!=="")){tfoot=$("<tfoot/>").appendTo(this)}if(tfoot.length===0||tfoot.children().length===0){$this.addClass(oClasses.sNoFooter)}else if(tfoot.length>0){oSettings.nTFoot=tfoot[0];_fnDetectHeader(oSettings.aoFooter,oSettings.nTFoot)}if(oInit.aaData){for(i=0;i<oInit.aaData.length;i++){_fnAddData(oSettings,oInit.aaData[i])}}else if(oSettings.bDeferLoading||_fnDataSource(oSettings)=="dom"){_fnAddTr(oSettings,$(oSettings.nTBody).children("tr"))}oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings.bInitialised=true;if(bInitHandedOff===false){_fnInitialise(oSettings)}});_that=null;return this};var __apiStruct=[];var __arrayProto=Array.prototype;var _toSettings=function(mixed){var idx,jq;var settings=DataTable.settings;var tables=$.map(settings,function(el,i){return el.nTable});if(!mixed){return[]}else if(mixed.nTable&&mixed.oApi){return[mixed]}else if(mixed.nodeName&&mixed.nodeName.toLowerCase()==="table"){idx=$.inArray(mixed,tables);return idx!==-1?[settings[idx]]:null}else if(mixed&&typeof mixed.settings==="function"){return mixed.settings().toArray()}else if(typeof mixed==="string"){jq=$(mixed)}else if(mixed instanceof $){jq=mixed}if(jq){return jq.map(function(i){idx=$.inArray(this,tables);return idx!==-1?settings[idx]:null}).toArray()}};_Api=function(context,data){if(!(this instanceof _Api)){return new _Api(context,data)}var settings=[];var ctxSettings=function(o){var a=_toSettings(o);if(a){settings.push.apply(settings,a)}};if($.isArray(context)){for(var i=0,ien=context.length;i<ien;i++){ctxSettings(context[i])}}else{ctxSettings(context)}this.context=_unique(settings);if(data){this.push.apply(this,data.toArray?data.toArray():data)}this.selector={rows:null,cols:null,opts:null};_Api.extend(this,this,__apiStruct)};DataTable.Api=_Api;_Api.prototype={any:function(){return this.flatten().length!==0},concat:__arrayProto.concat,context:[],each:function(fn){for(var i=0,ien=this.length;i<ien;i++){fn.call(this,this[i],i,this)}return this},eq:function(idx){var ctx=this.context;return ctx.length>idx?new _Api(ctx[idx],this[idx]):null},filter:function(fn){var a=[];if(__arrayProto.filter){a=__arrayProto.filter.call(this,fn,this)}else{for(var i=0,ien=this.length;i<ien;i++){if(fn.call(this,this[i],i,this)){a.push(this[i])}}}return new _Api(this.context,a)},flatten:function(){var a=[];return new _Api(this.context,a.concat.apply(a,this.toArray()))},join:__arrayProto.join,indexOf:__arrayProto.indexOf||function(obj,start){for(var i=start||0,ien=this.length;i<ien;i++){if(this[i]===obj){return i}}return-1},iterator:function(flatten,type,fn,alwaysNew){var a=[],ret,i,ien,j,jen,context=this.context,rows,items,item,selector=this.selector;if(typeof flatten==="string"){alwaysNew=fn;fn=type;type=flatten;flatten=false}for(i=0,ien=context.length;i<ien;i++){var apiInst=new _Api(context[i]);if(type==="table"){ret=fn.call(apiInst,context[i],i);if(ret!==undefined){a.push(ret)}}else if(type==="columns"||type==="rows"){ret=fn.call(apiInst,context[i],this[i],i);if(ret!==undefined){a.push(ret)}}else if(type==="column"||type==="column-rows"||type==="row"||type==="cell"){items=this[i];if(type==="column-rows"){rows=_selector_row_indexes(context[i],selector.opts)}for(j=0,jen=items.length;j<jen;j++){item=items[j];if(type==="cell"){ret=fn.call(apiInst,context[i],item.row,item.column,i,j)}else{ret=fn.call(apiInst,context[i],item,i,j,rows)}if(ret!==undefined){a.push(ret)}}}}if(a.length||alwaysNew){var api=new _Api(context,flatten?a.concat.apply([],a):a);var apiSelector=api.selector;apiSelector.rows=selector.rows;apiSelector.cols=selector.cols;apiSelector.opts=selector.opts;return api}return this},lastIndexOf:__arrayProto.lastIndexOf||function(obj,start){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(fn){var a=[];if(__arrayProto.map){a=__arrayProto.map.call(this,fn,this)}else{for(var i=0,ien=this.length;i<ien;i++){a.push(fn.call(this,this[i],i))}}return new _Api(this.context,a)},pluck:function(prop){return this.map(function(el){return el[prop]})},pop:__arrayProto.pop,push:__arrayProto.push,reduce:__arrayProto.reduce||function(fn,init){return _fnReduce(this,fn,init,0,this.length,1)},reduceRight:__arrayProto.reduceRight||function(fn,init){return _fnReduce(this,fn,init,this.length-1,-1,-1)},reverse:__arrayProto.reverse,selector:null,shift:__arrayProto.shift,sort:__arrayProto.sort,splice:__arrayProto.splice,toArray:function(){return __arrayProto.slice.call(this)},to$:function(){return $(this)},toJQuery:function(){return $(this)},unique:function(){return new _Api(this.context,_unique(this))},unshift:__arrayProto.unshift};_Api.extend=function(scope,obj,ext){if(!ext.length||!obj||!(obj instanceof _Api)&&!obj.__dt_wrapper){return}var i,ien,j,jen,struct,inner,methodScoping=function(scope,fn,struc){return function(){var ret=fn.apply(scope,arguments);_Api.extend(ret,ret,struc.methodExt);return ret}};for(i=0,ien=ext.length;i<ien;i++){struct=ext[i];obj[struct.name]=typeof struct.val==="function"?methodScoping(scope,struct.val,struct):$.isPlainObject(struct.val)?{}:struct.val;obj[struct.name].__dt_wrapper=true;_Api.extend(scope,obj[struct.name],struct.propExt)}};_Api.register=_api_register=function(name,val){if($.isArray(name)){for(var j=0,jen=name.length;j<jen;j++){_Api.register(name[j],val)}return}var i,ien,heir=name.split("."),struct=__apiStruct,key,method;var find=function(src,name){for(var i=0,ien=src.length;i<ien;i++){if(src[i].name===name){return src[i]}}return null};for(i=0,ien=heir.length;i<ien;i++){method=heir[i].indexOf("()")!==-1;key=method?heir[i].replace("()",""):heir[i];var src=find(struct,key);if(!src){src={name:key,val:{},methodExt:[],propExt:[]};struct.push(src)}if(i===ien-1){src.val=val}else{struct=method?src.methodExt:src.propExt}}};_Api.registerPlural=_api_registerPlural=function(pluralName,singularName,val){_Api.register(pluralName,val);_Api.register(singularName,function(){var ret=val.apply(this,arguments);if(ret===this){return this}else if(ret instanceof _Api){return ret.length?$.isArray(ret[0])?new _Api(ret.context,ret[0]):ret[0]:undefined}return ret})};var __table_selector=function(selector,a){if(typeof selector==="number"){return[a[selector]]}var nodes=$.map(a,function(el,i){return el.nTable});return $(nodes).filter(selector).map(function(i){var idx=$.inArray(this,nodes);return a[idx]}).toArray()};_api_register("tables()",function(selector){return selector?new _Api(__table_selector(selector,this.context)):this});_api_register("table()",function(selector){var tables=this.tables(selector);var ctx=tables.context;return ctx.length?new _Api(ctx[0]):tables});_api_registerPlural("tables().nodes()","table().node()",function(){return this.iterator("table",function(ctx){return ctx.nTable},1)});_api_registerPlural("tables().body()","table().body()",function(){return this.iterator("table",function(ctx){return ctx.nTBody},1)});_api_registerPlural("tables().header()","table().header()",function(){return this.iterator("table",function(ctx){return ctx.nTHead},1)});_api_registerPlural("tables().footer()","table().footer()",function(){return this.iterator("table",function(ctx){return ctx.nTFoot},1)});_api_registerPlural("tables().containers()","table().container()",function(){return this.iterator("table",function(ctx){return ctx.nTableWrapper},1)});_api_register("draw()",function(resetPaging){return this.iterator("table",function(settings){_fnReDraw(settings,resetPaging===false)})});_api_register("page()",function(action){if(action===undefined){return this.page.info().page}return this.iterator("table",function(settings){_fnPageChange(settings,action)})});_api_register("page.info()",function(action){if(this.context.length===0){return undefined}var settings=this.context[0],start=settings._iDisplayStart,len=settings._iDisplayLength,visRecords=settings.fnRecordsDisplay(),all=len===-1;return{page:all?0:Math.floor(start/len),pages:all?1:Math.ceil(visRecords/len),start:start,end:settings.fnDisplayEnd(),length:len,recordsTotal:settings.fnRecordsTotal(),recordsDisplay:visRecords}});_api_register("page.len()",function(len){if(len===undefined){return this.context.length!==0?this.context[0]._iDisplayLength:undefined}return this.iterator("table",function(settings){_fnLengthChange(settings,len)})});var __reload=function(settings,holdPosition,callback){if(callback){var api=new _Api(settings);api.one("draw",function(){callback(api.ajax.json())})}if(_fnDataSource(settings)=="ssp"){_fnReDraw(settings,holdPosition)}else{_fnProcessingDisplay(settings,true);_fnBuildAjax(settings,[],function(json){_fnClearTable(settings);var data=_fnAjaxDataSrc(settings,json);for(var i=0,ien=data.length;i<ien;i++){_fnAddData(settings,data[i])}_fnReDraw(settings,holdPosition);_fnProcessingDisplay(settings,false)})}};_api_register("ajax.json()",function(){var ctx=this.context;if(ctx.length>0){return ctx[0].json}});_api_register("ajax.params()",function(){var ctx=this.context;if(ctx.length>0){return ctx[0].oAjaxData}});_api_register("ajax.reload()",function(callback,resetPaging){return this.iterator("table",function(settings){__reload(settings,resetPaging===false,callback)})});_api_register("ajax.url()",function(url){var ctx=this.context;if(url===undefined){if(ctx.length===0){return undefined}ctx=ctx[0];return ctx.ajax?$.isPlainObject(ctx.ajax)?ctx.ajax.url:ctx.ajax:ctx.sAjaxSource}return this.iterator("table",function(settings){if($.isPlainObject(settings.ajax)){settings.ajax.url=url}else{settings.ajax=url}})});_api_register("ajax.url().load()",function(callback,resetPaging){return this.iterator("table",function(ctx){__reload(ctx,resetPaging===false,callback)})});var _selector_run=function(type,selector,selectFn,settings,opts){var out=[],res,a,i,ien,j,jen,selectorType=typeof selector;if(!selector||selectorType==="string"||selectorType==="function"||selector.length===undefined){selector=[selector]}for(i=0,ien=selector.length;i<ien;i++){a=selector[i]&&selector[i].split?selector[i].split(","):[selector[i]];for(j=0,jen=a.length;j<jen;j++){res=selectFn(typeof a[j]==="string"?$.trim(a[j]):a[j]);if(res&&res.length){out.push.apply(out,res)}}}var ext=_ext.selector[type];if(ext.length){for(i=0,ien=ext.length;i<ien;i++){out=ext[i](settings,opts,out)}}return out};var _selector_opts=function(opts){if(!opts){opts={}}if(opts.filter&&opts.search===undefined){opts.search=opts.filter}return $.extend({search:"none",order:"current",page:"all"},opts)};var _selector_first=function(inst){for(var i=0,ien=inst.length;i<ien;i++){if(inst[i].length>0){inst[0]=inst[i];inst[0].length=1;inst.length=1;inst.context=[inst.context[i]];return inst}}inst.length=0;return inst};var _selector_row_indexes=function(settings,opts){var i,ien,tmp,a=[],displayFiltered=settings.aiDisplay,displayMaster=settings.aiDisplayMaster;var search=opts.search,order=opts.order,page=opts.page;if(_fnDataSource(settings)=="ssp"){return search==="removed"?[]:_range(0,displayMaster.length)}else if(page=="current"){for(i=settings._iDisplayStart,ien=settings.fnDisplayEnd();i<ien;i++){a.push(displayFiltered[i])}}else if(order=="current"||order=="applied"){a=search=="none"?displayMaster.slice():search=="applied"?displayFiltered.slice():$.map(displayMaster,function(el,i){return $.inArray(el,displayFiltered)===-1?el:null})}else if(order=="index"||order=="original"){for(i=0,ien=settings.aoData.length;i<ien;i++){if(search=="none"){a.push(i)}else{tmp=$.inArray(i,displayFiltered);if(tmp===-1&&search=="removed"||tmp>=0&&search=="applied"){a.push(i)}}}}return a};var __row_selector=function(settings,selector,opts){var run=function(sel){var selInt=_intVal(sel);var i,ien;if(selInt!==null&&!opts){return[selInt]}var rows=_selector_row_indexes(settings,opts);if(selInt!==null&&$.inArray(selInt,rows)!==-1){return[selInt]}else if(!sel){return rows}if(typeof sel==="function"){return $.map(rows,function(idx){var row=settings.aoData[idx];return sel(idx,row._aData,row.nTr)?idx:null})}var nodes=_removeEmpty(_pluck_order(settings.aoData,rows,"nTr"));if(sel.nodeName){if($.inArray(sel,nodes)!==-1){return[sel._DT_RowIndex]}}return $(nodes).filter(sel).map(function(){return this._DT_RowIndex}).toArray()};return _selector_run("row",selector,run,settings,opts)};_api_register("rows()",function(selector,opts){if(selector===undefined){selector=""}else if($.isPlainObject(selector)){opts=selector;selector=""}opts=_selector_opts(opts);var inst=this.iterator("table",function(settings){return __row_selector(settings,selector,opts)},1);inst.selector.rows=selector;inst.selector.opts=opts;return inst});_api_register("rows().nodes()",function(){return this.iterator("row",function(settings,row){return settings.aoData[row].nTr||undefined},1)});_api_register("rows().data()",function(){return this.iterator(true,"rows",function(settings,rows){return _pluck_order(settings.aoData,rows,"_aData")},1)});_api_registerPlural("rows().cache()","row().cache()",function(type){return this.iterator("row",function(settings,row){var r=settings.aoData[row];return type==="search"?r._aFilterData:r._aSortData},1)});_api_registerPlural("rows().invalidate()","row().invalidate()",function(src){return this.iterator("row",function(settings,row){_fnInvalidate(settings,row,src)})});_api_registerPlural("rows().indexes()","row().index()",function(){return this.iterator("row",function(settings,row){return row},1)});_api_registerPlural("rows().remove()","row().remove()",function(){var that=this;return this.iterator("row",function(settings,row,thatIdx){var data=settings.aoData;data.splice(row,1);for(var i=0,ien=data.length;i<ien;i++){if(data[i].nTr!==null){data[i].nTr._DT_RowIndex=i}}var displayIndex=$.inArray(row,settings.aiDisplay);_fnDeleteIndex(settings.aiDisplayMaster,row);_fnDeleteIndex(settings.aiDisplay,row);_fnDeleteIndex(that[thatIdx],row,false);_fnLengthOverflow(settings)})});_api_register("rows.add()",function(rows){var newRows=this.iterator("table",function(settings){var row,i,ien;var out=[];for(i=0,ien=rows.length;i<ien;i++){row=rows[i];if(row.nodeName&&row.nodeName.toUpperCase()==="TR"){out.push(_fnAddTr(settings,row)[0])}else{out.push(_fnAddData(settings,row))}}return out},1);var modRows=this.rows(-1);modRows.pop();modRows.push.apply(modRows,newRows.toArray());return modRows});_api_register("row()",function(selector,opts){return _selector_first(this.rows(selector,opts))});_api_register("row().data()",function(data){var ctx=this.context;if(data===undefined){return ctx.length&&this.length?ctx[0].aoData[this[0]]._aData:undefined}ctx[0].aoData[this[0]]._aData=data;_fnInvalidate(ctx[0],this[0],"data");return this});_api_register("row().node()",function(){var ctx=this.context;return ctx.length&&this.length?ctx[0].aoData[this[0]].nTr||null:null});_api_register("row.add()",function(row){if(row instanceof $&&row.length){row=row[0]}var rows=this.iterator("table",function(settings){if(row.nodeName&&row.nodeName.toUpperCase()==="TR"){return _fnAddTr(settings,row)[0]}return _fnAddData(settings,row)});return this.row(rows[0])});var __details_add=function(ctx,row,data,klass){var rows=[];var addRow=function(r,k){if($.isArray(r)||r instanceof $){for(var i=0,ien=r.length;i<ien;i++){addRow(r[i],k)}return}if(r.nodeName&&r.nodeName.toLowerCase()==="tr"){rows.push(r)}else{var created=$("<tr><td/></tr>").addClass(k);$("td",created).addClass(k).html(r)[0].colSpan=_fnVisbleColumns(ctx);rows.push(created[0])}};addRow(data,klass);if(row._details){row._details.remove()}row._details=$(rows);if(row._detailsShow){row._details.insertAfter(row.nTr)}};var __details_remove=function(api,idx){var ctx=api.context;if(ctx.length){var row=ctx[0].aoData[idx!==undefined?idx:api[0]];if(row._details){row._details.remove();row._detailsShow=undefined;row._details=undefined}}};var __details_display=function(api,show){var ctx=api.context;if(ctx.length&&api.length){var row=ctx[0].aoData[api[0]];if(row._details){row._detailsShow=show;if(show){row._details.insertAfter(row.nTr)}else{row._details.detach()}__details_events(ctx[0])}}};var __details_events=function(settings){var api=new _Api(settings);var namespace=".dt.DT_details";var drawEvent="draw"+namespace;var colvisEvent="column-visibility"+namespace;var destroyEvent="destroy"+namespace;var data=settings.aoData;api.off(drawEvent+" "+colvisEvent+" "+destroyEvent);if(_pluck(data,"_details").length>0){api.on(drawEvent,function(e,ctx){if(settings!==ctx){return}api.rows({page:"current"}).eq(0).each(function(idx){var row=data[idx];if(row._detailsShow){row._details.insertAfter(row.nTr)}})});api.on(colvisEvent,function(e,ctx,idx,vis){if(settings!==ctx){return}var row,visible=_fnVisbleColumns(ctx);for(var i=0,ien=data.length;i<ien;i++){row=data[i];if(row._details){row._details.children("td[colspan]").attr("colspan",visible)}}});api.on(destroyEvent,function(e,ctx){if(settings!==ctx){return}for(var i=0,ien=data.length;i<ien;i++){if(data[i]._details){__details_remove(api,i)}}})}};var _emp="";var _child_obj=_emp+"row().child";var _child_mth=_child_obj+"()";_api_register(_child_mth,function(data,klass){var ctx=this.context;if(data===undefined){return ctx.length&&this.length?ctx[0].aoData[this[0]]._details:undefined}else if(data===true){this.child.show()}else if(data===false){__details_remove(this)}else if(ctx.length&&this.length){__details_add(ctx[0],ctx[0].aoData[this[0]],data,klass)}return this});_api_register([_child_obj+".show()",_child_mth+".show()"],function(show){__details_display(this,true);return this});_api_register([_child_obj+".hide()",_child_mth+".hide()"],function(){__details_display(this,false);return this});_api_register([_child_obj+".remove()",_child_mth+".remove()"],function(){__details_remove(this);return this});_api_register(_child_obj+".isShown()",function(){var ctx=this.context;if(ctx.length&&this.length){return ctx[0].aoData[this[0]]._detailsShow||false}return false});var __re_column_selector=/^(.+):(name|visIdx|visible)$/;var __columnData=function(settings,column,r1,r2,rows){var a=[];for(var row=0,ien=rows.length;row<ien;row++){a.push(_fnGetCellData(settings,rows[row],column))}return a};var __column_selector=function(settings,selector,opts){var columns=settings.aoColumns,names=_pluck(columns,"sName"),nodes=_pluck(columns,"nTh");var run=function(s){var selInt=_intVal(s);if(s===""){return _range(columns.length)}if(selInt!==null){return[selInt>=0?selInt:columns.length+selInt]}if(typeof s==="function"){var rows=_selector_row_indexes(settings,opts);return $.map(columns,function(col,idx){return s(idx,__columnData(settings,idx,0,0,rows),nodes[idx])?idx:null})}var match=typeof s==="string"?s.match(__re_column_selector):"";if(match){switch(match[2]){case"visIdx":case"visible":var idx=parseInt(match[1],10);if(idx<0){var visColumns=$.map(columns,function(col,i){return col.bVisible?i:null});return[visColumns[visColumns.length+idx]]}return[_fnVisibleToColumnIndex(settings,idx)];case"name":return $.map(names,function(name,i){return name===match[1]?i:null})}}else{return $(nodes).filter(s).map(function(){return $.inArray(this,nodes)}).toArray()}};return _selector_run("column",selector,run,settings,opts)};var __setColumnVis=function(settings,column,vis,recalc){var cols=settings.aoColumns,col=cols[column],data=settings.aoData,row,cells,i,ien,tr;if(vis===undefined){return col.bVisible}if(col.bVisible===vis){return}if(vis){var insertBefore=$.inArray(true,_pluck(cols,"bVisible"),column+1);for(i=0,ien=data.length;i<ien;i++){tr=data[i].nTr;cells=data[i].anCells;if(tr){tr.insertBefore(cells[column],cells[insertBefore]||null)}}}else{$(_pluck(settings.aoData,"anCells",column)).detach()}col.bVisible=vis;_fnDrawHead(settings,settings.aoHeader);_fnDrawHead(settings,settings.aoFooter);if(recalc===undefined||recalc){_fnAdjustColumnSizing(settings);if(settings.oScroll.sX||settings.oScroll.sY){_fnScrollDraw(settings)}}_fnCallbackFire(settings,null,"column-visibility",[settings,column,vis]);_fnSaveState(settings)};_api_register("columns()",function(selector,opts){if(selector===undefined){selector=""}else if($.isPlainObject(selector)){opts=selector;selector=""}opts=_selector_opts(opts);var inst=this.iterator("table",function(settings){
return __column_selector(settings,selector,opts)},1);inst.selector.cols=selector;inst.selector.opts=opts;return inst});_api_registerPlural("columns().header()","column().header()",function(selector,opts){return this.iterator("column",function(settings,column){return settings.aoColumns[column].nTh},1)});_api_registerPlural("columns().footer()","column().footer()",function(selector,opts){return this.iterator("column",function(settings,column){return settings.aoColumns[column].nTf},1)});_api_registerPlural("columns().data()","column().data()",function(){return this.iterator("column-rows",__columnData,1)});_api_registerPlural("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(settings,column){return settings.aoColumns[column].mData},1)});_api_registerPlural("columns().cache()","column().cache()",function(type){return this.iterator("column-rows",function(settings,column,i,j,rows){return _pluck_order(settings.aoData,rows,type==="search"?"_aFilterData":"_aSortData",column)},1)});_api_registerPlural("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(settings,column,i,j,rows){return _pluck_order(settings.aoData,rows,"anCells",column)},1)});_api_registerPlural("columns().visible()","column().visible()",function(vis,calc){return this.iterator("column",function(settings,column){if(vis===undefined){return settings.aoColumns[column].bVisible}__setColumnVis(settings,column,vis,calc)})});_api_registerPlural("columns().indexes()","column().index()",function(type){return this.iterator("column",function(settings,column){return type==="visible"?_fnColumnIndexToVisible(settings,column):column},1)});_api_register("columns.adjust()",function(){return this.iterator("table",function(settings){_fnAdjustColumnSizing(settings)},1)});_api_register("column.index()",function(type,idx){if(this.context.length!==0){var ctx=this.context[0];if(type==="fromVisible"||type==="toData"){return _fnVisibleToColumnIndex(ctx,idx)}else if(type==="fromData"||type==="toVisible"){return _fnColumnIndexToVisible(ctx,idx)}}});_api_register("column()",function(selector,opts){return _selector_first(this.columns(selector,opts))});var __cell_selector=function(settings,selector,opts){var data=settings.aoData;var rows=_selector_row_indexes(settings,opts);var cells=_removeEmpty(_pluck_order(data,rows,"anCells"));var allCells=$([].concat.apply([],cells));var row;var columns=settings.aoColumns.length;var a,i,ien,j,o,host;var run=function(s){var fnSelector=typeof s==="function";if(s===null||s===undefined||fnSelector){a=[];for(i=0,ien=rows.length;i<ien;i++){row=rows[i];for(j=0;j<columns;j++){o={row:row,column:j};if(fnSelector){host=settings.aoData[row];if(s(o,_fnGetCellData(settings,row,j),host.anCells?host.anCells[j]:null)){a.push(o)}}else{a.push(o)}}}return a}if($.isPlainObject(s)){return[s]}return allCells.filter(s).map(function(i,el){row=el.parentNode._DT_RowIndex;return{row:row,column:$.inArray(el,data[row].anCells)}}).toArray()};return _selector_run("cell",selector,run,settings,opts)};_api_register("cells()",function(rowSelector,columnSelector,opts){if($.isPlainObject(rowSelector)){if(rowSelector.row===undefined){opts=rowSelector;rowSelector=null}else{opts=columnSelector;columnSelector=null}}if($.isPlainObject(columnSelector)){opts=columnSelector;columnSelector=null}if(columnSelector===null||columnSelector===undefined){return this.iterator("table",function(settings){return __cell_selector(settings,rowSelector,_selector_opts(opts))})}var columns=this.columns(columnSelector,opts);var rows=this.rows(rowSelector,opts);var a,i,ien,j,jen;var cells=this.iterator("table",function(settings,idx){a=[];for(i=0,ien=rows[idx].length;i<ien;i++){for(j=0,jen=columns[idx].length;j<jen;j++){a.push({row:rows[idx][i],column:columns[idx][j]})}}return a},1);$.extend(cells.selector,{cols:columnSelector,rows:rowSelector,opts:opts});return cells});_api_registerPlural("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(settings,row,column){var cells=settings.aoData[row].anCells;return cells?cells[column]:undefined},1)});_api_register("cells().data()",function(){return this.iterator("cell",function(settings,row,column){return _fnGetCellData(settings,row,column)},1)});_api_registerPlural("cells().cache()","cell().cache()",function(type){type=type==="search"?"_aFilterData":"_aSortData";return this.iterator("cell",function(settings,row,column){return settings.aoData[row][type][column]},1)});_api_registerPlural("cells().render()","cell().render()",function(type){return this.iterator("cell",function(settings,row,column){return _fnGetCellData(settings,row,column,type)},1)});_api_registerPlural("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(settings,row,column){return{row:row,column:column,columnVisible:_fnColumnIndexToVisible(settings,column)}},1)});_api_registerPlural("cells().invalidate()","cell().invalidate()",function(src){return this.iterator("cell",function(settings,row,column){_fnInvalidate(settings,row,src,column)})});_api_register("cell()",function(rowSelector,columnSelector,opts){return _selector_first(this.cells(rowSelector,columnSelector,opts))});_api_register("cell().data()",function(data){var ctx=this.context;var cell=this[0];if(data===undefined){return ctx.length&&cell.length?_fnGetCellData(ctx[0],cell[0].row,cell[0].column):undefined}_fnSetCellData(ctx[0],cell[0].row,cell[0].column,data);_fnInvalidate(ctx[0],cell[0].row,"data",cell[0].column);return this});_api_register("order()",function(order,dir){var ctx=this.context;if(order===undefined){return ctx.length!==0?ctx[0].aaSorting:undefined}if(typeof order==="number"){order=[[order,dir]]}else if(!$.isArray(order[0])){order=Array.prototype.slice.call(arguments)}return this.iterator("table",function(settings){settings.aaSorting=order.slice()})});_api_register("order.listener()",function(node,column,callback){return this.iterator("table",function(settings){_fnSortAttachListener(settings,node,column,callback)})});_api_register(["columns().order()","column().order()"],function(dir){var that=this;return this.iterator("table",function(settings,i){var sort=[];$.each(that[i],function(j,col){sort.push([col,dir])});settings.aaSorting=sort})});_api_register("search()",function(input,regex,smart,caseInsen){var ctx=this.context;if(input===undefined){return ctx.length!==0?ctx[0].oPreviousSearch.sSearch:undefined}return this.iterator("table",function(settings){if(!settings.oFeatures.bFilter){return}_fnFilterComplete(settings,$.extend({},settings.oPreviousSearch,{sSearch:input+"",bRegex:regex===null?false:regex,bSmart:smart===null?true:smart,bCaseInsensitive:caseInsen===null?true:caseInsen}),1)})});_api_registerPlural("columns().search()","column().search()",function(input,regex,smart,caseInsen){return this.iterator("column",function(settings,column){var preSearch=settings.aoPreSearchCols;if(input===undefined){return preSearch[column].sSearch}if(!settings.oFeatures.bFilter){return}$.extend(preSearch[column],{sSearch:input+"",bRegex:regex===null?false:regex,bSmart:smart===null?true:smart,bCaseInsensitive:caseInsen===null?true:caseInsen});_fnFilterComplete(settings,settings.oPreviousSearch,1)})});_api_register("state()",function(){return this.context.length?this.context[0].oSavedState:null});_api_register("state.clear()",function(){return this.iterator("table",function(settings){settings.fnStateSaveCallback.call(settings.oInstance,settings,{})})});_api_register("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});_api_register("state.save()",function(){return this.iterator("table",function(settings){_fnSaveState(settings)})});DataTable.versionCheck=DataTable.fnVersionCheck=function(version){var aThis=DataTable.version.split(".");var aThat=version.split(".");var iThis,iThat;for(var i=0,iLen=aThat.length;i<iLen;i++){iThis=parseInt(aThis[i],10)||0;iThat=parseInt(aThat[i],10)||0;if(iThis===iThat){continue}return iThis>iThat}return true};DataTable.isDataTable=DataTable.fnIsDataTable=function(table){var t=$(table).get(0);var is=false;$.each(DataTable.settings,function(i,o){var head=o.nScrollHead?$("table",o.nScrollHead)[0]:null;var foot=o.nScrollFoot?$("table",o.nScrollFoot)[0]:null;if(o.nTable===t||head===t||foot===t){is=true}});return is};DataTable.tables=DataTable.fnTables=function(visible){return $.map(DataTable.settings,function(o){if(!visible||visible&&$(o.nTable).is(":visible")){return o.nTable}})};DataTable.util={throttle:_fnThrottle,escapeRegex:_fnEscapeRegex};DataTable.camelToHungarian=_fnCamelToHungarian;_api_register("$()",function(selector,opts){var rows=this.rows(opts).nodes(),jqRows=$(rows);return $([].concat(jqRows.filter(selector).toArray(),jqRows.find(selector).toArray()))});$.each(["on","one","off"],function(i,key){_api_register(key+"()",function(){var args=Array.prototype.slice.call(arguments);if(!args[0].match(/\.dt\b/)){args[0]+=".dt"}var inst=$(this.tables().nodes());inst[key].apply(inst,args);return this})});_api_register("clear()",function(){return this.iterator("table",function(settings){_fnClearTable(settings)})});_api_register("settings()",function(){return new _Api(this.context,this.context)});_api_register("init()",function(){var ctx=this.context;return ctx.length?ctx[0].oInit:null});_api_register("data()",function(){return this.iterator("table",function(settings){return _pluck(settings.aoData,"_aData")}).flatten()});_api_register("destroy()",function(remove){remove=remove||false;return this.iterator("table",function(settings){var orig=settings.nTableWrapper.parentNode;var classes=settings.oClasses;var table=settings.nTable;var tbody=settings.nTBody;var thead=settings.nTHead;var tfoot=settings.nTFoot;var jqTable=$(table);var jqTbody=$(tbody);var jqWrapper=$(settings.nTableWrapper);var rows=$.map(settings.aoData,function(r){return r.nTr});var i,ien;settings.bDestroying=true;_fnCallbackFire(settings,"aoDestroyCallback","destroy",[settings]);if(!remove){new _Api(settings).columns().visible(true)}jqWrapper.unbind(".DT").find(":not(tbody *)").unbind(".DT");$(window).unbind(".DT-"+settings.sInstance);if(table!=thead.parentNode){jqTable.children("thead").detach();jqTable.append(thead)}if(tfoot&&table!=tfoot.parentNode){jqTable.children("tfoot").detach();jqTable.append(tfoot)}jqTable.detach();jqWrapper.detach();settings.aaSorting=[];settings.aaSortingFixed=[];_fnSortingClasses(settings);$(rows).removeClass(settings.asStripeClasses.join(" "));$("th, td",thead).removeClass(classes.sSortable+" "+classes.sSortableAsc+" "+classes.sSortableDesc+" "+classes.sSortableNone);if(settings.bJUI){$("th span."+classes.sSortIcon+", td span."+classes.sSortIcon,thead).detach();$("th, td",thead).each(function(){var wrapper=$("div."+classes.sSortJUIWrapper,this);$(this).append(wrapper.contents());wrapper.detach()})}if(!remove&&orig){orig.insertBefore(table,settings.nTableReinsertBefore)}jqTbody.children().detach();jqTbody.append(rows);jqTable.css("width",settings.sDestroyWidth).removeClass(classes.sTable);ien=settings.asDestroyStripes.length;if(ien){jqTbody.children().each(function(i){$(this).addClass(settings.asDestroyStripes[i%ien])})}var idx=$.inArray(settings,DataTable.settings);if(idx!==-1){DataTable.settings.splice(idx,1)}})});$.each(["column","row","cell"],function(i,type){_api_register(type+"s().every()",function(fn){return this.iterator(type,function(settings,idx,idx2){fn.call(new _Api(settings)[type](idx,idx2))})})});_api_register("i18n()",function(token,def,plural){var ctx=this.context[0];var resolved=_fnGetObjectDataFn(token)(ctx.oLanguage);if(resolved===undefined){resolved=def}if(plural!==undefined&&$.isPlainObject(resolved)){resolved=resolved[plural]!==undefined?resolved[plural]:resolved._}return resolved.replace("%d",plural)});DataTable.version="1.10.7";DataTable.settings=[];DataTable.models={};DataTable.models.oSearch={bCaseInsensitive:true,sSearch:"",bRegex:false,bSmart:true};DataTable.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null};DataTable.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:false,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};DataTable.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:true,bDeferRender:false,bDestroy:false,bFilter:true,bInfo:true,bJQueryUI:false,bLengthChange:true,bPaginate:true,bProcessing:false,bRetrieve:false,bScrollCollapse:false,bServerSide:false,bSort:true,bSortMulti:true,bSortCellsTop:false,bSortClasses:true,bStateSave:false,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(toFormat){return toFormat.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(settings){try{return JSON.parse((settings.iStateDuration===-1?sessionStorage:localStorage).getItem("DataTables_"+settings.sInstance+"_"+location.pathname))}catch(e){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(settings,data){try{(settings.iStateDuration===-1?sessionStorage:localStorage).setItem("DataTables_"+settings.sInstance+"_"+location.pathname,JSON.stringify(data))}catch(e){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:$.extend({},DataTable.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null};_fnHungarianMap(DataTable.defaults);DataTable.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:true,bSortable:true,bVisible:true,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};_fnHungarianMap(DataTable.defaults.column);DataTable.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:false,bScrollbarLeft:false},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:false,bInitialised:false,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:true,jqXHR:null,json:undefined,oAjaxData:undefined,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:false,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:false,bSorted:false,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return _fnDataSource(this)=="ssp"?this._iRecordsTotal*1:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return _fnDataSource(this)=="ssp"?this._iRecordsDisplay*1:this.aiDisplay.length},fnDisplayEnd:function(){var len=this._iDisplayLength,start=this._iDisplayStart,calc=start+len,records=this.aiDisplay.length,features=this.oFeatures,paginate=features.bPaginate;if(features.bServerSide){return paginate===false||len===-1?start+records:Math.min(start+len,this._iRecordsDisplay)}else{return!paginate||calc>records||len===-1?records:calc}},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}};DataTable.ext=_ext={buttons:{},classes:{},errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:DataTable.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:DataTable.version};$.extend(_ext,{afnFiltering:_ext.search,aTypes:_ext.type.detect,ofnSearch:_ext.type.search,oSort:_ext.type.order,afnSortData:_ext.order,aoFeatures:_ext.feature,oApi:_ext.internal,oStdClasses:_ext.classes,oPagination:_ext.pager});$.extend(DataTable.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});(function(){var _empty="";_empty="";var _stateDefault=_empty+"ui-state-default";var _sortIcon=_empty+"css_right ui-icon ui-icon-";var _headerFooter=_empty+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";$.extend(DataTable.ext.oJUIClasses,DataTable.ext.classes,{sPageButton:"fg-button ui-button "+_stateDefault,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi "+"ui-buttonset-multi paging_",sSortAsc:_stateDefault+" sorting_asc",sSortDesc:_stateDefault+" sorting_desc",sSortable:_stateDefault+" sorting",sSortableAsc:_stateDefault+" sorting_asc_disabled",sSortableDesc:_stateDefault+" sorting_desc_disabled",sSortableNone:_stateDefault+" sorting_disabled",sSortJUIAsc:_sortIcon+"triangle-1-n",sSortJUIDesc:_sortIcon+"triangle-1-s",sSortJUI:_sortIcon+"carat-2-n-s",sSortJUIAscAllowed:_sortIcon+"carat-1-n",sSortJUIDescAllowed:_sortIcon+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+_stateDefault,sScrollFoot:"dataTables_scrollFoot "+_stateDefault,sHeaderTH:_stateDefault,sFooterTH:_stateDefault,sJUIHeader:_headerFooter+" ui-corner-tl ui-corner-tr",sJUIFooter:_headerFooter+" ui-corner-bl ui-corner-br"})})();var extPagination=DataTable.ext.pager;function _numbers(page,pages){var numbers=[],buttons=extPagination.numbers_length,half=Math.floor(buttons/2),i=1;if(pages<=buttons){numbers=_range(0,pages)}else if(page<=half){numbers=_range(0,buttons-2);numbers.push("ellipsis");numbers.push(pages-1)}else if(page>=pages-1-half){numbers=_range(pages-(buttons-2),pages);numbers.splice(0,0,"ellipsis");numbers.splice(0,0,0)}else{numbers=_range(page-half+2,page+half-1);numbers.push("ellipsis");numbers.push(pages-1);numbers.splice(0,0,"ellipsis");numbers.splice(0,0,0)}numbers.DT_el="span";return numbers}$.extend(extPagination,{simple:function(page,pages){return["previous","next"]},full:function(page,pages){return["first","previous","next","last"]},simple_numbers:function(page,pages){return["previous",_numbers(page,pages),"next"]},full_numbers:function(page,pages){return["first","previous",_numbers(page,pages),"next","last"]},_numbers:_numbers,numbers_length:7});$.extend(true,DataTable.ext.renderer,{pageButton:{_:function(settings,host,idx,buttons,page,pages){var classes=settings.oClasses;var lang=settings.oLanguage.oPaginate;var btnDisplay,btnClass,counter=0;var attach=function(container,buttons){var i,ien,node,button;var clickHandler=function(e){_fnPageChange(settings,e.data.action,true)};for(i=0,ien=buttons.length;i<ien;i++){button=buttons[i];if($.isArray(button)){var inner=$("<"+(button.DT_el||"div")+"/>").appendTo(container);attach(inner,button)}else{btnDisplay="";btnClass="";switch(button){case"ellipsis":container.append('<span class="ellipsis">&#x2026;</span>');break;case"first":btnDisplay=lang.sFirst;btnClass=button+(page>0?"":" "+classes.sPageButtonDisabled);break;case"previous":btnDisplay=lang.sPrevious;btnClass=button+(page>0?"":" "+classes.sPageButtonDisabled);break;case"next":btnDisplay=lang.sNext;btnClass=button+(page<pages-1?"":" "+classes.sPageButtonDisabled);break;case"last":btnDisplay=lang.sLast;btnClass=button+(page<pages-1?"":" "+classes.sPageButtonDisabled);break;default:btnDisplay=button+1;btnClass=page===button?classes.sPageButtonActive:"";break}if(btnDisplay){node=$("<a>",{"class":classes.sPageButton+" "+btnClass,"aria-controls":settings.sTableId,"data-dt-idx":counter,tabindex:settings.iTabIndex,id:idx===0&&typeof button==="string"?settings.sTableId+"_"+button:null}).html(btnDisplay).appendTo(container);_fnBindAction(node,{action:button},clickHandler);counter++}}}};var activeEl;try{activeEl=$(document.activeElement).data("dt-idx")}catch(e){}attach($(host).empty(),buttons);if(activeEl){$(host).find("[data-dt-idx="+activeEl+"]").focus()}}}});$.extend(DataTable.ext.type.detect,[function(d,settings){var decimal=settings.oLanguage.sDecimal;return _isNumber(d,decimal)?"num"+decimal:null},function(d,settings){if(d&&!(d instanceof Date)&&(!_re_date_start.test(d)||!_re_date_end.test(d))){return null}var parsed=Date.parse(d);return parsed!==null&&!isNaN(parsed)||_empty(d)?"date":null},function(d,settings){var decimal=settings.oLanguage.sDecimal;return _isNumber(d,decimal,true)?"num-fmt"+decimal:null},function(d,settings){var decimal=settings.oLanguage.sDecimal;return _htmlNumeric(d,decimal)?"html-num"+decimal:null},function(d,settings){var decimal=settings.oLanguage.sDecimal;return _htmlNumeric(d,decimal,true)?"html-num-fmt"+decimal:null},function(d,settings){return _empty(d)||typeof d==="string"&&d.indexOf("<")!==-1?"html":null}]);$.extend(DataTable.ext.type.search,{html:function(data){return _empty(data)?data:typeof data==="string"?data.replace(_re_new_lines," ").replace(_re_html,""):""},string:function(data){return _empty(data)?data:typeof data==="string"?data.replace(_re_new_lines," "):data}});var __numericReplace=function(d,decimalPlace,re1,re2){if(d!==0&&(!d||d==="-")){return-Infinity}if(decimalPlace){d=_numToDecimal(d,decimalPlace)}if(d.replace){if(re1){d=d.replace(re1,"")}if(re2){d=d.replace(re2,"")}}return d*1};function _addNumericSort(decimalPlace){$.each({num:function(d){return __numericReplace(d,decimalPlace)},"num-fmt":function(d){return __numericReplace(d,decimalPlace,_re_formatted_numeric)},"html-num":function(d){return __numericReplace(d,decimalPlace,_re_html)},"html-num-fmt":function(d){return __numericReplace(d,decimalPlace,_re_html,_re_formatted_numeric)}},function(key,fn){_ext.type.order[key+decimalPlace+"-pre"]=fn;if(key.match(/^html\-/)){_ext.type.search[key+decimalPlace]=_ext.type.search.html}})}$.extend(_ext.type.order,{"date-pre":function(d){return Date.parse(d)||0},"html-pre":function(a){return _empty(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return _empty(a)?"":typeof a==="string"?a.toLowerCase():!a.toString?"":a.toString()},"string-asc":function(x,y){return x<y?-1:x>y?1:0},"string-desc":function(x,y){return x<y?1:x>y?-1:0}});_addNumericSort("");$.extend(true,DataTable.ext.renderer,{header:{_:function(settings,cell,column,classes){$(settings.nTable).on("order.dt.DT",function(e,ctx,sorting,columns){if(settings!==ctx){return}var colIdx=column.idx;cell.removeClass(column.sSortingClass+" "+classes.sSortAsc+" "+classes.sSortDesc).addClass(columns[colIdx]=="asc"?classes.sSortAsc:columns[colIdx]=="desc"?classes.sSortDesc:column.sSortingClass)})},jqueryui:function(settings,cell,column,classes){$("<div/>").addClass(classes.sSortJUIWrapper).append(cell.contents()).append($("<span/>").addClass(classes.sSortIcon+" "+column.sSortingClassJUI)).appendTo(cell);$(settings.nTable).on("order.dt.DT",function(e,ctx,sorting,columns){if(settings!==ctx){return}var colIdx=column.idx;cell.removeClass(classes.sSortAsc+" "+classes.sSortDesc).addClass(columns[colIdx]=="asc"?classes.sSortAsc:columns[colIdx]=="desc"?classes.sSortDesc:column.sSortingClass);cell.find("span."+classes.sSortIcon).removeClass(classes.sSortJUIAsc+" "+classes.sSortJUIDesc+" "+classes.sSortJUI+" "+classes.sSortJUIAscAllowed+" "+classes.sSortJUIDescAllowed).addClass(columns[colIdx]=="asc"?classes.sSortJUIAsc:columns[colIdx]=="desc"?classes.sSortJUIDesc:column.sSortingClassJUI)})}}});DataTable.render={number:function(thousands,decimal,precision,prefix){return{display:function(d){if(typeof d!=="number"&&typeof d!=="string"){return d}var negative=d<0?"-":"";d=Math.abs(parseFloat(d));var intPart=parseInt(d,10);var floatPart=precision?decimal+(d-intPart).toFixed(precision).substring(2):"";return negative+(prefix||"")+intPart.toString().replace(/\B(?=(\d{3})+(?!\d))/g,thousands)+floatPart}}}};function _fnExternApiFunc(fn){return function(){var args=[_fnSettingsFromNode(this[DataTable.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return DataTable.ext.internal[fn].apply(this,args)}}$.extend(DataTable.ext.internal,{_fnExternApiFunc:_fnExternApiFunc,_fnBuildAjax:_fnBuildAjax,_fnAjaxUpdate:_fnAjaxUpdate,_fnAjaxParameters:_fnAjaxParameters,_fnAjaxUpdateDraw:_fnAjaxUpdateDraw,_fnAjaxDataSrc:_fnAjaxDataSrc,_fnAddColumn:_fnAddColumn,_fnColumnOptions:_fnColumnOptions,_fnAdjustColumnSizing:_fnAdjustColumnSizing,_fnVisibleToColumnIndex:_fnVisibleToColumnIndex,_fnColumnIndexToVisible:_fnColumnIndexToVisible,_fnVisbleColumns:_fnVisbleColumns,_fnGetColumns:_fnGetColumns,_fnColumnTypes:_fnColumnTypes,_fnApplyColumnDefs:_fnApplyColumnDefs,_fnHungarianMap:_fnHungarianMap,_fnCamelToHungarian:_fnCamelToHungarian,_fnLanguageCompat:_fnLanguageCompat,_fnBrowserDetect:_fnBrowserDetect,_fnAddData:_fnAddData,_fnAddTr:_fnAddTr,_fnNodeToDataIndex:_fnNodeToDataIndex,_fnNodeToColumnIndex:_fnNodeToColumnIndex,_fnGetCellData:_fnGetCellData,_fnSetCellData:_fnSetCellData,_fnSplitObjNotation:_fnSplitObjNotation,_fnGetObjectDataFn:_fnGetObjectDataFn,_fnSetObjectDataFn:_fnSetObjectDataFn,_fnGetDataMaster:_fnGetDataMaster,_fnClearTable:_fnClearTable,_fnDeleteIndex:_fnDeleteIndex,_fnInvalidate:_fnInvalidate,_fnGetRowElements:_fnGetRowElements,_fnCreateTr:_fnCreateTr,_fnBuildHead:_fnBuildHead,_fnDrawHead:_fnDrawHead,_fnDraw:_fnDraw,_fnReDraw:_fnReDraw,_fnAddOptionsHtml:_fnAddOptionsHtml,_fnDetectHeader:_fnDetectHeader,_fnGetUniqueThs:_fnGetUniqueThs,_fnFeatureHtmlFilter:_fnFeatureHtmlFilter,_fnFilterComplete:_fnFilterComplete,_fnFilterCustom:_fnFilterCustom,_fnFilterColumn:_fnFilterColumn,_fnFilter:_fnFilter,_fnFilterCreateSearch:_fnFilterCreateSearch,_fnEscapeRegex:_fnEscapeRegex,_fnFilterData:_fnFilterData,_fnFeatureHtmlInfo:_fnFeatureHtmlInfo,_fnUpdateInfo:_fnUpdateInfo,_fnInfoMacros:_fnInfoMacros,_fnInitialise:_fnInitialise,_fnInitComplete:_fnInitComplete,_fnLengthChange:_fnLengthChange,_fnFeatureHtmlLength:_fnFeatureHtmlLength,_fnFeatureHtmlPaginate:_fnFeatureHtmlPaginate,_fnPageChange:_fnPageChange,_fnFeatureHtmlProcessing:_fnFeatureHtmlProcessing,_fnProcessingDisplay:_fnProcessingDisplay,_fnFeatureHtmlTable:_fnFeatureHtmlTable,_fnScrollDraw:_fnScrollDraw,_fnApplyToChildren:_fnApplyToChildren,_fnCalculateColumnWidths:_fnCalculateColumnWidths,_fnThrottle:_fnThrottle,_fnConvertToWidth:_fnConvertToWidth,_fnScrollingWidthAdjust:_fnScrollingWidthAdjust,_fnGetWidestNode:_fnGetWidestNode,_fnGetMaxLenString:_fnGetMaxLenString,_fnStringToCss:_fnStringToCss,_fnScrollBarWidth:_fnScrollBarWidth,_fnSortFlatten:_fnSortFlatten,_fnSort:_fnSort,_fnSortAria:_fnSortAria,_fnSortListener:_fnSortListener,_fnSortAttachListener:_fnSortAttachListener,_fnSortingClasses:_fnSortingClasses,_fnSortData:_fnSortData,_fnSaveState:_fnSaveState,_fnLoadState:_fnLoadState,_fnSettingsFromNode:_fnSettingsFromNode,_fnLog:_fnLog,_fnMap:_fnMap,_fnBindAction:_fnBindAction,_fnCallbackReg:_fnCallbackReg,_fnCallbackFire:_fnCallbackFire,_fnLengthOverflow:_fnLengthOverflow,_fnRenderer:_fnRenderer,_fnDataSource:_fnDataSource,_fnRowAttributes:_fnRowAttributes,_fnCalculateEnd:function(){}});$.fn.dataTable=DataTable;$.fn.dataTableSettings=DataTable.settings;$.fn.dataTableExt=DataTable.ext;$.fn.DataTable=function(opts){return $(this).dataTable(opts).api()};$.each(DataTable,function(prop,val){$.fn.DataTable[prop]=val});return $.fn.dataTable})})(window,document)},{jquery:34}],31:[function(require,module,exports){module.exports.form2js=require("./src/form2js");module.exports.js2form=require("./src/js2form")},{"./src/form2js":32,"./src/js2form":33}],32:[function(require,module,exports){(function(root,factory){if(typeof exports!=="undefined"&&typeof module!=="undefined"&&module.exports){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{root.form2js=factory()}})(this,function(){"use strict";function form2js(rootNode,delimiter,skipEmpty,nodeCallback,useIdIfEmptyName,getDisabled){getDisabled=getDisabled?true:false;if(typeof skipEmpty=="undefined"||skipEmpty==null)skipEmpty=true;if(typeof delimiter=="undefined"||delimiter==null)delimiter=".";if(arguments.length<5)useIdIfEmptyName=false;rootNode=typeof rootNode=="string"?document.getElementById(rootNode):rootNode;var formValues=[],currNode,i=0;if(rootNode.constructor==Array||typeof NodeList!="undefined"&&rootNode.constructor==NodeList){while(currNode=rootNode[i++]){formValues=formValues.concat(getFormValues(currNode,nodeCallback,useIdIfEmptyName,getDisabled))}}else{formValues=getFormValues(rootNode,nodeCallback,useIdIfEmptyName,getDisabled)}return processNameValues(formValues,skipEmpty,delimiter)}function processNameValues(nameValues,skipEmpty,delimiter){var result={},arrays={},i,j,k,l,value,nameParts,currResult,arrNameFull,arrName,arrIdx,namePart,name,_nameParts;for(i=0;i<nameValues.length;i++){value=nameValues[i].value;if(skipEmpty&&(value===""||value===null))continue;name=nameValues[i].name;_nameParts=name.split(delimiter);nameParts=[];currResult=result;arrNameFull="";for(j=0;j<_nameParts.length;j++){namePart=_nameParts[j].split("][");if(namePart.length>1){for(k=0;k<namePart.length;k++){if(k==0){namePart[k]=namePart[k]+"]"}else if(k==namePart.length-1){namePart[k]="["+namePart[k]}else{namePart[k]="["+namePart[k]+"]"}arrIdx=namePart[k].match(/([a-z_]+)?\[([a-z_][a-z0-9_]+?)\]/i);if(arrIdx){for(l=1;l<arrIdx.length;l++){
if(arrIdx[l])nameParts.push(arrIdx[l])}}else{nameParts.push(namePart[k])}}}else nameParts=nameParts.concat(namePart)}for(j=0;j<nameParts.length;j++){namePart=nameParts[j];if(namePart.indexOf("[]")>-1&&j==nameParts.length-1){arrName=namePart.substr(0,namePart.indexOf("["));arrNameFull+=arrName;if(!currResult[arrName])currResult[arrName]=[];currResult[arrName].push(value)}else if(namePart.indexOf("[")>-1){arrName=namePart.substr(0,namePart.indexOf("["));arrIdx=namePart.replace(/(^([a-z_]+)?\[)|(\]$)/gi,"");arrNameFull+="_"+arrName+"_"+arrIdx;if(!arrays[arrNameFull])arrays[arrNameFull]={};if(arrName!=""&&!currResult[arrName])currResult[arrName]=[];if(j==nameParts.length-1){if(arrName==""){currResult.push(value);arrays[arrNameFull][arrIdx]=currResult[currResult.length-1]}else{currResult[arrName].push(value);arrays[arrNameFull][arrIdx]=currResult[arrName][currResult[arrName].length-1]}}else{if(!arrays[arrNameFull][arrIdx]){if(/^[0-9a-z_]+\[?/i.test(nameParts[j+1]))currResult[arrName].push({});else currResult[arrName].push([]);arrays[arrNameFull][arrIdx]=currResult[arrName][currResult[arrName].length-1]}}currResult=arrays[arrNameFull][arrIdx]}else{arrNameFull+=namePart;if(j<nameParts.length-1){if(!currResult[namePart])currResult[namePart]={};currResult=currResult[namePart]}else{currResult[namePart]=value}}}}return result}function getFormValues(rootNode,nodeCallback,useIdIfEmptyName,getDisabled){var result=extractNodeValues(rootNode,nodeCallback,useIdIfEmptyName,getDisabled);return result.length>0?result:getSubFormValues(rootNode,nodeCallback,useIdIfEmptyName,getDisabled)}function getSubFormValues(rootNode,nodeCallback,useIdIfEmptyName,getDisabled){var result=[],currentNode=rootNode.firstChild;while(currentNode){result=result.concat(extractNodeValues(currentNode,nodeCallback,useIdIfEmptyName,getDisabled));currentNode=currentNode.nextSibling}return result}function extractNodeValues(node,nodeCallback,useIdIfEmptyName,getDisabled){if(node.disabled&&!getDisabled)return[];var callbackResult,fieldValue,result,fieldName=getFieldName(node,useIdIfEmptyName);callbackResult=nodeCallback&&nodeCallback(node);if(callbackResult&&callbackResult.name){result=[callbackResult]}else if(fieldName!=""&&node.nodeName.match(/INPUT|TEXTAREA/i)){fieldValue=getFieldValue(node,getDisabled);if(null===fieldValue){result=[]}else{result=[{name:fieldName,value:fieldValue}]}}else if(fieldName!=""&&node.nodeName.match(/SELECT/i)){fieldValue=getFieldValue(node,getDisabled);result=[{name:fieldName.replace(/\[\]$/,""),value:fieldValue}]}else{result=getSubFormValues(node,nodeCallback,useIdIfEmptyName,getDisabled)}return result}function getFieldName(node,useIdIfEmptyName){if(node.name&&node.name!="")return node.name;else if(useIdIfEmptyName&&node.id&&node.id!="")return node.id;else return""}function getFieldValue(fieldNode,getDisabled){if(fieldNode.disabled&&!getDisabled)return null;switch(fieldNode.nodeName){case"INPUT":case"TEXTAREA":switch(fieldNode.type.toLowerCase()){case"radio":if(fieldNode.checked&&fieldNode.value==="false")return false;case"checkbox":if(fieldNode.checked&&fieldNode.value==="true")return true;if(!fieldNode.checked&&fieldNode.value==="true")return false;if(fieldNode.checked)return fieldNode.value;break;case"button":case"reset":case"submit":case"image":return"";break;default:return fieldNode.value;break}break;case"SELECT":return getSelectedOptionValue(fieldNode);break;default:break}return null}function getSelectedOptionValue(selectNode){var multiple=selectNode.multiple,result=[],options,i,l;if(!multiple)return selectNode.value;for(options=selectNode.getElementsByTagName("option"),i=0,l=options.length;i<l;i++){if(options[i].selected)result.push(options[i].value)}return result}return form2js})},{}],33:[function(require,module,exports){(function(root,factory){if(typeof exports!=="undefined"&&typeof module!=="undefined"&&module.exports){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{root.js2form=factory()}})(this,function(){"use strict";var _subArrayRegexp=/^\[\d+?\]/,_subObjectRegexp=/^[a-zA-Z_][a-zA-Z_0-9]*/,_arrayItemRegexp=/\[[0-9]+?\]$/,_lastIndexedArrayRegexp=/(.*)(\[)([0-9]*)(\])$/,_arrayOfArraysRegexp=/\[([0-9]+)\]\[([0-9]+)\]/g,_inputOrTextareaRegexp=/INPUT|TEXTAREA/i;function js2form(rootNode,data,delimiter,nodeCallback,useIdIfEmptyName){if(arguments.length<3)delimiter=".";if(arguments.length<4)nodeCallback=null;if(arguments.length<5)useIdIfEmptyName=false;rootNode=typeof rootNode=="string"?document.getElementById(rootNode):rootNode;var fieldValues,formFieldsByName;fieldValues=object2array(data);formFieldsByName=getFields(rootNode,useIdIfEmptyName,delimiter,{},true);for(var i=0;i<fieldValues.length;i++){var fieldName=fieldValues[i].name,fieldValue=fieldValues[i].value;if(typeof formFieldsByName[fieldName]!="undefined"){setValue(formFieldsByName[fieldName],fieldValue)}else if(typeof formFieldsByName[fieldName.replace(_arrayItemRegexp,"[]")]!="undefined"){setValue(formFieldsByName[fieldName.replace(_arrayItemRegexp,"[]")],fieldValue)}else if(typeof formFieldsByName[fieldName.replace(_arrayItemRegexp,"")]!="undefined"){setValue(formFieldsByName[fieldName.replace(_arrayItemRegexp,"")],fieldValue)}}}function setValue(field,value){var children,i,l;if(field instanceof Array){for(i=0;i<field.length;i++){if(field[i].value==value||value===true)field[i].checked=true}}else if(_inputOrTextareaRegexp.test(field.nodeName)){field.value=value}else if(/SELECT/i.test(field.nodeName)){children=field.getElementsByTagName("option");for(i=0,l=children.length;i<l;i++){if(children[i].value==value){children[i].selected=true;if(field.multiple)break}else if(!field.multiple){children[i].selected=false}}}}function getFields(rootNode,useIdIfEmptyName,delimiter,arrayIndexes,shouldClean){if(arguments.length<4)arrayIndexes={};var result={},currNode=rootNode.firstChild,name,nameNormalized,subFieldName,i,j,l,options;while(currNode){name="";if(currNode.name&&currNode.name!=""){name=currNode.name}else if(useIdIfEmptyName&&currNode.id&&currNode.id!=""){name=currNode.id}if(name==""){var subFields=getFields(currNode,useIdIfEmptyName,delimiter,arrayIndexes,shouldClean);for(subFieldName in subFields){if(typeof result[subFieldName]=="undefined"){result[subFieldName]=subFields[subFieldName]}else{for(i=0;i<subFields[subFieldName].length;i++){result[subFieldName].push(subFields[subFieldName][i])}}}}else{if(/SELECT/i.test(currNode.nodeName)){for(j=0,options=currNode.getElementsByTagName("option"),l=options.length;j<l;j++){if(shouldClean){options[j].selected=false}nameNormalized=normalizeName(name,delimiter,arrayIndexes);result[nameNormalized]=currNode}}else if(/INPUT/i.test(currNode.nodeName)&&/CHECKBOX|RADIO/i.test(currNode.type)){if(shouldClean){currNode.checked=false}nameNormalized=normalizeName(name,delimiter,arrayIndexes);nameNormalized=nameNormalized.replace(_arrayItemRegexp,"[]");if(!result[nameNormalized])result[nameNormalized]=[];result[nameNormalized].push(currNode)}else{if(shouldClean){currNode.value=""}nameNormalized=normalizeName(name,delimiter,arrayIndexes);result[nameNormalized]=currNode}}currNode=currNode.nextSibling}return result}function normalizeName(name,delimiter,arrayIndexes){var nameChunksNormalized=[],nameChunks=name.split(delimiter),currChunk,nameMatches,nameNormalized,currIndex,newIndex,i;name=name.replace(_arrayOfArraysRegexp,"[$1].[$2]");for(i=0;i<nameChunks.length;i++){currChunk=nameChunks[i];nameChunksNormalized.push(currChunk);nameMatches=currChunk.match(_lastIndexedArrayRegexp);if(nameMatches!=null){nameNormalized=nameChunksNormalized.join(delimiter);currIndex=nameNormalized.replace(_lastIndexedArrayRegexp,"$3");nameNormalized=nameNormalized.replace(_lastIndexedArrayRegexp,"$1");if(typeof arrayIndexes[nameNormalized]=="undefined"){arrayIndexes[nameNormalized]={lastIndex:-1,indexes:{}}}if(currIndex==""||typeof arrayIndexes[nameNormalized].indexes[currIndex]=="undefined"){arrayIndexes[nameNormalized].lastIndex++;arrayIndexes[nameNormalized].indexes[currIndex]=arrayIndexes[nameNormalized].lastIndex}newIndex=arrayIndexes[nameNormalized].indexes[currIndex];nameChunksNormalized[nameChunksNormalized.length-1]=currChunk.replace(_lastIndexedArrayRegexp,"$1$2"+newIndex+"$4")}}nameNormalized=nameChunksNormalized.join(delimiter);nameNormalized=nameNormalized.replace("].[","][");return nameNormalized}function object2array(obj,lvl){var result=[],i,name;if(arguments.length==1)lvl=0;if(obj==null){result=[{name:"",value:null}]}else if(typeof obj=="string"||typeof obj=="number"||typeof obj=="date"||typeof obj=="boolean"){result=[{name:"",value:obj}]}else if(obj instanceof Array){for(i=0;i<obj.length;i++){name="["+i+"]";result=result.concat(getSubValues(obj[i],name,lvl+1))}}else{for(i in obj){name=i;result=result.concat(getSubValues(obj[i],name,lvl+1))}}return result}function getSubValues(subObj,name,lvl){var itemName;var result=[],tempResult=object2array(subObj,lvl+1),i,tempItem;for(i=0;i<tempResult.length;i++){itemName=name;if(_subArrayRegexp.test(tempResult[i].name)){itemName+=tempResult[i].name}else if(_subObjectRegexp.test(tempResult[i].name)){itemName+="."+tempResult[i].name}tempItem={name:itemName,value:tempResult[i].value};result.push(tempItem)}return result}return js2form})},{}],34:[function(require,module,exports){(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document")}return factory(w)}}else{factory(global)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){var arr=[];var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var document=window.document,version="2.1.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)+1>=0},isPlainObject:function(obj){if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}if(obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}return true},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},type:function(obj){if(obj==null){return obj+""}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i)},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j]}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:Date.now,support:support});jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length="length"in obj&&obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||length===0||typeof length==="number"&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];nodeType=context.nodeType;if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results}if(!seed&&documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType!==1&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+" "]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;parent=doc.defaultView;if(parent&&parent!==parent.top){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false)}else if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler)}}documentIsHTML=!isXML(doc);support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag)}else if(support.qsa){return context.querySelectorAll(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\f]' msallowcapture=''>"+"<option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]){match[2]=match[4]||match[5]||""}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];
break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text")},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector)}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector}return cached};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}else if(compiled){context=context.parentNode}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return typeof rootjQuery.ready!=="undefined"?rootjQuery.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break}matched.push(elem)}}return matched},sibling:function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n)}}return matched}});jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0])}return indexOf.call(this,elem.jquery?elem[0]:elem)},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched)}if(this.length>1){if(!guaranteedUnique[name]){jQuery.unique(matched)}if(rparentsprev.test(name)){matched.reverse()}}return this.pushStack(matched)}});var rnotwhite=/\S+/g;var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready")}}});function completed(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(obj)};jQuery.ready.promise();var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet};jQuery.acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!+owner.nodeType};function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Data.uid++}Data.uid=1;Data.accepts=jQuery.acceptData;Data.prototype={key:function(owner){if(!Data.accepts(owner)){return 0}var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock};Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock;jQuery.extend(owner,descriptor)}}if(!this.cache[unlock]){this.cache[unlock]={}}return unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if(typeof data==="string"){cache[data]=value}else{if(jQuery.isEmptyObject(cache)){jQuery.extend(this.cache[unlock],data)}else{for(prop in data){cache[prop]=data[prop]}}}return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;if(key===undefined||key&&typeof key==="string"&&value===undefined){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))}this.set(owner,key,value);return value!==undefined?value:key},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined){this.cache[unlock]={}}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase))}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel]}else{name=camel;name=name in cache?[name]:name.match(rnotwhite)||[]}}i=name.length;while(i--){delete cache[name[i]]}}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){if(owner[this.expando]){delete this.cache[owner[this.expando]]}}};var data_priv=new Data;var data_user=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}data_user.set(elem,key,data)}else{data=undefined}}return data}jQuery.extend({hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=data_user.get(elem);if(elem.nodeType===1&&!data_priv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}}data_priv.set(elem,"hasDataAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){data_user.set(this,key)})}return access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){data=data_user.get(elem,key);if(data!==undefined){return data}data=data_user.get(elem,camelKey);if(data!==undefined){return data}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data}return}this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value);if(key.indexOf("-")!==-1&&data!==undefined){data_user.set(this,key,value)}})},null,value,arguments.length>1,null,true)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=data_priv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=data_priv.access(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=data_priv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)};var rcheckableType=/^(?:checkbox|radio)$/i;(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;

var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined}}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;data_priv.remove(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&jQuery.acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!==this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=document}if(event.target.nodeType===3){event.target=event.target.parentNode}return fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&e.stopImmediatePropagation){e.stopImmediatePropagation()}this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}data_priv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=data_priv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);data_priv.remove(doc,fix)}else{data_priv.access(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return}if(data_priv.hasData(src)){pdataOld=data_priv.access(src);pdataCur=data_priv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}}if(data_user.hasData(src)){udataOld=data_user.access(src);udataCur=jQuery.extend({},udataOld);data_user.set(dest,udataCur)}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i])}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}return clone},buildFragment:function(elems,context,scripts,selection){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent=""}}}fragment.textContent="";i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}return fragment},cleanData:function(elems){var data,elem,type,key,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(jQuery.acceptData(elem)){key=elem[data_priv.expando];if(key&&(data=data_priv.cache[key])){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(data_priv.cache[key]){delete data_priv.cache[key]}}}delete data_user.cache[elem[data_user.expando]]}}});jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value}})},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent=""}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];this.domManip(arguments,function(elem){arg=this.parentNode;jQuery.cleanData(getAll(this));if(arg){arg.replaceChild(elem,this)}});return arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value)){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=iframe[0].contentDocument;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){if(elem.ownerDocument.defaultView.opener){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)}return window.getComputedStyle(elem,null)};function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);if(computed){ret=computed.getPropertyValue(name)||computed[name]}if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret!==undefined?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}(function(){var pixelPositionVal,boxSizingReliableVal,docElem=document.documentElement,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;"+"position:absolute";container.appendChild(div);function computePixelPositionAndBoxSizingReliable(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;display:block;margin-top:1%;top:1%;"+"border:1px;padding:1px;width:4px;position:absolute";div.innerHTML="";docElem.appendChild(container);var divStyle=window.getComputedStyle(div,null);pixelPositionVal=divStyle.top!=="1%";boxSizingReliableVal=divStyle.width==="4px";docElem.removeChild(container)}if(window.getComputedStyle){jQuery.extend(support,{pixelPosition:function(){computePixelPositionAndBoxSizingReliable();return pixelPositionVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computePixelPositionAndBoxSizingReliable()}return boxSizingReliableVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;"+"box-sizing:content-box;display:block;margin:0;border:0;padding:0";marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";docElem.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv,null).marginRight);docElem.removeChild(container);div.removeChild(marginDiv);return ret}})}})();jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name[0].toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=data_priv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=data_priv.access(elem,"olddisplay",defaultDisplay(elem.nodeName))}}else{hidden=isHidden(elem);if(display!=="none"||!hidden){data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||value!==value){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide();

}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?data_priv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block"}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else{display=undefined}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=data_priv.access(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||data_priv.get(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t"})();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false}elem.removeAttribute(name)}}},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else{elem.setAttribute(name,name)}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}});jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}finalValue=jQuery.trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,proceed=arguments.length===0||typeof value==="string"&&value,i=0,len=this.length;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}finalValue=value?jQuery.trim(cur):"";if(elem.className!==finalValue){elem.className=finalValue}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===strundefined||type==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||value===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(option.value,values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now();var rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*"),ajaxLocation=window.location.href,ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})};jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild}return elem;

}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();if(window.attachEvent){window.attachEvent("onunload",function(){for(var key in xhrCallbacks){xhrCallbacks[key]()}})}support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(i in headers){xhr.setRequestHeader(i,headers[i])}callback=function(type){return function(){if(callback){delete xhrCallbacks[id];callback=xhr.onload=xhr.onerror=null;if(type==="abort"){xhr.abort()}else if(type==="error"){complete(xhr.status,xhr.statusText)}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,typeof xhr.responseText==="string"?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders())}}}};xhr.onload=callback();xhr.onerror=callback("error");callback=xhrCallbacks[id]=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback){throw e}}},abort:function(){if(callback){callback()}}}}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET"}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:true,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type)}});document.head.appendChild(script[0])},abort:function(){if(callback){callback()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=jQuery.trim(url.slice(off));url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}},position:function(){if(!this[0]){return}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method]}if(win){win.scrollTo(!top?val:window.pageXOffset,top?val:window.pageYOffset)}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}})});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(typeof noGlobal===strundefined){window.jQuery=window.$=jQuery}return jQuery})},{}],35:[function(require,module,exports){(function(factory){if(typeof define==="function"&&define.amd){define(factory)}else if(typeof exports==="object"){module.exports=factory()}else{var _OldCookies=window.Cookies;var api=window.Cookies=factory(window.jQuery);api.noConflict=function(){window.Cookies=_OldCookies;return api}}})(function(){function extend(){var i=0;var result={};for(;i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes){result[key]=attributes[key]}}return result}function init(converter){function api(key,value,attributes){var result;if(arguments.length>1){attributes=extend({path:"/"},api.defaults,attributes);if(typeof attributes.expires==="number"){var expires=new Date;expires.setMilliseconds(expires.getMilliseconds()+attributes.expires*864e5);attributes.expires=expires}try{result=JSON.stringify(value);if(/^[\{\[]/.test(result)){value=result}}catch(e){}value=encodeURIComponent(String(value));value=value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);key=encodeURIComponent(String(key));key=key.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);key=key.replace(/[\(\)]/g,escape);return document.cookie=[key,"=",value,attributes.expires&&"; expires="+attributes.expires.toUTCString(),attributes.path&&"; path="+attributes.path,attributes.domain&&"; domain="+attributes.domain,attributes.secure&&"; secure"].join("")}if(!key){result={}}var cookies=document.cookie?document.cookie.split("; "):[];var rdecode=/(%[0-9A-Z]{2})+/g;var i=0;for(;i<cookies.length;i++){var parts=cookies[i].split("=");var name=parts[0].replace(rdecode,decodeURIComponent);var cookie=parts.slice(1).join("=");if(cookie.charAt(0)==='"'){cookie=cookie.slice(1,-1)}cookie=converter&&converter(cookie,name)||cookie.replace(rdecode,decodeURIComponent);if(this.json){try{cookie=JSON.parse(cookie)}catch(e){}}if(key===name){result=cookie;break}if(!key){result[name]=cookie}}return result}api.get=api.set=api;api.getJSON=function(){return api.apply({json:true},[].slice.call(arguments))};api.defaults={};api.remove=function(key,attributes){api(key,"",extend(attributes,{expires:-1}))};api.withConverter=init;return api}return init()})},{}],36:[function(require,module,exports){"use strict";module.exports=INTERNAL;function INTERNAL(){}},{}],37:[function(require,module,exports){"use strict";var Promise=require("./promise");var reject=require("./reject");var resolve=require("./resolve");var INTERNAL=require("./INTERNAL");var handlers=require("./handlers");module.exports=all;function all(iterable){if(Object.prototype.toString.call(iterable)!=="[object Array]"){return reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return resolve([])}var values=new Array(len);var resolved=0;var i=-1;var promise=new Promise(INTERNAL);while(++i<len){allResolver(iterable[i],i)}return promise;function allResolver(value,i){resolve(value).then(resolveFromAll,function(error){if(!called){called=true;handlers.reject(promise,error)}});function resolveFromAll(outValue){values[i]=outValue;if(++resolved===len&!called){called=true;handlers.resolve(promise,values)}}}}},{"./INTERNAL":36,"./handlers":38,"./promise":40,"./reject":43,"./resolve":44}],38:[function(require,module,exports){"use strict";var tryCatch=require("./tryCatch");var resolveThenable=require("./resolveThenable");var states=require("./states");exports.resolve=function(self,value){var result=tryCatch(getThen,value);if(result.status==="error"){return exports.reject(self,result.value)}var thenable=result.value;if(thenable){resolveThenable.safely(self,thenable)}else{self.state=states.FULFILLED;self.outcome=value;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callFulfilled(value)}}return self};exports.reject=function(self,error){self.state=states.REJECTED;self.outcome=error;var i=-1;var len=self.queue.length;while(++i<len){self.queue[i].callRejected(error)}return self};function getThen(obj){var then=obj&&obj.then;if(obj&&typeof obj==="object"&&typeof then==="function"){return function appyThen(){then.apply(obj,arguments)}}}},{"./resolveThenable":45,"./states":46,"./tryCatch":47}],39:[function(require,module,exports){module.exports=exports=require("./promise");exports.resolve=require("./resolve");exports.reject=require("./reject");exports.all=require("./all");exports.race=require("./race")},{"./all":37,"./promise":40,"./race":42,"./reject":43,"./resolve":44}],40:[function(require,module,exports){"use strict";var unwrap=require("./unwrap");var INTERNAL=require("./INTERNAL");var resolveThenable=require("./resolveThenable");var states=require("./states");var QueueItem=require("./queueItem");module.exports=Promise;function Promise(resolver){if(!(this instanceof Promise)){return new Promise(resolver)}if(typeof resolver!=="function"){throw new TypeError("resolver must be a function")}this.state=states.PENDING;this.queue=[];this.outcome=void 0;if(resolver!==INTERNAL){resolveThenable.safely(this,resolver)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!=="function"&&this.state===states.FULFILLED||typeof onRejected!=="function"&&this.state===states.REJECTED){return this}var promise=new Promise(INTERNAL);if(this.state!==states.PENDING){var resolver=this.state===states.FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome)}else{this.queue.push(new QueueItem(promise,onFulfilled,onRejected))}return promise}},{"./INTERNAL":36,"./queueItem":41,"./resolveThenable":45,"./states":46,"./unwrap":48}],41:[function(require,module,exports){"use strict";var handlers=require("./handlers");var unwrap=require("./unwrap");module.exports=QueueItem;function QueueItem(promise,onFulfilled,onRejected){this.promise=promise;if(typeof onFulfilled==="function"){this.onFulfilled=onFulfilled;this.callFulfilled=this.otherCallFulfilled}if(typeof onRejected==="function"){this.onRejected=onRejected;this.callRejected=this.otherCallRejected}}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)};QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)};QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)};QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)}},{"./handlers":38,"./unwrap":48}],42:[function(require,module,exports){"use strict";var Promise=require("./promise");var reject=require("./reject");var resolve=require("./resolve");var INTERNAL=require("./INTERNAL");var handlers=require("./handlers");module.exports=race;function race(iterable){if(Object.prototype.toString.call(iterable)!=="[object Array]"){return reject(new TypeError("must be an array"))}var len=iterable.length;var called=false;if(!len){return resolve([])}var i=-1;var promise=new Promise(INTERNAL);while(++i<len){resolver(iterable[i])}return promise;function resolver(value){resolve(value).then(function(response){if(!called){called=true;handlers.resolve(promise,response)}},function(error){if(!called){called=true;handlers.reject(promise,error)}})}}},{"./INTERNAL":36,"./handlers":38,"./promise":40,"./reject":43,"./resolve":44}],43:[function(require,module,exports){"use strict";var Promise=require("./promise");var INTERNAL=require("./INTERNAL");var handlers=require("./handlers");module.exports=reject;function reject(reason){var promise=new Promise(INTERNAL);return handlers.reject(promise,reason)}},{"./INTERNAL":36,"./handlers":38,"./promise":40}],44:[function(require,module,exports){"use strict";var Promise=require("./promise");var INTERNAL=require("./INTERNAL");var handlers=require("./handlers");module.exports=resolve;var FALSE=handlers.resolve(new Promise(INTERNAL),false);var NULL=handlers.resolve(new Promise(INTERNAL),null);var UNDEFINED=handlers.resolve(new Promise(INTERNAL),void 0);var ZERO=handlers.resolve(new Promise(INTERNAL),0);var EMPTYSTRING=handlers.resolve(new Promise(INTERNAL),"");function resolve(value){if(value){if(value instanceof Promise){return value}return handlers.resolve(new Promise(INTERNAL),value)}var valueType=typeof value;switch(valueType){case"boolean":return FALSE;case"undefined":return UNDEFINED;case"object":return NULL;case"number":return ZERO;case"string":return EMPTYSTRING}}},{"./INTERNAL":36,"./handlers":38,"./promise":40}],45:[function(require,module,exports){"use strict";var handlers=require("./handlers");var tryCatch=require("./tryCatch");function safelyResolveThenable(self,thenable){var called=false;function onError(value){if(called){return}called=true;handlers.reject(self,value)}function onSuccess(value){if(called){return}called=true;handlers.resolve(self,value)}function tryToUnwrap(){thenable(onSuccess,onError)}var result=tryCatch(tryToUnwrap);if(result.status==="error"){onError(result.value)}}exports.safely=safelyResolveThenable},{"./handlers":38,"./tryCatch":47}],46:[function(require,module,exports){exports.REJECTED=["REJECTED"];exports.FULFILLED=["FULFILLED"];exports.PENDING=["PENDING"]},{}],47:[function(require,module,exports){"use strict";module.exports=tryCatch;function tryCatch(func,value){var out={};try{out.value=func(value);out.status="success"}catch(e){out.status="error";out.value=e}return out}},{}],48:[function(require,module,exports){"use strict";var immediate=require("immediate");var handlers=require("./handlers");module.exports=unwrap;function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}if(returnValue===promise){handlers.reject(promise,new TypeError("Cannot resolve promise with itself"))}else{handlers.resolve(promise,returnValue)}})}},{"./handlers":38,immediate:49}],49:[function(require,module,exports){"use strict";var types=[require("./nextTick"),require("./mutation.js"),require("./messageChannel"),require("./stateChange"),require("./timeout")];var draining;var queue=[];function nextTick(){draining=true;var i,oldQueue;var len=queue.length;while(len){oldQueue=queue;queue=[];i=-1;while(++i<len){oldQueue[i]()}len=queue.length}draining=false}var scheduleDrain;var i=-1;var len=types.length;while(++i<len){if(types[i]&&types[i].test&&types[i].test()){scheduleDrain=types[i].install(nextTick);break}}module.exports=immediate;function immediate(task){if(queue.push(task)===1&&!draining){scheduleDrain()}}},{"./messageChannel":50,"./mutation.js":51,"./nextTick":1,"./stateChange":52,"./timeout":53}],50:[function(require,module,exports){(function(global){"use strict";exports.test=function(){if(global.setImmediate){return false}return typeof global.MessageChannel!=="undefined"};exports.install=function(func){var channel=new global.MessageChannel;channel.port1.onmessage=func;return function(){channel.port2.postMessage(0)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],51:[function(require,module,exports){(function(global){"use strict";var Mutation=global.MutationObserver||global.WebKitMutationObserver;exports.test=function(){return Mutation};exports.install=function(handle){var called=0;var observer=new Mutation(handle);var element=global.document.createTextNode("");observer.observe(element,{characterData:true});return function(){element.data=called=++called%2}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],52:[function(require,module,exports){(function(global){"use strict";exports.test=function(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")};exports.install=function(handle){return function(){var scriptEl=global.document.createElement("script");scriptEl.onreadystatechange=function(){handle();scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null};global.document.documentElement.appendChild(scriptEl);return handle}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],53:[function(require,module,exports){"use strict";exports.test=function(){return true};exports.install=function(t){return function(){setTimeout(t,0)}}},{}],54:[function(require,module,exports){(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.moment=factory()})(this,function(){"use strict";var hookCallback;function utils_hooks__hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return Object.prototype.toString.call(input)==="[object Array]"}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==="[object Date]"}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,"toString")){a.toString=b.toString}if(hasOwnProp(b,"valueOf")){a.valueOf=b.valueOf}return a}function create_utc__createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}function valid__isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);m._isValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated;if(m._strict){m._isValid=m._isValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}}return m._isValid}function valid__createInvalid(flags){var m=create_utc__createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}var momentProperties=utils_hooks__hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(typeof from._isAMomentObject!=="undefined"){to._isAMomentObject=from._isAMomentObject}if(typeof from._i!=="undefined"){to._i=from._i}if(typeof from._f!=="undefined"){to._f=from._f}if(typeof from._l!=="undefined"){to._l=from._l}if(typeof from._strict!=="undefined"){to._strict=from._strict}if(typeof from._tzm!=="undefined"){to._tzm=from._tzm}if(typeof from._isUTC!=="undefined"){to._isUTC=from._isUTC}if(typeof from._offset!=="undefined"){to._offset=from._offset}if(typeof from._pf!=="undefined"){to._pf=getParsingFlags(from)}if(typeof from._locale!=="undefined"){to._locale=from._locale}if(momentProperties.length>0){for(i in momentProperties){prop=momentProperties[i];val=from[prop];if(typeof val!=="undefined"){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(+config._d);if(updateInProgress===false){updateInProgress=true;utils_hooks__hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){if(coercedNumber>=0){value=Math.floor(coercedNumber)}else{value=Math.ceil(coercedNumber)}}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function Locale(){}var locales={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace("_","-"):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split("-");j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split("-"):null;while(j>0){locale=loadLocale(split.slice(0,j).join("-"));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=="undefined"&&module&&module.exports){try{oldLocale=globalLocale._abbr;require("./locale/"+name);locale_locales__getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function locale_locales__getSetGlobalLocale(key,values){var data;if(key){if(typeof values==="undefined"){data=locale_locales__getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}}return globalLocale._abbr}function defineLocale(name,values){if(values!==null){values.abbr=name;if(!locales[name]){locales[name]=new Locale}locales[name].set(values);locale_locales__getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function locale_locales__getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+"s"]=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==="string"?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}function makeGetSet(unit,keepTime){return function(value){if(value!=null){get_set__set(this,unit,value);utils_hooks__hooks.updateOffset(this,keepTime);return this}else{return get_set__get(this,unit)}}}function get_set__get(mom,unit){return mom._d["get"+(mom._isUTC?"UTC":"")+unit]()}function get_set__set(mom,unit,value){return mom._d["set"+(mom._isUTC?"UTC":"")+unit](value)}function getSet(units,value){var unit;if(typeof units==="object"){for(unit in units){this.set(unit,units[unit])}}else{units=normalizeUnits(units);if(typeof this[units]==="function"){return this[units](value)}}return this}function zeroFill(number,targetLength,forceSign){var output=""+Math.abs(number),sign=number>=0;while(output.length<targetLength){output="0"+output}return(sign?forceSign?"+":"":"-")+output}var formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==="string"){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="";for(i=0;i<length;i++){output+=array[i]instanceof Function?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());

if(!formatFunctions[format]){formatFunctions[format]=makeFormatFunction(format)}return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=typeof regex==="function"?regex:function(isStrict){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return s.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==="string"){token=[token]}if(typeof callback==="number"){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken("MMMM",0,0,function(format){return this.localeData().months(this,format)});addUnitAlias("month","M");addRegexToken("M",match1to2);addRegexToken("MM",match1to2,match2);addRegexToken("MMM",matchWord);addRegexToken("MMMM",matchWord);addParseToken(["M","MM"],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(["MMM","MMMM"],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var defaultLocaleMonths="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(m){return this._months[m.month()]}var defaultLocaleMonthsShort="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(m){return this._monthsShort[m.month()]}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=create_utc__createUTC([2e3,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(mom,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(mom,"").replace(".","")+"$","i")}if(!strict&&!this._monthsParse[i]){regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(strict&&format==="MMMM"&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==="MMM"&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(typeof value==="string"){value=mom.localeData().monthsParse(value);if(typeof value!=="number"){return mom}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d["set"+(mom._isUTC?"UTC":"")+"Month"](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);utils_hooks__hooks.updateOffset(this,true);return this}else{return get_set__get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}getParsingFlags(m).overflow=overflow}return m}function warn(msg){if(utils_hooks__hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+msg)}}function deprecate(msg,fn){var firstTime=true,msgWithStack=msg+"\n"+(new Error).stack;return extend(function(){if(firstTime){warn(msgWithStack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(!deprecations[name]){warn(msg);deprecations[name]=true}}utils_hooks__hooks.suppressDeprecationWarnings=false;var from_string__isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]];var isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=from_string__isoRegex.exec(string);if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(string)){config._f=isoDates[i][0]+(match[6]||" ");break}}for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}}if(string.match(matchOffset)){config._f+="Z"}configFromStringAndFormat(config)}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return}configFromISO(config);if(config._isValid===false){delete config._isValid;utils_hooks__hooks.createFromInputFallback(config)}}utils_hooks__hooks.createFromInputFallback=deprecate("moment construction falls back to js Date. This is "+"discouraged and will be removed in upcoming major "+"release. Please refer to "+"https://github.com/moment/moment/issues/1407 for more info.",function(config){config._d=new Date(config._i+(config._useUTC?" UTC":""))});function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<1970){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<1970){date.setUTCFullYear(y)}return date}addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addRegexToken("Y",matchSigned);addRegexToken("YY",match1to2,match2);addRegexToken("YYYY",match1to4,match4);addRegexToken("YYYYY",match1to6,match6);addRegexToken("YYYYYY",match1to6,match6);addParseToken(["YYYY","YYYYY","YYYYYY"],YEAR);addParseToken("YY",function(input,array){array[YEAR]=utils_hooks__hooks.parseTwoDigitYear(input)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}utils_hooks__hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2e3)};var getSetYear=makeGetSet("FullYear",false);function getIsLeapYear(){return isLeapYear(this.year())}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addRegexToken("w",match1to2);addRegexToken("ww",match1to2,match2);addRegexToken("W",match1to2);addRegexToken("WW",match1to2,match2);addWeekParseToken(["w","ww","W","WW"],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day(),adjustedMoment;if(daysToDayOfWeek>end){daysToDayOfWeek-=7}if(daysToDayOfWeek<end-7){daysToDayOfWeek+=7}adjustedMoment=local__createLocal(mom).add(daysToDayOfWeek,"d");return{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,"d")}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,"d")}addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addRegexToken("DDD",match1to3);addRegexToken("DDDD",match3);addParseToken(["DDD","DDDD"],function(input,array,config){config._dayOfYear=toInt(input)});function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var d=createUTCDate(year,0,1).getUTCDay();var daysToAdd;var dayOfYear;d=d===0?7:d;weekday=weekday!=null?weekday:firstDayOfWeek;daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0)-(d<firstDayOfWeek?7:0);dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1;return{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return input==null?dayOfYear:this.add(input-dayOfYear,"d")}function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var now=new Date;if(config._useUTC){return[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]}return[now.getFullYear(),now.getMonth(),now.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(local__createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1)}else{dow=config._locale._week.dow;doy=config._locale._week.doy;weekYear=defaults(w.gg,config._a[YEAR],weekOfYear(local__createLocal(),dow,doy).year);week=defaults(w.w,1);if(w.d!=null){weekday=w.d;if(weekday<dow){++week}}else if(w.e!=null){weekday=w.e+dow}else{weekday=dow}}temp=dayOfYearFromWeeks(weekYear,week,weekday,doy,dow);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}utils_hooks__hooks.ISO_8601=function(){};function configFromStringAndFormat(config){if(config._f===utils_hooks__hooks.ISO_8601){configFromISO(config);return}config._a=[];getParsingFlags(config).empty=true;var string=""+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(getParsingFlags(config).bigHour===true&&config._a[HOUR]<=12&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!valid__isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=[i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond];configFromArray(config)}function createFromConfig(config){var input=config._i,format=config._f,res;config._locale=config._locale||locale_locales__getLocale(config._l);if(input===null||format===undefined&&input===""){return valid__createInvalid({nullInput:true})}if(typeof input==="string"){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else if(isDate(input)){config._d=input}else{configFromInput(config)}res=new Moment(checkOverflow(config));if(res._nextDay){res.add(1,"d");res._nextDay=undefined}return res}function configFromInput(config){var input=config._i;if(input===undefined){config._d=new Date}else if(isDate(input)){config._d=new Date(+input)}else if(typeof input==="string"){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(typeof input==="object"){configFromObject(config)}else if(typeof input==="number"){config._d=new Date(input)}else{utils_hooks__hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(typeof locale==="boolean"){strict=locale;locale=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function local__createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return other<this?this:other});var prototypeMax=deprecate("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var other=local__createLocal.apply(null,arguments);return other>this?this:other});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return local__createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy("isBefore",args)}function max(){var args=[].slice.call(arguments,0);return pickBy("isAfter",args)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+seconds*1e3+minutes*6e4+hours*36e5;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=locale_locales__getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign="+";if(offset<0){offset=-offset;sign="-"}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",matchOffset);addRegexToken("ZZ",matchOffset);addParseToken(["Z","ZZ"],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(string){var matches=(string||"").match(matchOffset)||[];var chunk=matches[matches.length-1]||[];var parts=(chunk+"").match(chunkOffset)||["-",0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return parts[0]==="+"?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?+input:+local__createLocal(input))-+res;res._d.setTime(+res._d+diff);utils_hooks__hooks.updateOffset(res,false);return res}else{return local__createLocal(input).local()}return model._isUTC?local__createLocal(input).zone(model._offset||0):local__createLocal(input).local()}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15}utils_hooks__hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime){var offset=this._offset||0,localAdjust;if(input!=null){if(typeof input==="string"){input=offsetFromString(input)}if(Math.abs(input)<16){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,"m")}if(offset!==input){if(!keepLocalTime||this._changeInProgress){add_subtract__addSubtract(this,create__createDuration(input-offset,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;utils_hooks__hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=="string"){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm){this.utcOffset(this._tzm)}else if(typeof this._i==="string"){this.utcOffset(offsetFromString(this._i))}return this}function hasAlignedHourOffset(input){if(!input){input=0}else{input=local__createLocal(input).utcOffset()}return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(this._a){var other=this._isUTC?create_utc__createUTC(this._a):local__createLocal(this._a);return this.isValid()&&compareArrays(this._a,other.toArray())>0}return false}function isLocal(){return!this._isUTC}function isUtcOffset(){return this._isUTC}function isUtc(){return this._isUTC&&this._offset===0}var aspNetRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/;var create__isoRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;function create__createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(typeof input==="number"){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}}else if(!!(match=create__isoRegex.exec(input))){sign=match[1]==="-"?-1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),d:parseIso(match[4],sign),h:parseIso(match[5],sign),m:parseIso(match[6],sign),s:parseIso(match[7],sign),w:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==="object"&&("from"in duration||"to"in duration)){diffRes=momentsDifference(local__createLocal(duration.from),local__createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,"_locale")){ret._locale=input._locale}return ret}create__createDuration.fn=Duration.prototype;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,"M").isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,"M");return res}function momentsDifference(base,other){var res;other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,"moment()."+name+"(period, number) is deprecated. Please use moment()."+name+"(number, period).");tmp=val;val=period;period=tmp}val=typeof val==="string"?+val:val;dur=create__createDuration(val,period);add_subtract__addSubtract(this,dur,direction);return this}}function add_subtract__addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=duration._days,months=duration._months;updateOffset=updateOffset==null?true:updateOffset;if(milliseconds){mom._d.setTime(+mom._d+milliseconds*isAdding)}if(days){get_set__set(mom,"Date",get_set__get(mom,"Date")+days*isAdding)}if(months){setMonth(mom,get_set__get(mom,"Month")+months*isAdding)}if(updateOffset){utils_hooks__hooks.updateOffset(mom,days||months)}}var add_subtract__add=createAdder(1,"add");var add_subtract__subtract=createAdder(-1,"subtract");function moment_calendar__calendar(time){var now=time||local__createLocal(),sod=cloneWithOffset(now,this).startOf("day"),diff=this.diff(sod,"days",true),format=diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse";return this.format(this.localeData().calendar(format,this,local__createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var inputMs;units=normalizeUnits(typeof units!=="undefined"?units:"millisecond");if(units==="millisecond"){input=isMoment(input)?input:local__createLocal(input);return+this>+input}else{inputMs=isMoment(input)?+input:+local__createLocal(input);return inputMs<+this.clone().startOf(units)}}function isBefore(input,units){var inputMs;units=normalizeUnits(typeof units!=="undefined"?units:"millisecond");if(units==="millisecond"){input=isMoment(input)?input:local__createLocal(input);return+this<+input}else{inputMs=isMoment(input)?+input:+local__createLocal(input);return+this.clone().endOf(units)<inputMs}}function isBetween(from,to,units){return this.isAfter(from,units)&&this.isBefore(to,units)}function isSame(input,units){var inputMs;units=normalizeUnits(units||"millisecond");if(units==="millisecond"){input=isMoment(input)?input:local__createLocal(input);return+this===+input}else{inputMs=+local__createLocal(input);return+this.clone().startOf(units)<=inputMs&&inputMs<=+this.clone().endOf(units)}}function absFloor(number){if(number<0){return Math.ceil(number)}else{return Math.floor(number)}}function diff(input,units,asFloat){var that=cloneWithOffset(input,this),zoneDelta=(that.utcOffset()-this.utcOffset())*6e4,delta,output;units=normalizeUnits(units);if(units==="year"||units==="month"||units==="quarter"){output=monthDiff(this,that);if(units==="quarter"){output=output/3}else if(units==="year"){output=output/12}}else{delta=this-that;output=units==="second"?delta/1e3:units==="minute"?delta/6e4:units==="hour"?delta/36e5:units==="day"?(delta-zoneDelta)/864e5:units==="week"?(delta-zoneDelta)/6048e5:delta}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,"months"),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,"months");adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,"months");adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)}utils_hooks__hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function moment_format__toISOString(){var m=this.clone().utc();if(0<m.year()&&m.year()<=9999){if("function"===typeof Date.prototype.toISOString){return this.toDate().toISOString()}else{return formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}else{return formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}}function format(inputString){var output=formatMoment(this,inputString||utils_hooks__hooks.defaultFormat);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(!this.isValid()){return this.localeData().invalidDate()}return create__createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}function fromNow(withoutSuffix){return this.from(local__createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(!this.isValid()){return this.localeData().invalidDate()}return create__createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}function toNow(withoutSuffix){return this.to(local__createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=locale_locales__getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.weekday(0)}if(units==="isoWeek"){this.isoWeekday(1)}if(units==="quarter"){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==="millisecond"){return this}return this.startOf(units).add(1,units==="isoWeek"?"week":units).subtract(1,"ms")}function to_type__valueOf(){return+this._d-(this._offset||0)*6e4}function unix(){return Math.floor(+this/1e3)}function toDate(){return this._offset?new Date(+this):this._d}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function moment_valid__isValid(){return valid__isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addRegexToken("G",matchSigned);addRegexToken("g",matchSigned);addRegexToken("GG",match1to2,match2);addRegexToken("gg",match1to2,match2);addRegexToken("GGGG",match1to4,match4);addRegexToken("gggg",match1to4,match4);addRegexToken("GGGGG",match1to6,match6);addRegexToken("ggggg",match1to6,match6);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(["gg","GG"],function(input,week,config,token){week[token]=utils_hooks__hooks.parseTwoDigitYear(input)});function weeksInYear(year,dow,doy){return weekOfYear(local__createLocal([year,11,31+dow-doy]),dow,doy).week}function getSetWeekYear(input){var year=weekOfYear(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return input==null?year:this.add(input-year,"y")}function getSetISOWeekYear(input){var year=weekOfYear(this,1,4).year;return input==null?year:this.add(input-year,"y")}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}addFormatToken("Q",0,0,"quarter");addUnitAlias("quarter","Q");addRegexToken("Q",match1);addParseToken("Q",function(input,array){array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addRegexToken("D",match1to2);addRegexToken("DD",match1to2,match2);addRegexToken("Do",function(isStrict,locale){return isStrict?locale._ordinalParse:locale._ordinalParseLenient});addParseToken(["D","DD"],DATE);addParseToken("Do",function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet("Date",true);addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken("ddd",0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken("dddd",0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");

addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addRegexToken("d",match1to2);addRegexToken("e",match1to2);addRegexToken("E",match1to2);addRegexToken("dd",matchWord);addRegexToken("ddd",matchWord);addRegexToken("dddd",matchWord);addWeekParseToken(["dd","ddd","dddd"],function(input,week,config){var weekday=config._locale.weekdaysParse(input);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(["d","e","E"],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input==="string"){if(!isNaN(input)){input=parseInt(input,10)}else{input=locale.weekdaysParse(input);if(typeof input!=="number"){return null}}}return input}var defaultLocaleWeekdays="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(m){return this._weekdays[m.day()]}var defaultLocaleWeekdaysShort="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(m){return this._weekdaysShort[m.day()]}var defaultLocaleWeekdaysMin="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(m){return this._weekdaysMin[m.day()]}function localeWeekdaysParse(weekdayName){var i,mom,regex;if(!this._weekdaysParse){this._weekdaysParse=[]}for(i=0;i<7;i++){if(!this._weekdaysParse[i]){mom=local__createLocal([2e3,1]).day(i);regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,"");this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")}if(this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,"d")}else{return day}}function getSetLocaleDayOfWeek(input){var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,"d")}function getSetISODayOfWeek(input){return input==null?this.day()||7:this.day(this.day()%7?input:input-7)}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,function(){return this.hours()%12||12});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",match1to2);addRegexToken("h",match1to2);addRegexToken("HH",match1to2,match2);addRegexToken("hh",match1to2,match2);addParseToken(["H","HH"],HOUR);addParseToken(["a","A"],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(["h","hh"],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});function localeIsPM(input){return(input+"").toLowerCase().charAt(0)==="p"}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}}var getSetHour=makeGetSet("Hours",true);addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addRegexToken("m",match1to2);addRegexToken("mm",match1to2,match2);addParseToken(["m","mm"],MINUTE);var getSetMinute=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addRegexToken("s",match1to2);addRegexToken("ss",match1to2,match2);addParseToken(["s","ss"],SECOND);var getSetSecond=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});function millisecond__milliseconds(token){addFormatToken(0,[token,3],0,"millisecond")}millisecond__milliseconds("SSS");millisecond__milliseconds("SSSS");addUnitAlias("millisecond","ms");addRegexToken("S",match1to3,match1);addRegexToken("SS",match1to3,match2);addRegexToken("SSS",match1to3,match3);addRegexToken("SSSS",matchUnsigned);addParseToken(["S","SS","SSS","SSSS"],function(input,array){array[MILLISECOND]=toInt(("0."+input)*1e3)});var getSetMillisecond=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var momentPrototype__proto=Moment.prototype;momentPrototype__proto.add=add_subtract__add;momentPrototype__proto.calendar=moment_calendar__calendar;momentPrototype__proto.clone=clone;momentPrototype__proto.diff=diff;momentPrototype__proto.endOf=endOf;momentPrototype__proto.format=format;momentPrototype__proto.from=from;momentPrototype__proto.fromNow=fromNow;momentPrototype__proto.to=to;momentPrototype__proto.toNow=toNow;momentPrototype__proto.get=getSet;momentPrototype__proto.invalidAt=invalidAt;momentPrototype__proto.isAfter=isAfter;momentPrototype__proto.isBefore=isBefore;momentPrototype__proto.isBetween=isBetween;momentPrototype__proto.isSame=isSame;momentPrototype__proto.isValid=moment_valid__isValid;momentPrototype__proto.lang=lang;momentPrototype__proto.locale=locale;momentPrototype__proto.localeData=localeData;momentPrototype__proto.max=prototypeMax;momentPrototype__proto.min=prototypeMin;momentPrototype__proto.parsingFlags=parsingFlags;momentPrototype__proto.set=getSet;momentPrototype__proto.startOf=startOf;momentPrototype__proto.subtract=add_subtract__subtract;momentPrototype__proto.toArray=toArray;momentPrototype__proto.toDate=toDate;momentPrototype__proto.toISOString=moment_format__toISOString;momentPrototype__proto.toJSON=moment_format__toISOString;momentPrototype__proto.toString=toString;momentPrototype__proto.unix=unix;momentPrototype__proto.valueOf=to_type__valueOf;momentPrototype__proto.year=getSetYear;momentPrototype__proto.isLeapYear=getIsLeapYear;momentPrototype__proto.weekYear=getSetWeekYear;momentPrototype__proto.isoWeekYear=getSetISOWeekYear;momentPrototype__proto.quarter=momentPrototype__proto.quarters=getSetQuarter;momentPrototype__proto.month=getSetMonth;momentPrototype__proto.daysInMonth=getDaysInMonth;momentPrototype__proto.week=momentPrototype__proto.weeks=getSetWeek;momentPrototype__proto.isoWeek=momentPrototype__proto.isoWeeks=getSetISOWeek;momentPrototype__proto.weeksInYear=getWeeksInYear;momentPrototype__proto.isoWeeksInYear=getISOWeeksInYear;momentPrototype__proto.date=getSetDayOfMonth;momentPrototype__proto.day=momentPrototype__proto.days=getSetDayOfWeek;momentPrototype__proto.weekday=getSetLocaleDayOfWeek;momentPrototype__proto.isoWeekday=getSetISODayOfWeek;momentPrototype__proto.dayOfYear=getSetDayOfYear;momentPrototype__proto.hour=momentPrototype__proto.hours=getSetHour;momentPrototype__proto.minute=momentPrototype__proto.minutes=getSetMinute;momentPrototype__proto.second=momentPrototype__proto.seconds=getSetSecond;momentPrototype__proto.millisecond=momentPrototype__proto.milliseconds=getSetMillisecond;momentPrototype__proto.utcOffset=getSetOffset;momentPrototype__proto.utc=setOffsetToUTC;momentPrototype__proto.local=setOffsetToLocal;momentPrototype__proto.parseZone=setOffsetToParsedOffset;momentPrototype__proto.hasAlignedHourOffset=hasAlignedHourOffset;momentPrototype__proto.isDST=isDaylightSavingTime;momentPrototype__proto.isDSTShifted=isDaylightSavingTimeShifted;momentPrototype__proto.isLocal=isLocal;momentPrototype__proto.isUtcOffset=isUtcOffset;momentPrototype__proto.isUtc=isUtc;momentPrototype__proto.isUTC=isUtc;momentPrototype__proto.zoneAbbr=getZoneAbbr;momentPrototype__proto.zoneName=getZoneName;momentPrototype__proto.dates=deprecate("dates accessor is deprecated. Use date instead.",getSetDayOfMonth);momentPrototype__proto.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);momentPrototype__proto.years=deprecate("years accessor is deprecated. Use year instead",getSetYear);momentPrototype__proto.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",getSetZone);var momentPrototype=momentPrototype__proto;function moment__createUnix(input){return local__createLocal(input*1e3)}function moment__createInZone(){return local__createLocal.apply(null,arguments).parseZone()}var defaultCalendar={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function locale_calendar__calendar(key,mom,now){var output=this._calendar[key];return typeof output==="function"?output.call(mom,now):output}var defaultLongDateFormat={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"};function longDateFormat(key){var output=this._longDateFormat[key];if(!output&&this._longDateFormat[key.toUpperCase()]){output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});this._longDateFormat[key]=output}return output}var defaultInvalidDate="Invalid date";function invalidDate(){return this._invalidDate}var defaultOrdinal="%d";var defaultOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace("%d",number)}function preParsePostFormat(string){return string}var defaultRelativeTime={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relative__relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return typeof output==="function"?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return typeof format==="function"?format(output):format.replace(/%s/i,output)}function locale_set__set(config){var prop,i;for(i in config){prop=config[i];if(typeof prop==="function"){this[i]=prop}else{this["_"+i]=prop}}this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}var prototype__proto=Locale.prototype;prototype__proto._calendar=defaultCalendar;prototype__proto.calendar=locale_calendar__calendar;prototype__proto._longDateFormat=defaultLongDateFormat;prototype__proto.longDateFormat=longDateFormat;prototype__proto._invalidDate=defaultInvalidDate;prototype__proto.invalidDate=invalidDate;prototype__proto._ordinal=defaultOrdinal;prototype__proto.ordinal=ordinal;prototype__proto._ordinalParse=defaultOrdinalParse;prototype__proto.preparse=preParsePostFormat;prototype__proto.postformat=preParsePostFormat;prototype__proto._relativeTime=defaultRelativeTime;prototype__proto.relativeTime=relative__relativeTime;prototype__proto.pastFuture=pastFuture;prototype__proto.set=locale_set__set;prototype__proto.months=localeMonths;prototype__proto._months=defaultLocaleMonths;prototype__proto.monthsShort=localeMonthsShort;prototype__proto._monthsShort=defaultLocaleMonthsShort;prototype__proto.monthsParse=localeMonthsParse;prototype__proto.week=localeWeek;prototype__proto._week=defaultLocaleWeek;prototype__proto.firstDayOfYear=localeFirstDayOfYear;prototype__proto.firstDayOfWeek=localeFirstDayOfWeek;prototype__proto.weekdays=localeWeekdays;prototype__proto._weekdays=defaultLocaleWeekdays;prototype__proto.weekdaysMin=localeWeekdaysMin;prototype__proto._weekdaysMin=defaultLocaleWeekdaysMin;prototype__proto.weekdaysShort=localeWeekdaysShort;prototype__proto._weekdaysShort=defaultLocaleWeekdaysShort;prototype__proto.weekdaysParse=localeWeekdaysParse;prototype__proto.isPM=localeIsPM;prototype__proto._meridiemParse=defaultLocaleMeridiemParse;prototype__proto.meridiem=localeMeridiem;function lists__get(format,index,field,setter){var locale=locale_locales__getLocale();var utc=create_utc__createUTC().set(setter,index);return locale[field](utc,format)}function list(format,index,field,count,setter){if(typeof format==="number"){index=format;format=undefined}format=format||"";if(index!=null){return lists__get(format,index,field,setter)}var i;var out=[];for(i=0;i<count;i++){out[i]=lists__get(format,i,field,setter)}return out}function lists__listMonths(format,index){return list(format,index,"months",12,"month")}function lists__listMonthsShort(format,index){return list(format,index,"monthsShort",12,"month")}function lists__listWeekdays(format,index){return list(format,index,"weekdays",7,"day")}function lists__listWeekdaysShort(format,index){return list(format,index,"weekdaysShort",7,"day")}function lists__listWeekdaysMin(format,index){return list(format,index,"weekdaysMin",7,"day")}locale_locales__getSetGlobalLocale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th";return number+output}});utils_hooks__hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",locale_locales__getSetGlobalLocale);utils_hooks__hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",locale_locales__getLocale);var mathAbs=Math.abs;function duration_abs__abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function duration_add_subtract__addSubtract(duration,input,value,direction){var other=create__createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function duration_add_subtract__add(input,value){return duration_add_subtract__addSubtract(this,input,value,1)}function duration_add_subtract__subtract(input,value){return duration_add_subtract__addSubtract(this,input,value,-1)}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years=0;data.milliseconds=milliseconds%1e3;seconds=absFloor(milliseconds/1e3);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);years=absFloor(daysToYears(days));days-=absFloor(yearsToDays(years));months+=absFloor(days/30);days%=30;years+=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToYears(days){return days*400/146097}function yearsToDays(years){return years*146097/400}function as(units){var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==="month"||units==="year"){days=this._days+milliseconds/864e5;months=this._months+daysToYears(days)*12;return units==="month"?months:months/12}else{days=this._days+Math.round(yearsToDays(this._months/12));switch(units){case"week":return days/7+milliseconds/6048e5;case"day":return days+milliseconds/864e5;case"hour":return days*24+milliseconds/36e5;case"minute":return days*1440+milliseconds/6e4;case"second":return days*86400+milliseconds/1e3;case"millisecond":return Math.floor(days*864e5)+milliseconds;default:throw new Error("Unknown unit "+units)}}}function duration_as__valueOf(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs("ms");var asSeconds=makeAs("s");var asMinutes=makeAs("m");var asHours=makeAs("h");var asDays=makeAs("d");var asWeeks=makeAs("w");var asMonths=makeAs("M");var asYears=makeAs("y");function duration_get__get(units){units=normalizeUnits(units);return this[units+"s"]()}function makeGetter(name){return function(){return this._data[name]}}var duration_get__milliseconds=makeGetter("milliseconds");var seconds=makeGetter("seconds");var minutes=makeGetter("minutes");var hours=makeGetter("hours");var days=makeGetter("days");var months=makeGetter("months");var years=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function duration_humanize__relativeTime(posNegDuration,withoutSuffix,locale){var duration=create__createDuration(posNegDuration).abs();var seconds=round(duration.as("s"));var minutes=round(duration.as("m"));var hours=round(duration.as("h"));var days=round(duration.as("d"));var months=round(duration.as("M"));var years=round(duration.as("y"));var a=seconds<thresholds.s&&["s",seconds]||minutes===1&&["m"]||minutes<thresholds.m&&["mm",minutes]||hours===1&&["h"]||hours<thresholds.h&&["hh",hours]||days===1&&["d"]||days<thresholds.d&&["dd",days]||months===1&&["M"]||months<thresholds.M&&["MM",months]||years===1&&["y"]||["yy",years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function duration_humanize__getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;return true}function humanize(withSuffix){var locale=this.localeData();var output=duration_humanize__relativeTime(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var iso_string__abs=Math.abs;function iso_string__toISOString(){var Y=iso_string__abs(this.years());var M=iso_string__abs(this.months());var D=iso_string__abs(this.days());var h=iso_string__abs(this.hours());var m=iso_string__abs(this.minutes());var s=iso_string__abs(this.seconds()+this.milliseconds()/1e3);var total=this.asSeconds();if(!total){return"P0D"}return(total<0?"-":"")+"P"+(Y?Y+"Y":"")+(M?M+"M":"")+(D?D+"D":"")+(h||m||s?"T":"")+(h?h+"H":"")+(m?m+"M":"")+(s?s+"S":"")}var duration_prototype__proto=Duration.prototype;duration_prototype__proto.abs=duration_abs__abs;duration_prototype__proto.add=duration_add_subtract__add;duration_prototype__proto.subtract=duration_add_subtract__subtract;duration_prototype__proto.as=as;duration_prototype__proto.asMilliseconds=asMilliseconds;duration_prototype__proto.asSeconds=asSeconds;duration_prototype__proto.asMinutes=asMinutes;duration_prototype__proto.asHours=asHours;duration_prototype__proto.asDays=asDays;duration_prototype__proto.asWeeks=asWeeks;duration_prototype__proto.asMonths=asMonths;duration_prototype__proto.asYears=asYears;duration_prototype__proto.valueOf=duration_as__valueOf;duration_prototype__proto._bubble=bubble;duration_prototype__proto.get=duration_get__get;duration_prototype__proto.milliseconds=duration_get__milliseconds;duration_prototype__proto.seconds=seconds;duration_prototype__proto.minutes=minutes;duration_prototype__proto.hours=hours;duration_prototype__proto.days=days;duration_prototype__proto.weeks=weeks;duration_prototype__proto.months=months;duration_prototype__proto.years=years;duration_prototype__proto.humanize=humanize;duration_prototype__proto.toISOString=iso_string__toISOString;duration_prototype__proto.toString=iso_string__toISOString;duration_prototype__proto.toJSON=iso_string__toISOString;duration_prototype__proto.locale=locale;duration_prototype__proto.localeData=localeData;duration_prototype__proto.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",iso_string__toISOString);duration_prototype__proto.lang=lang;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",matchSigned);addRegexToken("X",matchTimestamp);addParseToken("X",function(input,array,config){config._d=new Date(parseFloat(input,10)*1e3)});addParseToken("x",function(input,array,config){config._d=new Date(toInt(input))});utils_hooks__hooks.version="2.10.3";setHookCallback(local__createLocal);utils_hooks__hooks.fn=momentPrototype;utils_hooks__hooks.min=min;utils_hooks__hooks.max=max;utils_hooks__hooks.utc=create_utc__createUTC;utils_hooks__hooks.unix=moment__createUnix;utils_hooks__hooks.months=lists__listMonths;utils_hooks__hooks.isDate=isDate;utils_hooks__hooks.locale=locale_locales__getSetGlobalLocale;utils_hooks__hooks.invalid=valid__createInvalid;utils_hooks__hooks.duration=create__createDuration;utils_hooks__hooks.isMoment=isMoment;utils_hooks__hooks.weekdays=lists__listWeekdays;utils_hooks__hooks.parseZone=moment__createInZone;utils_hooks__hooks.localeData=locale_locales__getLocale;utils_hooks__hooks.isDuration=isDuration;utils_hooks__hooks.monthsShort=lists__listMonthsShort;utils_hooks__hooks.weekdaysMin=lists__listWeekdaysMin;utils_hooks__hooks.defineLocale=defineLocale;utils_hooks__hooks.weekdaysShort=lists__listWeekdaysShort;utils_hooks__hooks.normalizeUnits=normalizeUnits;utils_hooks__hooks.relativeTimeThreshold=duration_humanize__getSetRelativeTimeThreshold;var _moment=utils_hooks__hooks;return _moment})},{}],55:[function(require,module,exports){"use strict";var MIN_MAGNITUDE=-324;var MAGNITUDE_DIGITS=3;var SEP="";var utils=require("./utils");exports.collate=function(a,b){if(a===b){return 0}a=exports.normalizeKey(a);b=exports.normalizeKey(b);var ai=collationIndex(a);var bi=collationIndex(b);if(ai-bi!==0){return ai-bi}if(a===null){return 0}switch(typeof a){case"number":return a-b;case"boolean":return a===b?0:a<b?-1:1;case"string":return stringCollate(a,b)}return Array.isArray(a)?arrayCollate(a,b):objectCollate(a,b)};exports.normalizeKey=function(key){switch(typeof key){case"undefined":return null;case"number":if(key===Infinity||key===-Infinity||isNaN(key)){return null}return key;case"object":var origKey=key;if(Array.isArray(key)){var len=key.length;key=new Array(len);for(var i=0;i<len;i++){key[i]=exports.normalizeKey(origKey[i])}}else if(key instanceof Date){return key.toJSON()}else if(key!==null){key={};for(var k in origKey){if(origKey.hasOwnProperty(k)){var val=origKey[k];if(typeof val!=="undefined"){key[k]=exports.normalizeKey(val)}}}}}return key};function indexify(key){if(key!==null){switch(typeof key){case"boolean":return key?1:0;case"number":return numToIndexableString(key);case"string":return key.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var isArray=Array.isArray(key);var arr=isArray?key:Object.keys(key);var i=-1;var len=arr.length;var result="";if(isArray){while(++i<len){result+=exports.toIndexableString(arr[i])}}else{while(++i<len){var objKey=arr[i];result+=exports.toIndexableString(objKey)+exports.toIndexableString(key[objKey])}}return result}}return""}exports.toIndexableString=function(key){var zero="\x00";key=exports.normalizeKey(key);return collationIndex(key)+SEP+indexify(key)+zero};function parseNumber(str,i){var originalIdx=i;var num;var zero=str[i]==="1";if(zero){num=0;i++}else{var neg=str[i]==="0";i++;var numAsString="";var magAsString=str.substring(i,i+MAGNITUDE_DIGITS);var magnitude=parseInt(magAsString,10)+MIN_MAGNITUDE;if(neg){magnitude=-magnitude}i+=MAGNITUDE_DIGITS;while(true){var ch=str[i];if(ch==="\x00"){break}else{numAsString+=ch}i++}numAsString=numAsString.split(".");if(numAsString.length===1){num=parseInt(numAsString,10)}else{num=parseFloat(numAsString[0]+"."+numAsString[1])}if(neg){num=num-10}if(magnitude!==0){num=parseFloat(num+"e"+magnitude)}}return{num:num,length:i-originalIdx}}function pop(stack,metaStack){var obj=stack.pop();if(metaStack.length){var lastMetaElement=metaStack[metaStack.length-1];if(obj===lastMetaElement.element){metaStack.pop();lastMetaElement=metaStack[metaStack.length-1]}var element=lastMetaElement.element;var lastElementIndex=lastMetaElement.index;if(Array.isArray(element)){element.push(obj)}else if(lastElementIndex===stack.length-2){var key=stack.pop();element[key]=obj}else{stack.push(obj)}}}exports.parseIndexableString=function(str){var stack=[];var metaStack=[];var i=0;while(true){var collationIndex=str[i++];if(collationIndex==="\x00"){if(stack.length===1){return stack.pop()}else{pop(stack,metaStack);continue}}switch(collationIndex){case"1":stack.push(null);break;case"2":stack.push(str[i]==="1");i++;break;case"3":var parsedNum=parseNumber(str,i);stack.push(parsedNum.num);i+=parsedNum.length;break;case"4":var parsedStr="";while(true){var ch=str[i];if(ch==="\x00"){break}parsedStr+=ch;i++}parsedStr=parsedStr.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"");stack.push(parsedStr);break;case"5":var arrayElement={element:[],index:stack.length};stack.push(arrayElement.element);metaStack.push(arrayElement);break;case"6":var objElement={element:{},index:stack.length};stack.push(objElement.element);metaStack.push(objElement);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+collationIndex)}}};function arrayCollate(a,b){var len=Math.min(a.length,b.length);for(var i=0;i<len;i++){var sort=exports.collate(a[i],b[i]);if(sort!==0){return sort}}return a.length===b.length?0:a.length>b.length?1:-1}function stringCollate(a,b){return a===b?0:a>b?1:-1}function objectCollate(a,b){var ak=Object.keys(a),bk=Object.keys(b);var len=Math.min(ak.length,bk.length);for(var i=0;i<len;i++){var sort=exports.collate(ak[i],bk[i]);if(sort!==0){return sort}sort=exports.collate(a[ak[i]],b[bk[i]]);if(sort!==0){return sort}}return ak.length===bk.length?0:ak.length>bk.length?1:-1}function collationIndex(x){var id=["boolean","number","string","object"];var idx=id.indexOf(typeof x);if(~idx){if(x===null){return 1}if(Array.isArray(x)){return 5}return idx<3?idx+2:idx+3}if(Array.isArray(x)){return 5}}function numToIndexableString(num){if(num===0){return"1"}var expFormat=num.toExponential().split(/e\+?/);var magnitude=parseInt(expFormat[1],10);var neg=num<0;var result=neg?"0":"2";var magForComparison=(neg?-magnitude:magnitude)-MIN_MAGNITUDE;var magString=utils.padLeft(magForComparison.toString(),"0",MAGNITUDE_DIGITS);result+=SEP+magString;var factor=Math.abs(parseFloat(expFormat[0]));if(neg){factor=10-factor}var factorStr=factor.toFixed(20);factorStr=factorStr.replace(/\.?0+$/,"");result+=SEP+factorStr;return result}},{"./utils":56}],56:[function(require,module,exports){"use strict";function pad(str,padWith,upToLength){var padding="";var targetLength=upToLength-str.length;while(padding.length<targetLength){padding+=padWith}return padding}exports.padLeft=function(str,padWith,upToLength){var padding=pad(str,padWith,upToLength);return padding+str};exports.padRight=function(str,padWith,upToLength){var padding=pad(str,padWith,upToLength);return str+padding};exports.stringLexCompare=function(a,b){var aLen=a.length;var bLen=b.length;var i;for(i=0;i<aLen;i++){if(i===bLen){return 1}var aChar=a.charAt(i);var bChar=b.charAt(i);if(aChar!==bChar){return aChar<bChar?-1:1}}if(aLen<bLen){return-1}return 0};exports.intToDecimalForm=function(int){var isNeg=int<0;var result="";do{var remainder=isNeg?-Math.ceil(int%10):Math.floor(int%10);result=remainder+result;int=isNeg?Math.ceil(int/10):Math.floor(int/10)}while(int);if(isNeg&&result!=="0"){result="-"+result}return result}},{}],57:[function(require,module,exports){"use strict";var class2type={};var types=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"];for(var i=0;i<types.length;i++){var typename=types[i];class2type["[object "+typename+"]"]=typename.toLowerCase()}var core_toString=class2type.toString;var core_hasOwn=class2type.hasOwnProperty;function type(obj){if(obj===null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj}function isWindow(obj){return obj!==null&&obj===obj.window}function isPlainObject(obj){if(!obj||type(obj)!=="object"||obj.nodeType||isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var key;for(key in obj){}return key===undefined||core_hasOwn.call(obj,key)}function isFunction(obj){return type(obj)==="function"}var isArray=Array.isArray||function(obj){return type(obj)==="array"};function extend(){var stack=[];var i=-1;var len=arguments.length;var args=new Array(len);while(++i<len){args[i]=arguments[i]}var container={};stack.push({args:args,result:{container:container,key:"key"}});var next;while(next=stack.pop()){extendInner(stack,next.args,next.result)}return container.key}function extendInner(stack,args,result){var options,name,src,copy,copyIsArray,clone,target=args[0]||{},i=1,length=args.length,deep=false,numericStringRegex=/\d+/,optionsIsArray;if(typeof target==="boolean"){deep=target;target=args[1]||{};i=2}if(typeof target!=="object"&&!isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=args[i])!=null){optionsIsArray=isArray(options);for(name in options){if(!(name in Object.prototype)){if(optionsIsArray&&!numericStringRegex.test(name)){continue}src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}stack.push({args:[deep,clone,copy],result:{container:target,key:name}})}else if(copy!==undefined){if(!(isArray(options)&&isFunction(copy))){target[name]=copy}}}}}}result.container[result.key]=target}module.exports=extend},{}],58:[function(require,module,exports){(function(process){"use strict";var utils=require("./utils");var merge=require("./merge");var errors=require("./deps/errors");var EventEmitter=require("events").EventEmitter;var upsert=require("./deps/upsert");var Changes=require("./changes");var Promise=utils.Promise;function arrayFirst(arr,callback){for(var i=0;i<arr.length;i++){if(callback(arr[i],i)===true){return arr[i]}}return false}function yankError(callback){return function(err,results){if(err||results[0]&&results[0].error){callback(err||results[0])}else{callback(null,results.length?results[0]:results)}}}function cleanDocs(docs){for(var i=0;i<docs.length;i++){var doc=docs[i];if(doc._deleted){delete doc._attachments}else if(doc._attachments){var atts=Object.keys(doc._attachments);for(var j=0;j<atts.length;j++){var att=atts[j];doc._attachments[att]=utils.pick(doc._attachments[att],["data","digest","content_type","revpos","stub"])}}}}function compareByIdThenRev(a,b){var idCompare=utils.compare(a._id,b._id);if(idCompare!==0){return idCompare}var aStart=a._revisions?a._revisions.start:0;var bStart=b._revisions?b._revisions.start:0;return utils.compare(aStart,bStart)}function computeHeight(revs){var height={};var edges=[];merge.traverseRevTree(revs,function(isLeaf,pos,id,prnt){var rev=pos+"-"+id;if(isLeaf){height[rev]=0}if(prnt!==undefined){edges.push({from:prnt,to:rev})}return rev});edges.reverse();edges.forEach(function(edge){if(height[edge.from]===undefined){height[edge.from]=1+height[edge.to]}else{height[edge.from]=Math.min(height[edge.from],1+height[edge.to])}});return height}function allDocsKeysQuery(api,opts,callback){var keys="limit"in opts?opts.keys.slice(opts.skip,opts.limit+opts.skip):opts.skip>0?opts.keys.slice(opts.skip):opts.keys;if(opts.descending){keys.reverse()}if(!keys.length){return api._allDocs({limit:0},callback)}var finalResults={offset:opts.skip};return Promise.all(keys.map(function(key){var subOpts=utils.extend(true,{key:key,deleted:"ok"},opts);["limit","skip","keys"].forEach(function(optKey){delete subOpts[optKey]});return new Promise(function(resolve,reject){api._allDocs(subOpts,function(err,res){if(err){return reject(err)}finalResults.total_rows=res.total_rows;resolve(res.rows[0]||{key:key,error:"not_found"})})})})).then(function(results){finalResults.rows=results;return finalResults})}function doNextCompaction(self){var task=self._compactionQueue[0];var opts=task.opts;var callback=task.callback;self.get("_local/compaction").catch(function(){return false}).then(function(doc){
if(doc&&doc.last_seq){opts.last_seq=doc.last_seq}self._compact(opts,function(err,res){if(err){callback(err)}else{callback(null,res)}process.nextTick(function(){self._compactionQueue.shift();if(self._compactionQueue.length){doNextCompaction(self)}})})})}utils.inherits(AbstractPouchDB,EventEmitter);module.exports=AbstractPouchDB;function AbstractPouchDB(){EventEmitter.call(this)}AbstractPouchDB.prototype.post=utils.adapterFun("post",function(doc,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}if(typeof doc!=="object"||Array.isArray(doc)){return callback(errors.error(errors.NOT_AN_OBJECT))}this.bulkDocs({docs:[doc]},opts,yankError(callback))});AbstractPouchDB.prototype.put=utils.adapterFun("put",utils.getArguments(function(args){var temp,temptype,opts,callback;var doc=args.shift();var id="_id"in doc;if(typeof doc!=="object"||Array.isArray(doc)){callback=args.pop();return callback(errors.error(errors.NOT_AN_OBJECT))}doc=utils.clone(doc);while(true){temp=args.shift();temptype=typeof temp;if(temptype==="string"&&!id){doc._id=temp;id=true}else if(temptype==="string"&&id&&!("_rev"in doc)){doc._rev=temp}else if(temptype==="object"){opts=temp}else if(temptype==="function"){callback=temp}if(!args.length){break}}opts=opts||{};var error=utils.invalidIdError(doc._id);if(error){return callback(error)}if(utils.isLocalId(doc._id)&&typeof this._putLocal==="function"){if(doc._deleted){return this._removeLocal(doc,callback)}else{return this._putLocal(doc,callback)}}this.bulkDocs({docs:[doc]},opts,yankError(callback))}));AbstractPouchDB.prototype.putAttachment=utils.adapterFun("putAttachment",function(docId,attachmentId,rev,blob,type,callback){var api=this;if(typeof type==="function"){callback=type;type=blob;blob=rev;rev=null}if(typeof type==="undefined"){type=blob;blob=rev;rev=null}function createAttachment(doc){doc._attachments=doc._attachments||{};doc._attachments[attachmentId]={content_type:type,data:blob};return api.put(doc)}return api.get(docId).then(function(doc){if(doc._rev!==rev){throw errors.error(errors.REV_CONFLICT)}return createAttachment(doc)},function(err){if(err.reason===errors.MISSING_DOC.message){return createAttachment({_id:docId})}else{throw err}})});AbstractPouchDB.prototype.removeAttachment=utils.adapterFun("removeAttachment",function(docId,attachmentId,rev,callback){var self=this;self.get(docId,function(err,obj){if(err){callback(err);return}if(obj._rev!==rev){callback(errors.error(errors.REV_CONFLICT));return}if(!obj._attachments){return callback()}delete obj._attachments[attachmentId];if(Object.keys(obj._attachments).length===0){delete obj._attachments}self.put(obj,callback)})});AbstractPouchDB.prototype.remove=utils.adapterFun("remove",function(docOrId,optsOrRev,opts,callback){var doc;if(typeof optsOrRev==="string"){doc={_id:docOrId,_rev:optsOrRev};if(typeof opts==="function"){callback=opts;opts={}}}else{doc=docOrId;if(typeof optsOrRev==="function"){callback=optsOrRev;opts={}}else{callback=opts;opts=optsOrRev}}opts=utils.clone(opts||{});opts.was_delete=true;var newDoc={_id:doc._id,_rev:doc._rev||opts.rev};newDoc._deleted=true;if(utils.isLocalId(newDoc._id)&&typeof this._removeLocal==="function"){return this._removeLocal(doc,callback)}this.bulkDocs({docs:[newDoc]},opts,yankError(callback))});AbstractPouchDB.prototype.revsDiff=utils.adapterFun("revsDiff",function(req,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=utils.clone(opts);var ids=Object.keys(req);if(!ids.length){return callback(null,{})}var count=0;var missing=new utils.Map;function addToMissing(id,revId){if(!missing.has(id)){missing.set(id,{missing:[]})}missing.get(id).missing.push(revId)}function processDoc(id,rev_tree){var missingForId=req[id].slice(0);merge.traverseRevTree(rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;var idx=missingForId.indexOf(rev);if(idx===-1){return}missingForId.splice(idx,1);if(opts.status!=="available"){addToMissing(id,rev)}});missingForId.forEach(function(rev){addToMissing(id,rev)})}ids.map(function(id){this._getRevisionTree(id,function(err,rev_tree){if(err&&err.status===404&&err.message==="missing"){missing.set(id,{missing:req[id]})}else if(err){return callback(err)}else{processDoc(id,rev_tree)}if(++count===ids.length){var missingObj={};missing.forEach(function(value,key){missingObj[key]=value});return callback(null,missingObj)}})},this)});AbstractPouchDB.prototype.compactDocument=utils.adapterFun("compactDocument",function(docId,maxHeight,callback){var self=this;this._getRevisionTree(docId,function(err,revTree){if(err){return callback(err)}var height=computeHeight(revTree);var candidates=[];var revs=[];Object.keys(height).forEach(function(rev){if(height[rev]>maxHeight){candidates.push(rev)}});merge.traverseRevTree(revTree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;if(opts.status==="available"&&candidates.indexOf(rev)!==-1){revs.push(rev)}});self._doCompaction(docId,revs,callback)})});AbstractPouchDB.prototype.compact=utils.adapterFun("compact",function(opts,callback){if(typeof opts==="function"){callback=opts;opts={}}var self=this;opts=utils.clone(opts||{});self._compactionQueue=self._compactionQueue||[];self._compactionQueue.push({opts:opts,callback:callback});if(self._compactionQueue.length===1){doNextCompaction(self)}});AbstractPouchDB.prototype._compact=function(opts,callback){var self=this;var changesOpts={returnDocs:false,last_seq:opts.last_seq||0};var promises=[];function onChange(row){promises.push(self.compactDocument(row.id,0))}function onComplete(resp){var lastSeq=resp.last_seq;Promise.all(promises).then(function(){return upsert(self,"_local/compaction",function deltaFunc(doc){if(!doc.last_seq||doc.last_seq<lastSeq){doc.last_seq=lastSeq;return doc}return false})}).then(function(){callback(null,{ok:true})}).catch(callback)}self.changes(changesOpts).on("change",onChange).on("complete",onComplete).on("error",callback)};AbstractPouchDB.prototype.get=utils.adapterFun("get",function(id,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}if(typeof id!=="string"){return callback(errors.error(errors.INVALID_ID))}if(utils.isLocalId(id)&&typeof this._getLocal==="function"){return this._getLocal(id,callback)}var leaves=[],self=this;function finishOpenRevs(){var result=[];var count=leaves.length;if(!count){return callback(null,result)}leaves.forEach(function(leaf){self.get(id,{rev:leaf,revs:opts.revs,attachments:opts.attachments},function(err,doc){if(!err){result.push({ok:doc})}else{result.push({missing:leaf})}count--;if(!count){callback(null,result)}})})}if(opts.open_revs){if(opts.open_revs==="all"){this._getRevisionTree(id,function(err,rev_tree){if(err){return callback(err)}leaves=merge.collectLeaves(rev_tree).map(function(leaf){return leaf.rev});finishOpenRevs()})}else{if(Array.isArray(opts.open_revs)){leaves=opts.open_revs;for(var i=0;i<leaves.length;i++){var l=leaves[i];if(!(typeof l==="string"&&/^\d+-/.test(l))){return callback(errors.error(errors.INVALID_REV))}}finishOpenRevs()}else{return callback(errors.error(errors.UNKNOWN_ERROR,"function_clause"))}}return}return this._get(id,opts,function(err,result){opts=utils.clone(opts);if(err){return callback(err)}var doc=result.doc;var metadata=result.metadata;var ctx=result.ctx;if(opts.conflicts){var conflicts=merge.collectConflicts(metadata);if(conflicts.length){doc._conflicts=conflicts}}if(utils.isDeleted(metadata,doc._rev)){doc._deleted=true}if(opts.revs||opts.revs_info){var paths=merge.rootToLeaf(metadata.rev_tree);var path=arrayFirst(paths,function(arr){return arr.ids.map(function(x){return x.id}).indexOf(doc._rev.split("-")[1])!==-1});var indexOfRev=path.ids.map(function(x){return x.id}).indexOf(doc._rev.split("-")[1])+1;var howMany=path.ids.length-indexOfRev;path.ids.splice(indexOfRev,howMany);path.ids.reverse();if(opts.revs){doc._revisions={start:path.pos+path.ids.length-1,ids:path.ids.map(function(rev){return rev.id})}}if(opts.revs_info){var pos=path.pos+path.ids.length;doc._revs_info=path.ids.map(function(rev){pos--;return{rev:pos+"-"+rev.id,status:rev.opts.status}})}}if(opts.local_seq){utils.info('The "local_seq" option is deprecated and will be removed');doc._local_seq=result.metadata.seq}if(opts.attachments&&doc._attachments){var attachments=doc._attachments;var count=Object.keys(attachments).length;if(count===0){return callback(null,doc)}Object.keys(attachments).forEach(function(key){this._getAttachment(attachments[key],{encode:true,ctx:ctx},function(err,data){var att=doc._attachments[key];att.data=data;delete att.stub;delete att.length;if(!--count){callback(null,doc)}})},self)}else{if(doc._attachments){for(var key in doc._attachments){if(doc._attachments.hasOwnProperty(key)){doc._attachments[key].stub=true}}}callback(null,doc)}})});AbstractPouchDB.prototype.getAttachment=utils.adapterFun("getAttachment",function(docId,attachmentId,opts,callback){var self=this;if(opts instanceof Function){callback=opts;opts={}}opts=utils.clone(opts);this._get(docId,opts,function(err,res){if(err){return callback(err)}if(res.doc._attachments&&res.doc._attachments[attachmentId]){opts.ctx=res.ctx;self._getAttachment(res.doc._attachments[attachmentId],opts,callback)}else{return callback(errors.error(errors.MISSING_DOC))}})});AbstractPouchDB.prototype.allDocs=utils.adapterFun("allDocs",function(opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=utils.clone(opts);opts.skip=typeof opts.skip!=="undefined"?opts.skip:0;if("keys"in opts){if(!Array.isArray(opts.keys)){return callback(new TypeError("options.keys must be an array"))}var incompatibleOpt=["startkey","endkey","key"].filter(function(incompatibleOpt){return incompatibleOpt in opts})[0];if(incompatibleOpt){callback(errors.error(errors.QUERY_PARSE_ERROR,"Query parameter `"+incompatibleOpt+"` is not compatible with multi-get"));return}if(this.type()!=="http"){return allDocsKeysQuery(this,opts,callback)}}return this._allDocs(opts,callback)});AbstractPouchDB.prototype.changes=function(opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return new Changes(this,opts,callback)};AbstractPouchDB.prototype.close=utils.adapterFun("close",function(callback){this._closed=true;return this._close(callback)});AbstractPouchDB.prototype.info=utils.adapterFun("info",function(callback){var self=this;this._info(function(err,info){if(err){return callback(err)}info.db_name=info.db_name||self._db_name;info.auto_compaction=!!(self.auto_compaction&&self.type()!=="http");callback(null,info)})});AbstractPouchDB.prototype.id=utils.adapterFun("id",function(callback){return this._id(callback)});AbstractPouchDB.prototype.type=function(){return typeof this._type==="function"?this._type():this.adapter};AbstractPouchDB.prototype.bulkDocs=utils.adapterFun("bulkDocs",function(req,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=utils.clone(opts);if(Array.isArray(req)){req={docs:req}}if(!req||!req.docs||!Array.isArray(req.docs)){return callback(errors.error(errors.MISSING_BULK_DOCS))}for(var i=0;i<req.docs.length;++i){if(typeof req.docs[i]!=="object"||Array.isArray(req.docs[i])){return callback(errors.error(errors.NOT_AN_OBJECT))}}req=utils.clone(req);if(!("new_edits"in opts)){if("new_edits"in req){opts.new_edits=req.new_edits}else{opts.new_edits=true}}if(!opts.new_edits&&this.type()!=="http"){req.docs.sort(compareByIdThenRev)}cleanDocs(req.docs);return this._bulkDocs(req,opts,function(err,res){if(err){return callback(err)}if(!opts.new_edits){res=res.filter(function(x){return x.error})}callback(null,res)})});AbstractPouchDB.prototype.registerDependentDatabase=utils.adapterFun("registerDependentDatabase",function(dependentDb,callback){var depDB=new this.constructor(dependentDb,this.__opts);function diffFun(doc){doc.dependentDbs=doc.dependentDbs||{};if(doc.dependentDbs[dependentDb]){return false}doc.dependentDbs[dependentDb]=true;return doc}upsert(this,"_local/_pouch_dependentDbs",diffFun,function(err){if(err){return callback(err)}return callback(null,{db:depDB})})});AbstractPouchDB.prototype.destroy=utils.adapterFun("destroy",function(callback){var self=this;var usePrefix="use_prefix"in self?self.use_prefix:true;function destroyDb(){self._destroy(function(err,resp){if(err){return callback(err)}self.emit("destroyed");callback(null,resp||{ok:true})})}self.get("_local/_pouch_dependentDbs",function(err,localDoc){if(err){if(err.status!==404){return callback(err)}else{return destroyDb()}}var dependentDbs=localDoc.dependentDbs;var PouchDB=self.constructor;var deletedMap=Object.keys(dependentDbs).map(function(name){var trueName=usePrefix?name.replace(new RegExp("^"+PouchDB.prefix),""):name;return new PouchDB(trueName,self.__opts).destroy()});Promise.all(deletedMap).then(destroyDb,function(error){callback(error)})})})}).call(this,require("_process"))},{"./changes":70,"./deps/errors":81,"./deps/upsert":90,"./merge":95,"./utils":106,_process:7,events:6}],59:[function(require,module,exports){(function(process){"use strict";var CHANGES_BATCH_SIZE=25;var MAX_URL_LENGTH=1800;var readAsBinaryString=require("../../deps/binary/readAsBinaryString");var binaryStringToBlob=require("../../deps/binary/binaryStringToBlob");var utils=require("../../utils");var Promise=utils.Promise;var clone=utils.clone;var base64=require("../../deps/binary/base64");var btoa=base64.btoa;var atob=base64.atob;var errors=require("../../deps/errors");var log=require("debug")("pouchdb:http");var isBrowser=typeof process==="undefined"||process.browser;var buffer=require("../../deps/buffer");var createMultipart=require("../../deps/multipart");function blobToBase64(blobOrBuffer){if(!isBrowser){return Promise.resolve(blobOrBuffer.toString("base64"))}return new Promise(function(resolve){readAsBinaryString(blobOrBuffer,function(bin){resolve(btoa(bin))})})}function encodeDocId(id){if(/^_design/.test(id)){return"_design/"+encodeURIComponent(id.slice(8))}if(/^_local/.test(id)){return"_local/"+encodeURIComponent(id.slice(7))}return encodeURIComponent(id)}function preprocessAttachments(doc){if(!doc._attachments||!Object.keys(doc._attachments)){return Promise.resolve()}return Promise.all(Object.keys(doc._attachments).map(function(key){var attachment=doc._attachments[key];if(attachment.data&&typeof attachment.data!=="string"){return blobToBase64(attachment.data).then(function(b64){attachment.data=b64})}}))}function getHost(name,opts){if(/http(s?):/.test(name)){var uri=utils.parseUri(name);uri.remote=true;if(uri.user||uri.password){uri.auth={username:uri.user,password:uri.password}}var parts=uri.path.replace(/(^\/|\/$)/g,"").split("/");uri.db=parts.pop();uri.path=parts.join("/");opts=opts||{};opts=clone(opts);uri.headers=opts.headers||opts.ajax&&opts.ajax.headers||{};if(opts.auth||uri.auth){var nAuth=opts.auth||uri.auth;var token=btoa(nAuth.username+":"+nAuth.password);uri.headers.Authorization="Basic "+token}if(opts.headers){uri.headers=opts.headers}return uri}return{host:"",path:"/",db:name,auth:false}}function genDBUrl(opts,path){return genUrl(opts,opts.db+"/"+path)}function genUrl(opts,path){if(opts.remote){var pathDel=!opts.path?"":"/";return opts.protocol+"://"+opts.host+":"+opts.port+"/"+opts.path+pathDel+path}return"/"+path}function HttpPouch(opts,callback){var api=this;api.getHost=opts.getHost?opts.getHost:getHost;var host=api.getHost(opts.name,opts);var dbUrl=genDBUrl(host,"");api.getUrl=function(){return dbUrl};api.getHeaders=function(){return clone(host.headers)};var ajaxOpts=opts.ajax||{};opts=clone(opts);function ajax(options,callback){var reqOpts=utils.extend(true,clone(ajaxOpts),options);log(reqOpts.method+" "+reqOpts.url);return utils.ajax(reqOpts,callback)}function ajaxPromise(opts){return new Promise(function(resolve,reject){ajax(opts,function(err,res){if(err){return reject(err)}resolve(res)})})}var createDB=function(){ajax({headers:clone(host.headers),method:"PUT",url:dbUrl},function(err){if(err&&err.status===401){ajax({headers:clone(host.headers),method:"HEAD",url:dbUrl},function(err){if(err){callback(err)}else{callback(null,api)}})}else if(!err||err.status===412){callback(null,api)}else{callback(err)}})};if(!opts.skipSetup){ajax({headers:clone(host.headers),method:"GET",url:dbUrl},function(err){if(err){if(err.status===404){utils.explain404("PouchDB is just detecting if the remote DB exists.");createDB()}else{callback(err)}}else{callback(null,api)}})}api.type=function(){return"http"};api.id=utils.adapterFun("id",function(callback){ajax({headers:clone(host.headers),method:"GET",url:genUrl(host,"")},function(err,result){if(err){return callback(err)}var uuid=result&&result.uuid?result.uuid+host.db:genDBUrl(host,"");callback(null,uuid)})});api.request=utils.adapterFun("request",function(options,callback){options.headers=host.headers;options.url=genDBUrl(host,options.url);ajax(options,callback)});api.compact=utils.adapterFun("compact",function(opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=clone(opts);ajax({headers:clone(host.headers),url:genDBUrl(host,"_compact"),method:"POST"},function(){function ping(){api.info(function(err,res){if(!res.compact_running){callback(null,{ok:true})}else{setTimeout(ping,opts.interval||200)}})}if(typeof callback==="function"){ping()}})});api._info=function(callback){ajax({headers:clone(host.headers),method:"GET",url:genDBUrl(host,"")},function(err,res){if(err){callback(err)}else{res.host=genDBUrl(host,"");callback(null,res)}})};api.get=utils.adapterFun("get",function(id,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=clone(opts);var params=[];if(opts.revs){params.push("revs=true")}if(opts.revs_info){params.push("revs_info=true")}if(opts.local_seq){params.push("local_seq=true")}if(opts.open_revs){if(opts.open_revs!=="all"){opts.open_revs=JSON.stringify(opts.open_revs)}params.push("open_revs="+opts.open_revs)}if(opts.rev){params.push("rev="+opts.rev)}if(opts.conflicts){params.push("conflicts="+opts.conflicts)}params=params.join("&");params=params===""?"":"?"+params;id=encodeDocId(id);var options={headers:clone(host.headers),method:"GET",url:genDBUrl(host,id+params)};var getRequestAjaxOpts=opts.ajax||{};utils.extend(true,options,getRequestAjaxOpts);function fetchAttachments(doc){var atts=doc._attachments;var filenames=atts&&Object.keys(atts);if(!atts||!filenames.length){return}return Promise.all(filenames.map(function(filename){var att=atts[filename];var path=encodeDocId(doc._id)+"/"+encodeAttachmentId(filename)+"?rev="+doc._rev;return ajaxPromise({headers:clone(host.headers),method:"GET",url:genDBUrl(host,path),binary:true}).then(blobToBase64).then(function(b64){delete att.stub;delete att.length;att.data=b64})}))}function fetchAllAttachments(docOrDocs){if(Array.isArray(docOrDocs)){return Promise.all(docOrDocs.map(function(doc){if(doc.ok){return fetchAttachments(doc.ok)}}))}return fetchAttachments(docOrDocs)}ajaxPromise(options).then(function(res){return Promise.resolve().then(function(){if(opts.attachments){return fetchAllAttachments(res)}}).then(function(){callback(null,res)})}).catch(callback)});api.remove=utils.adapterFun("remove",function(docOrId,optsOrRev,opts,callback){var doc;if(typeof optsOrRev==="string"){doc={_id:docOrId,_rev:optsOrRev};if(typeof opts==="function"){callback=opts;opts={}}}else{doc=docOrId;if(typeof optsOrRev==="function"){callback=optsOrRev;opts={}}else{callback=opts;opts=optsOrRev}}var rev=doc._rev||opts.rev;ajax({headers:clone(host.headers),method:"DELETE",url:genDBUrl(host,encodeDocId(doc._id))+"?rev="+rev},callback)});function encodeAttachmentId(attachmentId){return attachmentId.split("/").map(encodeURIComponent).join("/")}api.getAttachment=utils.adapterFun("getAttachment",function(docId,attachmentId,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}var params=opts.rev?"?rev="+opts.rev:"";var url=genDBUrl(host,encodeDocId(docId))+"/"+encodeAttachmentId(attachmentId)+params;ajax({headers:clone(host.headers),method:"GET",url:url,binary:true},callback)});api.removeAttachment=utils.adapterFun("removeAttachment",function(docId,attachmentId,rev,callback){var url=genDBUrl(host,encodeDocId(docId)+"/"+encodeAttachmentId(attachmentId))+"?rev="+rev;ajax({headers:clone(host.headers),method:"DELETE",url:url},callback)});api.putAttachment=utils.adapterFun("putAttachment",function(docId,attachmentId,rev,blob,type,callback){if(typeof type==="function"){callback=type;type=blob;blob=rev;rev=null}if(typeof type==="undefined"){type=blob;blob=rev;rev=null}var id=encodeDocId(docId)+"/"+encodeAttachmentId(attachmentId);var url=genDBUrl(host,id);if(rev){url+="?rev="+rev}if(typeof blob==="string"){var binary;try{binary=atob(blob)}catch(err){return callback(errors.error(errors.BAD_ARG,"Attachments need to be base64 encoded"))}if(isBrowser){blob=binaryStringToBlob(binary,type)}else{blob=binary?new buffer(binary,"binary"):""}}var opts={headers:clone(host.headers),method:"PUT",url:url,processData:false,body:blob,timeout:6e4};opts.headers["Content-Type"]=type;ajax(opts,callback)});api.put=utils.adapterFun("put",utils.getArguments(function(args){var temp,temptype,opts;var doc=args.shift();var id="_id"in doc;var callback=args.pop();if(typeof doc!=="object"||Array.isArray(doc)){return callback(errors.error(errors.NOT_AN_OBJECT))}doc=clone(doc);preprocessAttachments(doc).then(function(){while(true){temp=args.shift();temptype=typeof temp;if(temptype==="string"&&!id){doc._id=temp;id=true}else if(temptype==="string"&&id&&!("_rev"in doc)){doc._rev=temp}else if(temptype==="object"){opts=clone(temp)}if(!args.length){break}}opts=opts||{};var error=utils.invalidIdError(doc._id);if(error){throw error}var params=[];if(opts&&typeof opts.new_edits!=="undefined"){params.push("new_edits="+opts.new_edits)}params=params.join("&");if(params!==""){params="?"+params}var ajaxOpts={headers:clone(host.headers),method:"PUT",url:genDBUrl(host,encodeDocId(doc._id))+params,body:doc};return Promise.resolve().then(function(){var hasNonStubAttachments=doc._attachments&&Object.keys(doc._attachments).filter(function(att){return!doc._attachments[att].stub}).length;if(hasNonStubAttachments){var multipart=createMultipart(doc);ajaxOpts.body=multipart.body;ajaxOpts.processData=false;ajaxOpts.headers=utils.extend(ajaxOpts.headers,multipart.headers)}}).catch(function(){throw new Error("Did you forget to base64-encode an attachment?")}).then(function(){return ajaxPromise(ajaxOpts)}).then(function(res){res.ok=true;callback(null,res)})}).catch(callback)}));api.post=utils.adapterFun("post",function(doc,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=clone(opts);if(typeof doc!=="object"){return callback(errors.error(errors.NOT_AN_OBJECT))}if(!("_id"in doc)){doc._id=utils.uuid()}api.put(doc,opts,function(err,res){if(err){return callback(err)}res.ok=true;callback(null,res)})});api._bulkDocs=function(req,opts,callback){if(typeof opts.new_edits!=="undefined"){req.new_edits=opts.new_edits}Promise.all(req.docs.map(preprocessAttachments)).then(function(){ajax({headers:clone(host.headers),method:"POST",url:genDBUrl(host,"_bulk_docs"),body:req},function(err,results){if(err){return callback(err)}results.forEach(function(result){result.ok=true});callback(null,results)})}).catch(callback)};api.allDocs=utils.adapterFun("allDocs",function(opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=clone(opts);var params=[];var body;var method="GET";if(opts.conflicts){params.push("conflicts=true")}if(opts.descending){params.push("descending=true")}if(opts.include_docs){params.push("include_docs=true")}if(opts.attachments){params.push("attachments=true")}if(opts.key){params.push("key="+encodeURIComponent(JSON.stringify(opts.key)))}if(opts.startkey){params.push("startkey="+encodeURIComponent(JSON.stringify(opts.startkey)))}if(opts.endkey){params.push("endkey="+encodeURIComponent(JSON.stringify(opts.endkey)))}if(typeof opts.inclusive_end!=="undefined"){params.push("inclusive_end="+!!opts.inclusive_end)}if(typeof opts.limit!=="undefined"){params.push("limit="+opts.limit)}if(typeof opts.skip!=="undefined"){params.push("skip="+opts.skip)}params=params.join("&");if(params!==""){params="?"+params}if(typeof opts.keys!=="undefined"){var keysAsString="keys="+encodeURIComponent(JSON.stringify(opts.keys));if(keysAsString.length+params.length+1<=MAX_URL_LENGTH){params+=(params.indexOf("?")!==-1?"&":"?")+keysAsString}else{method="POST";body=JSON.stringify({keys:opts.keys})}}ajax({headers:clone(host.headers),method:method,url:genDBUrl(host,"_all_docs"+params),body:body},callback)});api._changes=function(opts){var batchSize="batch_size"in opts?opts.batch_size:CHANGES_BATCH_SIZE;opts=clone(opts);opts.timeout=opts.timeout||30*1e3;var params={timeout:opts.timeout-5*1e3};var limit=typeof opts.limit!=="undefined"?opts.limit:false;if(limit===0){limit=1}var returnDocs;if("returnDocs"in opts){returnDocs=opts.returnDocs}else{returnDocs=true}var leftToFetch=limit;if(opts.style){params.style=opts.style}if(opts.include_docs||opts.filter&&typeof opts.filter==="function"){params.include_docs=true}if(opts.attachments){params.attachments=true}if(opts.continuous){params.feed="longpoll"}if(opts.conflicts){params.conflicts=true}if(opts.descending){params.descending=true}if(opts.filter&&typeof opts.filter==="string"){params.filter=opts.filter;if(opts.filter==="_view"&&opts.view&&typeof opts.view==="string"){params.view=opts.view}}if(opts.query_params&&typeof opts.query_params==="object"){for(var param_name in opts.query_params){if(opts.query_params.hasOwnProperty(param_name)){params[param_name]=opts.query_params[param_name]}}}var method="GET";var body;if(opts.doc_ids){params.filter="_doc_ids";var docIdsJson=JSON.stringify(opts.doc_ids);if(docIdsJson.length<MAX_URL_LENGTH){params.doc_ids=docIdsJson}else{method="POST";body={doc_ids:opts.doc_ids}}}if(opts.continuous&&api._useSSE){return api.sse(opts,params,returnDocs)}var xhr;var lastFetchedSeq;var fetch=function(since,callback){if(opts.aborted){return}params.since=since;if(typeof params.since==="object"){params.since=JSON.stringify(params.since)}if(opts.descending){if(limit){params.limit=leftToFetch}}else{params.limit=!limit||leftToFetch>batchSize?batchSize:leftToFetch}var paramStr="?"+Object.keys(params).map(function(k){return k+"="+params[k]}).join("&");var xhrOpts={headers:clone(host.headers),method:method,url:genDBUrl(host,"_changes"+paramStr),timeout:opts.timeout,body:body};lastFetchedSeq=since;if(opts.aborted){return}xhr=ajax(xhrOpts,callback)};var fetchTimeout=10;var fetchRetryCount=0;var results={results:[]};var fetched=function(err,res){if(opts.aborted){return}var raw_results_length=0;if(res&&res.results){raw_results_length=res.results.length;results.last_seq=res.last_seq;var req={};req.query=opts.query_params;res.results=res.results.filter(function(c){leftToFetch--;var ret=utils.filterChange(opts)(c);if(ret){if(returnDocs){results.results.push(c)}utils.call(opts.onChange,c)}return ret})}else if(err){opts.aborted=true;utils.call(opts.complete,err);return}if(res&&res.last_seq){lastFetchedSeq=res.last_seq}var finished=limit&&leftToFetch<=0||res&&raw_results_length<batchSize||opts.descending;if(opts.continuous&&!(limit&&leftToFetch<=0)||!finished){if(err){fetchRetryCount+=1}else{fetchRetryCount=0}var timeoutMultiplier=1<<fetchRetryCount;var retryWait=fetchTimeout*timeoutMultiplier;var maximumWait=opts.maximumWait||3e4;if(retryWait>maximumWait){utils.call(opts.complete,err||errors.error(errors.UNKNOWN_ERROR));return}setTimeout(function(){fetch(lastFetchedSeq,fetched)},retryWait)}else{utils.call(opts.complete,null,results)}};fetch(opts.since||0,fetched);return{cancel:function(){opts.aborted=true;if(xhr){xhr.abort()}}}};api.sse=function(opts,params,returnDocs){params.feed="eventsource";params.since=opts.since||0;params.limit=opts.limit;delete params.timeout;var paramStr="?"+Object.keys(params).map(function(k){return k+"="+params[k]}).join("&");var url=genDBUrl(host,"_changes"+paramStr);var source=new EventSource(url);var results={results:[],last_seq:false};var dispatched=false;var open=false;source.addEventListener("message",msgHandler,false);source.onopen=function(){open=true};source.onerror=errHandler;return{cancel:function(){if(dispatched){return dispatched.cancel()}source.removeEventListener("message",msgHandler,false);source.close()}};function msgHandler(e){var data=JSON.parse(e.data);if(returnDocs){results.results.push(data)}results.last_seq=data.seq;utils.call(opts.onChange,data)}function errHandler(err){source.removeEventListener("message",msgHandler,false);if(open===false){api._useSSE=false;dispatched=api._changes(opts);return}source.close();utils.call(opts.complete,err)}};api._useSSE=false;api.revsDiff=utils.adapterFun("revsDiff",function(req,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}ajax({headers:clone(host.headers),method:"POST",url:genDBUrl(host,"_revs_diff"),body:JSON.stringify(req)},callback)});api._close=function(callback){callback()};api._destroy=function(callback){ajax({url:genDBUrl(host,""),method:"DELETE",headers:clone(host.headers)},function(err,resp){if(err){api.emit("error",err);callback(err)}else{api.emit("destroyed");api.constructor.emit("destroyed",opts.name);callback(null,resp)}})}}HttpPouch.valid=function(){return true};module.exports=HttpPouch}).call(this,require("_process"))},{"../../deps/binary/base64":74,"../../deps/binary/binaryStringToBlob":76,"../../deps/binary/readAsBinaryString":79,"../../deps/buffer":80,"../../deps/errors":81,"../../deps/multipart":84,"../../utils":106,_process:7,debug:108}],60:[function(require,module,exports){"use strict";var merge=require("../../merge");var errors=require("../../deps/errors");var idbUtils=require("./idb-utils");var idbConstants=require("./idb-constants");var ATTACH_STORE=idbConstants.ATTACH_STORE;var BY_SEQ_STORE=idbConstants.BY_SEQ_STORE;var DOC_STORE=idbConstants.DOC_STORE;var decodeDoc=idbUtils.decodeDoc;var decodeMetadata=idbUtils.decodeMetadata;var fetchAttachmentsIfNecessary=idbUtils.fetchAttachmentsIfNecessary;var postProcessAttachments=idbUtils.postProcessAttachments;var openTransactionSafely=idbUtils.openTransactionSafely;function createKeyRange(start,end,inclusiveEnd,key,descending){try{if(start&&end){if(descending){return IDBKeyRange.bound(end,start,!inclusiveEnd,false)}else{return IDBKeyRange.bound(start,end,false,!inclusiveEnd)}}else if(start){if(descending){return IDBKeyRange.upperBound(start)}else{return IDBKeyRange.lowerBound(start)}}else if(end){if(descending){return IDBKeyRange.lowerBound(end,!inclusiveEnd)}else{return IDBKeyRange.upperBound(end,!inclusiveEnd)}}else if(key){return IDBKeyRange.only(key)}}catch(e){return{error:e}}return null}function handleKeyRangeError(api,opts,err,callback){if(err.name==="DataError"&&err.code===0){return callback(null,{total_rows:api._meta.docCount,offset:opts.skip,rows:[]})}callback(errors.error(errors.IDB_ERROR,err.name,err.message))}function idbAllDocs(opts,api,idb,callback){function allDocsQuery(opts,callback){var start="startkey"in opts?opts.startkey:false;var end="endkey"in opts?opts.endkey:false;var key="key"in opts?opts.key:false;var skip=opts.skip||0;var limit=typeof opts.limit==="number"?opts.limit:-1;var inclusiveEnd=opts.inclusive_end!==false;var descending="descending"in opts&&opts.descending?"prev":null;var keyRange=createKeyRange(start,end,inclusiveEnd,key,descending);if(keyRange&&keyRange.error){return handleKeyRangeError(api,opts,keyRange.error,callback)}var stores=[DOC_STORE,BY_SEQ_STORE];if(opts.attachments){stores.push(ATTACH_STORE)}var txnResult=openTransactionSafely(idb,stores,"readonly");if(txnResult.error){return callback(txnResult.error)}var txn=txnResult.txn;var docStore=txn.objectStore(DOC_STORE);var seqStore=txn.objectStore(BY_SEQ_STORE);var cursor=descending?docStore.openCursor(keyRange,descending):docStore.openCursor(keyRange);var docIdRevIndex=seqStore.index("_doc_id_rev");var results=[];var docCount=0;function fetchDocAsynchronously(metadata,row,winningRev){var key=metadata.id+"::"+winningRev;docIdRevIndex.get(key).onsuccess=function onGetDoc(e){row.doc=decodeDoc(e.target.result);

if(opts.conflicts){row.doc._conflicts=merge.collectConflicts(metadata)}fetchAttachmentsIfNecessary(row.doc,opts,txn)}}function allDocsInner(cursor,winningRev,metadata){var row={id:metadata.id,key:metadata.id,value:{rev:winningRev}};var deleted=metadata.deleted;if(opts.deleted==="ok"){results.push(row);if(deleted){row.value.deleted=true;row.doc=null}else if(opts.include_docs){fetchDocAsynchronously(metadata,row,winningRev)}}else if(!deleted&&skip--<=0){results.push(row);if(opts.include_docs){fetchDocAsynchronously(metadata,row,winningRev)}if(--limit===0){return}}cursor.continue()}function onGetCursor(e){docCount=api._meta.docCount;var cursor=e.target.result;if(!cursor){return}var metadata=decodeMetadata(cursor.value);var winningRev=metadata.winningRev;allDocsInner(cursor,winningRev,metadata)}function onResultsReady(){callback(null,{total_rows:docCount,offset:opts.skip,rows:results})}function onTxnComplete(){if(opts.attachments){postProcessAttachments(results).then(onResultsReady)}else{onResultsReady()}}txn.oncomplete=onTxnComplete;cursor.onsuccess=onGetCursor}function allDocs(opts,callback){if(opts.limit===0){return callback(null,{total_rows:api._meta.docCount,offset:opts.skip,rows:[]})}allDocsQuery(opts,callback)}allDocs(opts,callback)}module.exports=idbAllDocs},{"../../deps/errors":81,"../../merge":95,"./idb-constants":63,"./idb-utils":64}],61:[function(require,module,exports){"use strict";var utils=require("../../utils");var idbConstants=require("./idb-constants");var DETECT_BLOB_SUPPORT_STORE=idbConstants.DETECT_BLOB_SUPPORT_STORE;function checkBlobSupport(txn,idb){return new utils.Promise(function(resolve,reject){var blob=utils.createBlob([""],{type:"image/png"});txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob,"key");txn.oncomplete=function(){var blobTxn=idb.transaction([DETECT_BLOB_SUPPORT_STORE],"readwrite");var getBlobReq=blobTxn.objectStore(DETECT_BLOB_SUPPORT_STORE).get("key");getBlobReq.onerror=reject;getBlobReq.onsuccess=function(e){var storedBlob=e.target.result;var url=URL.createObjectURL(storedBlob);utils.ajax({url:url,cache:true,binary:true},function(err,res){if(err&&err.status===405){resolve(true)}else{resolve(!!(res&&res.type==="image/png"));if(err&&err.status===404){utils.explain404("PouchDB is just detecting blob URL support.")}}URL.revokeObjectURL(url)})}}}).catch(function(){return false})}module.exports=checkBlobSupport},{"../../utils":106,"./idb-constants":63}],62:[function(require,module,exports){"use strict";var utils=require("../../utils");var errors=require("../../deps/errors");var idbUtils=require("./idb-utils");var idbConstants=require("./idb-constants");var ATTACH_AND_SEQ_STORE=idbConstants.ATTACH_AND_SEQ_STORE;var ATTACH_STORE=idbConstants.ATTACH_STORE;var BY_SEQ_STORE=idbConstants.BY_SEQ_STORE;var DOC_STORE=idbConstants.DOC_STORE;var LOCAL_STORE=idbConstants.LOCAL_STORE;var META_STORE=idbConstants.META_STORE;var compactRevs=idbUtils.compactRevs;var decodeMetadata=idbUtils.decodeMetadata;var encodeMetadata=idbUtils.encodeMetadata;var idbError=idbUtils.idbError;var openTransactionSafely=idbUtils.openTransactionSafely;function idbBulkDocs(req,opts,api,idb,Changes,callback){var docInfos=req.docs;var txn;var docStore;var bySeqStore;var attachStore;var attachAndSeqStore;var docInfoError;var docCountDelta=0;for(var i=0,len=docInfos.length;i<len;i++){var doc=docInfos[i];if(doc._id&&utils.isLocalId(doc._id)){continue}doc=docInfos[i]=utils.parseDoc(doc,opts.new_edits);if(doc.error&&!docInfoError){docInfoError=doc}}if(docInfoError){return callback(docInfoError)}var results=new Array(docInfos.length);var fetchedDocs=new utils.Map;var preconditionErrored=false;var blobType=api._meta.blobSupport?"blob":"base64";utils.preprocessAttachments(docInfos,blobType,function(err){if(err){return callback(err)}startTransaction()});function startTransaction(){var stores=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE,LOCAL_STORE,ATTACH_AND_SEQ_STORE];var txnResult=openTransactionSafely(idb,stores,"readwrite");if(txnResult.error){return callback(txnResult.error)}txn=txnResult.txn;txn.onerror=idbError(callback);txn.ontimeout=idbError(callback);txn.oncomplete=complete;docStore=txn.objectStore(DOC_STORE);bySeqStore=txn.objectStore(BY_SEQ_STORE);attachStore=txn.objectStore(ATTACH_STORE);attachAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE);verifyAttachments(function(err){if(err){preconditionErrored=true;return callback(err)}fetchExistingDocs()})}function processDocs(){utils.processDocs(docInfos,api,fetchedDocs,txn,results,writeDoc,opts)}function fetchExistingDocs(){if(!docInfos.length){return}var numFetched=0;function checkDone(){if(++numFetched===docInfos.length){processDocs()}}function readMetadata(event){var metadata=decodeMetadata(event.target.result);if(metadata){fetchedDocs.set(metadata.id,metadata)}checkDone()}for(var i=0,len=docInfos.length;i<len;i++){var docInfo=docInfos[i];if(docInfo._id&&utils.isLocalId(docInfo._id)){checkDone();continue}var req=docStore.get(docInfo.metadata.id);req.onsuccess=readMetadata}}function complete(){if(preconditionErrored){return}Changes.notify(api._meta.name);api._meta.docCount+=docCountDelta;callback(null,results)}function verifyAttachment(digest,callback){var req=attachStore.get(digest);req.onsuccess=function(e){if(!e.target.result){var err=errors.error(errors.MISSING_STUB,"unknown stub attachment with digest "+digest);err.status=412;callback(err)}else{callback()}}}function verifyAttachments(finish){var digests=[];docInfos.forEach(function(docInfo){if(docInfo.data&&docInfo.data._attachments){Object.keys(docInfo.data._attachments).forEach(function(filename){var att=docInfo.data._attachments[filename];if(att.stub){digests.push(att.digest)}})}});if(!digests.length){return finish()}var numDone=0;var err;function checkDone(){if(++numDone===digests.length){finish(err)}}digests.forEach(function(digest){verifyAttachment(digest,function(attErr){if(attErr&&!err){err=attErr}checkDone()})})}function writeDoc(docInfo,winningRev,winningRevIsDeleted,newRevIsDeleted,isUpdate,delta,resultsIdx,callback){docCountDelta+=delta;var doc=docInfo.data;doc._id=docInfo.metadata.id;doc._rev=docInfo.metadata.rev;if(newRevIsDeleted){doc._deleted=true}var hasAttachments=doc._attachments&&Object.keys(doc._attachments).length;if(hasAttachments){return writeAttachments(docInfo,winningRev,winningRevIsDeleted,isUpdate,resultsIdx,callback)}finishDoc(docInfo,winningRev,winningRevIsDeleted,isUpdate,resultsIdx,callback)}function autoCompact(docInfo){var revsToDelete=utils.compactTree(docInfo.metadata);compactRevs(revsToDelete,docInfo.metadata.id,txn)}function finishDoc(docInfo,winningRev,winningRevIsDeleted,isUpdate,resultsIdx,callback){var doc=docInfo.data;var metadata=docInfo.metadata;doc._doc_id_rev=metadata.id+"::"+metadata.rev;delete doc._id;delete doc._rev;function afterPutDoc(e){if(isUpdate&&api.auto_compaction){autoCompact(docInfo)}metadata.seq=e.target.result;delete metadata.rev;var metadataToStore=encodeMetadata(metadata,winningRev,winningRevIsDeleted);var metaDataReq=docStore.put(metadataToStore);metaDataReq.onsuccess=afterPutMetadata}function afterPutDocError(e){e.preventDefault();e.stopPropagation();var index=bySeqStore.index("_doc_id_rev");var getKeyReq=index.getKey(doc._doc_id_rev);getKeyReq.onsuccess=function(e){var putReq=bySeqStore.put(doc,e.target.result);putReq.onsuccess=afterPutDoc}}function afterPutMetadata(){results[resultsIdx]={ok:true,id:metadata.id,rev:winningRev};fetchedDocs.set(docInfo.metadata.id,docInfo.metadata);insertAttachmentMappings(docInfo,metadata.seq,callback)}var putReq=bySeqStore.put(doc);putReq.onsuccess=afterPutDoc;putReq.onerror=afterPutDocError}function writeAttachments(docInfo,winningRev,winningRevIsDeleted,isUpdate,resultsIdx,callback){var doc=docInfo.data;var numDone=0;var attachments=Object.keys(doc._attachments);function collectResults(){if(numDone===attachments.length){finishDoc(docInfo,winningRev,winningRevIsDeleted,isUpdate,resultsIdx,callback)}}function attachmentSaved(){numDone++;collectResults()}attachments.forEach(function(key){var att=docInfo.data._attachments[key];if(!att.stub){var data=att.data;delete att.data;var digest=att.digest;saveAttachment(digest,data,attachmentSaved)}else{numDone++;collectResults()}})}function insertAttachmentMappings(docInfo,seq,callback){var attsAdded=0;var attsToAdd=Object.keys(docInfo.data._attachments||{});if(!attsToAdd.length){return callback()}function checkDone(){if(++attsAdded===attsToAdd.length){callback()}}function add(att){var digest=docInfo.data._attachments[att].digest;var req=attachAndSeqStore.put({seq:seq,digestSeq:digest+"::"+seq});req.onsuccess=checkDone;req.onerror=function(e){e.preventDefault();e.stopPropagation();checkDone()}}for(var i=0;i<attsToAdd.length;i++){add(attsToAdd[i])}}function saveAttachment(digest,data,callback){var getKeyReq=attachStore.count(digest);getKeyReq.onsuccess=function(e){var count=e.target.result;if(count){return callback()}var newAtt={digest:digest,body:data};var putReq=attachStore.put(newAtt);putReq.onsuccess=callback}}}module.exports=idbBulkDocs},{"../../deps/errors":81,"../../utils":106,"./idb-constants":63,"./idb-utils":64}],63:[function(require,module,exports){"use strict";exports.ADAPTER_VERSION=5;exports.DOC_STORE="document-store";exports.BY_SEQ_STORE="by-sequence";exports.ATTACH_STORE="attach-store";exports.ATTACH_AND_SEQ_STORE="attach-seq-store";exports.META_STORE="meta-store";exports.LOCAL_STORE="local-store";exports.DETECT_BLOB_SUPPORT_STORE="detect-blob-support"},{}],64:[function(require,module,exports){(function(process){"use strict";var errors=require("../../deps/errors");var utils=require("../../utils");var base64=require("../../deps/binary/base64");var atob=base64.atob;var btoa=base64.btoa;var constants=require("./idb-constants");var readAsBinaryString=require("../../deps/binary/readAsBinaryString");var binaryStringToArrayBuffer=require("../../deps/binary/binaryStringToArrayBuffer");function tryCode(fun,that,args){try{fun.apply(that,args)}catch(err){if(typeof PouchDB!=="undefined"){PouchDB.emit("error",err)}}}exports.taskQueue={running:false,queue:[]};exports.applyNext=function(){if(exports.taskQueue.running||!exports.taskQueue.queue.length){return}exports.taskQueue.running=true;var item=exports.taskQueue.queue.shift();item.action(function(err,res){tryCode(item.callback,this,[err,res]);exports.taskQueue.running=false;process.nextTick(exports.applyNext)})};exports.idbError=function(callback){return function(event){var message=event.target&&event.target.error&&event.target.error.name||event.target;callback(errors.error(errors.IDB_ERROR,message,event.type))}};exports.encodeMetadata=function(metadata,winningRev,deleted){return{data:utils.safeJsonStringify(metadata),winningRev:winningRev,deletedOrLocal:deleted?"1":"0",seq:metadata.seq,id:metadata.id}};exports.decodeMetadata=function(storedObject){if(!storedObject){return null}var metadata=utils.safeJsonParse(storedObject.data);metadata.winningRev=storedObject.winningRev;metadata.deleted=storedObject.deletedOrLocal==="1";metadata.seq=storedObject.seq;return metadata};exports.decodeDoc=function(doc){if(!doc){return doc}var idx=utils.lastIndexOf(doc._doc_id_rev,":");doc._id=doc._doc_id_rev.substring(0,idx-1);doc._rev=doc._doc_id_rev.substring(idx+1);delete doc._doc_id_rev;return doc};exports.readBlobData=function(body,type,encode,callback){if(encode){if(!body){callback("")}else if(typeof body!=="string"){readAsBinaryString(body,function(binary){callback(btoa(binary))})}else{callback(body)}}else{if(!body){callback(utils.createBlob([""],{type:type}))}else if(typeof body!=="string"){callback(body)}else{body=binaryStringToArrayBuffer(atob(body));callback(utils.createBlob([body],{type:type}))}}};exports.fetchAttachmentsIfNecessary=function(doc,opts,txn,cb){var attachments=Object.keys(doc._attachments||{});if(!attachments.length){return cb&&cb()}var numDone=0;function checkDone(){if(++numDone===attachments.length&&cb){cb()}}function fetchAttachment(doc,att){var attObj=doc._attachments[att];var digest=attObj.digest;var req=txn.objectStore(constants.ATTACH_STORE).get(digest);req.onsuccess=function(e){attObj.body=e.target.result.body;checkDone()}}attachments.forEach(function(att){if(opts.attachments&&opts.include_docs){fetchAttachment(doc,att)}else{doc._attachments[att].stub=true;checkDone()}})};exports.postProcessAttachments=function(results){return utils.Promise.all(results.map(function(row){if(row.doc&&row.doc._attachments){var attNames=Object.keys(row.doc._attachments);return utils.Promise.all(attNames.map(function(att){var attObj=row.doc._attachments[att];if(!("body"in attObj)){return}var body=attObj.body;var type=attObj.content_type;return new utils.Promise(function(resolve){exports.readBlobData(body,type,true,function(base64){row.doc._attachments[att]=utils.extend(utils.pick(attObj,["digest","content_type"]),{data:base64});resolve()})})}))}}))};exports.compactRevs=function(revs,docId,txn){var possiblyOrphanedDigests=[];var seqStore=txn.objectStore(constants.BY_SEQ_STORE);var attStore=txn.objectStore(constants.ATTACH_STORE);var attAndSeqStore=txn.objectStore(constants.ATTACH_AND_SEQ_STORE);var count=revs.length;function checkDone(){count--;if(!count){deleteOrphanedAttachments()}}function deleteOrphanedAttachments(){if(!possiblyOrphanedDigests.length){return}possiblyOrphanedDigests.forEach(function(digest){var countReq=attAndSeqStore.index("digestSeq").count(IDBKeyRange.bound(digest+"::",digest+"::￿",false,false));countReq.onsuccess=function(e){var count=e.target.result;if(!count){attStore.delete(digest)}}})}revs.forEach(function(rev){var index=seqStore.index("_doc_id_rev");var key=docId+"::"+rev;index.getKey(key).onsuccess=function(e){var seq=e.target.result;if(typeof seq!=="number"){return checkDone()}seqStore.delete(seq);var cursor=attAndSeqStore.index("seq").openCursor(IDBKeyRange.only(seq));cursor.onsuccess=function(event){var cursor=event.target.result;if(cursor){var digest=cursor.value.digestSeq.split("::")[0];possiblyOrphanedDigests.push(digest);attAndSeqStore.delete(cursor.primaryKey);cursor.continue()}else{checkDone()}}}})};exports.openTransactionSafely=function(idb,stores,mode){try{return{txn:idb.transaction(stores,mode)}}catch(err){return{error:err}}}}).call(this,require("_process"))},{"../../deps/binary/base64":74,"../../deps/binary/binaryStringToArrayBuffer":75,"../../deps/binary/readAsBinaryString":79,"../../deps/errors":81,"../../utils":106,"./idb-constants":63,_process:7}],65:[function(require,module,exports){(function(process){"use strict";var utils=require("../../utils");var merge=require("../../merge");var errors=require("../../deps/errors");var idbUtils=require("./idb-utils");var idbConstants=require("./idb-constants");var idbBulkDocs=require("./idb-bulk-docs");var idbAllDocs=require("./idb-all-docs");var checkBlobSupport=require("./idb-blob-support");var ADAPTER_VERSION=idbConstants.ADAPTER_VERSION;var ATTACH_AND_SEQ_STORE=idbConstants.ATTACH_AND_SEQ_STORE;var ATTACH_STORE=idbConstants.ATTACH_STORE;var BY_SEQ_STORE=idbConstants.BY_SEQ_STORE;var DETECT_BLOB_SUPPORT_STORE=idbConstants.DETECT_BLOB_SUPPORT_STORE;var DOC_STORE=idbConstants.DOC_STORE;var LOCAL_STORE=idbConstants.LOCAL_STORE;var META_STORE=idbConstants.META_STORE;var applyNext=idbUtils.applyNext;var compactRevs=idbUtils.compactRevs;var decodeDoc=idbUtils.decodeDoc;var decodeMetadata=idbUtils.decodeMetadata;var encodeMetadata=idbUtils.encodeMetadata;var fetchAttachmentsIfNecessary=idbUtils.fetchAttachmentsIfNecessary;var idbError=idbUtils.idbError;var postProcessAttachments=idbUtils.postProcessAttachments;var readBlobData=idbUtils.readBlobData;var taskQueue=idbUtils.taskQueue;var openTransactionSafely=idbUtils.openTransactionSafely;var cachedDBs={};var blobSupportPromise;function IdbPouch(opts,callback){var api=this;taskQueue.queue.push({action:function(thisCallback){init(api,opts,thisCallback)},callback:callback});applyNext()}function init(api,opts,callback){var dbName=opts.name;var idb=null;api._meta=null;function createSchema(db){var docStore=db.createObjectStore(DOC_STORE,{keyPath:"id"});db.createObjectStore(BY_SEQ_STORE,{autoIncrement:true}).createIndex("_doc_id_rev","_doc_id_rev",{unique:true});db.createObjectStore(ATTACH_STORE,{keyPath:"digest"});db.createObjectStore(META_STORE,{keyPath:"id",autoIncrement:false});db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);docStore.createIndex("deletedOrLocal","deletedOrLocal",{unique:false});db.createObjectStore(LOCAL_STORE,{keyPath:"_id"});var attAndSeqStore=db.createObjectStore(ATTACH_AND_SEQ_STORE,{autoIncrement:true});attAndSeqStore.createIndex("seq","seq");attAndSeqStore.createIndex("digestSeq","digestSeq",{unique:true})}function addDeletedOrLocalIndex(txn,callback){var docStore=txn.objectStore(DOC_STORE);docStore.createIndex("deletedOrLocal","deletedOrLocal",{unique:false});docStore.openCursor().onsuccess=function(event){var cursor=event.target.result;if(cursor){var metadata=cursor.value;var deleted=utils.isDeleted(metadata);metadata.deletedOrLocal=deleted?"1":"0";docStore.put(metadata);cursor.continue()}else{callback()}}}function createLocalStoreSchema(db){db.createObjectStore(LOCAL_STORE,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:true})}function migrateLocalStore(txn,cb){var localStore=txn.objectStore(LOCAL_STORE);var docStore=txn.objectStore(DOC_STORE);var seqStore=txn.objectStore(BY_SEQ_STORE);var cursor=docStore.openCursor();cursor.onsuccess=function(event){var cursor=event.target.result;if(cursor){var metadata=cursor.value;var docId=metadata.id;var local=utils.isLocalId(docId);var rev=merge.winningRev(metadata);if(local){var docIdRev=docId+"::"+rev;var start=docId+"::";var end=docId+"::~";var index=seqStore.index("_doc_id_rev");var range=IDBKeyRange.bound(start,end,false,false);var seqCursor=index.openCursor(range);seqCursor.onsuccess=function(e){seqCursor=e.target.result;if(!seqCursor){docStore.delete(cursor.primaryKey);cursor.continue()}else{var data=seqCursor.value;if(data._doc_id_rev===docIdRev){localStore.put(data)}seqStore.delete(seqCursor.primaryKey);seqCursor.continue()}}}else{cursor.continue()}}else if(cb){cb()}}}function addAttachAndSeqStore(db){var attAndSeqStore=db.createObjectStore(ATTACH_AND_SEQ_STORE,{autoIncrement:true});attAndSeqStore.createIndex("seq","seq");attAndSeqStore.createIndex("digestSeq","digestSeq",{unique:true})}function migrateAttsAndSeqs(txn,callback){var seqStore=txn.objectStore(BY_SEQ_STORE);var attStore=txn.objectStore(ATTACH_STORE);var attAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE);var req=attStore.count();req.onsuccess=function(e){var count=e.target.result;if(!count){return callback()}seqStore.openCursor().onsuccess=function(e){var cursor=e.target.result;if(!cursor){return callback()}var doc=cursor.value;var seq=cursor.primaryKey;var atts=Object.keys(doc._attachments||{});var digestMap={};for(var j=0;j<atts.length;j++){var att=doc._attachments[atts[j]];digestMap[att.digest]=true}var digests=Object.keys(digestMap);for(j=0;j<digests.length;j++){var digest=digests[j];attAndSeqStore.put({seq:seq,digestSeq:digest+"::"+seq})}cursor.continue()}}}function migrateMetadata(txn){function decodeMetadataCompat(storedObject){if(!storedObject.data){storedObject.deleted=storedObject.deletedOrLocal==="1";return storedObject}return decodeMetadata(storedObject)}var bySeqStore=txn.objectStore(BY_SEQ_STORE);var docStore=txn.objectStore(DOC_STORE);var cursor=docStore.openCursor();cursor.onsuccess=function(e){var cursor=e.target.result;if(!cursor){return}var metadata=decodeMetadataCompat(cursor.value);metadata.winningRev=metadata.winningRev||merge.winningRev(metadata);function fetchMetadataSeq(){var start=metadata.id+"::";var end=metadata.id+"::￿";var req=bySeqStore.index("_doc_id_rev").openCursor(IDBKeyRange.bound(start,end));var metadataSeq=0;req.onsuccess=function(e){var cursor=e.target.result;if(!cursor){metadata.seq=metadataSeq;return onGetMetadataSeq()}var seq=cursor.primaryKey;if(seq>metadataSeq){metadataSeq=seq}cursor.continue()}}function onGetMetadataSeq(){var metadataToStore=encodeMetadata(metadata,metadata.winningRev,metadata.deleted);var req=docStore.put(metadataToStore);req.onsuccess=function(){cursor.continue()}}if(metadata.seq){return onGetMetadataSeq()}fetchMetadataSeq()}}api.type=function(){return"idb"};api._id=utils.toPromise(function(callback){callback(null,api._meta.instanceId)});api._bulkDocs=function idb_bulkDocs(req,opts,callback){idbBulkDocs(req,opts,api,idb,IdbPouch.Changes,callback)};api._get=function idb_get(id,opts,callback){var doc;var metadata;var err;var txn;opts=utils.clone(opts);if(opts.ctx){txn=opts.ctx}else{var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");if(txnResult.error){return callback(txnResult.error)}txn=txnResult.txn}function finish(){callback(err,{doc:doc,metadata:metadata,ctx:txn})}txn.objectStore(DOC_STORE).get(id).onsuccess=function(e){metadata=decodeMetadata(e.target.result);if(!metadata){err=errors.error(errors.MISSING_DOC,"missing");return finish()}if(utils.isDeleted(metadata)&&!opts.rev){err=errors.error(errors.MISSING_DOC,"deleted");return finish()}var objectStore=txn.objectStore(BY_SEQ_STORE);var rev=opts.rev||metadata.winningRev;var key=metadata.id+"::"+rev;objectStore.index("_doc_id_rev").get(key).onsuccess=function(e){doc=e.target.result;if(doc){doc=decodeDoc(doc)}if(!doc){err=errors.error(errors.MISSING_DOC,"missing");return finish()}finish()}}};api._getAttachment=function(attachment,opts,callback){var txn;opts=utils.clone(opts);if(opts.ctx){txn=opts.ctx}else{var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");if(txnResult.error){return callback(txnResult.error)}txn=txnResult.txn}var digest=attachment.digest;var type=attachment.content_type;txn.objectStore(ATTACH_STORE).get(digest).onsuccess=function(e){var body=e.target.result.body;readBlobData(body,type,opts.encode,function(blobData){callback(null,blobData)})}};api._info=function idb_info(callback){if(idb===null||!cachedDBs[dbName]){var error=new Error("db isn't open");error.id="idbNull";return callback(error)}var updateSeq;var docCount;var txnResult=openTransactionSafely(idb,[BY_SEQ_STORE],"readonly");if(txnResult.error){return callback(txnResult.error)}var txn=txnResult.txn;var cursor=txn.objectStore(BY_SEQ_STORE).openCursor(null,"prev");cursor.onsuccess=function(event){var cursor=event.target.result;updateSeq=cursor?cursor.key:0;docCount=api._meta.docCount};txn.oncomplete=function(){callback(null,{doc_count:docCount,update_seq:updateSeq,idb_attachment_format:api._meta.blobSupport?"binary":"base64"})}};api._allDocs=function idb_allDocs(opts,callback){idbAllDocs(opts,api,idb,callback)};api._changes=function(opts){opts=utils.clone(opts);if(opts.continuous){var id=dbName+":"+utils.uuid();IdbPouch.Changes.addListener(dbName,id,api,opts);IdbPouch.Changes.notify(dbName);return{cancel:function(){IdbPouch.Changes.removeListener(dbName,id)}}}var docIds=opts.doc_ids&&new utils.Set(opts.doc_ids);var descending=opts.descending?"prev":null;opts.since=opts.since||0;var lastSeq=opts.since;var limit="limit"in opts?opts.limit:-1;if(limit===0){limit=1}var returnDocs;if("returnDocs"in opts){returnDocs=opts.returnDocs}else{returnDocs=true}var results=[];var numResults=0;var filter=utils.filterChange(opts);var docIdsToMetadata=new utils.Map;var txn;var bySeqStore;var docStore;function onGetCursor(cursor){var doc=decodeDoc(cursor.value);var seq=cursor.key;if(docIds&&!docIds.has(doc._id)){return cursor.continue()}var metadata;function onGetMetadata(){if(metadata.seq!==seq){return cursor.continue()}lastSeq=seq;if(metadata.winningRev===doc._rev){return onGetWinningDoc(doc)}fetchWinningDoc()}function fetchWinningDoc(){var docIdRev=doc._id+"::"+metadata.winningRev;var req=bySeqStore.index("_doc_id_rev").openCursor(IDBKeyRange.bound(docIdRev,docIdRev+"￿"));req.onsuccess=function(e){onGetWinningDoc(decodeDoc(e.target.result.value))}}function onGetWinningDoc(winningDoc){var change=opts.processChange(winningDoc,metadata,opts);change.seq=metadata.seq;if(filter(change)){numResults++;if(returnDocs){results.push(change)}if(opts.attachments&&opts.include_docs){fetchAttachmentsIfNecessary(winningDoc,opts,txn,function(){postProcessAttachments([change]).then(function(){opts.onChange(change)})})}else{opts.onChange(change)}}if(numResults!==limit){cursor.continue()}}metadata=docIdsToMetadata.get(doc._id);if(metadata){return onGetMetadata()}docStore.get(doc._id).onsuccess=function(event){metadata=decodeMetadata(event.target.result);docIdsToMetadata.set(doc._id,metadata);onGetMetadata()}}function onsuccess(event){var cursor=event.target.result;if(!cursor){return}onGetCursor(cursor)}function fetchChanges(){var objectStores=[DOC_STORE,BY_SEQ_STORE];if(opts.attachments){objectStores.push(ATTACH_STORE)}var txnResult=openTransactionSafely(idb,objectStores,"readonly");if(txnResult.error){return opts.complete(txnResult.error)}txn=txnResult.txn;txn.onerror=idbError(opts.complete);txn.oncomplete=onTxnComplete;bySeqStore=txn.objectStore(BY_SEQ_STORE);docStore=txn.objectStore(DOC_STORE);var req;if(descending){req=bySeqStore.openCursor(null,descending)}else{req=bySeqStore.openCursor(IDBKeyRange.lowerBound(opts.since,true))}req.onsuccess=onsuccess}fetchChanges();function onTxnComplete(){function finish(){opts.complete(null,{results:results,last_seq:lastSeq})}if(!opts.continuous&&opts.attachments){postProcessAttachments(results).then(finish)}else{finish()}}};api._close=function(callback){if(idb===null){return callback(errors.error(errors.NOT_OPEN))}idb.close();delete cachedDBs[dbName];idb=null;callback()};api._getRevisionTree=function(docId,callback){var txnResult=openTransactionSafely(idb,[DOC_STORE],"readonly");if(txnResult.error){return callback(txnResult.error)}var txn=txnResult.txn;var req=txn.objectStore(DOC_STORE).get(docId);req.onsuccess=function(event){var doc=decodeMetadata(event.target.result);if(!doc){callback(errors.error(errors.MISSING_DOC))}else{callback(null,doc.rev_tree)}}};api._doCompaction=function(docId,revs,callback){var stores=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,ATTACH_AND_SEQ_STORE];var txnResult=openTransactionSafely(idb,stores,"readwrite");if(txnResult.error){return callback(txnResult.error)}var txn=txnResult.txn;var docStore=txn.objectStore(DOC_STORE);docStore.get(docId).onsuccess=function(event){var metadata=decodeMetadata(event.target.result);merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;if(revs.indexOf(rev)!==-1){opts.status="missing"}});compactRevs(revs,docId,txn);var winningRev=metadata.winningRev;var deleted=metadata.deleted;txn.objectStore(DOC_STORE).put(encodeMetadata(metadata,winningRev,deleted))};txn.onerror=idbError(callback);txn.oncomplete=function(){utils.call(callback)}};api._getLocal=function(id,callback){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readonly");if(txnResult.error){return callback(txnResult.error)}var tx=txnResult.txn;var req=tx.objectStore(LOCAL_STORE).get(id);req.onerror=idbError(callback);req.onsuccess=function(e){var doc=e.target.result;if(!doc){callback(errors.error(errors.MISSING_DOC))}else{delete doc["_doc_id_rev"];callback(null,doc)}}};api._putLocal=function(doc,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}delete doc._revisions;var oldRev=doc._rev;var id=doc._id;if(!oldRev){doc._rev="0-1"}else{doc._rev="0-"+(parseInt(oldRev.split("-")[1],10)+1)}var tx=opts.ctx;var ret;if(!tx){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readwrite");if(txnResult.error){return callback(txnResult.error)}tx=txnResult.txn;tx.onerror=idbError(callback);tx.oncomplete=function(){if(ret){callback(null,ret)}}}var oStore=tx.objectStore(LOCAL_STORE);var req;if(oldRev){req=oStore.get(id);req.onsuccess=function(e){var oldDoc=e.target.result;if(!oldDoc||oldDoc._rev!==oldRev){callback(errors.error(errors.REV_CONFLICT))}else{var req=oStore.put(doc);req.onsuccess=function(){ret={ok:true,id:doc._id,rev:doc._rev};if(opts.ctx){callback(null,ret)}}}}}else{req=oStore.add(doc);req.onerror=function(e){callback(errors.error(errors.REV_CONFLICT));e.preventDefault();e.stopPropagation()};req.onsuccess=function(){ret={ok:true,id:doc._id,rev:doc._rev};if(opts.ctx){callback(null,ret)}}}};api._removeLocal=function(doc,callback){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readwrite");if(txnResult.error){return callback(txnResult.error)}var tx=txnResult.txn;var ret;tx.oncomplete=function(){if(ret){callback(null,ret)}};var id=doc._id;var oStore=tx.objectStore(LOCAL_STORE);var req=oStore.get(id);req.onerror=idbError(callback);req.onsuccess=function(e){var oldDoc=e.target.result;if(!oldDoc||oldDoc._rev!==doc._rev){callback(errors.error(errors.MISSING_DOC))}else{oStore.delete(id);ret={ok:true,id:id,rev:"0-0"}}}};api._destroy=function(callback){IdbPouch.Changes.removeAllListeners(dbName);if(IdbPouch.openReqList[dbName]&&IdbPouch.openReqList[dbName].result){IdbPouch.openReqList[dbName].result.close();delete cachedDBs[dbName]}var req=indexedDB.deleteDatabase(dbName);req.onsuccess=function(){if(IdbPouch.openReqList[dbName]){IdbPouch.openReqList[dbName]=null}if(utils.hasLocalStorage()&&dbName in localStorage){delete localStorage[dbName]}callback(null,{ok:true})};req.onerror=idbError(callback)};var cached=cachedDBs[dbName];if(cached){idb=cached.idb;api._meta=cached.global;process.nextTick(function(){callback(null,api)});return}var req=indexedDB.open(dbName,ADAPTER_VERSION);if(!("openReqList"in IdbPouch)){IdbPouch.openReqList={}}IdbPouch.openReqList[dbName]=req;req.onupgradeneeded=function(e){var db=e.target.result;if(e.oldVersion<1){return createSchema(db)}var txn=e.currentTarget.transaction;if(e.oldVersion<3){createLocalStoreSchema(db)}if(e.oldVersion<4){addAttachAndSeqStore(db)}var migrations=[addDeletedOrLocalIndex,migrateLocalStore,migrateAttsAndSeqs,migrateMetadata];var i=e.oldVersion;function next(){var migration=migrations[i-1];i++;if(migration){migration(txn,next)}}next()};req.onsuccess=function(e){idb=e.target.result;idb.onversionchange=function(){idb.close();delete cachedDBs[dbName]};idb.onabort=function(){idb.close();delete cachedDBs[dbName]};var txn=idb.transaction([META_STORE,DETECT_BLOB_SUPPORT_STORE,DOC_STORE],"readwrite");var req=txn.objectStore(META_STORE).get(META_STORE);var blobSupport=null;var docCount=null;var instanceId=null;req.onsuccess=function(e){var checkSetupComplete=function(){if(blobSupport===null||docCount===null||instanceId===null){return}else{api._meta={name:dbName,instanceId:instanceId,blobSupport:blobSupport,docCount:docCount};cachedDBs[dbName]={idb:idb,global:api._meta};callback(null,api)}};var meta=e.target.result||{id:META_STORE};if(dbName+"_id"in meta){instanceId=meta[dbName+"_id"];checkSetupComplete()}else{instanceId=utils.uuid();meta[dbName+"_id"]=instanceId;txn.objectStore(META_STORE).put(meta).onsuccess=function(){checkSetupComplete()}}if(!blobSupportPromise){blobSupportPromise=checkBlobSupport(txn,idb)}blobSupportPromise.then(function(val){blobSupport=val;checkSetupComplete()});var index=txn.objectStore(DOC_STORE).index("deletedOrLocal");index.count(IDBKeyRange.only("0")).onsuccess=function(e){docCount=e.target.result;checkSetupComplete()}}};req.onerror=idbError(callback)}IdbPouch.valid=function(){var isSafari=typeof openDatabase!=="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!isSafari&&typeof indexedDB!=="undefined"&&typeof IDBKeyRange!=="undefined"};IdbPouch.Changes=new utils.Changes;module.exports=IdbPouch}).call(this,require("_process"))},{"../../deps/errors":81,"../../merge":95,"../../utils":106,"./idb-all-docs":60,"./idb-blob-support":61,"./idb-bulk-docs":62,"./idb-constants":63,"./idb-utils":64,_process:7}],66:[function(require,module,exports){"use strict";var utils=require("../../utils");var errors=require("../../deps/errors");var websqlUtils=require("./websql-utils");var websqlConstants=require("./websql-constants");var DOC_STORE=websqlConstants.DOC_STORE;

var BY_SEQ_STORE=websqlConstants.BY_SEQ_STORE;var ATTACH_STORE=websqlConstants.ATTACH_STORE;var ATTACH_AND_SEQ_STORE=websqlConstants.ATTACH_AND_SEQ_STORE;var select=websqlUtils.select;var stringifyDoc=websqlUtils.stringifyDoc;var compactRevs=websqlUtils.compactRevs;var unknownError=websqlUtils.unknownError;function websqlBulkDocs(req,opts,api,db,Changes,callback){var newEdits=opts.new_edits;var userDocs=req.docs;var docInfos=userDocs.map(function(doc){if(doc._id&&utils.isLocalId(doc._id)){return doc}var newDoc=utils.parseDoc(doc,newEdits);return newDoc});var docInfoErrors=docInfos.filter(function(docInfo){return docInfo.error});if(docInfoErrors.length){return callback(docInfoErrors[0])}var tx;var results=new Array(docInfos.length);var fetchedDocs=new utils.Map;var preconditionErrored;function complete(){if(preconditionErrored){return callback(preconditionErrored)}Changes.notify(api._name);api._docCount=-1;callback(null,results)}function verifyAttachment(digest,callback){var sql="SELECT count(*) as cnt FROM "+ATTACH_STORE+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){if(result.rows.item(0).cnt===0){var err=errors.error(errors.MISSING_STUB,"unknown stub attachment with digest "+digest);callback(err)}else{callback()}})}function verifyAttachments(finish){var digests=[];docInfos.forEach(function(docInfo){if(docInfo.data&&docInfo.data._attachments){Object.keys(docInfo.data._attachments).forEach(function(filename){var att=docInfo.data._attachments[filename];if(att.stub){digests.push(att.digest)}})}});if(!digests.length){return finish()}var numDone=0;var err;function checkDone(){if(++numDone===digests.length){finish(err)}}digests.forEach(function(digest){verifyAttachment(digest,function(attErr){if(attErr&&!err){err=attErr}checkDone()})})}function writeDoc(docInfo,winningRev,winningRevIsDeleted,newRevIsDeleted,isUpdate,delta,resultsIdx,callback){function finish(){var data=docInfo.data;var deletedInt=newRevIsDeleted?1:0;var id=data._id;var rev=data._rev;var json=stringifyDoc(data);var sql="INSERT INTO "+BY_SEQ_STORE+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);";var sqlArgs=[id,rev,json,deletedInt];function insertAttachmentMappings(seq,callback){var attsAdded=0;var attsToAdd=Object.keys(data._attachments||{});if(!attsToAdd.length){return callback()}function checkDone(){if(++attsAdded===attsToAdd.length){callback()}return false}function add(att){var sql="INSERT INTO "+ATTACH_AND_SEQ_STORE+" (digest, seq) VALUES (?,?)";var sqlArgs=[data._attachments[att].digest,seq];tx.executeSql(sql,sqlArgs,checkDone,checkDone)}for(var i=0;i<attsToAdd.length;i++){add(attsToAdd[i])}}tx.executeSql(sql,sqlArgs,function(tx,result){var seq=result.insertId;insertAttachmentMappings(seq,function(){dataWritten(tx,seq)})},function(){var fetchSql=select("seq",BY_SEQ_STORE,null,"doc_id=? AND rev=?");tx.executeSql(fetchSql,[id,rev],function(tx,res){var seq=res.rows.item(0).seq;var sql="UPDATE "+BY_SEQ_STORE+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;";var sqlArgs=[json,deletedInt,id,rev];tx.executeSql(sql,sqlArgs,function(tx){insertAttachmentMappings(seq,function(){dataWritten(tx,seq)})})});return false})}function collectResults(attachmentErr){if(!err){if(attachmentErr){err=attachmentErr;callback(err)}else if(recv===attachments.length){finish()}}}var err=null;var recv=0;docInfo.data._id=docInfo.metadata.id;docInfo.data._rev=docInfo.metadata.rev;var attachments=Object.keys(docInfo.data._attachments||{});if(newRevIsDeleted){docInfo.data._deleted=true}function attachmentSaved(err){recv++;collectResults(err)}attachments.forEach(function(key){var att=docInfo.data._attachments[key];if(!att.stub){var data=att.data;delete att.data;var digest=att.digest;saveAttachment(digest,data,attachmentSaved)}else{recv++;collectResults()}});if(!attachments.length){finish()}function autoCompact(){if(!isUpdate||!api.auto_compaction){return}var id=docInfo.metadata.id;var revsToDelete=utils.compactTree(docInfo.metadata);compactRevs(revsToDelete,id,tx)}function dataWritten(tx,seq){autoCompact();docInfo.metadata.seq=seq;delete docInfo.metadata.rev;var sql=isUpdate?"UPDATE "+DOC_STORE+" SET json=?, max_seq=?, winningseq="+"(SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id="+DOC_STORE+".id AND rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);";var metadataStr=utils.safeJsonStringify(docInfo.metadata);var id=docInfo.metadata.id;var params=isUpdate?[metadataStr,seq,winningRev,id]:[id,seq,seq,metadataStr];tx.executeSql(sql,params,function(){results[resultsIdx]={ok:true,id:docInfo.metadata.id,rev:winningRev};fetchedDocs.set(id,docInfo.metadata);callback()})}}function processDocs(){utils.processDocs(docInfos,api,fetchedDocs,tx,results,writeDoc,opts)}function fetchExistingDocs(callback){if(!docInfos.length){return callback()}var numFetched=0;function checkDone(){if(++numFetched===docInfos.length){callback()}}docInfos.forEach(function(docInfo){if(docInfo._id&&utils.isLocalId(docInfo._id)){return checkDone()}var id=docInfo.metadata.id;tx.executeSql("SELECT json FROM "+DOC_STORE+" WHERE id = ?",[id],function(tx,result){if(result.rows.length){var metadata=utils.safeJsonParse(result.rows.item(0).json);fetchedDocs.set(id,metadata)}checkDone()})})}function saveAttachment(digest,data,callback){var sql="SELECT digest FROM "+ATTACH_STORE+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){if(result.rows.length){return callback()}sql="INSERT INTO "+ATTACH_STORE+" (digest, body, escaped) VALUES (?,?,1)";tx.executeSql(sql,[digest,websqlUtils.escapeBlob(data)],function(){callback()},function(){callback();return false})})}utils.preprocessAttachments(docInfos,"binary",function(err){if(err){return callback(err)}db.transaction(function(txn){tx=txn;verifyAttachments(function(err){if(err){preconditionErrored=err}else{fetchExistingDocs(processDocs)}})},unknownError(callback),complete)})}module.exports=websqlBulkDocs},{"../../deps/errors":81,"../../utils":106,"./websql-constants":67,"./websql-utils":68}],67:[function(require,module,exports){"use strict";function quote(str){return"'"+str+"'"}exports.ADAPTER_VERSION=7;exports.DOC_STORE=quote("document-store");exports.BY_SEQ_STORE=quote("by-sequence");exports.ATTACH_STORE=quote("attach-store");exports.LOCAL_STORE=quote("local-store");exports.META_STORE=quote("metadata-store");exports.ATTACH_AND_SEQ_STORE=quote("attach-seq-store")},{}],68:[function(require,module,exports){"use strict";var utils=require("../../utils");var errors=require("../../deps/errors");var websqlConstants=require("./websql-constants");var BY_SEQ_STORE=websqlConstants.BY_SEQ_STORE;var ATTACH_STORE=websqlConstants.ATTACH_STORE;var ATTACH_AND_SEQ_STORE=websqlConstants.ATTACH_AND_SEQ_STORE;function escapeBlob(str){return str.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function unescapeBlob(str){return str.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function stringifyDoc(doc){delete doc._id;delete doc._rev;return JSON.stringify(doc)}function unstringifyDoc(doc,id,rev){doc=JSON.parse(doc);doc._id=id;doc._rev=rev;return doc}function qMarks(num){var s="(";while(num--){s+="?";if(num){s+=","}}return s+")"}function select(selector,table,joiner,where,orderBy){return"SELECT "+selector+" FROM "+(typeof table==="string"?table:table.join(" JOIN "))+(joiner?" ON "+joiner:"")+(where?" WHERE "+(typeof where==="string"?where:where.join(" AND ")):"")+(orderBy?" ORDER BY "+orderBy:"")}function compactRevs(revs,docId,tx){if(!revs.length){return}var numDone=0;var seqs=[];function checkDone(){if(++numDone===revs.length){deleteOrphans()}}function deleteOrphans(){if(!seqs.length){return}var sql="SELECT DISTINCT digest AS digest FROM "+ATTACH_AND_SEQ_STORE+" WHERE seq IN "+qMarks(seqs.length);tx.executeSql(sql,seqs,function(tx,res){var digestsToCheck=[];for(var i=0;i<res.rows.length;i++){digestsToCheck.push(res.rows.item(i).digest)}if(!digestsToCheck.length){return}var sql="DELETE FROM "+ATTACH_AND_SEQ_STORE+" WHERE seq IN ("+seqs.map(function(){return"?"}).join(",")+")";tx.executeSql(sql,seqs,function(tx){var sql="SELECT digest FROM "+ATTACH_AND_SEQ_STORE+" WHERE digest IN ("+digestsToCheck.map(function(){return"?"}).join(",")+")";tx.executeSql(sql,digestsToCheck,function(tx,res){var nonOrphanedDigests=new utils.Set;for(var i=0;i<res.rows.length;i++){nonOrphanedDigests.add(res.rows.item(i).digest)}digestsToCheck.forEach(function(digest){if(nonOrphanedDigests.has(digest)){return}tx.executeSql("DELETE FROM "+ATTACH_AND_SEQ_STORE+" WHERE digest=?",[digest]);tx.executeSql("DELETE FROM "+ATTACH_STORE+" WHERE digest=?",[digest])})})})})}revs.forEach(function(rev){var sql="SELECT seq FROM "+BY_SEQ_STORE+" WHERE doc_id=? AND rev=?";tx.executeSql(sql,[docId,rev],function(tx,res){if(!res.rows.length){return checkDone()}var seq=res.rows.item(0).seq;seqs.push(seq);tx.executeSql("DELETE FROM "+BY_SEQ_STORE+" WHERE seq=?",[seq],checkDone)})})}function unknownError(callback){return function(event){var errorNameMatch=event&&event.constructor.toString().match(/function ([^\(]+)/);var errorName=errorNameMatch&&errorNameMatch[1]||event.type;var errorReason=event.target||event.message;callback(errors.error(errors.WSQ_ERROR,errorReason,errorName))}}function getSize(opts){if("size"in opts){return opts.size*1e6}var isAndroid=/Android/.test(window.navigator.userAgent);return isAndroid?5e6:1}function createOpenDBFunction(){if(typeof sqlitePlugin!=="undefined"){return sqlitePlugin.openDatabase.bind(sqlitePlugin)}if(typeof openDatabase!=="undefined"){return function openDB(opts){return openDatabase(opts.name,opts.version,opts.description,opts.size)}}}var cachedDatabases={};function openDB(opts){var openDBFunction=createOpenDBFunction();var db=cachedDatabases[opts.name];if(!db){db=cachedDatabases[opts.name]=openDBFunction(opts);db._sqlitePlugin=typeof sqlitePlugin!=="undefined"}return db}function valid(){return typeof openDatabase!=="undefined"||typeof SQLitePlugin!=="undefined"}module.exports={escapeBlob:escapeBlob,unescapeBlob:unescapeBlob,stringifyDoc:stringifyDoc,unstringifyDoc:unstringifyDoc,qMarks:qMarks,select:select,compactRevs:compactRevs,unknownError:unknownError,getSize:getSize,openDB:openDB,valid:valid}},{"../../deps/errors":81,"../../utils":106,"./websql-constants":67}],69:[function(require,module,exports){"use strict";var utils=require("../../utils");var merge=require("../../merge");var errors=require("../../deps/errors");var parseHexString=require("../../deps/parse-hex");var binaryStringToBlob=require("../../deps/binary/binaryStringToBlob");var websqlConstants=require("./websql-constants");var websqlUtils=require("./websql-utils");var websqlBulkDocs=require("./websql-bulk-docs");var ADAPTER_VERSION=websqlConstants.ADAPTER_VERSION;var DOC_STORE=websqlConstants.DOC_STORE;var BY_SEQ_STORE=websqlConstants.BY_SEQ_STORE;var ATTACH_STORE=websqlConstants.ATTACH_STORE;var LOCAL_STORE=websqlConstants.LOCAL_STORE;var META_STORE=websqlConstants.META_STORE;var ATTACH_AND_SEQ_STORE=websqlConstants.ATTACH_AND_SEQ_STORE;var qMarks=websqlUtils.qMarks;var stringifyDoc=websqlUtils.stringifyDoc;var unstringifyDoc=websqlUtils.unstringifyDoc;var select=websqlUtils.select;var compactRevs=websqlUtils.compactRevs;var unknownError=websqlUtils.unknownError;var getSize=websqlUtils.getSize;var openDB=websqlUtils.openDB;function fetchAttachmentsIfNecessary(doc,opts,api,txn,cb){var attachments=Object.keys(doc._attachments||{});if(!attachments.length){return cb&&cb()}var numDone=0;function checkDone(){if(++numDone===attachments.length&&cb){cb()}}function fetchAttachment(doc,att){var attObj=doc._attachments[att];var attOpts={encode:true,ctx:txn};api._getAttachment(attObj,attOpts,function(_,base64){doc._attachments[att]=utils.extend(utils.pick(attObj,["digest","content_type"]),{data:base64});checkDone()})}attachments.forEach(function(att){if(opts.attachments&&opts.include_docs){fetchAttachment(doc,att)}else{doc._attachments[att].stub=true;checkDone()}})}var POUCH_VERSION=1;var BY_SEQ_STORE_DELETED_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+BY_SEQ_STORE+" (seq, deleted)";var BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+BY_SEQ_STORE+" (doc_id, rev)";var DOC_STORE_WINNINGSEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+DOC_STORE+" (winningseq)";var ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ATTACH_AND_SEQ_STORE+" (seq)";var ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ATTACH_AND_SEQ_STORE+" (digest, seq)";var DOC_STORE_AND_BY_SEQ_JOINER=BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";var SELECT_DOCS=BY_SEQ_STORE+".seq AS seq, "+BY_SEQ_STORE+".deleted AS deleted, "+BY_SEQ_STORE+".json AS data, "+BY_SEQ_STORE+".rev AS rev, "+DOC_STORE+".json AS metadata";function WebSqlPouch(opts,callback){var api=this;var instanceId=null;var size=getSize(opts);var idRequests=[];var encoding;api._docCount=-1;api._name=opts.name;var db=openDB({name:api._name,version:POUCH_VERSION,description:api._name,size:size,location:opts.location,createFromLocation:opts.createFromLocation,androidDatabaseImplementation:opts.androidDatabaseImplementation});if(!db){return callback(errors.error(errors.UNKNOWN_ERROR))}else if(typeof db.readTransaction!=="function"){db.readTransaction=db.transaction}function dbCreated(){if(utils.hasLocalStorage()){window.localStorage["_pouch__websqldb_"+api._name]=true}callback(null,api)}function runMigration2(tx,callback){tx.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL);tx.executeSql("ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){tx.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL);tx.executeSql("ALTER TABLE "+DOC_STORE+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){tx.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+DOC_STORE+" (local, id)");var sql="SELECT "+DOC_STORE+".winningseq AS seq, "+DOC_STORE+".json AS metadata FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq";tx.executeSql(sql,[],function(tx,result){var deleted=[];var local=[];for(var i=0;i<result.rows.length;i++){var item=result.rows.item(i);var seq=item.seq;var metadata=JSON.parse(item.metadata);if(utils.isDeleted(metadata)){deleted.push(seq)}if(utils.isLocalId(metadata.id)){local.push(metadata.id)}}tx.executeSql("UPDATE "+DOC_STORE+"SET local = 1 WHERE id IN "+qMarks(local.length),local,function(){tx.executeSql("UPDATE "+BY_SEQ_STORE+" SET deleted = 1 WHERE seq IN "+qMarks(deleted.length),deleted,callback)})})})})}function runMigration3(tx,callback){var local="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE+" (id UNIQUE, rev, json)";tx.executeSql(local,[],function(){var sql="SELECT "+DOC_STORE+".id AS id, "+BY_SEQ_STORE+".json AS data "+"FROM "+BY_SEQ_STORE+" JOIN "+DOC_STORE+" ON "+BY_SEQ_STORE+".seq = "+DOC_STORE+".winningseq WHERE local = 1";tx.executeSql(sql,[],function(tx,res){var rows=[];for(var i=0;i<res.rows.length;i++){rows.push(res.rows.item(i))}function doNext(){if(!rows.length){return callback(tx)}var row=rows.shift();var rev=JSON.parse(row.data)._rev;tx.executeSql("INSERT INTO "+LOCAL_STORE+" (id, rev, json) VALUES (?,?,?)",[row.id,rev,row.data],function(tx){tx.executeSql("DELETE FROM "+DOC_STORE+" WHERE id=?",[row.id],function(tx){tx.executeSql("DELETE FROM "+BY_SEQ_STORE+" WHERE seq=?",[row.seq],function(){doNext()})})})}doNext()})})}function runMigration4(tx,callback){function updateRows(rows){function doNext(){if(!rows.length){return callback(tx)}var row=rows.shift();var doc_id_rev=parseHexString(row.hex,encoding);var idx=doc_id_rev.lastIndexOf("::");var doc_id=doc_id_rev.substring(0,idx);var rev=doc_id_rev.substring(idx+2);var sql="UPDATE "+BY_SEQ_STORE+" SET doc_id=?, rev=? WHERE doc_id_rev=?";tx.executeSql(sql,[doc_id,rev,doc_id_rev],function(){doNext()})}doNext()}var sql="ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN doc_id";tx.executeSql(sql,[],function(tx){var sql="ALTER TABLE "+BY_SEQ_STORE+" ADD COLUMN rev";tx.executeSql(sql,[],function(tx){tx.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL,[],function(tx){var sql="SELECT hex(doc_id_rev) as hex FROM "+BY_SEQ_STORE;tx.executeSql(sql,[],function(tx,res){var rows=[];for(var i=0;i<res.rows.length;i++){rows.push(res.rows.item(i))}updateRows(rows)})})})})}function runMigration5(tx,callback){function migrateAttsAndSeqs(tx){var sql="SELECT COUNT(*) AS cnt FROM "+ATTACH_STORE;tx.executeSql(sql,[],function(tx,res){var count=res.rows.item(0).cnt;if(!count){return callback(tx)}var offset=0;var pageSize=10;function nextPage(){var sql=select(SELECT_DOCS+", "+DOC_STORE+".id AS id",[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,null,DOC_STORE+".id ");sql+=" LIMIT "+pageSize+" OFFSET "+offset;offset+=pageSize;tx.executeSql(sql,[],function(tx,res){if(!res.rows.length){return callback(tx)}var digestSeqs={};function addDigestSeq(digest,seq){var seqs=digestSeqs[digest]=digestSeqs[digest]||[];if(seqs.indexOf(seq)===-1){seqs.push(seq)}}for(var i=0;i<res.rows.length;i++){var row=res.rows.item(i);var doc=unstringifyDoc(row.data,row.id,row.rev);var atts=Object.keys(doc._attachments||{});for(var j=0;j<atts.length;j++){var att=doc._attachments[atts[j]];addDigestSeq(att.digest,row.seq)}}var digestSeqPairs=[];Object.keys(digestSeqs).forEach(function(digest){var seqs=digestSeqs[digest];seqs.forEach(function(seq){digestSeqPairs.push([digest,seq])})});if(!digestSeqPairs.length){return nextPage()}var numDone=0;digestSeqPairs.forEach(function(pair){var sql="INSERT INTO "+ATTACH_AND_SEQ_STORE+" (digest, seq) VALUES (?,?)";tx.executeSql(sql,pair,function(){if(++numDone===digestSeqPairs.length){nextPage()}})})})}nextPage()})}var attachAndRev="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE+" (digest, seq INTEGER)";tx.executeSql(attachAndRev,[],function(tx){tx.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL,[],function(tx){tx.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL,[],migrateAttsAndSeqs)})})}function runMigration6(tx,callback){var sql="ALTER TABLE "+ATTACH_STORE+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";tx.executeSql(sql,[],callback)}function runMigration7(tx,callback){var sql="ALTER TABLE "+DOC_STORE+" ADD COLUMN max_seq INTEGER";tx.executeSql(sql,[],function(tx){var sql="UPDATE "+DOC_STORE+" SET max_seq=(SELECT MAX(seq) FROM "+BY_SEQ_STORE+" WHERE doc_id=id)";tx.executeSql(sql,[],function(tx){var sql="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+DOC_STORE+" (max_seq)";tx.executeSql(sql,[],callback)})})}function checkEncoding(tx,cb){tx.executeSql('SELECT HEX("a") AS hex',[],function(tx,res){var hex=res.rows.item(0).hex;encoding=hex.length===2?"UTF-8":"UTF-16";cb()})}function onGetInstanceId(){while(idRequests.length>0){var idCallback=idRequests.pop();idCallback(null,instanceId)}}function onGetVersion(tx,dbVersion){if(dbVersion===0){var meta="CREATE TABLE IF NOT EXISTS "+META_STORE+" (dbid, db_version INTEGER)";var attach="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE+" (digest UNIQUE, escaped TINYINT(1), body BLOB)";var attachAndRev="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE+" (digest, seq INTEGER)";var doc="CREATE TABLE IF NOT EXISTS "+DOC_STORE+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)";var seq="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, "+"json, deleted TINYINT(1), doc_id, rev)";var local="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE+" (id UNIQUE, rev, json)";tx.executeSql(attach);tx.executeSql(local);tx.executeSql(attachAndRev,[],function(){tx.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL);tx.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL)});tx.executeSql(doc,[],function(){tx.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL);tx.executeSql(seq,[],function(){tx.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL);tx.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL);tx.executeSql(meta,[],function(){var initSeq="INSERT INTO "+META_STORE+" (db_version, dbid) VALUES (?,?)";instanceId=utils.uuid();var initSeqArgs=[ADAPTER_VERSION,instanceId];tx.executeSql(initSeq,initSeqArgs,function(){onGetInstanceId()})})})})}else{var setupDone=function(){var migrated=dbVersion<ADAPTER_VERSION;if(migrated){tx.executeSql("UPDATE "+META_STORE+" SET db_version = "+ADAPTER_VERSION)}var sql="SELECT dbid FROM "+META_STORE;tx.executeSql(sql,[],function(tx,result){instanceId=result.rows.item(0).dbid;onGetInstanceId()})};var tasks=[runMigration2,runMigration3,runMigration4,runMigration5,runMigration6,runMigration7,setupDone];var i=dbVersion;var nextMigration=function(tx){tasks[i-1](tx,nextMigration);i++};nextMigration(tx)}}function setup(){db.transaction(function(tx){checkEncoding(tx,function(){fetchVersion(tx)})},unknownError(callback),dbCreated)}function fetchVersion(tx){var sql="SELECT sql FROM sqlite_master WHERE tbl_name = "+META_STORE;tx.executeSql(sql,[],function(tx,result){if(!result.rows.length){onGetVersion(tx,0)}else if(!/db_version/.test(result.rows.item(0).sql)){tx.executeSql("ALTER TABLE "+META_STORE+" ADD COLUMN db_version INTEGER",[],function(){onGetVersion(tx,1)})}else{tx.executeSql("SELECT db_version FROM "+META_STORE,[],function(tx,result){var dbVersion=result.rows.item(0).db_version;onGetVersion(tx,dbVersion)})}})}if(utils.isCordova()){window.addEventListener(api._name+"_pouch",function cordova_init(){window.removeEventListener(api._name+"_pouch",cordova_init,false);setup()},false)}else{setup()}api.type=function(){return"websql"};api._id=utils.toPromise(function(callback){callback(null,instanceId)});api._info=function(callback){db.readTransaction(function(tx){countDocs(tx,function(docCount){var sql="SELECT MAX(seq) AS seq FROM "+BY_SEQ_STORE;tx.executeSql(sql,[],function(tx,res){var updateSeq=res.rows.item(0).seq||0;callback(null,{doc_count:docCount,update_seq:updateSeq,sqlite_plugin:db._sqlitePlugin,websql_encoding:encoding})})})},unknownError(callback))};api._bulkDocs=function(req,opts,callback){websqlBulkDocs(req,opts,api,db,WebSqlPouch.Changes,callback)};api._get=function(id,opts,callback){opts=utils.clone(opts);var doc;var metadata;var err;if(!opts.ctx){db.readTransaction(function(txn){opts.ctx=txn;api._get(id,opts,callback)});return}var tx=opts.ctx;function finish(){callback(err,{doc:doc,metadata:metadata,ctx:tx})}var sql;var sqlArgs;if(opts.rev){sql=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE+".id="+BY_SEQ_STORE+".doc_id",[BY_SEQ_STORE+".doc_id=?",BY_SEQ_STORE+".rev=?"]);sqlArgs=[id,opts.rev]}else{sql=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,DOC_STORE+".id=?");sqlArgs=[id]}tx.executeSql(sql,sqlArgs,function(a,results){if(!results.rows.length){err=errors.error(errors.MISSING_DOC,"missing");return finish()}var item=results.rows.item(0);metadata=utils.safeJsonParse(item.metadata);if(item.deleted&&!opts.rev){err=errors.error(errors.MISSING_DOC,"deleted");return finish()}doc=unstringifyDoc(item.data,metadata.id,item.rev);finish()})};function countDocs(tx,callback){if(api._docCount!==-1){return callback(api._docCount)}var sql=select("COUNT("+DOC_STORE+".id) AS 'num'",[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,BY_SEQ_STORE+".deleted=0");tx.executeSql(sql,[],function(tx,result){api._docCount=result.rows.item(0).num;callback(api._docCount)})}api._allDocs=function(opts,callback){var results=[];var totalRows;var start="startkey"in opts?opts.startkey:false;var end="endkey"in opts?opts.endkey:false;var key="key"in opts?opts.key:false;var descending="descending"in opts?opts.descending:false;var limit="limit"in opts?opts.limit:-1;var offset="skip"in opts?opts.skip:0;var inclusiveEnd=opts.inclusive_end!==false;var sqlArgs=[];var criteria=[];if(key!==false){criteria.push(DOC_STORE+".id = ?");sqlArgs.push(key)}else if(start!==false||end!==false){if(start!==false){criteria.push(DOC_STORE+".id "+(descending?"<=":">=")+" ?");sqlArgs.push(start)}if(end!==false){var comparator=descending?">":"<";if(inclusiveEnd){comparator+="="}criteria.push(DOC_STORE+".id "+comparator+" ?");sqlArgs.push(end)}if(key!==false){criteria.push(DOC_STORE+".id = ?");sqlArgs.push(key)}}if(opts.deleted!=="ok"){criteria.push(BY_SEQ_STORE+".deleted = 0")}db.readTransaction(function(tx){countDocs(tx,function(count){totalRows=count;if(limit===0){return}var sql=select(SELECT_DOCS,[DOC_STORE,BY_SEQ_STORE],DOC_STORE_AND_BY_SEQ_JOINER,criteria,DOC_STORE+".id "+(descending?"DESC":"ASC"));sql+=" LIMIT "+limit+" OFFSET "+offset;tx.executeSql(sql,sqlArgs,function(tx,result){for(var i=0,l=result.rows.length;i<l;i++){var item=result.rows.item(i);var metadata=utils.safeJsonParse(item.metadata);var id=metadata.id;var data=unstringifyDoc(item.data,id,item.rev);var winningRev=data._rev;var doc={id:id,key:id,value:{rev:winningRev}};if(opts.include_docs){doc.doc=data;doc.doc._rev=winningRev;if(opts.conflicts){doc.doc._conflicts=merge.collectConflicts(metadata)}fetchAttachmentsIfNecessary(doc.doc,opts,api,tx)}if(item.deleted){if(opts.deleted==="ok"){doc.value.deleted=true;doc.doc=null}else{continue}}results.push(doc)}})})},unknownError(callback),function(){callback(null,{total_rows:totalRows,offset:opts.skip,rows:results})})};api._changes=function(opts){opts=utils.clone(opts);if(opts.continuous){var id=api._name+":"+utils.uuid();WebSqlPouch.Changes.addListener(api._name,id,api,opts);WebSqlPouch.Changes.notify(api._name);return{cancel:function(){WebSqlPouch.Changes.removeListener(api._name,id)}}}var descending=opts.descending;opts.since=opts.since&&!descending?opts.since:0;var limit="limit"in opts?opts.limit:-1;if(limit===0){limit=1}var returnDocs;if("returnDocs"in opts){returnDocs=opts.returnDocs}else{returnDocs=true}var results=[];var numResults=0;function fetchChanges(){var selectStmt=DOC_STORE+".json AS metadata, "+DOC_STORE+".max_seq AS maxSeq, "+BY_SEQ_STORE+".json AS winningDoc, "+BY_SEQ_STORE+".rev AS winningRev ";var from=DOC_STORE+" JOIN "+BY_SEQ_STORE;var joiner=DOC_STORE+".id="+BY_SEQ_STORE+".doc_id"+" AND "+DOC_STORE+".winningseq="+BY_SEQ_STORE+".seq";var criteria=["maxSeq > ?"];var sqlArgs=[opts.since];if(opts.doc_ids){criteria.push(DOC_STORE+".id IN "+qMarks(opts.doc_ids.length));sqlArgs=sqlArgs.concat(opts.doc_ids)}var orderBy="maxSeq "+(descending?"DESC":"ASC");var sql=select(selectStmt,from,joiner,criteria,orderBy);var filter=utils.filterChange(opts);if(!opts.view&&!opts.filter){sql+=" LIMIT "+limit}var lastSeq=opts.since||0;db.readTransaction(function(tx){tx.executeSql(sql,sqlArgs,function(tx,result){function reportChange(change){return function(){opts.onChange(change)}}for(var i=0,l=result.rows.length;i<l;i++){var item=result.rows.item(i);var metadata=utils.safeJsonParse(item.metadata);lastSeq=item.maxSeq;var doc=unstringifyDoc(item.winningDoc,metadata.id,item.winningRev);var change=opts.processChange(doc,metadata,opts);change.seq=item.maxSeq;if(filter(change)){numResults++;if(returnDocs){results.push(change)}if(opts.attachments&&opts.include_docs){fetchAttachmentsIfNecessary(doc,opts,api,tx,reportChange(change))}else{reportChange(change)()}}if(numResults===limit){break}}})},unknownError(opts.complete),function(){if(!opts.continuous){opts.complete(null,{results:results,last_seq:lastSeq})}})}fetchChanges()};api._close=function(callback){callback()};api._getAttachment=function(attachment,opts,callback){var res;var tx=opts.ctx;var digest=attachment.digest;var type=attachment.content_type;var sql="SELECT escaped, "+"CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+ATTACH_STORE+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){var item=result.rows.item(0);var data=item.escaped?websqlUtils.unescapeBlob(item.body):parseHexString(item.body,encoding);if(opts.encode){res=utils.btoa(data)}else{res=binaryStringToBlob(data,type)}callback(null,res)})};api._getRevisionTree=function(docId,callback){db.readTransaction(function(tx){var sql="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";tx.executeSql(sql,[docId],function(tx,result){if(!result.rows.length){callback(errors.error(errors.MISSING_DOC))}else{var data=utils.safeJsonParse(result.rows.item(0).metadata);callback(null,data.rev_tree)}})})};api._doCompaction=function(docId,revs,callback){if(!revs.length){return callback()}db.transaction(function(tx){var sql="SELECT json AS metadata FROM "+DOC_STORE+" WHERE id = ?";tx.executeSql(sql,[docId],function(tx,result){var metadata=utils.safeJsonParse(result.rows.item(0).metadata);merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev=pos+"-"+revHash;if(revs.indexOf(rev)!==-1){opts.status="missing"}});var sql="UPDATE "+DOC_STORE+" SET json = ? WHERE id = ?";tx.executeSql(sql,[utils.safeJsonStringify(metadata),docId])});compactRevs(revs,docId,tx)},unknownError(callback),function(){callback()})};api._getLocal=function(id,callback){db.readTransaction(function(tx){var sql="SELECT json, rev FROM "+LOCAL_STORE+" WHERE id=?";tx.executeSql(sql,[id],function(tx,res){if(res.rows.length){var item=res.rows.item(0);var doc=unstringifyDoc(item.json,id,item.rev);callback(null,doc)}else{callback(errors.error(errors.MISSING_DOC))}})})};api._putLocal=function(doc,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}delete doc._revisions;var oldRev=doc._rev;var id=doc._id;var newRev;if(!oldRev){newRev=doc._rev="0-1"}else{newRev=doc._rev="0-"+(parseInt(oldRev.split("-")[1],10)+1)}var json=stringifyDoc(doc);var ret;function putLocal(tx){var sql;var values;if(oldRev){sql="UPDATE "+LOCAL_STORE+" SET rev=?, json=? "+"WHERE id=? AND rev=?";values=[newRev,json,id,oldRev]}else{sql="INSERT INTO "+LOCAL_STORE+" (id, rev, json) VALUES (?,?,?)";values=[id,newRev,json]}tx.executeSql(sql,values,function(tx,res){if(res.rowsAffected){ret={ok:true,id:id,rev:newRev};if(opts.ctx){callback(null,ret)}}else{callback(errors.error(errors.REV_CONFLICT))}},function(){callback(errors.error(errors.REV_CONFLICT));return false})}if(opts.ctx){putLocal(opts.ctx)}else{db.transaction(function(tx){putLocal(tx)},unknownError(callback),function(){if(ret){callback(null,ret)}})}};api._removeLocal=function(doc,callback){var ret;db.transaction(function(tx){var sql="DELETE FROM "+LOCAL_STORE+" WHERE id=? AND rev=?";var params=[doc._id,doc._rev];tx.executeSql(sql,params,function(tx,res){if(!res.rowsAffected){return callback(errors.error(errors.MISSING_DOC))}ret={ok:true,id:doc._id,rev:"0-0"}})},unknownError(callback),function(){if(ret){callback(null,ret)}})};api._destroy=function(callback){WebSqlPouch.Changes.removeAllListeners(api._name);db.transaction(function(tx){var stores=[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,META_STORE,LOCAL_STORE,ATTACH_AND_SEQ_STORE];stores.forEach(function(store){tx.executeSql("DROP TABLE IF EXISTS "+store,[])})},unknownError(callback),function(){if(utils.hasLocalStorage()){delete window.localStorage["_pouch__websqldb_"+api._name];delete window.localStorage[api._name]}callback(null,{ok:true})})}}WebSqlPouch.valid=websqlUtils.valid;WebSqlPouch.Changes=new utils.Changes;module.exports=WebSqlPouch},{"../../deps/binary/binaryStringToBlob":76,"../../deps/errors":81,"../../deps/parse-hex":86,"../../merge":95,"../../utils":106,"./websql-bulk-docs":66,"./websql-constants":67,"./websql-utils":68}],70:[function(require,module,exports){"use strict";var utils=require("./utils");var merge=require("./merge");var errors=require("./deps/errors");var EE=require("events").EventEmitter;var evalFilter=require("./evalFilter");var evalView=require("./evalView");module.exports=Changes;utils.inherits(Changes,EE);function Changes(db,opts,callback){EE.call(this);var self=this;this.db=db;opts=opts?utils.clone(opts):{};var oldComplete=callback||opts.complete||function(){};var complete=opts.complete=utils.once(function(err,resp){if(err){self.emit("error",err)}else{self.emit("complete",resp)}self.removeAllListeners();db.removeListener("destroyed",onDestroy)});if(oldComplete){self.on("complete",function(resp){oldComplete(null,resp)});self.on("error",function(err){oldComplete(err)})}var oldOnChange=opts.onChange;if(oldOnChange){self.on("change",oldOnChange);

}function onDestroy(){self.cancel()}db.once("destroyed",onDestroy);opts.onChange=function(change){if(opts.isCancelled){return}self.emit("change",change);if(self.startSeq&&self.startSeq<=change.seq){self.emit("uptodate");self.startSeq=false}if(change.deleted){self.emit("delete",change)}else if(change.changes.length===1&&change.changes[0].rev.slice(0,2)==="1-"){self.emit("create",change)}else{self.emit("update",change)}};var promise=new utils.Promise(function(fulfill,reject){opts.complete=function(err,res){if(err){reject(err)}else{fulfill(res)}}});self.once("cancel",function(){if(oldOnChange){self.removeListener("change",oldOnChange)}db.removeListener("destroyed",onDestroy);opts.complete(null,{status:"cancelled"})});this.then=promise.then.bind(promise);this["catch"]=promise["catch"].bind(promise);this.then(function(result){complete(null,result)},complete);if(!db.taskqueue.isReady){db.taskqueue.addTask(function(){if(self.isCancelled){self.emit("cancel")}else{self.doChanges(opts)}})}else{self.doChanges(opts)}}Changes.prototype.cancel=function(){this.isCancelled=true;if(this.db.taskqueue.isReady){this.emit("cancel")}};function processChange(doc,metadata,opts){var changeList=[{rev:doc._rev}];if(opts.style==="all_docs"){changeList=merge.collectLeaves(metadata.rev_tree).map(function(x){return{rev:x.rev}})}var change={id:metadata.id,changes:changeList,doc:doc};if(utils.isDeleted(metadata,doc._rev)){change.deleted=true}if(opts.conflicts){change.doc._conflicts=merge.collectConflicts(metadata);if(!change.doc._conflicts.length){delete change.doc._conflicts}}return change}Changes.prototype.doChanges=function(opts){var self=this;var callback=opts.complete;opts=utils.clone(opts);if("live"in opts&&!("continuous"in opts)){opts.continuous=opts.live}opts.processChange=processChange;if(opts.since==="latest"){opts.since="now"}if(!opts.since){opts.since=0}if(opts.since==="now"){this.db.info().then(function(info){if(self.isCancelled){callback(null,{status:"cancelled"});return}opts.since=info.update_seq;self.doChanges(opts)},callback);return}if(opts.continuous&&opts.since!=="now"){this.db.info().then(function(info){self.startSeq=info.update_seq},function(err){if(err.id==="idbNull"){return}throw err})}if(this.db.type()!=="http"&&opts.filter&&typeof opts.filter==="string"&&!opts.doc_ids){return this.filterChanges(opts)}if(!("descending"in opts)){opts.descending=false}opts.limit=opts.limit===0?1:opts.limit;opts.complete=callback;var newPromise=this.db._changes(opts);if(newPromise&&typeof newPromise.cancel==="function"){var cancel=self.cancel;self.cancel=utils.getArguments(function(args){newPromise.cancel();cancel.apply(this,args)})}};Changes.prototype.filterChanges=function(opts){var self=this;var callback=opts.complete;if(opts.filter==="_view"){if(!opts.view||typeof opts.view!=="string"){var err=errors.error(errors.BAD_REQUEST,"`view` filter parameter is not provided.");callback(err);return}var viewName=opts.view.split("/");this.db.get("_design/"+viewName[0],function(err,ddoc){if(self.isCancelled){callback(null,{status:"cancelled"});return}if(err){callback(errors.generateErrorFromResponse(err));return}if(ddoc&&ddoc.views&&ddoc.views[viewName[1]]){var filter=evalView(ddoc.views[viewName[1]].map);opts.filter=filter;self.doChanges(opts);return}var msg=ddoc.views?"missing json key: "+viewName[1]:"missing json key: views";if(!err){err=errors.error(errors.MISSING_DOC,msg)}callback(err);return})}else{var filterName=opts.filter.split("/");this.db.get("_design/"+filterName[0],function(err,ddoc){if(self.isCancelled){callback(null,{status:"cancelled"});return}if(err){callback(errors.generateErrorFromResponse(err));return}if(ddoc&&ddoc.filters&&ddoc.filters[filterName[1]]){var filter=evalFilter(ddoc.filters[filterName[1]]);opts.filter=filter;self.doChanges(opts);return}else{var msg=ddoc&&ddoc.filters?"missing json key: "+filterName[1]:"missing json key: filters";if(!err){err=errors.error(errors.MISSING_DOC,msg)}callback(err);return}})}}},{"./deps/errors":81,"./evalFilter":92,"./evalView":93,"./merge":95,"./utils":106,events:6}],71:[function(require,module,exports){(function(process,global){"use strict";var Adapter=require("./adapter");var utils=require("./utils");var TaskQueue=require("./taskqueue");var Promise=utils.Promise;function defaultCallback(err){if(err&&global.debug){console.error(err)}}utils.inherits(PouchDB,Adapter);function PouchDB(name,opts,callback){if(!(this instanceof PouchDB)){return new PouchDB(name,opts,callback)}var self=this;if(typeof opts==="function"||typeof opts==="undefined"){callback=opts;opts={}}if(name&&typeof name==="object"){opts=name;name=undefined}if(typeof callback==="undefined"){callback=defaultCallback}name=name||opts.name;opts=opts?utils.clone(opts):{};delete opts.name;this.__opts=opts;var oldCB=callback;self.auto_compaction=opts.auto_compaction;self.prefix=PouchDB.prefix;Adapter.call(self);self.taskqueue=new TaskQueue;var promise=new Promise(function(fulfill,reject){callback=function(err,resp){if(err){return reject(err)}delete resp.then;fulfill(resp)};opts=utils.clone(opts);var originalName=opts.name||name;var backend,error;(function(){try{if(typeof originalName!=="string"){error=new Error("Missing/invalid DB name");error.code=400;throw error}backend=PouchDB.parseAdapter(originalName,opts);opts.originalName=originalName;opts.name=backend.name;if(opts.prefix&&backend.adapter!=="http"&&backend.adapter!=="https"){opts.name=opts.prefix+opts.name}opts.adapter=opts.adapter||backend.adapter;self._adapter=opts.adapter;self._db_name=originalName;if(!PouchDB.adapters[opts.adapter]){error=new Error("Adapter is missing");error.code=404;throw error}if(!PouchDB.adapters[opts.adapter].valid()){error=new Error("Invalid Adapter");error.code=404;throw error}}catch(err){self.taskqueue.fail(err);self.changes=utils.toPromise(function(opts){if(opts.complete){opts.complete(err)}})}})();if(error){return reject(error)}self.adapter=opts.adapter;self.replicate={};self.replicate.from=function(url,opts,callback){return self.constructor.replicate(url,self,opts,callback)};self.replicate.to=function(url,opts,callback){return self.constructor.replicate(self,url,opts,callback)};self.sync=function(dbName,opts,callback){return self.constructor.sync(self,dbName,opts,callback)};self.replicate.sync=self.sync;PouchDB.adapters[opts.adapter].call(self,opts,function(err){if(err){if(callback){self.taskqueue.fail(err);callback(err)}return}function destructionListener(){PouchDB.emit("destroyed",opts.originalName);PouchDB.emit(opts.originalName,"destroyed");self.removeListener("destroyed",destructionListener)}self.on("destroyed",destructionListener);self.emit("created",self);PouchDB.emit("created",opts.originalName);self.taskqueue.ready(self);callback(null,self)});if(opts.skipSetup){self.taskqueue.ready(self);process.nextTick(function(){callback(null,self)})}if(utils.isCordova()){cordova.fireWindowEvent(opts.name+"_pouch",{})}});promise.then(function(resp){oldCB(null,resp)},oldCB);self.then=promise.then.bind(promise);self.catch=promise.catch.bind(promise)}PouchDB.debug=require("debug");module.exports=PouchDB}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./adapter":58,"./taskqueue":105,"./utils":106,_process:7,debug:108}],72:[function(require,module,exports){(function(process){"use strict";var request=require("request");var buffer=require("./buffer");var errors=require("./errors");var utils=require("../utils");function ajax(options,adapterCallback){var requestCompleted=false;var callback=utils.getArguments(function(args){if(requestCompleted){return}adapterCallback.apply(this,args);requestCompleted=true});if(typeof options==="function"){callback=options;options={}}options=utils.clone(options);var defaultOptions={method:"GET",headers:{},json:true,processData:true,timeout:1e4,cache:false};options=utils.extend(true,defaultOptions,options);function onSuccess(obj,resp,cb){if(!options.binary&&!options.json&&options.processData&&typeof obj!=="string"){obj=JSON.stringify(obj)}else if(!options.binary&&options.json&&typeof obj==="string"){try{obj=JSON.parse(obj)}catch(e){return cb(e)}}if(Array.isArray(obj)){obj=obj.map(function(v){if(v.error||v.missing){return errors.generateErrorFromResponse(v)}else{return v}})}cb(null,obj,resp)}function onError(err,cb){var errParsed,errObj;if(err.code&&err.status){var err2=new Error(err.message||err.code);err2.status=err.status;return cb(err2)}try{errParsed=JSON.parse(err.responseText);errObj=errors.generateErrorFromResponse(errParsed)}catch(e){errObj=errors.generateErrorFromResponse(err)}cb(errObj)}if(options.json){if(!options.binary){options.headers.Accept="application/json"}options.headers["Content-Type"]=options.headers["Content-Type"]||"application/json"}if(options.binary){options.encoding=null;options.json=false}if(!options.processData){options.json=false}function defaultBody(data){if(process.browser){return""}return new buffer("","binary")}return request(options,function(err,response,body){if(err){err.status=response?response.statusCode:400;return onError(err,callback)}var error;var content_type=response.headers&&response.headers["content-type"];var data=body||defaultBody();if(!options.binary&&(options.json||!options.processData)&&typeof data!=="object"&&(/json/.test(content_type)||/^[\s]*\{/.test(data)&&/\}[\s]*$/.test(data))){data=JSON.parse(data)}if(response.statusCode>=200&&response.statusCode<300){onSuccess(data,response,callback)}else{if(options.binary){data=JSON.parse(data.toString())}error=errors.generateErrorFromResponse(data);error.status=response.statusCode;callback(error)}})}module.exports=ajax}).call(this,require("_process"))},{"../utils":106,"./buffer":80,"./errors":81,_process:7,request:89}],73:[function(require,module,exports){"use strict";module.exports=function(buffer){var binary="";var bytes=new Uint8Array(buffer);var length=bytes.byteLength;for(var i=0;i<length;i++){binary+=String.fromCharCode(bytes[i])}return binary}},{}],74:[function(require,module,exports){"use strict";var buffer=require("./../buffer");if(typeof atob==="function"){exports.atob=function(str){return atob(str)}}else{exports.atob=function(str){var base64=new buffer(str,"base64");if(base64.toString("base64")!==str){throw"Cannot base64 encode full string"}return base64.toString("binary")}}if(typeof btoa==="function"){exports.btoa=function(str){return btoa(str)}}else{exports.btoa=function(str){return new buffer(str,"binary").toString("base64")}}},{"./../buffer":80}],75:[function(require,module,exports){"use strict";module.exports=function(bin){var length=bin.length;var buf=new ArrayBuffer(length);var arr=new Uint8Array(buf);for(var i=0;i<length;i++){arr[i]=bin.charCodeAt(i)}return buf}},{}],76:[function(require,module,exports){"use strict";var createBlob=require("./blob");var binaryStringToArrayBuffer=require("./binaryStringToArrayBuffer");module.exports=function binaryStringToBlob(binString,type){return createBlob([binaryStringToArrayBuffer(binString)],{type:type})}},{"./binaryStringToArrayBuffer":75,"./blob":77}],77:[function(require,module,exports){(function(global){"use strict";function createBlob(parts,properties){parts=parts||[];properties=properties||{};try{return new Blob(parts,properties)}catch(e){if(e.name!=="TypeError"){throw e}var BlobBuilder=global.BlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder||global.WebKitBlobBuilder;var builder=new BlobBuilder;for(var i=0;i<parts.length;i+=1){builder.append(parts[i])}return builder.getBlob(properties.type)}}module.exports=createBlob}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],78:[function(require,module,exports){"use strict";module.exports=function(blob,callback){var reader=new FileReader;reader.onloadend=function(e){var result=e.target.result||new ArrayBuffer(0);callback(result)};reader.readAsArrayBuffer(blob)}},{}],79:[function(require,module,exports){"use strict";var arrayBufferToBinaryString=require("./arrayBufferToBinaryString");module.exports=function(blob,callback){var reader=new FileReader;var hasBinaryString=typeof reader.readAsBinaryString==="function";reader.onloadend=function(e){var result=e.target.result||"";if(hasBinaryString){return callback(result)}callback(arrayBufferToBinaryString(result))};if(hasBinaryString){reader.readAsBinaryString(blob)}else{reader.readAsArrayBuffer(blob)}}},{"./arrayBufferToBinaryString":73}],80:[function(require,module,exports){module.exports={}},{}],81:[function(require,module,exports){"use strict";var inherits=require("inherits");inherits(PouchError,Error);function PouchError(opts){Error.call(opts.reason);this.status=opts.status;this.name=opts.error;this.message=opts.reason;this.error=true}PouchError.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})};exports.UNAUTHORIZED=new PouchError({status:401,error:"unauthorized",reason:"Name or password is incorrect."});exports.MISSING_BULK_DOCS=new PouchError({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"});exports.MISSING_DOC=new PouchError({status:404,error:"not_found",reason:"missing"});exports.REV_CONFLICT=new PouchError({status:409,error:"conflict",reason:"Document update conflict"});exports.INVALID_ID=new PouchError({status:400,error:"invalid_id",reason:"_id field must contain a string"});exports.MISSING_ID=new PouchError({status:412,error:"missing_id",reason:"_id is required for puts"});exports.RESERVED_ID=new PouchError({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."});exports.NOT_OPEN=new PouchError({status:412,error:"precondition_failed",reason:"Database not open"});exports.UNKNOWN_ERROR=new PouchError({status:500,error:"unknown_error",reason:"Database encountered an unknown error"});exports.BAD_ARG=new PouchError({status:500,error:"badarg",reason:"Some query argument is invalid"});exports.INVALID_REQUEST=new PouchError({status:400,error:"invalid_request",reason:"Request was invalid"});exports.QUERY_PARSE_ERROR=new PouchError({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"});exports.DOC_VALIDATION=new PouchError({status:500,error:"doc_validation",reason:"Bad special document member"});exports.BAD_REQUEST=new PouchError({status:400,error:"bad_request",reason:"Something wrong with the request"});exports.NOT_AN_OBJECT=new PouchError({status:400,error:"bad_request",reason:"Document must be a JSON object"});exports.DB_MISSING=new PouchError({status:404,error:"not_found",reason:"Database not found"});exports.IDB_ERROR=new PouchError({status:500,error:"indexed_db_went_bad",reason:"unknown"});exports.WSQ_ERROR=new PouchError({status:500,error:"web_sql_went_bad",reason:"unknown"});exports.LDB_ERROR=new PouchError({status:500,error:"levelDB_went_went_bad",reason:"unknown"});exports.FORBIDDEN=new PouchError({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"});exports.INVALID_REV=new PouchError({status:400,error:"bad_request",reason:"Invalid rev format"});exports.FILE_EXISTS=new PouchError({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."});exports.MISSING_STUB=new PouchError({status:412,error:"missing_stub"});exports.error=function(error,reason,name){function CustomPouchError(reason){for(var p in error){if(typeof error[p]!=="function"){this[p]=error[p]}}if(name!==undefined){this.name=name}if(reason!==undefined){this.reason=reason}}CustomPouchError.prototype=PouchError.prototype;return new CustomPouchError(reason)};exports.getErrorTypeByProp=function(prop,value,reason){var errors=exports;var keys=Object.keys(errors).filter(function(key){var error=errors[key];return typeof error!=="function"&&error[prop]===value});var key=reason&&keys.filter(function(key){var error=errors[key];return error.message===reason})[0]||keys[0];return key?errors[key]:null};exports.generateErrorFromResponse=function(res){var error,errName,errType,errMsg,errReason;var errors=exports;errName=res.error===true&&typeof res.name==="string"?res.name:res.error;errReason=res.reason;errType=errors.getErrorTypeByProp("name",errName,errReason);if(res.missing||errReason==="missing"||errReason==="deleted"||errName==="not_found"){errType=errors.MISSING_DOC}else if(errName==="doc_validation"){errType=errors.DOC_VALIDATION;errMsg=errReason}else if(errName==="bad_request"&&errType.message!==errReason){if(errReason.indexOf("unknown stub attachment")===0){errType=errors.MISSING_STUB;errMsg=errReason}else{errType=errors.BAD_REQUEST}}if(!errType){errType=errors.getErrorTypeByProp("status",res.status,errReason)||errors.UNKNOWN_ERROR}error=errors.error(errType,errReason,errName);if(errMsg){error.message=errMsg}if(res.id){error.id=res.id}if(res.status){error.status=res.status}if(res.statusText){error.name=res.statusText}if(res.missing){error.missing=res.missing}return error}},{inherits:111}],82:[function(require,module,exports){(function(process,global){"use strict";function explain404(str){if(process.browser&&"console"in global&&"info"in console){console.info("The above 404 is totally normal. "+str)}}module.exports=explain404}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:7}],83:[function(require,module,exports){(function(process,global){"use strict";var base64=require("./binary/base64");var crypto=require("crypto");var Md5=require("spark-md5");var setImmediateShim=global.setImmediate||global.setTimeout;var MD5_CHUNK_SIZE=32768;function intToString(int){return String.fromCharCode(int&255)+String.fromCharCode(int>>>8&255)+String.fromCharCode(int>>>16&255)+String.fromCharCode(int>>>24&255)}function rawToBase64(raw){var res="";for(var i=0,len=raw.length;i<len;i++){res+=intToString(raw[i])}return base64.btoa(res)}function appendBuffer(buffer,data,start,end){if(start>0||end<data.byteLength){data=new Uint8Array(data,start,Math.min(end,data.byteLength)-start)}buffer.append(data)}function appendString(buffer,data,start,end){if(start>0||end<data.length){data=data.substring(start,end)}buffer.appendBinary(data)}module.exports=function(data,callback){if(!process.browser){var base64=crypto.createHash("md5").update(data).digest("base64");callback(null,base64);return}var inputIsString=typeof data==="string";var len=inputIsString?data.length:data.byteLength;var chunkSize=Math.min(MD5_CHUNK_SIZE,len);var chunks=Math.ceil(len/chunkSize);var currentChunk=0;var buffer=inputIsString?new Md5:new Md5.ArrayBuffer;var append=inputIsString?appendString:appendBuffer;function loadNextChunk(){var start=currentChunk*chunkSize;var end=start+chunkSize;currentChunk++;if(currentChunk<chunks){append(buffer,data,start,end);setImmediateShim(loadNextChunk)}else{append(buffer,data,start,end);var raw=buffer.end(true);var base64=rawToBase64(raw);callback(null,base64);buffer.destroy()}}loadNextChunk()}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./binary/base64":74,_process:7,crypto:1,"spark-md5":124}],84:[function(require,module,exports){(function(process){"use strict";var base64=require("./binary/base64");var atob=base64.atob;var uuid=require("./uuid");var createBlob=require("./binary/blob");var binaryStringToArrayBuffer=require("./binary/binaryStringToArrayBuffer");var utils=require("../utils");var clone=utils.clone;var isBrowser=typeof process==="undefined"||process.browser;var buffer=require("./buffer");function createBlobOrBuffer(parts,type){if(isBrowser){return createBlob(parts,{type:type})}return buffer.concat(parts.map(function(part){return new buffer(part,"binary")}))}function createMultipart(doc){doc=clone(doc);var boundary=uuid();var nonStubAttachments={};Object.keys(doc._attachments).forEach(function(filename){var att=doc._attachments[filename];if(att.stub){return}var binData=atob(att.data);nonStubAttachments[filename]={type:att.content_type,data:binData};att.length=binData.length;att.follows=true;delete att.digest;delete att.data});var preamble="--"+boundary+"\r\nContent-Type: application/json\r\n\r\n";var parts=[preamble,JSON.stringify(doc)];Object.keys(nonStubAttachments).forEach(function(filename){var att=nonStubAttachments[filename];var preamble="\r\n--"+boundary+"\r\nContent-Disposition: attachment; filename="+JSON.stringify(filename)+"\r\nContent-Type: "+att.type+"\r\nContent-Length: "+att.data.length+"\r\n\r\n";parts.push(preamble);parts.push(isBrowser?binaryStringToArrayBuffer(att.data):att.data)});parts.push("\r\n--"+boundary+"--");var type="multipart/related; boundary="+boundary;var body=createBlobOrBuffer(parts,type);return{headers:{"Content-Type":type},body:body}}module.exports=createMultipart}).call(this,require("_process"))},{"../utils":106,"./binary/base64":74,"./binary/binaryStringToArrayBuffer":75,"./binary/blob":77,"./buffer":80,"./uuid":91,_process:7}],85:[function(require,module,exports){"use strict";var errors=require("./errors");var uuid=require("./uuid");function toObject(array){return array.reduce(function(obj,item){obj[item]=true;return obj},{})}var reservedWords=toObject(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]);var dataWords=toObject(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);exports.invalidIdError=function(id){var err;if(!id){err=errors.error(errors.MISSING_ID)}else if(typeof id!=="string"){err=errors.error(errors.INVALID_ID)}else if(/^_/.test(id)&&!/^_(design|local)/.test(id)){err=errors.error(errors.RESERVED_ID)}if(err){throw err}};function parseRevisionInfo(rev){if(!/^\d+\-./.test(rev)){return errors.error(errors.INVALID_REV)}var idx=rev.indexOf("-");var left=rev.substring(0,idx);var right=rev.substring(idx+1);return{prefix:parseInt(left,10),id:right}}function makeRevTreeFromRevisions(revisions,opts){var pos=revisions.start-revisions.ids.length+1;var revisionIds=revisions.ids;var ids=[revisionIds[0],opts,[]];for(var i=1,len=revisionIds.length;i<len;i++){ids=[revisionIds[i],{status:"missing"},[ids]]}return[{pos:pos,ids:ids}]}exports.parseDoc=function(doc,newEdits){var nRevNum;var newRevId;var revInfo;var opts={status:"available"};if(doc._deleted){opts.deleted=true}if(newEdits){if(!doc._id){doc._id=uuid()}newRevId=uuid(32,16).toLowerCase();if(doc._rev){revInfo=parseRevisionInfo(doc._rev);if(revInfo.error){return revInfo}doc._rev_tree=[{pos:revInfo.prefix,ids:[revInfo.id,{status:"missing"},[[newRevId,opts,[]]]]}];nRevNum=revInfo.prefix+1}else{doc._rev_tree=[{pos:1,ids:[newRevId,opts,[]]}];nRevNum=1}}else{if(doc._revisions){doc._rev_tree=makeRevTreeFromRevisions(doc._revisions,opts);nRevNum=doc._revisions.start;newRevId=doc._revisions.ids[0]}if(!doc._rev_tree){revInfo=parseRevisionInfo(doc._rev);if(revInfo.error){return revInfo}nRevNum=revInfo.prefix;newRevId=revInfo.id;doc._rev_tree=[{pos:nRevNum,ids:[newRevId,opts,[]]}]}}exports.invalidIdError(doc._id);doc._rev=nRevNum+"-"+newRevId;var result={metadata:{},data:{}};for(var key in doc){if(doc.hasOwnProperty(key)){var specialKey=key[0]==="_";if(specialKey&&!reservedWords[key]){var error=errors.error(errors.DOC_VALIDATION,key);error.message=errors.DOC_VALIDATION.message+": "+key;throw error}else if(specialKey&&!dataWords[key]){result.metadata[key.slice(1)]=doc[key]}else{result.data[key]=doc[key]}}}return result}},{"./errors":81,"./uuid":91}],86:[function(require,module,exports){"use strict";function decodeUtf8(str){return decodeURIComponent(window.escape(str))}function hexToInt(charCode){return charCode<65?charCode-48:charCode-55}function parseHexUtf8(str,start,end){var result="";while(start<end){result+=String.fromCharCode(hexToInt(str.charCodeAt(start++))<<4|hexToInt(str.charCodeAt(start++)))}return result}function parseHexUtf16(str,start,end){var result="";while(start<end){result+=String.fromCharCode(hexToInt(str.charCodeAt(start+2))<<12|hexToInt(str.charCodeAt(start+3))<<8|hexToInt(str.charCodeAt(start))<<4|hexToInt(str.charCodeAt(start+1)));start+=4}return result}function parseHexString(str,encoding){if(encoding==="UTF-8"){return decodeUtf8(parseHexUtf8(str,0,str.length))}else{return parseHexUtf16(str,0,str.length)}}module.exports=parseHexString},{}],87:[function(require,module,exports){"use strict";var options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function parseUri(str){var o=options;var m=o.parser[o.strictMode?"strict":"loose"].exec(str);var uri={};var i=14;while(i--){var key=o.key[i];var value=m[i]||"";var encoded=["user","password"].indexOf(key)!==-1;uri[key]=encoded?decodeURIComponent(value):value}uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1){uri[o.q.name][$1]=$2}});return uri}module.exports=parseUri},{}],88:[function(require,module,exports){"use strict";if(typeof Promise==="function"){module.exports=Promise}else{module.exports=require("bluebird")}},{bluebird:39}],89:[function(require,module,exports){"use strict";var createBlob=require("./binary/blob.js");var utils=require("../utils");var readAsArrayBuffer=require("./binary/readAsArrayBuffer");function wrappedFetch(){var wrappedPromise={};var promise=new utils.Promise(function(resolve,reject){wrappedPromise.resolve=resolve;wrappedPromise.reject=reject});var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}wrappedPromise.promise=promise;utils.Promise.resolve().then(function(){return fetch.apply(null,args)}).then(function(response){wrappedPromise.resolve(response)}).catch(function(error){wrappedPromise.reject(error)});return wrappedPromise}function fetchRequest(options,callback){var wrappedPromise,timer,response;var headers=new Headers;var fetchOptions={method:options.method,credentials:"include",headers:headers};if(options.json){headers.set("Accept","application/json");headers.set("Content-Type",options.headers["Content-Type"]||"application/json")}if(options.body&&options.body instanceof Blob){readAsArrayBuffer(options.body,function(arrayBuffer){fetchOptions.body=arrayBuffer})}else if(options.body&&options.processData&&typeof options.body!=="string"){fetchOptions.body=JSON.stringify(options.body)}else if("body"in options){fetchOptions.body=options.body}else{fetchOptions.body=null}Object.keys(options.headers).forEach(function(key){if(options.headers.hasOwnProperty(key)){headers.set(key,options.headers[key])}});wrappedPromise=wrappedFetch(options.url,fetchOptions);if(options.timeout>0){timer=setTimeout(function(){wrappedPromise.reject(new Error("Load timeout for resource: "+options.url))},options.timeout)}wrappedPromise.promise.then(function(fetchResponse){response={statusCode:fetchResponse.status};if(options.timeout>0){clearTimeout(timer)}if(response.statusCode>=200&&response.statusCode<300){return options.binary?fetchResponse.blob():fetchResponse.text()}return fetchResponse.json()}).then(function(result){if(response.statusCode>=200&&response.statusCode<300){callback(null,response,result)}else{callback(result,response)}}).catch(function(error){callback(error,response)});return{abort:wrappedPromise.reject}}function xhRequest(options,callback){var xhr,timer,hasUpload;var abortReq=function(){xhr.abort()};if(options.xhr){xhr=new options.xhr}else{xhr=new XMLHttpRequest}if(options.method==="GET"&&!options.cache){var hasArgs=options.url.indexOf("?")!==-1;options.url+=(hasArgs?"&":"?")+"_nonce="+Date.now()}xhr.open(options.method,options.url);xhr.withCredentials=true;if(options.method==="GET"){delete options.headers["Content-Type"]}else if(options.json){options.headers.Accept="application/json";options.headers["Content-Type"]=options.headers["Content-Type"]||"application/json";if(options.body&&options.processData&&typeof options.body!=="string"){options.body=JSON.stringify(options.body)}}if(options.binary){xhr.responseType="arraybuffer"}if(!("body"in options)){options.body=null}for(var key in options.headers){if(options.headers.hasOwnProperty(key)){xhr.setRequestHeader(key,options.headers[key])}}if(options.timeout>0){timer=setTimeout(abortReq,options.timeout);xhr.onprogress=function(){clearTimeout(timer);timer=setTimeout(abortReq,options.timeout)};if(typeof hasUpload==="undefined"){hasUpload=Object.keys(xhr).indexOf("upload")!==-1&&typeof xhr.upload!=="undefined"}if(hasUpload){xhr.upload.onprogress=xhr.onprogress}}xhr.onreadystatechange=function(){if(xhr.readyState!==4){return}var response={statusCode:xhr.status};if(xhr.status>=200&&xhr.status<300){var data;if(options.binary){data=createBlob([xhr.response||""],{type:xhr.getResponseHeader("Content-Type")})}else{data=xhr.responseText}callback(null,response,data)}else{var err={};try{err=JSON.parse(xhr.response)}catch(e){}callback(err,response)}};if(options.body&&options.body instanceof Blob){readAsArrayBuffer(options.body,function(arrayBuffer){xhr.send(arrayBuffer)})}else{xhr.send(options.body)}return{abort:abortReq}}function testXhr(){try{new XMLHttpRequest;return true}catch(err){return false}}var hasXhr=testXhr();module.exports=function(options,callback){if(hasXhr||options.xhr){return xhRequest(options,callback)}else{return fetchRequest(options,callback)}}},{"../utils":106,"./binary/blob.js":77,"./binary/readAsArrayBuffer":78}],90:[function(require,module,exports){"use strict";var upsert=require("pouchdb-upsert").upsert;module.exports=function(db,doc,diffFun,cb){return upsert.call(db,doc,diffFun,cb)}},{"pouchdb-upsert":119}],91:[function(require,module,exports){"use strict";var chars=("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz").split("");function getValue(radix){return 0|Math.random()*radix}function uuid(len,radix){radix=radix||chars.length;var out="";var i=-1;if(len){while(++i<len){out+=chars[getValue(radix)]}return out}while(++i<36){switch(i){case 8:case 13:case 18:case 23:out+="-";break;case 19:out+=chars[getValue(16)&3|8];break;default:out+=chars[getValue(16)]}}return out}module.exports=uuid},{}],92:[function(require,module,exports){"use strict";module.exports=evalFilter;function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}},{}],93:[function(require,module,exports){"use strict";module.exports=evalView;function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}},{}],94:[function(require,module,exports){(function(process){"use strict";var PouchDB=require("./setup");module.exports=PouchDB;PouchDB.ajax=require("./deps/ajax");PouchDB.utils=require("./utils");PouchDB.Errors=require("./deps/errors");PouchDB.replicate=require("./replicate").replicate;PouchDB.sync=require("./sync");PouchDB.version=require("./version");var httpAdapter=require("./adapters/http/http");PouchDB.adapter("http",httpAdapter);PouchDB.adapter("https",httpAdapter);PouchDB.adapter("idb",require("./adapters/idb/idb"),true);PouchDB.adapter("websql",require("./adapters/websql/websql"),true);PouchDB.plugin(require("pouchdb-mapreduce"));if(!process.browser){var ldbAdapter=require("./adapters/leveldb/leveldb");PouchDB.adapter("leveldb",ldbAdapter,true);

}}).call(this,require("_process"))},{"./adapters/http/http":59,"./adapters/idb/idb":65,"./adapters/leveldb/leveldb":1,"./adapters/websql/websql":69,"./deps/ajax":72,"./deps/errors":81,"./replicate":100,"./setup":103,"./sync":104,"./utils":106,"./version":107,_process:7,"pouchdb-mapreduce":115}],95:[function(require,module,exports){"use strict";var extend=require("pouchdb-extend");function binarySearch(arr,item,comparator){var low=0;var high=arr.length;var mid;while(low<high){mid=low+high>>>1;if(comparator(arr[mid],item)<0){low=mid+1}else{high=mid}}return low}function insertSorted(arr,item,comparator){var idx=binarySearch(arr,item,comparator);arr.splice(idx,0,item)}function pathToTree(path){var doc=path.shift();var root=[doc.id,doc.opts,[]];var leaf=root;var nleaf;while(path.length){doc=path.shift();nleaf=[doc.id,doc.opts,[]];leaf[2].push(nleaf);leaf=nleaf}return root}function compareTree(a,b){return a[0]<b[0]?-1:1}function mergeTree(in_tree1,in_tree2){var queue=[{tree1:in_tree1,tree2:in_tree2}];var conflicts=false;while(queue.length>0){var item=queue.pop();var tree1=item.tree1;var tree2=item.tree2;if(tree1[1].status||tree2[1].status){tree1[1].status=tree1[1].status==="available"||tree2[1].status==="available"?"available":"missing"}for(var i=0;i<tree2[2].length;i++){if(!tree1[2][0]){conflicts="new_leaf";tree1[2][0]=tree2[2][i];continue}var merged=false;for(var j=0;j<tree1[2].length;j++){if(tree1[2][j][0]===tree2[2][i][0]){queue.push({tree1:tree1[2][j],tree2:tree2[2][i]});merged=true}}if(!merged){conflicts="new_branch";insertSorted(tree1[2],tree2[2][i],compareTree)}}}return{conflicts:conflicts,tree:in_tree1}}function doMerge(tree,path,dontExpand){var restree=[];var conflicts=false;var merged=false;var res;if(!tree.length){return{tree:[path],conflicts:"new_leaf"}}tree.forEach(function(branch){if(branch.pos===path.pos&&branch.ids[0]===path.ids[0]){res=mergeTree(branch.ids,path.ids);restree.push({pos:branch.pos,ids:res.tree});conflicts=conflicts||res.conflicts;merged=true}else if(dontExpand!==true){var t1=branch.pos<path.pos?branch:path;var t2=branch.pos<path.pos?path:branch;var diff=t2.pos-t1.pos;var candidateParents=[];var trees=[];trees.push({ids:t1.ids,diff:diff,parent:null,parentIdx:null});while(trees.length>0){var item=trees.pop();if(item.diff===0){if(item.ids[0]===t2.ids[0]){candidateParents.push(item)}continue}if(!item.ids){continue}item.ids[2].forEach(function(el,idx){trees.push({ids:el,diff:item.diff-1,parent:item.ids,parentIdx:idx})})}var el=candidateParents[0];if(!el){restree.push(branch)}else{res=mergeTree(el.ids,t2.ids);el.parent[2][el.parentIdx]=res.tree;restree.push({pos:t1.pos,ids:t1.ids});conflicts=conflicts||res.conflicts;merged=true}}else{restree.push(branch)}});if(!merged){restree.push(path)}restree.sort(function(a,b){return a.pos-b.pos});return{tree:restree,conflicts:conflicts||"internal_node"}}function stem(tree,depth){var stemmedPaths=PouchMerge.rootToLeaf(tree).map(function(path){var stemmed=path.ids.slice(-depth);return{pos:path.pos+(path.ids.length-stemmed.length),ids:pathToTree(stemmed)}});return stemmedPaths.reduce(function(prev,current){return doMerge(prev,current,true).tree},[stemmedPaths.shift()])}var PouchMerge={};PouchMerge.merge=function(tree,path,depth){tree=extend(true,[],tree);path=extend(true,{},path);var newTree=doMerge(tree,path);return{tree:stem(newTree.tree,depth),conflicts:newTree.conflicts}};PouchMerge.winningRev=function(metadata){var leafs=[];PouchMerge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,id,something,opts){if(isLeaf){leafs.push({pos:pos,id:id,deleted:!!opts.deleted})}});leafs.sort(function(a,b){if(a.deleted!==b.deleted){return a.deleted>b.deleted?1:-1}if(a.pos!==b.pos){return b.pos-a.pos}return a.id<b.id?1:-1});return leafs[0].pos+"-"+leafs[0].id};PouchMerge.traverseRevTree=function(revs,callback){var toVisit=revs.slice();var node;while(node=toVisit.pop()){var pos=node.pos;var tree=node.ids;var branches=tree[2];var newCtx=callback(branches.length===0,pos,tree[0],node.ctx,tree[1]);for(var i=0,len=branches.length;i<len;i++){toVisit.push({pos:pos+1,ids:branches[i],ctx:newCtx})}}};PouchMerge.collectLeaves=function(revs){var leaves=[];PouchMerge.traverseRevTree(revs,function(isLeaf,pos,id,acc,opts){if(isLeaf){leaves.push({rev:pos+"-"+id,pos:pos,opts:opts})}});leaves.sort(function(a,b){return b.pos-a.pos});leaves.forEach(function(leaf){delete leaf.pos});return leaves};PouchMerge.collectConflicts=function(metadata){var win=PouchMerge.winningRev(metadata);var leaves=PouchMerge.collectLeaves(metadata.rev_tree);var conflicts=[];leaves.forEach(function(leaf){if(leaf.rev!==win&&!leaf.opts.deleted){conflicts.push(leaf.rev)}});return conflicts};PouchMerge.rootToLeaf=function(tree){var paths=[];PouchMerge.traverseRevTree(tree,function(isLeaf,pos,id,history,opts){history=history?history.slice(0):[];history.push({id:id,opts:opts});if(isLeaf){var rootPos=pos+1-history.length;paths.unshift({pos:rootPos,ids:history})}return history});return paths};module.exports=PouchMerge},{"pouchdb-extend":57}],96:[function(require,module,exports){"use strict";var STARTING_BACK_OFF=0;function randomNumber(min,max){min=parseInt(min,10);max=parseInt(max,10);if(min!==min){min=0}if(max!==max||max<=min){max=(min||1)<<1}else{max=max+1}var ratio=Math.random();var range=max-min;return~~(range*ratio+min)}function defaultBackOff(min){var max=0;if(!min){max=2e3}return randomNumber(min,max)}function backOff(opts,returnValue,error,callback){if(opts.retry===false){returnValue.emit("error",error);returnValue.removeAllListeners();return}if(typeof opts.back_off_function!=="function"){opts.back_off_function=defaultBackOff}returnValue.emit("requestError",error);if(returnValue.state==="active"){returnValue.emit("paused",error);returnValue.state="stopped";returnValue.once("active",function(){opts.current_back_off=STARTING_BACK_OFF})}opts.current_back_off=opts.current_back_off||STARTING_BACK_OFF;opts.current_back_off=opts.back_off_function(opts.current_back_off);setTimeout(callback,opts.current_back_off)}module.exports=backOff},{}],97:[function(require,module,exports){"use strict";var Promise=require("./../deps/promise");var explain404=require("./../deps/explain404");var pouchCollate=require("pouchdb-collate");var collate=pouchCollate.collate;function updateCheckpoint(db,id,checkpoint,returnValue){return db.get(id).catch(function(err){if(err.status===404){if(db.type()==="http"){explain404("PouchDB is just checking if a remote checkpoint exists.")}return{_id:id}}throw err}).then(function(doc){if(returnValue.cancelled){return}doc.last_seq=checkpoint;return db.put(doc).catch(function(err){if(err.status===409){return updateCheckpoint(db,id,checkpoint,returnValue)}throw err})})}function Checkpointer(src,target,id,returnValue){this.src=src;this.target=target;this.id=id;this.returnValue=returnValue}Checkpointer.prototype.writeCheckpoint=function(checkpoint){var self=this;return this.updateTarget(checkpoint).then(function(){return self.updateSource(checkpoint)})};Checkpointer.prototype.updateTarget=function(checkpoint){return updateCheckpoint(this.target,this.id,checkpoint,this.returnValue)};Checkpointer.prototype.updateSource=function(checkpoint){var self=this;if(this.readOnlySource){return Promise.resolve(true)}return updateCheckpoint(this.src,this.id,checkpoint,this.returnValue).catch(function(err){var isForbidden=typeof err.status==="number"&&Math.floor(err.status/100)===4;if(isForbidden){self.readOnlySource=true;return true}throw err})};Checkpointer.prototype.getCheckpoint=function(){var self=this;return self.target.get(self.id).then(function(targetDoc){return self.src.get(self.id).then(function(sourceDoc){if(collate(targetDoc.last_seq,sourceDoc.last_seq)===0){return sourceDoc.last_seq}return 0},function(err){if(err.status===404&&targetDoc.last_seq){return self.src.put({_id:self.id,last_seq:0}).then(function(){return 0},function(err){if(err.status===401){self.readOnlySource=true;return targetDoc.last_seq}return 0})}throw err})}).catch(function(err){if(err.status!==404){throw err}return 0})};module.exports=Checkpointer},{"./../deps/explain404":82,"./../deps/promise":88,"pouchdb-collate":55}],98:[function(require,module,exports){"use strict";var utils=require("../utils");function genReplicationId(src,target,opts){var filterFun=opts.filter?opts.filter.toString():"";return src.id().then(function(src_id){return target.id().then(function(target_id){var queryData=src_id+target_id+filterFun+JSON.stringify(opts.query_params)+opts.doc_ids;return utils.MD5(queryData).then(function(md5){md5=md5.replace(/\//g,".").replace(/\+/g,"_");return"_local/"+md5})})})}module.exports=genReplicationId},{"../utils":106}],99:[function(require,module,exports){"use strict";var utils=require("./../utils");var clone=utils.clone;var Promise=utils.Promise;var MAX_SIMULTANEOUS_REVS=50;function isGenOne(rev){return/^1-/.test(rev)}function getDocs(src,diffs,state){diffs=clone(diffs);var resultDocs=[];function fetchMissingRevs(id,missingRevs){var opts={revs:true,open_revs:missingRevs,attachments:true};return src.get(id,opts).then(function(docs){if(state.cancelled){throw new Error("cancelled")}docs.forEach(function(doc){if(doc.ok){resultDocs.push(doc.ok)}})})}function processDiffDoc(id){var missing=diffs[id].missing;var missingBatches=[];for(var i=0;i<missing.length;i+=MAX_SIMULTANEOUS_REVS){var missingBatch=missing.slice(i,Math.min(missing.length,i+MAX_SIMULTANEOUS_REVS));missingBatches.push(missingBatch)}return Promise.all(missingBatches.map(function(missingRevs){return fetchMissingRevs(id,missingRevs)}))}function getAllDocs(){var diffKeys=Object.keys(diffs);return Promise.all(diffKeys.map(processDiffDoc))}function hasAttachments(doc){return doc._attachments&&Object.keys(doc._attachments).length>0}function fetchRevisionOneDocs(ids){return src.allDocs({keys:ids,include_docs:true}).then(function(res){if(state.cancelled){throw new Error("cancelled")}res.rows.forEach(function(row){if(row.deleted||!row.doc||!isGenOne(row.value.rev)||hasAttachments(row.doc)){return}resultDocs.push(row.doc);delete diffs[row.id]})})}function getRevisionOneDocs(){var ids=Object.keys(diffs).filter(function(id){var missing=diffs[id].missing;return missing.length===1&&isGenOne(missing[0])});if(ids.length>0){return fetchRevisionOneDocs(ids)}}function returnDocs(){return resultDocs}return Promise.resolve().then(getRevisionOneDocs).then(getAllDocs).then(returnDocs)}module.exports=getDocs},{"./../utils":106}],100:[function(require,module,exports){"use strict";var utils=require("../utils");var replicate=require("./replicate");var Replication=require("./replication");function toPouch(db,opts){var PouchConstructor=opts.PouchConstructor;if(typeof db==="string"){return new PouchConstructor(db,opts)}else{return db}}function replicateWrapper(src,target,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}if(typeof opts==="undefined"){opts={}}if(!opts.complete){opts.complete=callback||function(){}}opts=utils.clone(opts);opts.continuous=opts.continuous||opts.live;opts.retry="retry"in opts?opts.retry:false;opts.PouchConstructor=opts.PouchConstructor||this;var replicateRet=new Replication(opts);var srcPouch=toPouch(src,opts);var targetPouch=toPouch(target,opts);replicate(srcPouch,targetPouch,opts,replicateRet);return replicateRet}module.exports={replicate:replicateWrapper,toPouch:toPouch}},{"../utils":106,"./replicate":101,"./replication":102}],101:[function(require,module,exports){"use strict";var utils=require("./../utils");var Checkpointer=require("./checkpointer");var backOff=require("./backoff");var genReplicationId=require("./gen-replication-id");var getDocs=require("./get-docs");function replicate(src,target,opts,returnValue,result){var batches=[];var currentBatch;var pendingBatch={seq:0,changes:[],docs:[]};var writingCheckpoint=false;var changesCompleted=false;var replicationCompleted=false;var last_seq=0;var continuous=opts.continuous||opts.live||false;var batch_size=opts.batch_size||100;var batches_limit=opts.batches_limit||10;var changesPending=false;var doc_ids=opts.doc_ids;var state={cancelled:false};var repId;var checkpointer;var allErrors=[];var changedDocs=[];result=result||{ok:true,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var changesOpts={};returnValue.ready(src,target);function initCheckpointer(){if(checkpointer){return utils.Promise.resolve()}return genReplicationId(src,target,opts).then(function(res){repId=res;checkpointer=new Checkpointer(src,target,repId,state)})}function writeDocs(){if(currentBatch.docs.length===0){return}var docs=currentBatch.docs;return target.bulkDocs({docs:docs,new_edits:false}).then(function(res){if(state.cancelled){completeReplication();throw new Error("cancelled")}var errors=[];var errorsById={};res.forEach(function(res){if(res.error){result.doc_write_failures++;errors.push(res);errorsById[res.id]=res}});allErrors=allErrors.concat(errors);result.docs_written+=currentBatch.docs.length-errors.length;var non403s=errors.filter(function(error){return error.name!=="unauthorized"&&error.name!=="forbidden"});changedDocs=[];docs.forEach(function(doc){var error=errorsById[doc._id];if(error){returnValue.emit("denied",utils.clone(error))}else{changedDocs.push(doc)}});if(non403s.length>0){var error=new Error("bulkDocs error");error.other_errors=errors;abortReplication("target.bulkDocs failed to write docs",error);throw new Error("bulkWrite partial failure")}},function(err){result.doc_write_failures+=docs.length;throw err})}function finishBatch(){writingCheckpoint=true;return checkpointer.writeCheckpoint(currentBatch.seq).then(function(){writingCheckpoint=false;if(state.cancelled){completeReplication();throw new Error("cancelled")}result.last_seq=last_seq=currentBatch.seq;var outResult=utils.clone(result);outResult.docs=changedDocs;returnValue.emit("change",outResult);currentBatch=undefined;getChanges()}).catch(function(err){writingCheckpoint=false;abortReplication("writeCheckpoint completed with error",err);throw err})}function getDiffs(){var diff={};currentBatch.changes.forEach(function(change){if(change.id==="_user/"){return}diff[change.id]=change.changes.map(function(x){return x.rev})});return target.revsDiff(diff).then(function(diffs){if(state.cancelled){completeReplication();throw new Error("cancelled")}currentBatch.diffs=diffs})}function getBatchDocs(){return getDocs(src,currentBatch.diffs,state).then(function(docs){docs.forEach(function(doc){delete currentBatch.diffs[doc._id];result.docs_read++;currentBatch.docs.push(doc)})})}function startNextBatch(){if(state.cancelled||currentBatch){return}if(batches.length===0){processPendingBatch(true);return}currentBatch=batches.shift();getDiffs().then(getBatchDocs).then(writeDocs).then(finishBatch).then(startNextBatch).catch(function(err){abortReplication("batch processing terminated with error",err)})}function processPendingBatch(immediate){if(pendingBatch.changes.length===0){if(batches.length===0&&!currentBatch){if(continuous&&changesOpts.live||changesCompleted){returnValue.state="pending";returnValue.emit("paused");returnValue.emit("uptodate",result)}if(changesCompleted){completeReplication()}}return}if(immediate||changesCompleted||pendingBatch.changes.length>=batch_size){batches.push(pendingBatch);pendingBatch={seq:0,changes:[],docs:[]};if(returnValue.state==="pending"||returnValue.state==="stopped"){returnValue.state="active";returnValue.emit("active")}startNextBatch()}}function abortReplication(reason,err){if(replicationCompleted){return}if(!err.message){err.message=reason}result.ok=false;result.status="aborting";result.errors.push(err);allErrors=allErrors.concat(err);batches=[];pendingBatch={seq:0,changes:[],docs:[]};completeReplication()}function completeReplication(){if(replicationCompleted){return}if(state.cancelled){result.status="cancelled";if(writingCheckpoint){return}}result.status=result.status||"complete";result.end_time=new Date;result.last_seq=last_seq;replicationCompleted=state.cancelled=true;var non403s=allErrors.filter(function(error){return error.name!=="unauthorized"&&error.name!=="forbidden"});if(non403s.length>0){var error=allErrors.pop();if(allErrors.length>0){error.other_errors=allErrors}error.result=result;backOff(opts,returnValue,error,function(){replicate(src,target,opts,returnValue)})}else{result.errors=allErrors;returnValue.emit("complete",result);returnValue.removeAllListeners()}}function onChange(change){if(state.cancelled){return completeReplication()}var filter=utils.filterChange(opts)(change);if(!filter){return}pendingBatch.seq=change.seq;pendingBatch.changes.push(change);processPendingBatch(batches.length===0)}function onChangesComplete(changes){changesPending=false;if(state.cancelled){return completeReplication()}if(changes.results.length>0){changesOpts.since=changes.last_seq;getChanges()}else{if(continuous){changesOpts.live=true;getChanges()}else{changesCompleted=true}}processPendingBatch(true)}function onChangesError(err){changesPending=false;if(state.cancelled){return completeReplication()}abortReplication("changes rejected",err)}function getChanges(){if(!(!changesPending&&!changesCompleted&&batches.length<batches_limit)){return}changesPending=true;function abortChanges(){changes.cancel()}function removeListener(){returnValue.removeListener("cancel",abortChanges)}if(returnValue._changes){returnValue.removeListener("cancel",returnValue._abortChanges);returnValue._changes.cancel()}returnValue.once("cancel",abortChanges);var changes=src.changes(changesOpts).on("change",onChange);changes.then(removeListener,removeListener);changes.then(onChangesComplete).catch(onChangesError);if(opts.retry){returnValue._changes=changes;returnValue._abortChanges=abortChanges}}function startChanges(){initCheckpointer().then(function(){if(state.cancelled){completeReplication();return}return checkpointer.getCheckpoint().then(function(checkpoint){last_seq=checkpoint;changesOpts={since:last_seq,limit:batch_size,batch_size:batch_size,style:"all_docs",doc_ids:doc_ids,returnDocs:true};if(opts.filter){if(typeof opts.filter!=="string"){changesOpts.include_docs=true}else{changesOpts.filter=opts.filter}}if(opts.query_params){changesOpts.query_params=opts.query_params}if(opts.view){changesOpts.view=opts.view}getChanges()})}).catch(function(err){abortReplication("getCheckpoint rejected with ",err)})}if(returnValue.cancelled){completeReplication();return}if(!returnValue._addedListeners){returnValue.once("cancel",completeReplication);if(typeof opts.onChange==="function"){returnValue.on("change",opts.onChange)}if(typeof opts.complete==="function"){returnValue.once("error",opts.complete);returnValue.once("complete",function(result){opts.complete(null,result)})}returnValue._addedListeners=true}if(typeof opts.since==="undefined"){startChanges()}else{initCheckpointer().then(function(){writingCheckpoint=true;return checkpointer.writeCheckpoint(opts.since)}).then(function(){writingCheckpoint=false;if(state.cancelled){completeReplication();return}last_seq=opts.since;startChanges()}).catch(function(err){writingCheckpoint=false;abortReplication("writeCheckpoint completed with error",err);throw err})}}module.exports=replicate},{"./../utils":106,"./backoff":96,"./checkpointer":97,"./gen-replication-id":98,"./get-docs":99}],102:[function(require,module,exports){"use strict";var utils=require("./../utils");var EE=require("events").EventEmitter;var Promise=utils.Promise;utils.inherits(Replication,EE);function Replication(){EE.call(this);this.cancelled=false;this.state="pending";var self=this;var promise=new Promise(function(fulfill,reject){self.once("complete",fulfill);self.once("error",reject)});self.then=function(resolve,reject){return promise.then(resolve,reject)};self.catch=function(reject){return promise.catch(reject)};self.catch(function(){})}Replication.prototype.cancel=function(){this.cancelled=true;this.state="cancelled";this.emit("cancel")};Replication.prototype.ready=function(src,target){var self=this;if(self._readyCalled){return}self._readyCalled=true;function onDestroy(){self.cancel()}src.once("destroyed",onDestroy);target.once("destroyed",onDestroy);function cleanup(){src.removeListener("destroyed",onDestroy);target.removeListener("destroyed",onDestroy)}self.once("complete",cleanup)};module.exports=Replication},{"./../utils":106,events:6}],103:[function(require,module,exports){"use strict";var PouchDB=require("./constructor");var utils=require("./utils");var EventEmitter=require("events").EventEmitter;PouchDB.adapters={};PouchDB.preferredAdapters=[];PouchDB.prefix="_pouch_";var eventEmitter=new EventEmitter;var eventEmitterMethods=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"];eventEmitterMethods.forEach(function(method){PouchDB[method]=eventEmitter[method].bind(eventEmitter)});PouchDB.setMaxListeners(0);PouchDB.parseAdapter=function(name,opts){var match=name.match(/([a-z\-]*):\/\/(.*)/);var adapter,adapterName;if(match){name=/http(s?)/.test(match[1])?match[1]+"://"+match[2]:match[2];adapter=match[1];if(!PouchDB.adapters[adapter].valid()){throw"Invalid adapter"}return{name:name,adapter:match[1]}}var skipIdb="idb"in PouchDB.adapters&&"websql"in PouchDB.adapters&&utils.hasLocalStorage()&&localStorage["_pouch__websqldb_"+PouchDB.prefix+name];if(opts.adapter){adapterName=opts.adapter}else if(typeof opts!=="undefined"&&opts.db){adapterName="leveldb"}else{for(var i=0;i<PouchDB.preferredAdapters.length;++i){adapterName=PouchDB.preferredAdapters[i];if(adapterName in PouchDB.adapters){if(skipIdb&&adapterName==="idb"){console.log('PouchDB is downgrading "'+name+'" to WebSQL to'+" avoid data loss, because it was already opened with WebSQL.");continue}break}}}adapter=PouchDB.adapters[adapterName];var usePrefix=adapter&&"use_prefix"in adapter?adapter.use_prefix:true;return{name:usePrefix?PouchDB.prefix+name:name,adapter:adapterName}};PouchDB.destroy=utils.toPromise(function(name,opts,callback){console.log("PouchDB.destroy() is deprecated and will be removed. "+"Please use db.destroy() instead.");if(typeof opts==="function"||typeof opts==="undefined"){callback=opts;opts={}}if(name&&typeof name==="object"){opts=name;name=undefined}new PouchDB(name,opts,function(err,db){if(err){return callback(err)}db.destroy(callback)})});PouchDB.adapter=function(id,obj,addToPreferredAdapters){if(obj.valid()){PouchDB.adapters[id]=obj;if(addToPreferredAdapters){PouchDB.preferredAdapters.push(id)}}};PouchDB.plugin=function(obj){Object.keys(obj).forEach(function(id){PouchDB.prototype[id]=obj[id]})};PouchDB.defaults=function(defaultOpts){function PouchAlt(name,opts,callback){if(typeof opts==="function"||typeof opts==="undefined"){callback=opts;opts={}}if(name&&typeof name==="object"){opts=name;name=undefined}opts=utils.extend(true,{},defaultOpts,opts);PouchDB.call(this,name,opts,callback)}utils.inherits(PouchAlt,PouchDB);PouchAlt.destroy=utils.toPromise(function(name,opts,callback){if(typeof opts==="function"||typeof opts==="undefined"){callback=opts;opts={}}if(name&&typeof name==="object"){opts=name;name=undefined}opts=utils.extend(true,{},defaultOpts,opts);return PouchDB.destroy(name,opts,callback)});eventEmitterMethods.forEach(function(method){PouchAlt[method]=eventEmitter[method].bind(eventEmitter)});PouchAlt.setMaxListeners(10);PouchAlt.preferredAdapters=PouchDB.preferredAdapters.slice();Object.keys(PouchDB).forEach(function(key){if(!(key in PouchAlt)){PouchAlt[key]=PouchDB[key]}});return PouchAlt};module.exports=PouchDB},{"./constructor":71,"./utils":106,events:6}],104:[function(require,module,exports){"use strict";var utils=require("./utils");var replication=require("./replicate");var replicate=replication.replicate;var EE=require("events").EventEmitter;utils.inherits(Sync,EE);module.exports=sync;function sync(src,target,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}if(typeof opts==="undefined"){opts={}}opts=utils.clone(opts);opts.PouchConstructor=opts.PouchConstructor||this;src=replication.toPouch(src,opts);target=replication.toPouch(target,opts);return new Sync(src,target,opts,callback)}function Sync(src,target,opts,callback){var self=this;this.canceled=false;var onChange,complete;if("onChange"in opts){onChange=opts.onChange;delete opts.onChange}if(typeof callback==="function"&&!opts.complete){complete=callback}else if("complete"in opts){complete=opts.complete;delete opts.complete}this.push=replicate(src,target,opts);this.pull=replicate(target,src,opts);var emittedCancel=false;function onCancel(data){if(!emittedCancel){emittedCancel=true;self.emit("cancel",data)}}function pullChange(change){self.emit("change",{direction:"pull",change:change})}function pushChange(change){self.emit("change",{direction:"push",change:change})}function pushDenied(doc){self.emit("denied",{direction:"push",doc:doc})}function pullDenied(doc){self.emit("denied",{direction:"pull",doc:doc})}var listeners={};var removed={};function removeAll(type){return function(event,func){var isChange=event==="change"&&(func===pullChange||func===pushChange);var isCancel=event==="cancel"&&func===onCancel;var isOtherEvent=event in listeners&&func===listeners[event];if(isChange||isCancel||isOtherEvent){if(!(event in removed)){removed[event]={}}removed[event][type]=true;if(Object.keys(removed[event]).length===2){self.removeAllListeners(event)}}}}if(opts.live){this.push.on("complete",self.pull.cancel.bind(self.pull));this.pull.on("complete",self.push.cancel.bind(self.push))}this.on("newListener",function(event){if(event==="change"){self.pull.on("change",pullChange);self.push.on("change",pushChange)}else if(event==="denied"){self.pull.on("denied",pullDenied);self.push.on("denied",pushDenied)}else if(event==="cancel"){self.pull.on("cancel",onCancel);self.push.on("cancel",onCancel)}else if(event!=="error"&&event!=="removeListener"&&event!=="complete"&&!(event in listeners)){listeners[event]=function(e){self.emit(event,e)};self.pull.on(event,listeners[event]);self.push.on(event,listeners[event])}});this.on("removeListener",function(event){if(event==="change"){self.pull.removeListener("change",pullChange);self.push.removeListener("change",pushChange)}else if(event==="cancel"){self.pull.removeListener("cancel",onCancel);self.push.removeListener("cancel",onCancel)}else if(event in listeners){if(typeof listeners[event]==="function"){self.pull.removeListener(event,listeners[event]);self.push.removeListener(event,listeners[event]);delete listeners[event]}}});this.pull.on("removeListener",removeAll("pull"));this.push.on("removeListener",removeAll("push"));var promise=utils.Promise.all([this.push,this.pull]).then(function(resp){var out={push:resp[0],pull:resp[1]};self.emit("complete",out);if(complete){complete(null,out)}self.removeAllListeners();return out},function(err){self.cancel();self.emit("error",err);if(complete){complete(err)}self.removeAllListeners();throw err});this.then=function(success,err){return promise.then(success,err)};this.catch=function(err){return promise.catch(err)}}Sync.prototype.cancel=function(){if(!this.canceled){this.canceled=true;this.push.cancel();this.pull.cancel()}}},{"./replicate":100,"./utils":106,events:6}],105:[function(require,module,exports){"use strict";module.exports=TaskQueue;function TaskQueue(){this.isReady=false;this.failed=false;this.queue=[]}TaskQueue.prototype.execute=function(){var d,func;if(this.failed){while(d=this.queue.shift()){if(typeof d==="function"){d(this.failed);continue}func=d.parameters[d.parameters.length-1];if(typeof func==="function"){func(this.failed)}else if(d.name==="changes"&&typeof func.complete==="function"){func.complete(this.failed)}}}else if(this.isReady){while(d=this.queue.shift()){if(typeof d==="function"){d()}else{d.task=this.db[d.name].apply(this.db,d.parameters)}}}};TaskQueue.prototype.fail=function(err){this.failed=err;this.execute()};TaskQueue.prototype.ready=function(db){if(this.failed){return false}else if(arguments.length===0){return this.isReady}this.isReady=db?true:false;this.db=db;this.execute()};TaskQueue.prototype.addTask=function(name,parameters){if(typeof name==="function"){this.queue.push(name);if(this.failed){this.execute()}}else{var task={name:name,parameters:parameters};this.queue.push(task);if(this.failed){this.execute()}return task}}},{}],106:[function(require,module,exports){(function(process){var merge=require("./merge");exports.extend=require("pouchdb-extend");exports.ajax=require("./deps/ajax");exports.createBlob=require("./deps/binary/blob");exports.uuid=require("./deps/uuid");exports.getArguments=require("argsarray");var errors=require("./deps/errors");var EventEmitter=require("events").EventEmitter;var collections=require("pouchdb-collections");exports.Map=collections.Map;exports.Set=collections.Set;var parseDoc=require("./deps/parse-doc");var Promise=require("./deps/promise");exports.Promise=Promise;var base64=require("./deps/binary/base64");exports.atob=base64.atob;exports.btoa=base64.btoa;var binaryStringToBlob=require("./deps/binary/binaryStringToBlob");var arrayBufferToBinaryString=require("./deps/binary/arrayBufferToBinaryString");var readAsArrayBuffer=require("./deps/binary/readAsArrayBuffer");exports.binaryStringToBlob=binaryStringToBlob;exports.lastIndexOf=function(str,char){for(var i=str.length-1;i>=0;i--){if(str.charAt(i)===char){return i}}return-1};exports.clone=function(obj){return exports.extend(true,{},obj)};exports.pick=function(obj,arr){var res={};for(var i=0,len=arr.length;i<len;i++){var prop=arr[i];res[prop]=obj[prop]}return res};exports.inherits=require("inherits");function isChromeApp(){return typeof chrome!=="undefined"&&typeof chrome.storage!=="undefined"&&typeof chrome.storage.local!=="undefined"}exports.call=exports.getArguments(function(args){if(!args.length){return}var fun=args.shift();if(typeof fun==="function"){fun.apply(this,args)}});exports.isLocalId=function(id){return/^_local/.test(id)};exports.isDeleted=function(metadata,rev){if(!rev){rev=merge.winningRev(metadata)}var dashIndex=rev.indexOf("-");if(dashIndex!==-1){rev=rev.substring(dashIndex+1)}var deleted=false;merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,id,acc,opts){if(id===rev){deleted=!!opts.deleted}});return deleted};exports.revExists=function(metadata,rev){var found=false;merge.traverseRevTree(metadata.rev_tree,function(leaf,pos,id){if(pos+"-"+id===rev){found=true}});return found};exports.filterChange=function filterChange(opts){var req={};var hasFilter=opts.filter&&typeof opts.filter==="function";req.query=opts.query_params;return function filter(change){if(!change.doc){change.doc={}}if(opts.filter&&hasFilter&&!opts.filter.call(this,change.doc,req)){return false}if(!opts.include_docs){delete change.doc}else if(!opts.attachments){for(var att in change.doc._attachments){if(change.doc._attachments.hasOwnProperty(att)){change.doc._attachments[att].stub=true}}}return true}};exports.parseDoc=parseDoc.parseDoc;exports.invalidIdError=parseDoc.invalidIdError;exports.isCordova=function(){return typeof cordova!=="undefined"||typeof PhoneGap!=="undefined"||typeof phonegap!=="undefined"};exports.hasLocalStorage=function(){if(isChromeApp()){return false}try{return localStorage}catch(e){return false}};exports.Changes=Changes;exports.inherits(Changes,EventEmitter);function Changes(){if(!(this instanceof Changes)){return new Changes}var self=this;EventEmitter.call(this);this.isChrome=isChromeApp();this._listeners={};this.hasLocal=false;if(!this.isChrome){this.hasLocal=exports.hasLocalStorage()}if(this.isChrome){chrome.storage.onChanged.addListener(function(e){if(e.db_name!=null){self.emit(e.dbName.newValue)}})}else if(this.hasLocal){if(typeof addEventListener!=="undefined"){addEventListener("storage",function(e){self.emit(e.key)})}else{window.attachEvent("storage",function(e){self.emit(e.key)})}}}Changes.prototype.addListener=function(dbName,id,db,opts){if(this._listeners[id]){return}var self=this;var inprogress=false;function eventFunction(){if(!self._listeners[id]){return}if(inprogress){inprogress="waiting";return}inprogress=true;db.changes({style:opts.style,
include_docs:opts.include_docs,attachments:opts.attachments,conflicts:opts.conflicts,continuous:false,descending:false,filter:opts.filter,doc_ids:opts.doc_ids,view:opts.view,since:opts.since,query_params:opts.query_params}).on("change",function(c){if(c.seq>opts.since&&!opts.cancelled){opts.since=c.seq;exports.call(opts.onChange,c)}}).on("complete",function(){if(inprogress==="waiting"){process.nextTick(function(){self.notify(dbName)})}inprogress=false}).on("error",function(){inprogress=false})}this._listeners[id]=eventFunction;this.on(dbName,eventFunction)};Changes.prototype.removeListener=function(dbName,id){if(!(id in this._listeners)){return}EventEmitter.prototype.removeListener.call(this,dbName,this._listeners[id])};Changes.prototype.notifyLocalWindows=function(dbName){if(this.isChrome){chrome.storage.local.set({dbName:dbName})}else if(this.hasLocal){localStorage[dbName]=localStorage[dbName]==="a"?"b":"a"}};Changes.prototype.notify=function(dbName){this.emit(dbName);this.notifyLocalWindows(dbName)};exports.once=function(fun){var called=false;return exports.getArguments(function(args){if(called){throw new Error("once called  more than once")}else{called=true;fun.apply(this,args)}})};exports.toPromise=function(func){return exports.getArguments(function(args){var self=this;var tempCB=typeof args[args.length-1]==="function"?args.pop():false;var usedCB;if(tempCB){usedCB=function(err,resp){process.nextTick(function(){tempCB(err,resp)})}}var promise=new Promise(function(fulfill,reject){var resp;try{var callback=exports.once(function(err,mesg){if(err){reject(err)}else{fulfill(mesg)}});args.push(callback);resp=func.apply(self,args);if(resp&&typeof resp.then==="function"){fulfill(resp)}}catch(e){reject(e)}});if(usedCB){promise.then(function(result){usedCB(null,result)},usedCB)}promise.cancel=function(){return this};return promise})};exports.adapterFun=function(name,callback){var log=require("debug")("pouchdb:api");function logApiCall(self,name,args){if(!log.enabled){return}var logArgs=[self._db_name,name];for(var i=0;i<args.length-1;i++){logArgs.push(args[i])}log.apply(null,logArgs);var origCallback=args[args.length-1];args[args.length-1]=function(err,res){var responseArgs=[self._db_name,name];responseArgs=responseArgs.concat(err?["error",err]:["success",res]);log.apply(null,responseArgs);origCallback(err,res)}}return exports.toPromise(exports.getArguments(function(args){if(this._closed){return Promise.reject(new Error("database is closed"))}var self=this;logApiCall(self,name,args);if(!this.taskqueue.isReady){return new Promise(function(fulfill,reject){self.taskqueue.addTask(function(failed){if(failed){reject(failed)}else{fulfill(self[name].apply(self,args))}})})}return callback.apply(this,args)}))};exports.cancellableFun=function(fun,self,opts){opts=opts?exports.clone(true,{},opts):{};var emitter=new EventEmitter;var oldComplete=opts.complete||function(){};var complete=opts.complete=exports.once(function(err,resp){if(err){oldComplete(err)}else{emitter.emit("end",resp);oldComplete(null,resp)}emitter.removeAllListeners()});var oldOnChange=opts.onChange||function(){};var lastChange=0;self.on("destroyed",function(){emitter.removeAllListeners()});opts.onChange=function(change){oldOnChange(change);if(change.seq<=lastChange){return}lastChange=change.seq;emitter.emit("change",change);if(change.deleted){emitter.emit("delete",change)}else if(change.changes.length===1&&change.changes[0].rev.slice(0,1)==="1-"){emitter.emit("create",change)}else{emitter.emit("update",change)}};var promise=new Promise(function(fulfill,reject){opts.complete=function(err,res){if(err){reject(err)}else{fulfill(res)}}});promise.then(function(result){complete(null,result)},complete);promise.cancel=function(){promise.isCancelled=true;if(self.taskqueue.isReady){opts.complete(null,{status:"cancelled"})}};if(!self.taskqueue.isReady){self.taskqueue.addTask(function(){if(promise.isCancelled){opts.complete(null,{status:"cancelled"})}else{fun(self,opts,promise)}})}else{fun(self,opts,promise)}promise.on=emitter.on.bind(emitter);promise.once=emitter.once.bind(emitter);promise.addListener=emitter.addListener.bind(emitter);promise.removeListener=emitter.removeListener.bind(emitter);promise.removeAllListeners=emitter.removeAllListeners.bind(emitter);promise.setMaxListeners=emitter.setMaxListeners.bind(emitter);promise.listeners=emitter.listeners.bind(emitter);promise.emit=emitter.emit.bind(emitter);return promise};exports.MD5=exports.toPromise(require("./deps/md5"));exports.explain404=require("./deps/explain404");exports.info=function(str){if(typeof console!=="undefined"&&"info"in console){console.info(str)}};exports.parseUri=require("./deps/parse-uri");exports.compare=function(left,right){return left<right?-1:left>right?1:0};exports.updateDoc=function updateDoc(prev,docInfo,results,i,cb,writeDoc,newEdits){if(exports.revExists(prev,docInfo.metadata.rev)){results[i]=docInfo;return cb()}var previousWinningRev=merge.winningRev(prev);var previouslyDeleted=exports.isDeleted(prev,previousWinningRev);var deleted=exports.isDeleted(docInfo.metadata);var isRoot=/^1-/.test(docInfo.metadata.rev);if(previouslyDeleted&&!deleted&&newEdits&&isRoot){var newDoc=docInfo.data;newDoc._rev=previousWinningRev;newDoc._id=docInfo.metadata.id;docInfo=exports.parseDoc(newDoc,newEdits)}var merged=merge.merge(prev.rev_tree,docInfo.metadata.rev_tree[0],1e3);var inConflict=newEdits&&(previouslyDeleted&&deleted||!previouslyDeleted&&merged.conflicts!=="new_leaf"||previouslyDeleted&&!deleted&&merged.conflicts==="new_branch");if(inConflict){var err=errors.error(errors.REV_CONFLICT);results[i]=err;return cb()}var newRev=docInfo.metadata.rev;docInfo.metadata.rev_tree=merged.tree;if(prev.rev_map){docInfo.metadata.rev_map=prev.rev_map}var winningRev=merge.winningRev(docInfo.metadata);var winningRevIsDeleted=exports.isDeleted(docInfo.metadata,winningRev);var delta=previouslyDeleted===winningRevIsDeleted?0:previouslyDeleted<winningRevIsDeleted?-1:1;var newRevIsDeleted=exports.isDeleted(docInfo.metadata,newRev);writeDoc(docInfo,winningRev,winningRevIsDeleted,newRevIsDeleted,true,delta,i,cb)};exports.processDocs=function processDocs(docInfos,api,fetchedDocs,tx,results,writeDoc,opts,overallCallback){if(!docInfos.length){return}function insertDoc(docInfo,resultsIdx,callback){var winningRev=merge.winningRev(docInfo.metadata);var deleted=exports.isDeleted(docInfo.metadata,winningRev);if("was_delete"in opts&&deleted){results[resultsIdx]=errors.error(errors.MISSING_DOC,"deleted");return callback()}var delta=deleted?0:1;writeDoc(docInfo,winningRev,deleted,deleted,false,delta,resultsIdx,callback)}var newEdits=opts.new_edits;var idsToDocs=new exports.Map;var docsDone=0;var docsToDo=docInfos.length;function checkAllDocsDone(){if(++docsDone===docsToDo&&overallCallback){overallCallback()}}docInfos.forEach(function(currentDoc,resultsIdx){if(currentDoc._id&&exports.isLocalId(currentDoc._id)){api[currentDoc._deleted?"_removeLocal":"_putLocal"](currentDoc,{ctx:tx},function(err){if(err){results[resultsIdx]=err}else{results[resultsIdx]={ok:true}}checkAllDocsDone()});return}var id=currentDoc.metadata.id;if(idsToDocs.has(id)){docsToDo--;idsToDocs.get(id).push([currentDoc,resultsIdx])}else{idsToDocs.set(id,[[currentDoc,resultsIdx]])}});idsToDocs.forEach(function(docs,id){var numDone=0;function docWritten(){if(++numDone<docs.length){nextDoc()}else{checkAllDocsDone()}}function nextDoc(){var value=docs[numDone];var currentDoc=value[0];var resultsIdx=value[1];if(fetchedDocs.has(id)){exports.updateDoc(fetchedDocs.get(id),currentDoc,results,resultsIdx,docWritten,writeDoc,newEdits)}else{insertDoc(currentDoc,resultsIdx,docWritten)}}nextDoc()})};exports.preprocessAttachments=function preprocessAttachments(docInfos,blobType,callback){if(!docInfos.length){return callback()}var docv=0;function parseBase64(data){try{return base64.atob(data)}catch(e){var err=errors.error(errors.BAD_ARG,"Attachments need to be base64 encoded");return{error:err}}}function preprocessAttachment(att,callback){if(att.stub){return callback()}if(typeof att.data==="string"){var asBinary=parseBase64(att.data);if(asBinary.error){return callback(asBinary.error)}att.length=asBinary.length;if(blobType==="blob"){att.data=binaryStringToBlob(asBinary,att.content_type)}else if(blobType==="base64"){att.data=base64.btoa(asBinary)}else{att.data=asBinary}exports.MD5(asBinary).then(function(result){att.digest="md5-"+result;callback()})}else{readAsArrayBuffer(att.data,function(buff){if(blobType==="binary"){att.data=arrayBufferToBinaryString(buff)}else if(blobType==="base64"){att.data=base64.btoa(arrayBufferToBinaryString(buff))}exports.MD5(buff).then(function(result){att.digest="md5-"+result;att.length=buff.byteLength;callback()})})}}var overallErr;docInfos.forEach(function(docInfo){var attachments=docInfo.data&&docInfo.data._attachments?Object.keys(docInfo.data._attachments):[];var recv=0;if(!attachments.length){return done()}function processedAttachment(err){overallErr=err;recv++;if(recv===attachments.length){done()}}for(var key in docInfo.data._attachments){if(docInfo.data._attachments.hasOwnProperty(key)){preprocessAttachment(docInfo.data._attachments[key],processedAttachment)}}});function done(){docv++;if(docInfos.length===docv){if(overallErr){callback(overallErr)}else{callback()}}}};exports.compactTree=function compactTree(metadata){var revs=[];merge.traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){if(opts.status==="available"&&!isLeaf){revs.push(pos+"-"+revHash);opts.status="missing"}});return revs};var vuvuzela=require("vuvuzela");exports.safeJsonParse=function safeJsonParse(str){try{return JSON.parse(str)}catch(e){return vuvuzela.parse(str)}};exports.safeJsonStringify=function safeJsonStringify(json){try{return JSON.stringify(json)}catch(e){return vuvuzela.stringify(json)}}}).call(this,require("_process"))},{"./deps/ajax":72,"./deps/binary/arrayBufferToBinaryString":73,"./deps/binary/base64":74,"./deps/binary/binaryStringToBlob":76,"./deps/binary/blob":77,"./deps/binary/readAsArrayBuffer":78,"./deps/errors":81,"./deps/explain404":82,"./deps/md5":83,"./deps/parse-doc":85,"./deps/parse-uri":87,"./deps/promise":88,"./deps/uuid":91,"./merge":95,_process:7,argsarray:27,debug:108,events:6,inherits:111,"pouchdb-collections":112,"pouchdb-extend":57,vuvuzela:120}],107:[function(require,module,exports){module.exports="3.6.0"},{}],108:[function(require,module,exports){exports=module.exports=require("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},{"./debug":109}],109:[function(require,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=require("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:110}],110:[function(require,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=""+str;if(str.length>1e4)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],111:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],112:[function(require,module,exports){"use strict";exports.Map=LazyMap;exports.Set=LazySet;function LazyMap(){this.store={}}LazyMap.prototype.mangle=function(key){if(typeof key!=="string"){throw new TypeError("key must be a string but Got "+key)}return"$"+key};LazyMap.prototype.unmangle=function(key){return key.substring(1)};LazyMap.prototype.get=function(key){var mangled=this.mangle(key);if(mangled in this.store){return this.store[mangled]}else{return void 0}};LazyMap.prototype.set=function(key,value){var mangled=this.mangle(key);this.store[mangled]=value;return true};LazyMap.prototype.has=function(key){var mangled=this.mangle(key);return mangled in this.store};LazyMap.prototype.delete=function(key){var mangled=this.mangle(key);if(mangled in this.store){delete this.store[mangled];return true}return false};LazyMap.prototype.forEach=function(cb){var self=this;var keys=Object.keys(self.store);keys.forEach(function(key){var value=self.store[key];key=self.unmangle(key);cb(value,key)})};function LazySet(array){this.store=new LazyMap;if(array&&Array.isArray(array)){for(var i=0,len=array.length;i<len;i++){this.add(array[i])}}}LazySet.prototype.add=function(key){return this.store.set(key,true)};LazySet.prototype.has=function(key){return this.store.has(key)};LazySet.prototype.delete=function(key){return this.store.delete(key)}},{}],113:[function(require,module,exports){"use strict";var upsert=require("./upsert");var utils=require("./utils");var Promise=utils.Promise;module.exports=function(opts){var sourceDB=opts.db;var viewName=opts.viewName;var mapFun=opts.map;var reduceFun=opts.reduce;var temporary=opts.temporary;var viewSignature=mapFun.toString()+(reduceFun&&reduceFun.toString())+"undefined";if(!temporary&&sourceDB._cachedViews){var cachedView=sourceDB._cachedViews[viewSignature];if(cachedView){return Promise.resolve(cachedView)}}return sourceDB.info().then(function(info){var depDbName=info.db_name+"-mrview-"+(temporary?"temp":utils.MD5(viewSignature));function diffFunction(doc){doc.views=doc.views||{};var fullViewName=viewName;if(fullViewName.indexOf("/")===-1){fullViewName=viewName+"/"+viewName}var depDbs=doc.views[fullViewName]=doc.views[fullViewName]||{};if(depDbs[depDbName]){return}depDbs[depDbName]=true;return doc}return upsert(sourceDB,"_local/mrviews",diffFunction).then(function(){return sourceDB.registerDependentDatabase(depDbName).then(function(res){var db=res.db;db.auto_compaction=true;var view={name:depDbName,db:db,sourceDB:sourceDB,adapter:sourceDB.adapter,mapFun:mapFun,reduceFun:reduceFun};return view.db.get("_local/lastSeq")["catch"](function(err){if(err.status!==404){throw err}}).then(function(lastSeqDoc){view.seq=lastSeqDoc?lastSeqDoc.seq:0;if(!temporary){sourceDB._cachedViews=sourceDB._cachedViews||{};sourceDB._cachedViews[viewSignature]=view;view.db.on("destroyed",function(){delete sourceDB._cachedViews[viewSignature]})}return view})})})})}},{"./upsert":117,"./utils":118}],114:[function(require,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func.replace(/;\s*$/,"")+");")}},{}],115:[function(require,module,exports){(function(process){"use strict";var pouchCollate=require("pouchdb-collate");var TaskQueue=require("./taskqueue");var collate=pouchCollate.collate;var toIndexableString=pouchCollate.toIndexableString;var normalizeKey=pouchCollate.normalizeKey;var createView=require("./create-view");var evalFunc=require("./evalfunc");var log;if(typeof console!=="undefined"&&typeof console.log==="function"){log=Function.prototype.bind.call(console.log,console)}else{log=function(){}}var utils=require("./utils");var Promise=utils.Promise;var persistentQueues={};var tempViewQueue=new TaskQueue;var CHANGES_BATCH_SIZE=50;function parseViewName(name){return name.indexOf("/")===-1?[name,name]:name.split("/")}function isGenOne(changes){return changes.length===1&&/^1-/.test(changes[0].rev)}function emitError(db,e){try{db.emit("error",e)}catch(err){console.error("The user's map/reduce function threw an uncaught error.\n"+"You can debug this error by doing:\n"+"myDatabase.on('error', function (err) { debugger; });\n"+"Please double-check your map/reduce function.");console.error(e)}}function tryCode(db,fun,args){try{return{output:fun.apply(null,args)}}catch(e){emitError(db,e);return{error:e}}}function sortByKeyThenValue(x,y){var keyCompare=collate(x.key,y.key);return keyCompare!==0?keyCompare:collate(x.value,y.value)}function sliceResults(results,limit,skip){skip=skip||0;if(typeof limit==="number"){return results.slice(skip,limit+skip)}else if(skip>0){return results.slice(skip)}return results}function rowToDocId(row){var val=row.value;var docId=val&&typeof val==="object"&&val._id||row.id;return docId}function createBuiltInError(name){var message="builtin "+name+" function requires map values to be numbers"+" or number arrays";return new BuiltInError(message)}function sum(values){var result=0;for(var i=0,len=values.length;i<len;i++){var num=values[i];if(typeof num!=="number"){if(Array.isArray(num)){result=typeof result==="number"?[result]:result;for(var j=0,jLen=num.length;j<jLen;j++){var jNum=num[j];if(typeof jNum!=="number"){throw createBuiltInError("_sum")}else if(typeof result[j]==="undefined"){result.push(jNum)}else{result[j]+=jNum}}}else{throw createBuiltInError("_sum")}}else if(typeof result==="number"){result+=num}else{result[0]+=num}}return result}var builtInReduce={_sum:function(keys,values){return sum(values)},_count:function(keys,values){return values.length},_stats:function(keys,values){function sumsqr(values){var _sumsqr=0;for(var i=0,len=values.length;i<len;i++){var num=values[i];_sumsqr+=num*num}return _sumsqr}return{sum:sum(values),min:Math.min.apply(null,values),max:Math.max.apply(null,values),count:values.length,sumsqr:sumsqr(values)}}};function addHttpParam(paramName,opts,params,asJson){var val=opts[paramName];if(typeof val!=="undefined"){if(asJson){val=encodeURIComponent(JSON.stringify(val))}params.push(paramName+"="+val)}}function checkQueryParseError(options,fun){var startkeyName=options.descending?"endkey":"startkey";var endkeyName=options.descending?"startkey":"endkey";if(typeof options[startkeyName]!=="undefined"&&typeof options[endkeyName]!=="undefined"&&collate(options[startkeyName],options[endkeyName])>0){throw new QueryParseError("No rows can match your key range, reverse your "+"start_key and end_key or set {descending : true}")}else if(fun.reduce&&options.reduce!==false){if(options.include_docs){throw new QueryParseError("{include_docs:true} is invalid for reduce")}else if(options.keys&&options.keys.length>1&&!options.group&&!options.group_level){throw new QueryParseError("Multi-key fetches for reduce views must use {group: true}")}}if(options.group_level){if(typeof options.group_level!=="number"){throw new QueryParseError('Invalid value for integer: "'+options.group_level+'"')}if(options.group_level<0){throw new QueryParseError("Invalid value for positive integer: "+'"'+options.group_level+'"')}}}function httpQuery(db,fun,opts){var params=[];var body;var method="GET";addHttpParam("reduce",opts,params);addHttpParam("include_docs",opts,params);addHttpParam("attachments",opts,params);addHttpParam("limit",opts,params);addHttpParam("descending",opts,params);addHttpParam("group",opts,params);addHttpParam("group_level",opts,params);addHttpParam("skip",opts,params);addHttpParam("stale",opts,params);addHttpParam("conflicts",opts,params);addHttpParam("startkey",opts,params,true);addHttpParam("endkey",opts,params,true);addHttpParam("inclusive_end",opts,params);addHttpParam("key",opts,params,true);params=params.join("&");params=params===""?"":"?"+params;if(typeof opts.keys!=="undefined"){var MAX_URL_LENGTH=2e3;var keysAsString="keys="+encodeURIComponent(JSON.stringify(opts.keys));if(keysAsString.length+params.length+1<=MAX_URL_LENGTH){params+=(params[0]==="?"?"&":"?")+keysAsString}else{method="POST";if(typeof fun==="string"){body=JSON.stringify({keys:opts.keys})}else{fun.keys=opts.keys}}}if(typeof fun==="string"){var parts=parseViewName(fun);return db.request({method:method,url:"_design/"+parts[0]+"/_view/"+parts[1]+params,body:body})}body=body||{};Object.keys(fun).forEach(function(key){if(Array.isArray(fun[key])){body[key]=fun[key]}else{body[key]=fun[key].toString()}});return db.request({method:"POST",url:"_temp_view"+params,body:body})}function defaultsTo(value){return function(reason){if(reason.status===404){return value}else{throw reason}}}function getDocsToPersist(docId,view,docIdsToChangesAndEmits){var metaDocId="_local/doc_"+docId;var defaultMetaDoc={_id:metaDocId,keys:[]};var docData=docIdsToChangesAndEmits[docId];var indexableKeysToKeyValues=docData.indexableKeysToKeyValues;var changes=docData.changes;function getMetaDoc(){if(isGenOne(changes)){return Promise.resolve(defaultMetaDoc)}return view.db.get(metaDocId)["catch"](defaultsTo(defaultMetaDoc))}function getKeyValueDocs(metaDoc){if(!metaDoc.keys.length){return Promise.resolve({rows:[]})}return view.db.allDocs({keys:metaDoc.keys,include_docs:true})}function processKvDocs(metaDoc,kvDocsRes){var kvDocs=[];var oldKeysMap={};for(var i=0,len=kvDocsRes.rows.length;i<len;i++){var row=kvDocsRes.rows[i];var doc=row.doc;if(!doc){continue}kvDocs.push(doc);oldKeysMap[doc._id]=true;doc._deleted=!indexableKeysToKeyValues[doc._id];if(!doc._deleted){var keyValue=indexableKeysToKeyValues[doc._id];if("value"in keyValue){doc.value=keyValue.value}}}var newKeys=Object.keys(indexableKeysToKeyValues);newKeys.forEach(function(key){if(!oldKeysMap[key]){var kvDoc={_id:key};var keyValue=indexableKeysToKeyValues[key];if("value"in keyValue){kvDoc.value=keyValue.value}kvDocs.push(kvDoc)}});metaDoc.keys=utils.uniq(newKeys.concat(metaDoc.keys));kvDocs.push(metaDoc);return kvDocs}return getMetaDoc().then(function(metaDoc){return getKeyValueDocs(metaDoc).then(function(kvDocsRes){return processKvDocs(metaDoc,kvDocsRes)})})}function saveKeyValues(view,docIdsToChangesAndEmits,seq){var seqDocId="_local/lastSeq";return view.db.get(seqDocId)["catch"](defaultsTo({_id:seqDocId,seq:0})).then(function(lastSeqDoc){var docIds=Object.keys(docIdsToChangesAndEmits);return Promise.all(docIds.map(function(docId){return getDocsToPersist(docId,view,docIdsToChangesAndEmits)})).then(function(listOfDocsToPersist){var docsToPersist=utils.flatten(listOfDocsToPersist);lastSeqDoc.seq=seq;docsToPersist.push(lastSeqDoc);return view.db.bulkDocs({docs:docsToPersist})})})}function getQueue(view){var viewName=typeof view==="string"?view:view.name;var queue=persistentQueues[viewName];if(!queue){queue=persistentQueues[viewName]=new TaskQueue}return queue}function updateView(view){return utils.sequentialize(getQueue(view),function(){return updateViewInQueue(view)})()}function updateViewInQueue(view){var mapResults;var doc;function emit(key,value){var output={id:doc._id,key:normalizeKey(key)};if(typeof value!=="undefined"&&value!==null){output.value=normalizeKey(value)}mapResults.push(output)}var mapFun;if(typeof view.mapFun==="function"&&view.mapFun.length===2){var origMap=view.mapFun;mapFun=function(doc){return origMap(doc,emit)}}else{mapFun=evalFunc(view.mapFun.toString(),emit,sum,log,Array.isArray,JSON.parse)}var currentSeq=view.seq||0;function processChange(docIdsToChangesAndEmits,seq){return function(){return saveKeyValues(view,docIdsToChangesAndEmits,seq)}}var queue=new TaskQueue;return new Promise(function(resolve,reject){function complete(){queue.finish().then(function(){view.seq=currentSeq;resolve()})}function processNextBatch(){view.sourceDB.changes({conflicts:true,include_docs:true,style:"all_docs",since:currentSeq,limit:CHANGES_BATCH_SIZE}).on("complete",function(response){var results=response.results;if(!results.length){return complete()}var docIdsToChangesAndEmits={};for(var i=0,l=results.length;i<l;i++){var change=results[i];if(change.doc._id[0]!=="_"){mapResults=[];doc=change.doc;if(!doc._deleted){tryCode(view.sourceDB,mapFun,[doc])}mapResults.sort(sortByKeyThenValue);var indexableKeysToKeyValues={};var lastKey;for(var j=0,jl=mapResults.length;j<jl;j++){var obj=mapResults[j];var complexKey=[obj.key,obj.id];if(collate(obj.key,lastKey)===0){complexKey.push(j)}var indexableKey=toIndexableString(complexKey);indexableKeysToKeyValues[indexableKey]=obj;lastKey=obj.key}docIdsToChangesAndEmits[change.doc._id]={indexableKeysToKeyValues:indexableKeysToKeyValues,changes:change.changes}}currentSeq=change.seq}queue.add(processChange(docIdsToChangesAndEmits,currentSeq));if(results.length<CHANGES_BATCH_SIZE){return complete()}return processNextBatch()}).on("error",onError);function onError(err){reject(err)}}processNextBatch()})}function reduceView(view,results,options){if(options.group_level===0){delete options.group_level}var shouldGroup=options.group||options.group_level;var reduceFun;if(builtInReduce[view.reduceFun]){reduceFun=builtInReduce[view.reduceFun]}else{reduceFun=evalFunc(view.reduceFun.toString(),null,sum,log,Array.isArray,JSON.parse)}var groups=[];var lvl=options.group_level;results.forEach(function(e){var last=groups[groups.length-1];var key=shouldGroup?e.key:null;if(shouldGroup&&Array.isArray(key)&&typeof lvl==="number"){key=key.length>lvl?key.slice(0,lvl):key}if(last&&collate(last.key[0][0],key)===0){last.key.push([key,e.id]);last.value.push(e.value);return}groups.push({key:[[key,e.id]],value:[e.value]})});for(var i=0,len=groups.length;i<len;i++){var e=groups[i];var reduceTry=tryCode(view.sourceDB,reduceFun,[e.key,e.value,false]);if(reduceTry.error&&reduceTry.error instanceof BuiltInError){throw reduceTry.error}e.value=reduceTry.error?null:reduceTry.output;e.key=e.key[0][0]}return{rows:sliceResults(groups,options.limit,options.skip)}}function queryView(view,opts){return utils.sequentialize(getQueue(view),function(){return queryViewInQueue(view,opts)})()}function queryViewInQueue(view,opts){var totalRows;var shouldReduce=view.reduceFun&&opts.reduce!==false;var skip=opts.skip||0;if(typeof opts.keys!=="undefined"&&!opts.keys.length){opts.limit=0;delete opts.keys}function fetchFromView(viewOpts){viewOpts.include_docs=true;return view.db.allDocs(viewOpts).then(function(res){totalRows=res.total_rows;return res.rows.map(function(result){if("value"in result.doc&&typeof result.doc.value==="object"&&result.doc.value!==null){var keys=Object.keys(result.doc.value).sort();var expectedKeys=["id","key","value"];if(!(keys<expectedKeys||keys>expectedKeys)){return result.doc.value}}var parsedKeyAndDocId=pouchCollate.parseIndexableString(result.doc._id);return{key:parsedKeyAndDocId[0],id:parsedKeyAndDocId[1],value:"value"in result.doc?result.doc.value:null}})})}function onMapResultsReady(rows){var finalResults;if(shouldReduce){finalResults=reduceView(view,rows,opts)}else{finalResults={total_rows:totalRows,offset:skip,rows:rows}}if(opts.include_docs){var docIds=utils.uniq(rows.map(rowToDocId));return view.sourceDB.allDocs({keys:docIds,include_docs:true,conflicts:opts.conflicts,attachments:opts.attachments}).then(function(allDocsRes){var docIdsToDocs={};allDocsRes.rows.forEach(function(row){if(row.doc){docIdsToDocs["$"+row.id]=row.doc}});rows.forEach(function(row){var docId=rowToDocId(row);var doc=docIdsToDocs["$"+docId];if(doc){row.doc=doc}});return finalResults})}else{return finalResults}}var flatten=function(array){return array.reduce(function(prev,cur){return prev.concat(cur)})};if(typeof opts.keys!=="undefined"){var keys=opts.keys;var fetchPromises=keys.map(function(key){var viewOpts={startkey:toIndexableString([key]),endkey:toIndexableString([key,{}])};return fetchFromView(viewOpts)});return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady)}else{var viewOpts={descending:opts.descending};if(typeof opts.startkey!=="undefined"){viewOpts.startkey=opts.descending?toIndexableString([opts.startkey,{}]):toIndexableString([opts.startkey])}if(typeof opts.endkey!=="undefined"){var inclusiveEnd=opts.inclusive_end!==false;if(opts.descending){inclusiveEnd=!inclusiveEnd}viewOpts.endkey=toIndexableString(inclusiveEnd?[opts.endkey,{}]:[opts.endkey])}if(typeof opts.key!=="undefined"){var keyStart=toIndexableString([opts.key]);

var keyEnd=toIndexableString([opts.key,{}]);if(viewOpts.descending){viewOpts.endkey=keyStart;viewOpts.startkey=keyEnd}else{viewOpts.startkey=keyStart;viewOpts.endkey=keyEnd}}if(!shouldReduce){if(typeof opts.limit==="number"){viewOpts.limit=opts.limit}viewOpts.skip=skip}return fetchFromView(viewOpts).then(onMapResultsReady)}}function httpViewCleanup(db){return db.request({method:"POST",url:"_view_cleanup"})}function localViewCleanup(db){return db.get("_local/mrviews").then(function(metaDoc){var docsToViews={};Object.keys(metaDoc.views).forEach(function(fullViewName){var parts=parseViewName(fullViewName);var designDocName="_design/"+parts[0];var viewName=parts[1];docsToViews[designDocName]=docsToViews[designDocName]||{};docsToViews[designDocName][viewName]=true});var opts={keys:Object.keys(docsToViews),include_docs:true};return db.allDocs(opts).then(function(res){var viewsToStatus={};res.rows.forEach(function(row){var ddocName=row.key.substring(8);Object.keys(docsToViews[row.key]).forEach(function(viewName){var fullViewName=ddocName+"/"+viewName;if(!metaDoc.views[fullViewName]){fullViewName=viewName}var viewDBNames=Object.keys(metaDoc.views[fullViewName]);var statusIsGood=row.doc&&row.doc.views&&row.doc.views[viewName];viewDBNames.forEach(function(viewDBName){viewsToStatus[viewDBName]=viewsToStatus[viewDBName]||statusIsGood})})});var dbsToDelete=Object.keys(viewsToStatus).filter(function(viewDBName){return!viewsToStatus[viewDBName]});var destroyPromises=dbsToDelete.map(function(viewDBName){return utils.sequentialize(getQueue(viewDBName),function(){return new db.constructor(viewDBName,db.__opts).destroy()})()});return Promise.all(destroyPromises).then(function(){return{ok:true}})})},defaultsTo({ok:true}))}exports.viewCleanup=utils.callbackify(function(){var db=this;if(db.type()==="http"){return httpViewCleanup(db)}return localViewCleanup(db)});function queryPromised(db,fun,opts){if(db.type()==="http"){return httpQuery(db,fun,opts)}if(typeof fun!=="string"){checkQueryParseError(opts,fun);var createViewOpts={db:db,viewName:"temp_view/temp_view",map:fun.map,reduce:fun.reduce,temporary:true};tempViewQueue.add(function(){return createView(createViewOpts).then(function(view){function cleanup(){return view.db.destroy()}return utils.fin(updateView(view).then(function(){return queryView(view,opts)}),cleanup)})});return tempViewQueue.finish()}else{var fullViewName=fun;var parts=parseViewName(fullViewName);var designDocName=parts[0];var viewName=parts[1];return db.get("_design/"+designDocName).then(function(doc){var fun=doc.views&&doc.views[viewName];if(!fun||typeof fun.map!=="string"){throw new NotFoundError("ddoc "+designDocName+" has no view named "+viewName)}checkQueryParseError(opts,fun);var createViewOpts={db:db,viewName:fullViewName,map:fun.map,reduce:fun.reduce};return createView(createViewOpts).then(function(view){if(opts.stale==="ok"||opts.stale==="update_after"){if(opts.stale==="update_after"){process.nextTick(function(){updateView(view)})}return queryView(view,opts)}else{return updateView(view).then(function(){return queryView(view,opts)})}})})}}exports.query=function(fun,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}opts=utils.extend(true,{},opts);if(typeof fun==="function"){fun={map:fun}}var db=this;var promise=Promise.resolve().then(function(){return queryPromised(db,fun,opts)});utils.promisedCallback(promise,callback);return promise};function QueryParseError(message){this.status=400;this.name="query_parse_error";this.message=message;this.error=true;try{Error.captureStackTrace(this,QueryParseError)}catch(e){}}utils.inherits(QueryParseError,Error);function NotFoundError(message){this.status=404;this.name="not_found";this.message=message;this.error=true;try{Error.captureStackTrace(this,NotFoundError)}catch(e){}}utils.inherits(NotFoundError,Error);function BuiltInError(message){this.status=500;this.name="invalid_value";this.message=message;this.error=true;try{Error.captureStackTrace(this,BuiltInError)}catch(e){}}utils.inherits(BuiltInError,Error)}).call(this,require("_process"))},{"./create-view":113,"./evalfunc":114,"./taskqueue":116,"./utils":118,_process:7,"pouchdb-collate":55}],116:[function(require,module,exports){"use strict";var Promise=require("./utils").Promise;function TaskQueue(){this.promise=new Promise(function(fulfill){fulfill()})}TaskQueue.prototype.add=function(promiseFactory){this.promise=this.promise["catch"](function(){}).then(function(){return promiseFactory()});return this.promise};TaskQueue.prototype.finish=function(){return this.promise};module.exports=TaskQueue},{"./utils":118}],117:[function(require,module,exports){"use strict";var upsert=require("pouchdb-upsert").upsert;module.exports=function(db,doc,diffFun){return upsert.apply(db,[doc,diffFun])}},{"pouchdb-upsert":119}],118:[function(require,module,exports){(function(process,global){"use strict";if(typeof global.Promise==="function"){exports.Promise=global.Promise}else{exports.Promise=require("lie")}exports.inherits=require("inherits");exports.extend=require("pouchdb-extend");var argsarray=require("argsarray");exports.promisedCallback=function(promise,callback){if(callback){promise.then(function(res){process.nextTick(function(){callback(null,res)})},function(reason){process.nextTick(function(){callback(reason)})})}return promise};exports.callbackify=function(fun){return argsarray(function(args){var cb=args.pop();var promise=fun.apply(this,args);if(typeof cb==="function"){exports.promisedCallback(promise,cb)}return promise})};exports.fin=function(promise,cb){return promise.then(function(res){var promise2=cb();if(typeof promise2.then==="function"){return promise2.then(function(){return res})}return res},function(reason){var promise2=cb();if(typeof promise2.then==="function"){return promise2.then(function(){throw reason})}throw reason})};exports.sequentialize=function(queue,promiseFactory){return function(){var args=arguments;var that=this;return queue.add(function(){return promiseFactory.apply(that,args)})}};exports.flatten=function(arrs){var res=[];for(var i=0,len=arrs.length;i<len;i++){res=res.concat(arrs[i])}return res};exports.uniq=function(arr){var map={};for(var i=0,len=arr.length;i<len;i++){map["$"+arr[i]]=true}var keys=Object.keys(map);var output=new Array(keys.length);for(i=0,len=keys.length;i<len;i++){output[i]=keys[i].substring(1)}return output};var crypto=require("crypto");var Md5=require("spark-md5");exports.MD5=function(string){if(!process.browser){return crypto.createHash("md5").update(string).digest("hex")}else{return Md5.hash(string)}}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:7,argsarray:27,crypto:1,inherits:111,lie:39,"pouchdb-extend":57,"spark-md5":124}],119:[function(require,module,exports){(function(global){"use strict";var PouchPromise;if(typeof window!=="undefined"&&window.PouchDB){PouchPromise=window.PouchDB.utils.Promise}else{PouchPromise=typeof global.Promise==="function"?global.Promise:require("lie")}function upsertInner(db,docId,diffFun){return new PouchPromise(function(fulfill,reject){if(typeof docId!=="string"){return reject(new Error("doc id is required"))}db.get(docId,function(err,doc){if(err){if(err.status!==404){return reject(err)}doc={}}var docRev=doc._rev;var newDoc=diffFun(doc);if(!newDoc){return fulfill({updated:false,rev:docRev})}newDoc._id=docId;newDoc._rev=docRev;fulfill(tryAndPut(db,newDoc,diffFun))})})}function tryAndPut(db,doc,diffFun){return db.put(doc).then(function(res){return{updated:true,rev:res.rev}},function(err){if(err.status!==409){throw err}return upsertInner(db,doc._id,diffFun)})}exports.upsert=function upsert(docId,diffFun,cb){var db=this;var promise=upsertInner(db,docId,diffFun);if(typeof cb!=="function"){return promise}promise.then(function(resp){cb(null,resp)},cb)};exports.putIfNotExists=function putIfNotExists(docId,doc,cb){var db=this;if(typeof docId!=="string"){cb=doc;doc=docId;docId=doc._id}var diffFun=function(existingDoc){if(existingDoc._rev){return false}return doc};var promise=upsertInner(db,docId,diffFun);if(typeof cb!=="function"){return promise}promise.then(function(resp){cb(null,resp)},cb)};if(typeof window!=="undefined"&&window.PouchDB){window.PouchDB.plugin(exports)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{lie:39}],120:[function(require,module,exports){"use strict";exports.stringify=function stringify(input){var queue=[];queue.push({obj:input});var res="";var next,obj,prefix,val,i,arrayPrefix,keys,k,key,value,objPrefix;while(next=queue.pop()){obj=next.obj;prefix=next.prefix||"";val=next.val||"";res+=prefix;if(val){res+=val}else if(typeof obj!=="object"){res+=typeof obj==="undefined"?null:JSON.stringify(obj)}else if(obj===null){res+="null"}else if(Array.isArray(obj)){queue.push({val:"]"});for(i=obj.length-1;i>=0;i--){arrayPrefix=i===0?"":",";queue.push({obj:obj[i],prefix:arrayPrefix})}queue.push({val:"["})}else{keys=[];for(k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}queue.push({val:"}"});for(i=keys.length-1;i>=0;i--){key=keys[i];value=obj[key];objPrefix=i>0?",":"";objPrefix+=JSON.stringify(key)+":";queue.push({obj:value,prefix:objPrefix})}queue.push({val:"{"})}}return res};function pop(obj,stack,metaStack){var lastMetaElement=metaStack[metaStack.length-1];if(obj===lastMetaElement.element){metaStack.pop();lastMetaElement=metaStack[metaStack.length-1]}var element=lastMetaElement.element;var lastElementIndex=lastMetaElement.index;if(Array.isArray(element)){element.push(obj)}else if(lastElementIndex===stack.length-2){var key=stack.pop();element[key]=obj}else{stack.push(obj)}}exports.parse=function(str){var stack=[];var metaStack=[];var i=0;var collationIndex,parsedNum,numChar;var parsedString,lastCh,numConsecutiveSlashes,ch;var arrayElement,objElement;while(true){collationIndex=str[i++];if(collationIndex==="}"||collationIndex==="]"||typeof collationIndex==="undefined"){if(stack.length===1){return stack.pop()}else{pop(stack.pop(),stack,metaStack);continue}}switch(collationIndex){case" ":case"	":case"\n":case":":case",":break;case"n":i+=3;pop(null,stack,metaStack);break;case"t":i+=3;pop(true,stack,metaStack);break;case"f":i+=4;pop(false,stack,metaStack);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":parsedNum="";i--;while(true){numChar=str[i++];if(/[\d\.\-e\+]/.test(numChar)){parsedNum+=numChar}else{i--;break}}pop(parseFloat(parsedNum),stack,metaStack);break;case'"':parsedString="";lastCh=void 0;numConsecutiveSlashes=0;while(true){ch=str[i++];if(ch!=='"'||lastCh==="\\"&&numConsecutiveSlashes%2===1){parsedString+=ch;lastCh=ch;if(lastCh==="\\"){numConsecutiveSlashes++}else{numConsecutiveSlashes=0}}else{break}}pop(JSON.parse('"'+parsedString+'"'),stack,metaStack);break;case"[":arrayElement={element:[],index:stack.length};stack.push(arrayElement.element);metaStack.push(arrayElement);break;case"{":objElement={element:{},index:stack.length};stack.push(objElement.element);metaStack.push(objElement);break;default:throw new Error("unexpectedly reached end of input: "+collationIndex)}}}},{}],121:[function(require,module,exports){var charenc={utf8:{stringToBytes:function(str){return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)))},bytesToString:function(bytes){return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)))}},bin:{stringToBytes:function(str){for(var bytes=[],i=0;i<str.length;i++)bytes.push(str.charCodeAt(i)&255);return bytes},bytesToString:function(bytes){for(var str=[],i=0;i<bytes.length;i++)str.push(String.fromCharCode(bytes[i]));return str.join("")}}};module.exports=charenc},{}],122:[function(require,module,exports){(function(){var base64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",crypt={rotl:function(n,b){return n<<b|n>>>32-b},rotr:function(n,b){return n<<32-b|n>>>b},endian:function(n){if(n.constructor==Number){return crypt.rotl(n,8)&16711935|crypt.rotl(n,24)&4278255360}for(var i=0;i<n.length;i++)n[i]=crypt.endian(n[i]);return n},randomBytes:function(n){for(var bytes=[];n>0;n--)bytes.push(Math.floor(Math.random()*256));return bytes},bytesToWords:function(bytes){for(var words=[],i=0,b=0;i<bytes.length;i++,b+=8)words[b>>>5]|=bytes[i]<<24-b%32;return words},wordsToBytes:function(words){for(var bytes=[],b=0;b<words.length*32;b+=8)bytes.push(words[b>>>5]>>>24-b%32&255);return bytes},bytesToHex:function(bytes){for(var hex=[],i=0;i<bytes.length;i++){hex.push((bytes[i]>>>4).toString(16));hex.push((bytes[i]&15).toString(16))}return hex.join("")},hexToBytes:function(hex){for(var bytes=[],c=0;c<hex.length;c+=2)bytes.push(parseInt(hex.substr(c,2),16));return bytes},bytesToBase64:function(bytes){for(var base64=[],i=0;i<bytes.length;i+=3){var triplet=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2];for(var j=0;j<4;j++)if(i*8+j*6<=bytes.length*8)base64.push(base64map.charAt(triplet>>>6*(3-j)&63));else base64.push("=")}return base64.join("")},base64ToBytes:function(base64){base64=base64.replace(/[^A-Z0-9+\/]/gi,"");for(var bytes=[],i=0,imod4=0;i<base64.length;imod4=++i%4){if(imod4==0)continue;bytes.push((base64map.indexOf(base64.charAt(i-1))&Math.pow(2,-2*imod4+8)-1)<<imod4*2|base64map.indexOf(base64.charAt(i))>>>6-imod4*2)}return bytes}};module.exports=crypt})()},{}],123:[function(require,module,exports){(function(Buffer){(function(){var crypt=require("crypt"),utf8=require("charenc").utf8,bin=require("charenc").bin,sha1=function(message){if(message.constructor==String)message=utf8.stringToBytes(message);else if(typeof Buffer!=="undefined"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(message))message=Array.prototype.slice.call(message,0);else if(!Array.isArray(message))message=message.toString();var m=crypt.bytesToWords(message),l=message.length*8,w=[],H0=1732584193,H1=-271733879,H2=-1732584194,H3=271733878,H4=-1009589776;m[l>>5]|=128<<24-l%32;m[(l+64>>>9<<4)+15]=l;for(var i=0;i<m.length;i+=16){var a=H0,b=H1,c=H2,d=H3,e=H4;for(var j=0;j<80;j++){if(j<16)w[j]=m[i+j];else{var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];w[j]=n<<1|n>>>31}var t=(H0<<5|H0>>>27)+H4+(w[j]>>>0)+(j<20?(H1&H2|~H1&H3)+1518500249:j<40?(H1^H2^H3)+1859775393:j<60?(H1&H2|H1&H3|H2&H3)-1894007588:(H1^H2^H3)-899497514);H4=H3;H3=H2;H2=H1<<30|H1>>>2;H1=H0;H0=t}H0+=a;H1+=b;H2+=c;H3+=d;H4+=e}return[H0,H1,H2,H3,H4]},api=function(message,options){var digestbytes=crypt.wordsToBytes(sha1(message));return options&&options.asBytes?digestbytes:options&&options.asString?bin.bytesToString(digestbytes):crypt.bytesToHex(digestbytes)};api._blocksize=16;api._digestsize=20;module.exports=api})()}).call(this,require("buffer").Buffer)},{buffer:2,charenc:121,crypt:122}],124:[function(require,module,exports){(function(factory){if(typeof exports==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{var glob;try{glob=window}catch(e){glob=self}glob.SparkMD5=factory()}})(function(undefined){"use strict";var add32=function(a,b){return a+b&4294967295},cmn=function(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32(a<<s|a>>>32-s,b)},ff=function(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t)},gg=function(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t)},hh=function(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)},ii=function(a,b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t)},md5cycle=function(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3])},md5blk=function(s){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24)}return md5blks},md5blk_array=function(a){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=a[i]+(a[i+1]<<8)+(a[i+2]<<16)+(a[i+3]<<24)}return md5blks},md51=function(s){var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i,length,tail,tmp,lo,hi;for(i=64;i<=n;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)))}s=s.substring(i-64);length=s.length;tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<length;i+=1){tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3)}tail[i>>2]|=128<<(i%4<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i+=1){tail[i]=0}}tmp=n*8;tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/);lo=parseInt(tmp[2],16);hi=parseInt(tmp[1],16)||0;tail[14]=lo;tail[15]=hi;md5cycle(state,tail);return state},md51_array=function(a){var n=a.length,state=[1732584193,-271733879,-1732584194,271733878],i,length,tail,tmp,lo,hi;for(i=64;i<=n;i+=64){md5cycle(state,md5blk_array(a.subarray(i-64,i)))}a=i-64<n?a.subarray(i-64):new Uint8Array(0);length=a.length;tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<length;i+=1){tail[i>>2]|=a[i]<<(i%4<<3)}tail[i>>2]|=128<<(i%4<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i+=1){tail[i]=0}}tmp=n*8;tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/);lo=parseInt(tmp[2],16);hi=parseInt(tmp[1],16)||0;tail[14]=lo;tail[15]=hi;md5cycle(state,tail);return state},hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],rhex=function(n){var s="",j;for(j=0;j<4;j+=1){s+=hex_chr[n>>j*8+4&15]+hex_chr[n>>j*8&15]}return s},hex=function(x){var i;for(i=0;i<x.length;i+=1){x[i]=rhex(x[i])}return x.join("")},md5=function(s){return hex(md51(s))},SparkMD5=function(){this.reset()};if(md5("hello")!=="5d41402abc4b2a76b9719d911017c592"){add32=function(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}}SparkMD5.prototype.append=function(str){if(/[\u0080-\uFFFF]/.test(str)){str=unescape(encodeURIComponent(str))}this.appendBinary(str);return this};SparkMD5.prototype.appendBinary=function(contents){this._buff+=contents;this._length+=contents.length;var length=this._buff.length,i;for(i=64;i<=length;i+=64){md5cycle(this._state,md5blk(this._buff.substring(i-64,i)))}this._buff=this._buff.substr(i-64);return this};SparkMD5.prototype.end=function(raw){var buff=this._buff,length=buff.length,i,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ret;for(i=0;i<length;i+=1){tail[i>>2]|=buff.charCodeAt(i)<<(i%4<<3)}this._finish(tail,length);ret=!!raw?this._state:hex(this._state);this.reset();return ret};SparkMD5.prototype._finish=function(tail,length){var i=length,tmp,lo,hi;tail[i>>2]|=128<<(i%4<<3);if(i>55){md5cycle(this._state,tail);for(i=0;i<16;i+=1){tail[i]=0}}tmp=this._length*8;tmp=tmp.toString(16).match(/(.*?)(.{0,8})$/);lo=parseInt(tmp[2],16);hi=parseInt(tmp[1],16)||0;tail[14]=lo;tail[15]=hi;md5cycle(this._state,tail)};SparkMD5.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};SparkMD5.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};SparkMD5.hash=function(str,raw){if(/[\u0080-\uFFFF]/.test(str)){str=unescape(encodeURIComponent(str))}var hash=md51(str);return!!raw?hash:hex(hash)};SparkMD5.hashBinary=function(content,raw){var hash=md51(content);return!!raw?hash:hex(hash)};SparkMD5.ArrayBuffer=function(){this.reset()};SparkMD5.ArrayBuffer.prototype.append=function(arr){var buff=this._concatArrayBuffer(this._buff,arr),length=buff.length,i;this._length+=arr.byteLength;for(i=64;i<=length;i+=64){md5cycle(this._state,md5blk_array(buff.subarray(i-64,i)))}this._buff=i-64<length?buff.subarray(i-64):new Uint8Array(0);return this};SparkMD5.ArrayBuffer.prototype.end=function(raw){var buff=this._buff,length=buff.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,ret;for(i=0;i<length;i+=1){tail[i>>2]|=buff[i]<<(i%4<<3)}this._finish(tail,length);ret=!!raw?this._state:hex(this._state);this.reset();return ret};SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish;SparkMD5.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy;SparkMD5.ArrayBuffer.prototype._concatArrayBuffer=function(first,second){var firstLength=first.length,result=new Uint8Array(firstLength+second.byteLength);result.set(first);result.set(new Uint8Array(second),firstLength);return result};SparkMD5.ArrayBuffer.hash=function(arr,raw){var hash=md51_array(new Uint8Array(arr));return!!raw?hash:hex(hash)};return SparkMD5})},{}],125:[function(require,module,exports){(function(root,factory){if(typeof define==="function"&&define.amd){define("bloodhound",["jquery"],function(a0){return root["Bloodhound"]=factory(a0)})}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{root["Bloodhound"]=factory(jQuery)}})(this,function($){var _=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:false},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return typeof obj==="string"},isNumber:function(obj){return typeof obj==="number"},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return typeof obj==="undefined"},isElement:function(obj){return!!(obj&&obj.nodeType===1)},isJQuery:function(obj){return obj instanceof $},toStr:function toStr(s){return _.isUndefined(s)||s===null?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,reverseArgs);function reverseArgs(index,value){return cb(value,index)}},map:$.map,filter:$.grep,every:function(obj,test){var result=true;if(!obj){return result}$.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj))){return false}});return!!result},some:function(obj,test){var result=false;if(!obj){return result}$.each(obj,function(key,val){if(result=test.call(null,val,key,obj)){return false}});return!!result},mixin:$.extend,identity:function(x){return x},clone:function(obj){return $.extend(true,{},obj)},getIdGenerator:function(){var counter=0;return function(){return counter++}},templatify:function templatify(obj){return $.isFunction(obj)?obj:template;function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}return result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;previous=0;later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}},stringify:function(val){return _.isString(val)?val:JSON.stringify(val)},noop:function(){}}}();var VERSION="0.11.1";var tokenizers=function(){"use strict";return{nonword:nonword,whitespace:whitespace,obj:{nonword:getObjTokenizer(nonword),whitespace:getObjTokenizer(whitespace)}};function whitespace(str){str=_.toStr(str);return str?str.split(/\s+/):[]}function nonword(str){str=_.toStr(str);return str?str.split(/\W+/):[]}function getObjTokenizer(tokenizer){return function setKey(keys){keys=_.isArray(keys)?keys:[].slice.call(arguments,0);return function tokenize(o){var tokens=[];_.each(keys,function(k){tokens=tokens.concat(tokenizer(_.toStr(o[k])))});return tokens}}}}();var LruCache=function(){"use strict";function LruCache(maxSize){this.maxSize=_.isNumber(maxSize)?maxSize:100;this.reset();if(this.maxSize<=0){this.set=this.get=$.noop}}_.mixin(LruCache.prototype,{set:function set(key,val){var tailItem=this.list.tail,node;if(this.size>=this.maxSize){this.list.remove(tailItem);delete this.hash[tailItem.key];this.size--}if(node=this.hash[key]){node.val=val;this.list.moveToFront(node)}else{node=new Node(key,val);this.list.add(node);this.hash[key]=node;this.size++}},get:function get(key){var node=this.hash[key];if(node){this.list.moveToFront(node);return node.val}},reset:function reset(){this.size=0;this.hash={};this.list=new List}});function List(){this.head=this.tail=null}_.mixin(List.prototype,{add:function add(node){if(this.head){node.next=this.head;this.head.prev=node}this.head=node;this.tail=this.tail||node},remove:function remove(node){node.prev?node.prev.next=node.next:this.head=node.next;node.next?node.next.prev=node.prev:this.tail=node.prev},moveToFront:function(node){this.remove(node);this.add(node)}});function Node(key,val){this.key=key;this.val=val;this.prev=this.next=null}return LruCache}();var PersistentStorage=function(){"use strict";var LOCAL_STORAGE;try{LOCAL_STORAGE=window.localStorage;LOCAL_STORAGE.setItem("~~~","!");LOCAL_STORAGE.removeItem("~~~")}catch(err){LOCAL_STORAGE=null}function PersistentStorage(namespace,override){this.prefix=["__",namespace,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+_.escapeRegExChars(this.prefix));this.ls=override||LOCAL_STORAGE;!this.ls&&this._noop()}_.mixin(PersistentStorage.prototype,{_prefix:function(key){return this.prefix+key},_ttlKey:function(key){return this._prefix(key)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=_.noop},_safeSet:function(key,val){try{this.ls.setItem(key,val)}catch(err){if(err.name==="QuotaExceededError"){this.clear();this._noop()}}},get:function(key){if(this.isExpired(key)){this.remove(key)}return decode(this.ls.getItem(this._prefix(key)))},set:function(key,val,ttl){if(_.isNumber(ttl)){this._safeSet(this._ttlKey(key),encode(now()+ttl))}else{this.ls.removeItem(this._ttlKey(key))}return this._safeSet(this._prefix(key),encode(val))},remove:function(key){this.ls.removeItem(this._ttlKey(key));this.ls.removeItem(this._prefix(key));return this},clear:function(){var i,keys=gatherMatchingKeys(this.keyMatcher);for(i=keys.length;i--;){this.remove(keys[i])}return this},isExpired:function(key){var ttl=decode(this.ls.getItem(this._ttlKey(key)));return _.isNumber(ttl)&&now()>ttl?true:false}});return PersistentStorage;function now(){return(new Date).getTime()}function encode(val){return JSON.stringify(_.isUndefined(val)?null:val)}function decode(val){return $.parseJSON(val)}function gatherMatchingKeys(keyMatcher){var i,key,keys=[],len=LOCAL_STORAGE.length;for(i=0;i<len;i++){if((key=LOCAL_STORAGE.key(i)).match(keyMatcher)){keys.push(key.replace(keyMatcher,""))}}return keys}}();var Transport=function(){"use strict";var pendingRequestsCount=0,pendingRequests={},maxPendingRequests=6,sharedCache=new LruCache(10);function Transport(o){o=o||{};this.cancelled=false;this.lastReq=null;this._send=o.transport;this._get=o.limiter?o.limiter(this._get):this._get;this._cache=o.cache===false?new LruCache(0):sharedCache}Transport.setMaxPendingRequests=function setMaxPendingRequests(num){maxPendingRequests=num};Transport.resetCache=function resetCache(){sharedCache.reset()};_.mixin(Transport.prototype,{_fingerprint:function fingerprint(o){o=o||{};return o.url+o.type+$.param(o.data||{})},_get:function(o,cb){var that=this,fingerprint,jqXhr;fingerprint=this._fingerprint(o);if(this.cancelled||fingerprint!==this.lastReq){return}if(jqXhr=pendingRequests[fingerprint]){jqXhr.done(done).fail(fail)}else if(pendingRequestsCount<maxPendingRequests){pendingRequestsCount++;pendingRequests[fingerprint]=this._send(o).done(done).fail(fail).always(always)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}function done(resp){cb(null,resp);that._cache.set(fingerprint,resp)}function fail(){cb(true)}function always(){pendingRequestsCount--;delete pendingRequests[fingerprint];if(that.onDeckRequestArgs){that._get.apply(that,that.onDeckRequestArgs);that.onDeckRequestArgs=null}}},get:function(o,cb){var resp,fingerprint;cb=cb||$.noop;o=_.isString(o)?{url:o}:o||{};fingerprint=this._fingerprint(o);this.cancelled=false;this.lastReq=fingerprint;if(resp=this._cache.get(fingerprint)){cb(null,resp)}else{this._get(o,cb)}},cancel:function(){this.cancelled=true}});return Transport}();var SearchIndex=window.SearchIndex=function(){"use strict";var CHILDREN="c",IDS="i";function SearchIndex(o){o=o||{};if(!o.datumTokenizer||!o.queryTokenizer){$.error("datumTokenizer and queryTokenizer are both required")}this.identify=o.identify||_.stringify;this.datumTokenizer=o.datumTokenizer;this.queryTokenizer=o.queryTokenizer;this.reset()}_.mixin(SearchIndex.prototype,{bootstrap:function bootstrap(o){this.datums=o.datums;this.trie=o.trie},add:function(data){var that=this;data=_.isArray(data)?data:[data];_.each(data,function(datum){var id,tokens;that.datums[id=that.identify(datum)]=datum;tokens=normalizeTokens(that.datumTokenizer(datum));_.each(tokens,function(token){var node,chars,ch;node=that.trie;chars=token.split("");while(ch=chars.shift()){node=node[CHILDREN][ch]||(node[CHILDREN][ch]=newNode());node[IDS].push(id)}})})},get:function get(ids){var that=this;return _.map(ids,function(id){return that.datums[id]})},search:function search(query){var that=this,tokens,matches;tokens=normalizeTokens(this.queryTokenizer(query));_.each(tokens,function(token){var node,chars,ch,ids;if(matches&&matches.length===0){return false}node=that.trie;chars=token.split("");while(node&&(ch=chars.shift())){node=node[CHILDREN][ch]}if(node&&chars.length===0){ids=node[IDS].slice(0);matches=matches?getIntersection(matches,ids):ids}else{matches=[];return false}});return matches?_.map(unique(matches),function(id){return that.datums[id]}):[]},all:function all(){var values=[];for(var key in this.datums){values.push(this.datums[key])}return values},reset:function reset(){this.datums={};this.trie=newNode()},serialize:function serialize(){return{datums:this.datums,trie:this.trie}}});return SearchIndex;function normalizeTokens(tokens){tokens=_.filter(tokens,function(token){return!!token});tokens=_.map(tokens,function(token){
return token.toLowerCase()});return tokens}function newNode(){var node={};node[IDS]=[];node[CHILDREN]={};return node}function unique(array){var seen={},uniques=[];for(var i=0,len=array.length;i<len;i++){if(!seen[array[i]]){seen[array[i]]=true;uniques.push(array[i])}}return uniques}function getIntersection(arrayA,arrayB){var ai=0,bi=0,intersection=[];arrayA=arrayA.sort();arrayB=arrayB.sort();var lenArrayA=arrayA.length,lenArrayB=arrayB.length;while(ai<lenArrayA&&bi<lenArrayB){if(arrayA[ai]<arrayB[bi]){ai++}else if(arrayA[ai]>arrayB[bi]){bi++}else{intersection.push(arrayA[ai]);ai++;bi++}}return intersection}}();var Prefetch=function(){"use strict";var keys;keys={data:"data",protocol:"protocol",thumbprint:"thumbprint"};function Prefetch(o){this.url=o.url;this.ttl=o.ttl;this.cache=o.cache;this.prepare=o.prepare;this.transform=o.transform;this.transport=o.transport;this.thumbprint=o.thumbprint;this.storage=new PersistentStorage(o.cacheKey)}_.mixin(Prefetch.prototype,{_settings:function settings(){return{url:this.url,type:"GET",dataType:"json"}},store:function store(data){if(!this.cache){return}this.storage.set(keys.data,data,this.ttl);this.storage.set(keys.protocol,location.protocol,this.ttl);this.storage.set(keys.thumbprint,this.thumbprint,this.ttl)},fromCache:function fromCache(){var stored={},isExpired;if(!this.cache){return null}stored.data=this.storage.get(keys.data);stored.protocol=this.storage.get(keys.protocol);stored.thumbprint=this.storage.get(keys.thumbprint);isExpired=stored.thumbprint!==this.thumbprint||stored.protocol!==location.protocol;return stored.data&&!isExpired?stored.data:null},fromNetwork:function(cb){var that=this,settings;if(!cb){return}settings=this.prepare(this._settings());this.transport(settings).fail(onError).done(onResponse);function onError(){cb(true)}function onResponse(resp){cb(null,that.transform(resp))}},clear:function clear(){this.storage.clear();return this}});return Prefetch}();var Remote=function(){"use strict";function Remote(o){this.url=o.url;this.prepare=o.prepare;this.transform=o.transform;this.transport=new Transport({cache:o.cache,limiter:o.limiter,transport:o.transport})}_.mixin(Remote.prototype,{_settings:function settings(){return{url:this.url,type:"GET",dataType:"json"}},get:function get(query,cb){var that=this,settings;if(!cb){return}query=query||"";settings=this.prepare(query,this._settings());return this.transport.get(settings,onResponse);function onResponse(err,resp){err?cb([]):cb(that.transform(resp))}},cancelLastRequest:function cancelLastRequest(){this.transport.cancel()}});return Remote}();var oParser=function(){"use strict";return function parse(o){var defaults,sorter;defaults={initialize:true,identify:_.stringify,datumTokenizer:null,queryTokenizer:null,sufficient:5,sorter:null,local:[],prefetch:null,remote:null};o=_.mixin(defaults,o||{});!o.datumTokenizer&&$.error("datumTokenizer is required");!o.queryTokenizer&&$.error("queryTokenizer is required");sorter=o.sorter;o.sorter=sorter?function(x){return x.sort(sorter)}:_.identity;o.local=_.isFunction(o.local)?o.local():o.local;o.prefetch=parsePrefetch(o.prefetch);o.remote=parseRemote(o.remote);return o};function parsePrefetch(o){var defaults;if(!o){return null}defaults={url:null,ttl:24*60*60*1e3,cache:true,cacheKey:null,thumbprint:"",prepare:_.identity,transform:_.identity,transport:null};o=_.isString(o)?{url:o}:o;o=_.mixin(defaults,o);!o.url&&$.error("prefetch requires url to be set");o.transform=o.filter||o.transform;o.cacheKey=o.cacheKey||o.url;o.thumbprint=VERSION+o.thumbprint;o.transport=o.transport?callbackToDeferred(o.transport):$.ajax;return o}function parseRemote(o){var defaults;if(!o){return}defaults={url:null,cache:true,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:_.identity,transport:null};o=_.isString(o)?{url:o}:o;o=_.mixin(defaults,o);!o.url&&$.error("remote requires url to be set");o.transform=o.filter||o.transform;o.prepare=toRemotePrepare(o);o.limiter=toLimiter(o);o.transport=o.transport?callbackToDeferred(o.transport):$.ajax;delete o.replace;delete o.wildcard;delete o.rateLimitBy;delete o.rateLimitWait;return o}function toRemotePrepare(o){var prepare,replace,wildcard;prepare=o.prepare;replace=o.replace;wildcard=o.wildcard;if(prepare){return prepare}if(replace){prepare=prepareByReplace}else if(o.wildcard){prepare=prepareByWildcard}else{prepare=idenityPrepare}return prepare;function prepareByReplace(query,settings){settings.url=replace(settings.url,query);return settings}function prepareByWildcard(query,settings){settings.url=settings.url.replace(wildcard,encodeURIComponent(query));return settings}function idenityPrepare(query,settings){return settings}}function toLimiter(o){var limiter,method,wait;limiter=o.limiter;method=o.rateLimitBy;wait=o.rateLimitWait;if(!limiter){limiter=/^throttle$/i.test(method)?throttle(wait):debounce(wait)}return limiter;function debounce(wait){return function debounce(fn){return _.debounce(fn,wait)}}function throttle(wait){return function throttle(fn){return _.throttle(fn,wait)}}}function callbackToDeferred(fn){return function wrapper(o){var deferred=$.Deferred();fn(o,onSuccess,onError);return deferred;function onSuccess(resp){_.defer(function(){deferred.resolve(resp)})}function onError(err){_.defer(function(){deferred.reject(err)})}}}}();var Bloodhound=function(){"use strict";var old;old=window&&window.Bloodhound;function Bloodhound(o){o=oParser(o);this.sorter=o.sorter;this.identify=o.identify;this.sufficient=o.sufficient;this.local=o.local;this.remote=o.remote?new Remote(o.remote):null;this.prefetch=o.prefetch?new Prefetch(o.prefetch):null;this.index=new SearchIndex({identify:this.identify,datumTokenizer:o.datumTokenizer,queryTokenizer:o.queryTokenizer});o.initialize!==false&&this.initialize()}Bloodhound.noConflict=function noConflict(){window&&(window.Bloodhound=old);return Bloodhound};Bloodhound.tokenizers=tokenizers;_.mixin(Bloodhound.prototype,{__ttAdapter:function ttAdapter(){var that=this;return this.remote?withAsync:withoutAsync;function withAsync(query,sync,async){return that.search(query,sync,async)}function withoutAsync(query,sync){return that.search(query,sync)}},_loadPrefetch:function loadPrefetch(){var that=this,deferred,serialized;deferred=$.Deferred();if(!this.prefetch){deferred.resolve()}else if(serialized=this.prefetch.fromCache()){this.index.bootstrap(serialized);deferred.resolve()}else{this.prefetch.fromNetwork(done)}return deferred.promise();function done(err,data){if(err){return deferred.reject()}that.add(data);that.prefetch.store(that.index.serialize());deferred.resolve()}},_initialize:function initialize(){var that=this,deferred;this.clear();(this.initPromise=this._loadPrefetch()).done(addLocalToIndex);return this.initPromise;function addLocalToIndex(){that.add(that.local)}},initialize:function initialize(force){return!this.initPromise||force?this._initialize():this.initPromise},add:function add(data){this.index.add(data);return this},get:function get(ids){ids=_.isArray(ids)?ids:[].slice.call(arguments);return this.index.get(ids)},search:function search(query,sync,async){var that=this,local;local=this.sorter(this.index.search(query));sync(this.remote?local.slice():local);if(this.remote&&local.length<this.sufficient){this.remote.get(query,processRemote)}else if(this.remote){this.remote.cancelLastRequest()}return this;function processRemote(remote){var nonDuplicates=[];_.each(remote,function(r){!_.some(local,function(l){return that.identify(r)===that.identify(l)})&&nonDuplicates.push(r)});async&&async(nonDuplicates)}},all:function all(){return this.index.all()},clear:function clear(){this.index.reset();return this},clearPrefetchCache:function clearPrefetchCache(){this.prefetch&&this.prefetch.clear();return this},clearRemoteCache:function clearRemoteCache(){Transport.resetCache();return this},ttAdapter:function ttAdapter(){return this.__ttAdapter()}});return Bloodhound}();return Bloodhound});(function(root,factory){if(typeof define==="function"&&define.amd){define("typeahead.js",["jquery"],function(a0){return factory(a0)})}else if(typeof exports==="object"){module.exports=factory(require("jquery"))}else{factory(jQuery)}})(this,function($){var _=function(){"use strict";return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:false},isBlankString:function(str){return!str||/^\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(obj){return typeof obj==="string"},isNumber:function(obj){return typeof obj==="number"},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return typeof obj==="undefined"},isElement:function(obj){return!!(obj&&obj.nodeType===1)},isJQuery:function(obj){return obj instanceof $},toStr:function toStr(s){return _.isUndefined(s)||s===null?"":s+""},bind:$.proxy,each:function(collection,cb){$.each(collection,reverseArgs);function reverseArgs(index,value){return cb(value,index)}},map:$.map,filter:$.grep,every:function(obj,test){var result=true;if(!obj){return result}$.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj))){return false}});return!!result},some:function(obj,test){var result=false;if(!obj){return result}$.each(obj,function(key,val){if(result=test.call(null,val,key,obj)){return false}});return!!result},mixin:$.extend,identity:function(x){return x},clone:function(obj){return $.extend(true,{},obj)},getIdGenerator:function(){var counter=0;return function(){return counter++}},templatify:function templatify(obj){return $.isFunction(obj)?obj:template;function template(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args)}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args)}return result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;previous=0;later=function(){previous=new Date;timeout=null;result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args)}else if(!timeout){timeout=setTimeout(later,remaining)}return result}},stringify:function(val){return _.isString(val)?val:JSON.stringify(val)},noop:function(){}}}();var WWW=function(){"use strict";var defaultClassNames={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return build;function build(o){var www,classes;classes=_.mixin({},defaultClassNames,o);www={css:buildCss(),classes:classes,html:buildHtml(classes),selectors:buildSelectors(classes)};return{css:www.css,html:www.html,classes:www.classes,selectors:www.selectors,mixin:function(o){_.mixin(o,www)}}}function buildHtml(c){return{wrapper:'<span class="'+c.wrapper+'"></span>',menu:'<div class="'+c.menu+'"></div>'}}function buildSelectors(classes){var selectors={};_.each(classes,function(v,k){selectors[k]="."+v});return selectors}function buildCss(){var css={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};if(_.isMsie()){_.mixin(css.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}return css}}();var EventBus=function(){"use strict";var namespace,deprecationMap;namespace="typeahead:";deprecationMap={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"};function EventBus(o){if(!o||!o.el){$.error("EventBus initialized without el")}this.$el=$(o.el)}_.mixin(EventBus.prototype,{_trigger:function(type,args){var $e;$e=$.Event(namespace+type);(args=args||[]).unshift($e);this.$el.trigger.apply(this.$el,args);return $e},before:function(type){var args,$e;args=[].slice.call(arguments,1);$e=this._trigger("before"+type,args);return $e.isDefaultPrevented()},trigger:function(type){var deprecatedType;this._trigger(type,[].slice.call(arguments,1));if(deprecatedType=deprecationMap[type]){this._trigger(deprecatedType,[].slice.call(arguments,1))}}});return EventBus}();var EventEmitter=function(){"use strict";var splitter=/\s+/,nextTick=getNextTick();return{onSync:onSync,onAsync:onAsync,off:off,trigger:trigger};function on(method,types,cb,context){var type;if(!cb){return this}types=types.split(splitter);cb=context?bindContext(cb,context):cb;this._callbacks=this._callbacks||{};while(type=types.shift()){this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]};this._callbacks[type][method].push(cb)}return this}function onAsync(types,cb,context){return on.call(this,"async",types,cb,context)}function onSync(types,cb,context){return on.call(this,"sync",types,cb,context)}function off(types){var type;if(!this._callbacks){return this}types=types.split(splitter);while(type=types.shift()){delete this._callbacks[type]}return this}function trigger(types){var type,callbacks,args,syncFlush,asyncFlush;if(!this._callbacks){return this}types=types.split(splitter);args=[].slice.call(arguments,1);while((type=types.shift())&&(callbacks=this._callbacks[type])){syncFlush=getFlush(callbacks.sync,this,[type].concat(args));asyncFlush=getFlush(callbacks.async,this,[type].concat(args));syncFlush()&&nextTick(asyncFlush)}return this}function getFlush(callbacks,context,args){return flush;function flush(){var cancelled;for(var i=0,len=callbacks.length;!cancelled&&i<len;i+=1){cancelled=callbacks[i].apply(context,args)===false}return!cancelled}}function getNextTick(){var nextTickFn;if(window.setImmediate){nextTickFn=function nextTickSetImmediate(fn){setImmediate(function(){fn()})}}else{nextTickFn=function nextTickSetTimeout(fn){setTimeout(function(){fn()},0)}}return nextTickFn}function bindContext(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}}();var highlight=function(doc){"use strict";var defaults={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:false,caseSensitive:false};return function hightlight(o){var regex;o=_.mixin({},defaults,o);if(!o.node||!o.pattern){return}o.pattern=_.isArray(o.pattern)?o.pattern:[o.pattern];regex=getRegex(o.pattern,o.caseSensitive,o.wordsOnly);traverse(o.node,hightlightTextNode);function hightlightTextNode(textNode){var match,patternNode,wrapperNode;if(match=regex.exec(textNode.data)){wrapperNode=doc.createElement(o.tagName);o.className&&(wrapperNode.className=o.className);patternNode=textNode.splitText(match.index);patternNode.splitText(match[0].length);wrapperNode.appendChild(patternNode.cloneNode(true));textNode.parentNode.replaceChild(wrapperNode,patternNode)}return!!match}function traverse(el,hightlightTextNode){var childNode,TEXT_NODE_TYPE=3;for(var i=0;i<el.childNodes.length;i++){childNode=el.childNodes[i];if(childNode.nodeType===TEXT_NODE_TYPE){i+=hightlightTextNode(childNode)?1:0}else{traverse(childNode,hightlightTextNode)}}}};function getRegex(patterns,caseSensitive,wordsOnly){var escapedPatterns=[],regexStr;for(var i=0,len=patterns.length;i<len;i++){escapedPatterns.push(_.escapeRegExChars(patterns[i]))}regexStr=wordsOnly?"\\b("+escapedPatterns.join("|")+")\\b":"("+escapedPatterns.join("|")+")";return caseSensitive?new RegExp(regexStr):new RegExp(regexStr,"i")}}(window.document);var Input=function(){"use strict";var specialKeyCodeMap;specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};function Input(o,www){o=o||{};if(!o.input){$.error("input is missing")}www.mixin(this);this.$hint=$(o.hint);this.$input=$(o.input);this.query=this.$input.val();this.queryWhenFocused=this.hasFocus()?this.query:null;this.$overflowHelper=buildOverflowHelper(this.$input);this._checkLanguageDirection();if(this.$hint.length===0){this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop}}Input.normalizeQuery=function(str){return _.toStr(str).replace(/^\s*/g,"").replace(/\s{2,}/g," ")};_.mixin(Input.prototype,EventEmitter,{_onBlur:function onBlur(){this.resetInputValue();this.trigger("blurred")},_onFocus:function onFocus(){this.queryWhenFocused=this.query;this.trigger("focused")},_onKeydown:function onKeydown($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e);if(keyName&&this._shouldTrigger(keyName,$e)){this.trigger(keyName+"Keyed",$e)}},_onInput:function onInput(){this._setQuery(this.getInputValue());this.clearHintIfInvalid();this._checkLanguageDirection()},_managePreventDefault:function managePreventDefault(keyName,$e){var preventDefault;switch(keyName){case"up":case"down":preventDefault=!withModifier($e);break;default:preventDefault=false}preventDefault&&$e.preventDefault()},_shouldTrigger:function shouldTrigger(keyName,$e){var trigger;switch(keyName){case"tab":trigger=!withModifier($e);break;default:trigger=true}return trigger},_checkLanguageDirection:function checkLanguageDirection(){var dir=(this.$input.css("direction")||"ltr").toLowerCase();if(this.dir!==dir){this.dir=dir;this.$hint.attr("dir",dir);this.trigger("langDirChanged",dir)}},_setQuery:function setQuery(val,silent){var areEquivalent,hasDifferentWhitespace;areEquivalent=areQueriesEquivalent(val,this.query);hasDifferentWhitespace=areEquivalent?this.query.length!==val.length:false;this.query=val;if(!silent&&!areEquivalent){this.trigger("queryChanged",this.query)}else if(!silent&&hasDifferentWhitespace){this.trigger("whitespaceChanged",this.query)}},bind:function(){var that=this,onBlur,onFocus,onKeydown,onInput;onBlur=_.bind(this._onBlur,this);onFocus=_.bind(this._onFocus,this);onKeydown=_.bind(this._onKeydown,this);onInput=_.bind(this._onInput,this);this.$input.on("blur.tt",onBlur).on("focus.tt",onFocus).on("keydown.tt",onKeydown);if(!_.isMsie()||_.isMsie()>9){this.$input.on("input.tt",onInput)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function($e){if(specialKeyCodeMap[$e.which||$e.keyCode]){return}_.defer(_.bind(that._onInput,that,$e))})}return this},focus:function focus(){this.$input.focus()},blur:function blur(){this.$input.blur()},getLangDir:function getLangDir(){return this.dir},getQuery:function getQuery(){return this.query||""},setQuery:function setQuery(val,silent){this.setInputValue(val);this._setQuery(val,silent)},hasQueryChangedSinceLastFocus:function hasQueryChangedSinceLastFocus(){return this.query!==this.queryWhenFocused},getInputValue:function getInputValue(){return this.$input.val()},setInputValue:function setInputValue(value){this.$input.val(value);this.clearHintIfInvalid();this._checkLanguageDirection()},resetInputValue:function resetInputValue(){this.setInputValue(this.query)},getHint:function getHint(){return this.$hint.val()},setHint:function setHint(value){this.$hint.val(value)},clearHint:function clearHint(){this.setHint("")},clearHintIfInvalid:function clearHintIfInvalid(){var val,hint,valIsPrefixOfHint,isValid;val=this.getInputValue();hint=this.getHint();valIsPrefixOfHint=val!==hint&&hint.indexOf(val)===0;isValid=val!==""&&valIsPrefixOfHint&&!this.hasOverflow();!isValid&&this.clearHint()},hasFocus:function hasFocus(){return this.$input.is(":focus")},hasOverflow:function hasOverflow(){var constraint=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength,selectionStart,range;valueLength=this.$input.val().length;selectionStart=this.$input[0].selectionStart;if(_.isNumber(selectionStart)){return selectionStart===valueLength}else if(document.selection){range=document.selection.createRange();range.moveStart("character",-valueLength);return valueLength===range.text.length}return true},destroy:function destroy(){this.$hint.off(".tt");this.$input.off(".tt");this.$overflowHelper.remove();this.$hint=this.$input=this.$overflowHelper=$("<div>")}});return Input;function buildOverflowHelper($input){return $('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:$input.css("font-family"),fontSize:$input.css("font-size"),fontStyle:$input.css("font-style"),fontVariant:$input.css("font-variant"),fontWeight:$input.css("font-weight"),wordSpacing:$input.css("word-spacing"),letterSpacing:$input.css("letter-spacing"),textIndent:$input.css("text-indent"),textRendering:$input.css("text-rendering"),textTransform:$input.css("text-transform")}).insertAfter($input)}function areQueriesEquivalent(a,b){return Input.normalizeQuery(a)===Input.normalizeQuery(b)}function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}}();var Dataset=function(){"use strict";var keys,nameGenerator;keys={val:"tt-selectable-display",obj:"tt-selectable-object"};nameGenerator=_.getIdGenerator();function Dataset(o,www){o=o||{};o.templates=o.templates||{};o.templates.notFound=o.templates.notFound||o.templates.empty;if(!o.source){$.error("missing source")}if(!o.node){$.error("missing node")}if(o.name&&!isValidName(o.name)){$.error("invalid dataset name: "+o.name)}www.mixin(this);this.highlight=!!o.highlight;this.name=o.name||nameGenerator();this.limit=o.limit||5;this.displayFn=getDisplayFn(o.display||o.displayKey);this.templates=getTemplates(o.templates,this.displayFn);this.source=o.source.__ttAdapter?o.source.__ttAdapter():o.source;this.async=_.isUndefined(o.async)?this.source.length>2:!!o.async;this._resetLastSuggestion();this.$el=$(o.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}Dataset.extractData=function extractData(el){var $el=$(el);if($el.data(keys.obj)){return{val:$el.data(keys.val)||"",obj:$el.data(keys.obj)||null}}return null};_.mixin(Dataset.prototype,EventEmitter,{_overwrite:function overwrite(query,suggestions){suggestions=suggestions||[];if(suggestions.length){this._renderSuggestions(query,suggestions)}else if(this.async&&this.templates.pending){this._renderPending(query)}else if(!this.async&&this.templates.notFound){this._renderNotFound(query)}else{this._empty()}this.trigger("rendered",this.name,suggestions,false)},_append:function append(query,suggestions){suggestions=suggestions||[];if(suggestions.length&&this.$lastSuggestion.length){this._appendSuggestions(query,suggestions)}else if(suggestions.length){this._renderSuggestions(query,suggestions)}else if(!this.$lastSuggestion.length&&this.templates.notFound){this._renderNotFound(query)}this.trigger("rendered",this.name,suggestions,true)},_renderSuggestions:function renderSuggestions(query,suggestions){var $fragment;$fragment=this._getSuggestionsFragment(query,suggestions);this.$lastSuggestion=$fragment.children().last();this.$el.html($fragment).prepend(this._getHeader(query,suggestions)).append(this._getFooter(query,suggestions))},_appendSuggestions:function appendSuggestions(query,suggestions){var $fragment,$lastSuggestion;$fragment=this._getSuggestionsFragment(query,suggestions);$lastSuggestion=$fragment.children().last();this.$lastSuggestion.after($fragment);this.$lastSuggestion=$lastSuggestion},_renderPending:function renderPending(query){var template=this.templates.pending;this._resetLastSuggestion();template&&this.$el.html(template({query:query,dataset:this.name}))},_renderNotFound:function renderNotFound(query){var template=this.templates.notFound;this._resetLastSuggestion();template&&this.$el.html(template({query:query,dataset:this.name}))},_empty:function empty(){this.$el.empty();this._resetLastSuggestion()},_getSuggestionsFragment:function getSuggestionsFragment(query,suggestions){var that=this,fragment;fragment=document.createDocumentFragment();_.each(suggestions,function getSuggestionNode(suggestion){var $el,context;context=that._injectQuery(query,suggestion);$el=$(that.templates.suggestion(context)).data(keys.obj,suggestion).data(keys.val,that.displayFn(suggestion)).addClass(that.classes.suggestion+" "+that.classes.selectable);fragment.appendChild($el[0])});this.highlight&&highlight({className:this.classes.highlight,node:fragment,pattern:query});return $(fragment)},_getFooter:function getFooter(query,suggestions){return this.templates.footer?this.templates.footer({query:query,suggestions:suggestions,dataset:this.name}):null},_getHeader:function getHeader(query,suggestions){return this.templates.header?this.templates.header({query:query,suggestions:suggestions,dataset:this.name}):null},_resetLastSuggestion:function resetLastSuggestion(){this.$lastSuggestion=$()},_injectQuery:function injectQuery(query,obj){return _.isObject(obj)?_.mixin({_query:query},obj):obj},update:function update(query){var that=this,canceled=false,syncCalled=false,rendered=0;this.cancel();this.cancel=function cancel(){canceled=true;that.cancel=$.noop;that.async&&that.trigger("asyncCanceled",query)};this.source(query,sync,async);!syncCalled&&sync([]);function sync(suggestions){if(syncCalled){return}syncCalled=true;suggestions=(suggestions||[]).slice(0,that.limit);rendered=suggestions.length;that._overwrite(query,suggestions);if(rendered<that.limit&&that.async){that.trigger("asyncRequested",query)}}function async(suggestions){suggestions=suggestions||[];if(!canceled&&rendered<that.limit){that.cancel=$.noop;rendered+=suggestions.length;that._append(query,suggestions.slice(0,that.limit-rendered));that.async&&that.trigger("asyncReceived",query)}}},cancel:$.noop,clear:function clear(){this._empty();this.cancel();this.trigger("cleared")},isEmpty:function isEmpty(){return this.$el.is(":empty")},destroy:function destroy(){this.$el=$("<div>")}});return Dataset;function getDisplayFn(display){display=display||_.stringify;return _.isFunction(display)?display:displayFn;function displayFn(obj){return obj[display]}}function getTemplates(templates,displayFn){return{notFound:templates.notFound&&_.templatify(templates.notFound),pending:templates.pending&&_.templatify(templates.pending),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||suggestionTemplate};function suggestionTemplate(context){return $("<div>").text(displayFn(context))}}function isValidName(str){return/^[_a-zA-Z0-9-]+$/.test(str)}}();var Menu=function(){"use strict";function Menu(o,www){var that=this;o=o||{};if(!o.node){$.error("node is required")}www.mixin(this);this.$node=$(o.node);this.query=null;this.datasets=_.map(o.datasets,initializeDataset);function initializeDataset(oDataset){var node=that.$node.find(oDataset.node).first();oDataset.node=node.length?node:$("<div>").appendTo(that.$node);return new Dataset(oDataset,www)}}_.mixin(Menu.prototype,EventEmitter,{_onSelectableClick:function onSelectableClick($e){this.trigger("selectableClicked",$($e.currentTarget))},_onRendered:function onRendered(type,dataset,suggestions,async){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetRendered",dataset,suggestions,async)},_onCleared:function onCleared(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty());this.trigger("datasetCleared")},_propagate:function propagate(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function allDatasetsEmpty(){return _.every(this.datasets,isDatasetEmpty);function isDatasetEmpty(dataset){return dataset.isEmpty()}},_getSelectables:function getSelectables(){return this.$node.find(this.selectors.selectable)},_removeCursor:function _removeCursor(){var $selectable=this.getActiveSelectable();$selectable&&$selectable.removeClass(this.classes.cursor)},_ensureVisible:function ensureVisible($el){var elTop,elBottom,nodeScrollTop,nodeHeight;elTop=$el.position().top;elBottom=elTop+$el.outerHeight(true);nodeScrollTop=this.$node.scrollTop();nodeHeight=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10);if(elTop<0){this.$node.scrollTop(nodeScrollTop+elTop)}else if(nodeHeight<elBottom){this.$node.scrollTop(nodeScrollTop+(elBottom-nodeHeight))}},bind:function(){var that=this,onSelectableClick;onSelectableClick=_.bind(this._onSelectableClick,this);this.$node.on("click.tt",this.selectors.selectable,onSelectableClick);_.each(this.datasets,function(dataset){dataset.onSync("asyncRequested",that._propagate,that).onSync("asyncCanceled",that._propagate,that).onSync("asyncReceived",that._propagate,that).onSync("rendered",that._onRendered,that).onSync("cleared",that._onCleared,that)});return this},isOpen:function isOpen(){return this.$node.hasClass(this.classes.open)},open:function open(){this.$node.addClass(this.classes.open)},close:function close(){this.$node.removeClass(this.classes.open);this._removeCursor()},setLanguageDirection:function setLanguageDirection(dir){this.$node.attr("dir",dir)},selectableRelativeToCursor:function selectableRelativeToCursor(delta){var $selectables,$oldCursor,oldIndex,newIndex;$oldCursor=this.getActiveSelectable();$selectables=this._getSelectables();oldIndex=$oldCursor?$selectables.index($oldCursor):-1;newIndex=oldIndex+delta;newIndex=(newIndex+1)%($selectables.length+1)-1;newIndex=newIndex<-1?$selectables.length-1:newIndex;return newIndex===-1?null:$selectables.eq(newIndex)},setCursor:function setCursor($selectable){this._removeCursor();if($selectable=$selectable&&$selectable.first()){$selectable.addClass(this.classes.cursor);this._ensureVisible($selectable)}},getSelectableData:function getSelectableData($el){return $el&&$el.length?Dataset.extractData($el):null},getActiveSelectable:function getActiveSelectable(){var $selectable=this._getSelectables().filter(this.selectors.cursor).first();return $selectable.length?$selectable:null},getTopSelectable:function getTopSelectable(){var $selectable=this._getSelectables().first();return $selectable.length?$selectable:null},update:function update(query){var isValidUpdate=query!==this.query;if(isValidUpdate){this.query=query;_.each(this.datasets,updateDataset)}return isValidUpdate;function updateDataset(dataset){dataset.update(query)}},empty:function empty(){_.each(this.datasets,clearDataset);this.query=null;this.$node.addClass(this.classes.empty);function clearDataset(dataset){dataset.clear()}},destroy:function destroy(){this.$node.off(".tt");this.$node=$("<div>");_.each(this.datasets,destroyDataset);function destroyDataset(dataset){dataset.destroy()}}});return Menu}();var DefaultMenu=function(){"use strict";var s=Menu.prototype;function DefaultMenu(){Menu.apply(this,[].slice.call(arguments,0))}_.mixin(DefaultMenu.prototype,Menu.prototype,{open:function open(){!this._allDatasetsEmpty()&&this._show();return s.open.apply(this,[].slice.call(arguments,0))},close:function close(){this._hide();return s.close.apply(this,[].slice.call(arguments,0))},_onRendered:function onRendered(){if(this._allDatasetsEmpty()){this._hide()}else{this.isOpen()&&this._show()}return s._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function onCleared(){if(this._allDatasetsEmpty()){this._hide()}else{this.isOpen()&&this._show()}return s._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function setLanguageDirection(dir){this.$node.css(dir==="ltr"?this.css.ltr:this.css.rtl);return s.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function hide(){this.$node.hide()},_show:function show(){this.$node.css("display","block")}});return DefaultMenu}();var Typeahead=function(){"use strict";function Typeahead(o,www){var onFocused,onBlurred,onEnterKeyed,onTabKeyed,onEscKeyed,onUpKeyed,onDownKeyed,onLeftKeyed,onRightKeyed,onQueryChanged,onWhitespaceChanged;

o=o||{};if(!o.input){$.error("missing input")}if(!o.menu){$.error("missing menu")}if(!o.eventBus){$.error("missing event bus")}www.mixin(this);this.eventBus=o.eventBus;this.minLength=_.isNumber(o.minLength)?o.minLength:1;this.input=o.input;this.menu=o.menu;this.enabled=true;this.active=false;this.input.hasFocus()&&this.activate();this.dir=this.input.getLangDir();this._hacks();this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this);onFocused=c(this,"activate","open","_onFocused");onBlurred=c(this,"deactivate","_onBlurred");onEnterKeyed=c(this,"isActive","isOpen","_onEnterKeyed");onTabKeyed=c(this,"isActive","isOpen","_onTabKeyed");onEscKeyed=c(this,"isActive","_onEscKeyed");onUpKeyed=c(this,"isActive","open","_onUpKeyed");onDownKeyed=c(this,"isActive","open","_onDownKeyed");onLeftKeyed=c(this,"isActive","isOpen","_onLeftKeyed");onRightKeyed=c(this,"isActive","isOpen","_onRightKeyed");onQueryChanged=c(this,"_openIfActive","_onQueryChanged");onWhitespaceChanged=c(this,"_openIfActive","_onWhitespaceChanged");this.input.bind().onSync("focused",onFocused,this).onSync("blurred",onBlurred,this).onSync("enterKeyed",onEnterKeyed,this).onSync("tabKeyed",onTabKeyed,this).onSync("escKeyed",onEscKeyed,this).onSync("upKeyed",onUpKeyed,this).onSync("downKeyed",onDownKeyed,this).onSync("leftKeyed",onLeftKeyed,this).onSync("rightKeyed",onRightKeyed,this).onSync("queryChanged",onQueryChanged,this).onSync("whitespaceChanged",onWhitespaceChanged,this).onSync("langDirChanged",this._onLangDirChanged,this)}_.mixin(Typeahead.prototype,{_hacks:function hacks(){var $input,$menu;$input=this.input.$input||$("<div>");$menu=this.menu.$node||$("<div>");$input.on("blur.tt",function($e){var active,isActive,hasActive;active=document.activeElement;isActive=$menu.is(active);hasActive=$menu.has(active).length>0;if(_.isMsie()&&(isActive||hasActive)){$e.preventDefault();$e.stopImmediatePropagation();_.defer(function(){$input.focus()})}});$menu.on("mousedown.tt",function($e){$e.preventDefault()})},_onSelectableClicked:function onSelectableClicked(type,$el){this.select($el)},_onDatasetCleared:function onDatasetCleared(){this._updateHint()},_onDatasetRendered:function onDatasetRendered(type,dataset,suggestions,async){this._updateHint();this.eventBus.trigger("render",suggestions,async,dataset)},_onAsyncRequested:function onAsyncRequested(type,dataset,query){this.eventBus.trigger("asyncrequest",query,dataset)},_onAsyncCanceled:function onAsyncCanceled(type,dataset,query){this.eventBus.trigger("asynccancel",query,dataset)},_onAsyncReceived:function onAsyncReceived(type,dataset,query){this.eventBus.trigger("asyncreceive",query,dataset)},_onFocused:function onFocused(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function onBlurred(){if(this.input.hasQueryChangedSinceLastFocus()){this.eventBus.trigger("change",this.input.getQuery())}},_onEnterKeyed:function onEnterKeyed(type,$e){var $selectable;if($selectable=this.menu.getActiveSelectable()){this.select($selectable)&&$e.preventDefault()}},_onTabKeyed:function onTabKeyed(type,$e){var $selectable;if($selectable=this.menu.getActiveSelectable()){this.select($selectable)&&$e.preventDefault()}else if($selectable=this.menu.getTopSelectable()){this.autocomplete($selectable)&&$e.preventDefault()}},_onEscKeyed:function onEscKeyed(){this.close()},_onUpKeyed:function onUpKeyed(){this.moveCursor(-1)},_onDownKeyed:function onDownKeyed(){this.moveCursor(+1)},_onLeftKeyed:function onLeftKeyed(){if(this.dir==="rtl"&&this.input.isCursorAtEnd()){this.autocomplete(this.menu.getTopSelectable())}},_onRightKeyed:function onRightKeyed(){if(this.dir==="ltr"&&this.input.isCursorAtEnd()){this.autocomplete(this.menu.getTopSelectable())}},_onQueryChanged:function onQueryChanged(e,query){this._minLengthMet(query)?this.menu.update(query):this.menu.empty()},_onWhitespaceChanged:function onWhitespaceChanged(){this._updateHint()},_onLangDirChanged:function onLangDirChanged(e,dir){if(this.dir!==dir){this.dir=dir;this.menu.setLanguageDirection(dir)}},_openIfActive:function openIfActive(){this.isActive()&&this.open()},_minLengthMet:function minLengthMet(query){query=_.isString(query)?query:this.input.getQuery()||"";return query.length>=this.minLength},_updateHint:function updateHint(){var $selectable,data,val,query,escapedQuery,frontMatchRegEx,match;$selectable=this.menu.getTopSelectable();data=this.menu.getSelectableData($selectable);val=this.input.getInputValue();if(data&&!_.isBlankString(val)&&!this.input.hasOverflow()){query=Input.normalizeQuery(val);escapedQuery=_.escapeRegExChars(query);frontMatchRegEx=new RegExp("^(?:"+escapedQuery+")(.+$)","i");match=frontMatchRegEx.exec(data.val);match&&this.input.setHint(val+match[1])}else{this.input.clearHint()}},isEnabled:function isEnabled(){return this.enabled},enable:function enable(){this.enabled=true},disable:function disable(){this.enabled=false},isActive:function isActive(){return this.active},activate:function activate(){if(this.isActive()){return true}else if(!this.isEnabled()||this.eventBus.before("active")){return false}else{this.active=true;this.eventBus.trigger("active");return true}},deactivate:function deactivate(){if(!this.isActive()){return true}else if(this.eventBus.before("idle")){return false}else{this.active=false;this.close();this.eventBus.trigger("idle");return true}},isOpen:function isOpen(){return this.menu.isOpen()},open:function open(){if(!this.isOpen()&&!this.eventBus.before("open")){this.menu.open();this._updateHint();this.eventBus.trigger("open")}return this.isOpen()},close:function close(){if(this.isOpen()&&!this.eventBus.before("close")){this.menu.close();this.input.clearHint();this.input.resetInputValue();this.eventBus.trigger("close")}return!this.isOpen()},setVal:function setVal(val){this.input.setQuery(_.toStr(val))},getVal:function getVal(){return this.input.getQuery()},select:function select($selectable){var data=this.menu.getSelectableData($selectable);if(data&&!this.eventBus.before("select",data.obj)){this.input.setQuery(data.val,true);this.eventBus.trigger("select",data.obj);this.close();return true}return false},autocomplete:function autocomplete($selectable){var query,data,isValid;query=this.input.getQuery();data=this.menu.getSelectableData($selectable);isValid=data&&query!==data.val;if(isValid&&!this.eventBus.before("autocomplete",data.obj)){this.input.setQuery(data.val);this.eventBus.trigger("autocomplete",data.obj);return true}return false},moveCursor:function moveCursor(delta){var query,$candidate,data,payload,cancelMove;query=this.input.getQuery();$candidate=this.menu.selectableRelativeToCursor(delta);data=this.menu.getSelectableData($candidate);payload=data?data.obj:null;cancelMove=this._minLengthMet()&&this.menu.update(query);if(!cancelMove&&!this.eventBus.before("cursorchange",payload)){this.menu.setCursor($candidate);if(data){this.input.setInputValue(data.val)}else{this.input.resetInputValue();this._updateHint()}this.eventBus.trigger("cursorchange",payload);return true}return false},destroy:function destroy(){this.input.destroy();this.menu.destroy()}});return Typeahead;function c(ctx){var methods=[].slice.call(arguments,1);return function(){var args=[].slice.call(arguments);_.each(methods,function(method){return ctx[method].apply(ctx,args)})}}}();(function(){"use strict";var old,keys,methods;old=$.fn.typeahead;keys={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"};methods={initialize:function initialize(o,datasets){var www;datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,1);o=o||{};www=WWW(o.classNames);return this.each(attach);function attach(){var $input,$wrapper,$hint,$menu,defaultHint,defaultMenu,eventBus,input,menu,typeahead,MenuConstructor;_.each(datasets,function(d){d.highlight=!!o.highlight});$input=$(this);$wrapper=$(www.html.wrapper);$hint=$elOrNull(o.hint);$menu=$elOrNull(o.menu);defaultHint=o.hint!==false&&!$hint;defaultMenu=o.menu!==false&&!$menu;defaultHint&&($hint=buildHintFromInput($input,www));defaultMenu&&($menu=$(www.html.menu).css(www.css.menu));$hint&&$hint.val("");$input=prepInput($input,www);if(defaultHint||defaultMenu){$wrapper.css(www.css.wrapper);$input.css(defaultHint?www.css.input:www.css.inputWithNoHint);$input.wrap($wrapper).parent().prepend(defaultHint?$hint:null).append(defaultMenu?$menu:null)}MenuConstructor=defaultMenu?DefaultMenu:Menu;eventBus=new EventBus({el:$input});input=new Input({hint:$hint,input:$input},www);menu=new MenuConstructor({node:$menu,datasets:datasets},www);typeahead=new Typeahead({input:input,menu:menu,eventBus:eventBus,minLength:o.minLength},www);$input.data(keys.www,www);$input.data(keys.typeahead,typeahead)}},isEnabled:function isEnabled(){var enabled;ttEach(this.first(),function(t){enabled=t.isEnabled()});return enabled},enable:function enable(){ttEach(this,function(t){t.enable()});return this},disable:function disable(){ttEach(this,function(t){t.disable()});return this},isActive:function isActive(){var active;ttEach(this.first(),function(t){active=t.isActive()});return active},activate:function activate(){ttEach(this,function(t){t.activate()});return this},deactivate:function deactivate(){ttEach(this,function(t){t.deactivate()});return this},isOpen:function isOpen(){var open;ttEach(this.first(),function(t){open=t.isOpen()});return open},open:function open(){ttEach(this,function(t){t.open()});return this},close:function close(){ttEach(this,function(t){t.close()});return this},select:function select(el){var success=false,$el=$(el);ttEach(this.first(),function(t){success=t.select($el)});return success},autocomplete:function autocomplete(el){var success=false,$el=$(el);ttEach(this.first(),function(t){success=t.autocomplete($el)});return success},moveCursor:function moveCursoe(delta){var success=false;ttEach(this.first(),function(t){success=t.moveCursor(delta)});return success},val:function val(newVal){var query;if(!arguments.length){ttEach(this.first(),function(t){query=t.getVal()});return query}else{ttEach(this,function(t){t.setVal(newVal)});return this}},destroy:function destroy(){ttEach(this,function(typeahead,$input){revert($input);typeahead.destroy()});return this}};$.fn.typeahead=function(method){if(methods[method]){return methods[method].apply(this,[].slice.call(arguments,1))}else{return methods.initialize.apply(this,arguments)}};$.fn.typeahead.noConflict=function noConflict(){$.fn.typeahead=old;return this};function ttEach($els,fn){$els.each(function(){var $input=$(this),typeahead;(typeahead=$input.data(keys.typeahead))&&fn(typeahead,$input)})}function buildHintFromInput($input,www){return $input.clone().addClass(www.classes.hint).removeData().css(www.css.hint).css(getBackgroundStyles($input)).prop("readonly",true).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}function prepInput($input,www){$input.data(keys.attrs,{dir:$input.attr("dir"),autocomplete:$input.attr("autocomplete"),spellcheck:$input.attr("spellcheck"),style:$input.attr("style")});$input.addClass(www.classes.input).attr({autocomplete:"off",spellcheck:false});try{!$input.attr("dir")&&$input.attr("dir","auto")}catch(e){}return $input}function getBackgroundStyles($el){return{backgroundAttachment:$el.css("background-attachment"),backgroundClip:$el.css("background-clip"),backgroundColor:$el.css("background-color"),backgroundImage:$el.css("background-image"),backgroundOrigin:$el.css("background-origin"),backgroundPosition:$el.css("background-position"),backgroundRepeat:$el.css("background-repeat"),backgroundSize:$el.css("background-size")}}function revert($input){var www,$wrapper;www=$input.data(keys.www);$wrapper=$input.parent().filter(www.selectors.wrapper);_.each($input.data(keys.attrs),function(val,key){_.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)});$input.removeData(keys.typeahead).removeData(keys.www).removeData(keys.attr).removeClass(www.classes.input);if($wrapper.length){$input.detach().insertAfter($wrapper);$wrapper.remove()}}function $elOrNull(obj){var isValid,$el;isValid=_.isJQuery(obj)||_.isElement(obj);$el=isValid?$(obj).first():[];return $el.length?$el:null}})()})},{jquery:34}],126:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];

var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}]},{},[19]);